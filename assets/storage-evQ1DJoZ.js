var i=Object.defineProperty;var n=(a,e,t)=>e in a?i(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var o=(a,e,t)=>n(a,typeof e!="symbol"?e+"":e,t);class l{constructor(){o(this,"isChrome");o(this,"isPWA");o(this,"retryAttempts",3);o(this,"retryDelay",50);this.isChrome=navigator.userAgent.includes("Chrome")&&!navigator.userAgent.includes("Edg"),this.isPWA=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://")}async getItem(e){for(let t=0;t<this.retryAttempts;t++)try{const r=localStorage.getItem(e);return r===""?null:r}catch(r){if(console.warn(`Chrome localStorage getItem attempt ${t+1} failed:`,r),t<this.retryAttempts-1)await this.delay(this.retryDelay);else throw r}return null}async setItem(e,t){for(let r=0;r<this.retryAttempts;r++)try{if(localStorage.setItem(e,t),this.isChrome&&this.isPWA&&localStorage.getItem(e)!==t)throw new Error("Chrome PWA localStorage write verification failed");return}catch(s){if(console.warn(`Chrome localStorage setItem attempt ${r+1} failed:`,s),r<this.retryAttempts-1)await this.delay(this.retryDelay);else throw s}}async removeItem(e){try{localStorage.removeItem(e)}catch(t){throw console.warn("Chrome localStorage removeItem failed:",t),t}}async getJSON(e){try{const t=await this.getItem(e);if(!t)return null;const r=typeof t=="string"?t:String(t);return JSON.parse(r)}catch(t){return console.error(`Chrome localStorage JSON parse failed for key ${e}:`,t),null}}async setJSON(e,t){try{const r=JSON.stringify(t);await this.setItem(e,r)}catch(r){throw console.error(`Chrome localStorage JSON stringify/set failed for key ${e}:`,r),r}}delay(e){return new Promise(t=>setTimeout(t,e))}isAvailable(){try{const e="__chrome_storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}getDebugInfo(){return{isChrome:this.isChrome,isPWA:this.isPWA,userAgent:navigator.userAgent,displayMode:window.matchMedia("(display-mode: standalone)").matches,standalone:window.navigator.standalone,storageAvailable:this.isAvailable(),referrer:document.referrer}}}const c=new l,h=c;export{c as chromeSafeStorage,h as safeStorage};
