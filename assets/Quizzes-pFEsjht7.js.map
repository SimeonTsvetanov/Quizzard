{"version":3,"mappings":"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","names":["EXPORT_OPTIONS","GoogleSlidesIcon","JSONIcon","ExportFormatDialog","open","quiz","onClose","onExport","handleExport","format","jsxs","Dialog","DialogTitle","jsx","DialogContent","Box","Typography","List","option","ListItem","ListItemButton","ListItemIcon","ListItemText","DialogActions","Button","QuizCard","onMenuOpen","onPreview","onEdit","exportDialogOpen","setExportDialogOpen","React","handlePreview","handleExportClick","handleExportFormat","handleEdit","handleMenuOpen","event","totalQuestions","_a","r","Grid","Zoom","Card","CardContent","IconButton","MoreVertIcon","ScheduleIcon","CategoryIcon","QuizIcon","CardActions","Stack","PlayIcon","EditIcon","DownloadIcon","LoadingSkeleton","Fragment","item","Skeleton","EmptyState","onCreateQuiz","SchoolIcon","AddIcon","QuizGrid","quizzes","isLoading","renderQuizCards","WIZARD_STEPS","useWizardNavigation","validateCurrentStep","currentStep","setCurrentStep","useState","steps","useMemo","step","index","isCompleted","isCurrentAndValid","canProceed","nextStep","useCallback","previousStep","goToStep","stepIndex","resetNavigation","QUIZ_CONSTANTS","useWizardValidation","context","draftQuiz","validateBasicInfo","errors","warnings","_b","validateQuestions","round","rIdx","roundNum","question","qIdx","questionNum","questionRef","answer","possibleAnswersLength","_c","opt","validateReview","sum","validateStep","validateSpecificStep","validateAllSteps","allErrors","allWarnings","stepValidation","isCurrentStepValid","isWizardComplete","useWizardCompletion","clearDraft","calculateEstimatedDuration","rounds","baseDuration","complexityFactor","factor","avgQuestionLength","q","generateQuizId","timestamp","randomPart","createCompleteQuiz","now","isEditMode","settings","estimatedDuration","canComplete","getCompletionStatus","completeWizard","completedQuiz","error","isReady","DB_CONFIG","STORAGE_LIMITS","AUTO_SAVE_CONFIG","IndexedDBService","__publicField","resolve","reject","request","db","quizzesStore","mediaStore","storeNames","mode","operation","transaction","data","usage","quizSize","draft","draftWithTimestamp","store","id","quizzesResult","draftsResult","mediaResult","totalSize","remainingSpace","percentageUsed","cutoffDate","range","deletedCount","cursor","storeName","key","size","total","metadata","existingIndex","drafts","d","filteredQuizzes","filteredDrafts","quizzesData","draftsData","quizzesSize","draftsSize","localStorageLimit","indexedDBService","useQuizStorage","showSnackbar","useSnackbar","state","setState","autoSaveTimeoutRef","useRef","currentDraftRef","retryCountRef","initializeStorage","prev","initialized","saveQuiz","result","loadQuizzes","loadDrafts","refreshStorageUsage","deleteQuiz","saveDraft","deleteDraft","performAutoSave","enableAutoSave","disableAutoSave","cleanupOldDrafts","useEffect","deletedRef","DEFAULT_QUIZ_SETTINGS","DEFAULT_DRAFT_QUIZ","useWizardPersistenceWithStorage","initialQuiz","saveToStorage","deleteDraftFromStorage","autoSaveStatus","storageError","clearError","setDraftQuiz","isInitialized","setIsInitialized","lastSaved","setLastSaved","autoSaveTimerRef","draftIdRef","editDraft","existingDraft","newDraft","fallbackDraft","scheduleAutoSave","updateDraft","updates","resetDraft","initializeFromQuiz","recoverDraft","latestDraft","a","b","useQuizWizardWithStorage","persistenceActions","validationHook","navigationActions","updatedValidation","completionHook","resetWizard","ErrorBoundaryContext","createContext","initialState","ErrorBoundary","Component","props","_this$props$onReset","_this$props","_len","args","_key","info","_this$props$onError","_this$props2","prevProps","prevState","didCatch","resetKeys","hasArrayChanged","_this$props$onReset2","_this$props3","children","fallbackRender","FallbackComponent","fallback","childToRender","createElement","ROUND_TYPE_CONFIG","QUIZ_CATEGORIES","DIFFICULTY_LEVELS","BasicInfoStep","validation","onDeleteQuiz","onContinue","getFieldError","fieldName","timeValue","displayTime","timeForValidation","isTimeValid","timeError","TextField","e","FormControl","InputLabel","Select","category","MenuItem","FormHelperText","DifficultyIcon","level","Chip","val","InputAdornment","DeleteIcon","useQuestionsStepState","currentRoundIdx","setCurrentRoundIdx","roundModalOpen","setRoundModalOpen","roundModalMode","setRoundModalMode","editingRound","setEditingRound","roundForm","setRoundForm","manualDialogOpen","setManualDialogOpen","manualQuestion","setManualQuestion","editingQuestionId","setEditingQuestionId","aiDialogOpen","setAiDialogOpen","aiGenerating","setAiGenerating","aiStatus","setAiStatus","aiError","setAiError","aiErrorDismissed","setAiErrorDismissed","aiSettings","setAiSettings","deleteRoundConfirmOpen","setDeleteRoundConfirmOpen","deleteQuestionConfirmOpen","setDeleteQuestionConfirmOpen","pendingDeleteQuestionId","setPendingDeleteQuestionId","currentRound","isRoundFormValid","actions","field","value","questionId","roundInfoContent","RoundInfoModal","roundType","InfoOutlinedIcon","getRoundTitle","CloseIcon","type","RoundNavigation","onPreviousRound","onNextRound","onAddRound","onEditRound","onDeleteRound","hasRounds","canGoBack","canGoForward","infoModalOpen","setInfoModalOpen","Fab","ChevronLeftIcon","ChevronRightIcon","isQuestionComplete","hasValidAnswers","hasCorrectAnswer","QuestionsList","onEditQuestion","onDeleteQuestion","onAddQuestion","isComplete","CheckCircleIcon","WarningIcon","QuestionIcon","QuestionActionsBar","showActions","onOpenAIDialog","onOpenManualDialog","showAIButton","AIIcon","QuestionEditor","onUpdate","roundConfig","handleMediaUpload","file","validTypes","fileExtension","validExtensions","questionTypeKey","isValidMimeType","isValidExtension","_d","_e","sizeLimits","limitMB","reader","ev","mediaFile","updateOption","newOptions","addOption","removeOption","minOptions","_","i","newCorrectAnswers","answerIndex","toggleCorrectAnswer","currentCorrect","isCorrect","renderMediaUpload","isMediaQuestion","isMediaRound","mediaType","newType","FormControlLabel","Checkbox","lastRequestTime","requestCount","RATE_LIMIT_WINDOW","MAX_REQUESTS_PER_MINUTE","MIN_REQUEST_INTERVAL","checkRateLimit","timeUntilReset","timeSinceLastRequest","waitTime","wait","seconds","generateQuestionWithGemini","params","onStatusUpdate","rateLimitCheck","apiKey","requestBody","createEnhancedGeminiPrompt","response","errorData","generatedText","questionData","parseGeminiResponse","difficulty","language","previousQuestions","languageInstruction","categoryInstruction","difficultyInstruction","getEnhancedDifficultyInstruction","previousQuestionsContext","factCheckingInstruction","getFactCheckingInstruction","lowerCategory","text","jsonMatch","parsed","isGeminiAvailable","getRateLimitStatus","requestsRemaining","isNearLimit","generateAIQuizQuestion","createEmptyQuestion","geminiParams","mapQuizCategoryToGemini","convertQuizQuestionsToSession","finalQuestion","questionType","convertToQuizQuestion","errorMessage","optionsCount","baseQuestion","generateQuestionId","calculatePointsForDifficulty","distractors","generateDistractorOptions","allOptions","shuffledOptions","shuffleArray","correctAnswerIndex","correctAnswer","count","prompt","createDistractorPrompt","generateFallbackDistractors","parseDistractorsFromResponse","fallbackDistractors","expectedCount","line","num","questions","array","shuffled","j","_difficulty","isAIQuestionGenerationAvailable","getAIQuestionRateLimit","RoundsQuestionsStep","showValidation","derived","ROUND_TYPES","REVEAL_MODES","infoModalRoundType","setInfoModalRoundType","handleRoundSave","roundIndex","goldenPyramidQuestions","handleSaveRound","renderAIDialog","BrainIcon","Alert","CircularProgress","ShortTextIcon","FormatListBulletedIcon","newQuestion","updatedRound","idx","openManualDialog","defaultQuestionType","questionDefaults","manualQuestionValid","handleAddRound","handleEditRound","getAvailableRoundTypes","self","t","requestDeleteRound","handleConfirmDeleteRound","newRounds","handleCancelDeleteRound","requestDeleteQuestion","handleConfirmDeleteQuestion","updatedQuestions","handleCancelDeleteQuestion","label","selected","found","rt","rm","DialogContentText","QuizWizardModal","onQuizCreated","onCancel","editQuiz","onQuizDeleted","handleThemeChange","useTheme","showBasicInfo","setShowBasicInfo","showSaveDialog","setShowSaveDialog","showDeleteDialog","setShowDeleteDialog","isSubmitting","setIsSubmitting","isDeleting","setIsDeleting","isOpen","setIsOpen","deleted","setDeleted","totalRounds","canSave","handleClose","handleEditQuiz","content","handleSaveQuiz","handleConfirmSave","handleCancelSave","handleDeleteQuiz","handleConfirmDelete","__vitePreload","indexedDBService$1","handleCancelDelete","bc","handler","Fade","Header","SaveIcon","CheckIcon","TimerIcon","Divider","_f","_g","_h","QuizActions","selectedQuiz","menuAnchorEl","editingQuiz","isWizardOpen","deleteConfirmOpen","pendingDeleteQuiz","onMenuClose","onEditQuiz","onExportQuiz","onRequestDeleteQuiz","onConfirmDeleteQuiz","onCancelDeleteQuiz","onWizardCancel","handleEditClick","handleSlidesExport","handleJSONExport","handleDeleteClick","Menu","StorageModal","storageUsage","draftsCount","onCleanupStorage","onRefreshStorage","theme","isMobile","useMediaQuery","showDeleteConfirm","setShowDeleteConfirm","formatSize","bytes","k","sizes","quizzesWithSizes","questionSize","titleSize","descSize","estimatedSize","handleCleanupClick","handleConfirmCleanup","handleCancelCleanup","usagePercentage","StorageIcon","ChartIcon","LinearProgress","DraftIcon","CleanIcon","debugLog","useQuizStateManager","syncStatus","setSyncStatus","lastSyncRef","forceRefreshAll","deleteQuizWithSync","success","saveQuizWithSync","getDebugInfo","useQuizzesPageStateWithStorage","reloadKey","errorDismissed","setErrorDismissed","setIsWizardOpen","setEditingQuiz","setMenuAnchorEl","setSelectedQuiz","setDeleteConfirmOpen","setPendingDeleteQuiz","storageWarningDismissed","setStorageWarningDismissed","localError","setLocalError","dismissError","dismissStorageWarning","handleCreateQuiz","handleQuizCreated","message","handleWizardCancel","handleExportQuiz","handleMenuClose","handleRequestDeleteQuiz","handleConfirmDeleteQuiz","handleCancelDeleteQuiz","handleCleanupDrafts","handleRefreshStorage","Quizzes","isAuthenticated","useGoogleAuth","setReloadKey","reloadQuizzes","storageModalOpen","setStorageModalOpen","getFullQuizObject","quizId","handleExportWrapper","fullQuiz","handleEditWrapper","handleMenuOpenWrapper","allQuizzes","validCategories","sanitizeCategory","cat","sanitizeDifficulty","diff","sanitizeDuration","duration","sanitizeDate","date","sanitizeSettings","defaultSettings","settingsObj","sanitizeRounds","sanitizeTags","tags","tag","draftQuizzes","quizIds","filteredDraftQuizzes","totalQuizCount","Container"],"ignoreList":[11],"sources":["../../src/features/quizzes/exporting/components/ExportFormatDialog/ExportFormatDialog.tsx","../../src/features/quizzes/management/components/QuizCard/QuizCard.tsx","../../src/features/quizzes/management/components/QuizGrid/QuizGrid.tsx","../../src/features/quizzes/creation-editing/hooks/useWizardNavigation.ts","../../src/features/quizzes/creation-editing/types/index.ts","../../src/features/quizzes/creation-editing/hooks/useWizardValidation.ts","../../src/features/quizzes/creation-editing/hooks/useWizardCompletion.ts","../../src/features/quizzes/management/services/indexedDBService.ts","../../src/features/quizzes/management/hooks/useQuizStorage.ts","../../src/features/quizzes/creation-editing/hooks/useWizardPersistenceWithStorage.ts","../../src/features/quizzes/creation-editing/hooks/useQuizWizardWithStorage.ts","../../node_modules/react-error-boundary/dist/react-error-boundary.js","../../src/features/quizzes/types/index.ts","../../src/features/quizzes/creation-editing/steps/BasicInfoStep.tsx","../../src/features/quizzes/creation-editing/steps/hooks/useQuestionsStepState.ts","../../src/features/quizzes/creation-editing/components/RoundInfo/roundInfoContent.ts","../../src/features/quizzes/creation-editing/components/RoundInfo/RoundInfoModal.tsx","../../src/features/quizzes/creation-editing/steps/components/RoundNavigation.tsx","../../src/features/quizzes/creation-editing/steps/components/QuestionsList.tsx","../../src/features/quizzes/creation-editing/steps/components/QuestionActionsBar.tsx","../../src/features/quizzes/creation-editing/steps/components/QuestionEditor.tsx","../../src/features/final-question/services/geminiService.ts","../../src/features/quizzes/services/aiQuestionService.ts","../../src/features/quizzes/creation-editing/steps/QuestionsStep.tsx","../../src/features/quizzes/creation-editing/components/QuizWizardModal/QuizWizardModal.tsx","../../src/features/quizzes/management/components/QuizActions/QuizActions.tsx","../../src/features/quizzes/management/components/StorageStatus/StorageModal.tsx","../../src/features/quizzes/management/hooks/useQuizStateManager.ts","../../src/features/quizzes/management/hooks/useQuizzesPageStateWithStorage.ts","../../src/features/quizzes/pages/Quizzes.tsx"],"sourcesContent":["/**\n * Export Format Dialog Component\n *\n * Provides a modal dialog for selecting the quiz export format.\n * Currently shows available and coming soon export options including\n * Google Slides and JSON exports.\n *\n * Features:\n * - Format selection with icons\n * - Disabled state for unimplemented formats\n * - Clean presentation interface\n * - Responsive design\n *\n * @fileoverview Quiz export format selection dialog\n * @version 2.0.0\n * @since December 2025\n */\n\nimport React from \"react\";\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Button,\n  List,\n  ListItem,\n  ListItemButton,\n  ListItemIcon,\n  ListItemText,\n  Typography,\n  Box,\n} from \"@mui/material\";\nimport {\n  Slideshow as GoogleSlidesIcon,\n  Code as JSONIcon,\n} from \"@mui/icons-material\";\nimport type { Quiz } from \"../../../types\";\n\n/**\n * Props for the ExportFormatDialog component\n */\nexport interface ExportFormatDialogProps {\n  /** Whether the dialog is open */\n  open: boolean;\n  /** Quiz to be exported */\n  quiz: Quiz;\n  /** Callback when dialog should close */\n  onClose: () => void;\n  /** Callback when export format is selected */\n  onExport: (format: \"slides\" | \"json\") => void;\n}\n\n/**\n * Export format options configuration\n */\nconst EXPORT_OPTIONS = [\n  {\n    id: \"slides\",\n    label: \"Export to Google Slides\",\n    icon: GoogleSlidesIcon,\n    disabled: true,\n    description: \"Export quiz as a Google Slides presentation (Coming Soon)\",\n  },\n  {\n    id: \"json\",\n    label: \"Export as JSON\",\n    icon: JSONIcon,\n    disabled: true,\n    description: \"Export quiz data in JSON format (Coming Soon)\",\n  },\n] as const;\n\n/**\n * ExportFormatDialog Component\n *\n * Renders a dialog for selecting the quiz export format with\n * visual feedback and disabled states for unavailable options.\n *\n * @param props - Component props\n * @returns JSX element representing the export format dialog\n */\nexport const ExportFormatDialog: React.FC<ExportFormatDialogProps> = ({\n  open,\n  quiz,\n  onClose,\n  onExport,\n}) => {\n  const handleExport = (format: \"slides\" | \"json\") => {\n    onExport(format);\n    onClose();\n  };\n\n  return (\n    <Dialog\n      open={open}\n      onClose={onClose}\n      aria-labelledby=\"export-format-dialog-title\"\n      maxWidth=\"sm\"\n      fullWidth\n    >\n      <DialogTitle id=\"export-format-dialog-title\">\n        Export Quiz: {quiz.title}\n      </DialogTitle>\n      <DialogContent>\n        <Box sx={{ py: 1 }}>\n          <Typography variant=\"body1\" gutterBottom>\n            Choose an export format:\n          </Typography>\n\n          <List>\n            {EXPORT_OPTIONS.map((option) => (\n              <ListItem key={option.id} disablePadding>\n                <ListItemButton\n                  onClick={() => handleExport(option.id)}\n                  disabled={option.disabled}\n                >\n                  <ListItemIcon>\n                    <option.icon />\n                  </ListItemIcon>\n                  <ListItemText\n                    primary={option.label}\n                    secondary={option.description}\n                  />\n                </ListItemButton>\n              </ListItem>\n            ))}\n          </List>\n\n          <Typography\n            variant=\"body2\"\n            color=\"text.secondary\"\n            sx={{ mt: 2, fontStyle: \"italic\" }}\n          >\n            Export functionality coming soon! These features are planned for\n            future releases.\n          </Typography>\n        </Box>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={onClose}>Cancel</Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default ExportFormatDialog;\n","/**\n * Quiz Card Component\n *\n * Displays individual quiz information in a card format with metadata,\n * actions, and hover effects. Extracted from the monolithic Quizzes.tsx\n * to improve maintainability and follow Single Responsibility Principle.\n *\n * Features:\n * - Quiz metadata display (title, description, category, difficulty)\n * - Action buttons (Preview, Export)\n * - Menu actions (Edit, Export, Delete)\n * - Hover animations and responsive design\n * - Quiz statistics and duration\n *\n * @fileoverview Individual quiz card component\n * @version 1.0.0\n * @since December 2025\n */\n\nimport React from \"react\";\nimport {\n  Grid,\n  Card,\n  CardContent,\n  CardActions,\n  Typography,\n  Button,\n  IconButton,\n  Box,\n  Zoom,\n  Stack,\n} from \"@mui/material\";\nimport {\n  Quiz as QuizIcon,\n  PlayArrow as PlayIcon,\n  Download as DownloadIcon,\n  MoreVert as MoreVertIcon,\n  Schedule as ScheduleIcon,\n  Category as CategoryIcon,\n  Edit as EditIcon,\n} from \"@mui/icons-material\";\nimport { ExportFormatDialog } from \"../../../exporting/components\";\nimport type { Quiz } from \"../../types\";\n\n/**\n * Props for the QuizCard component\n */\nexport interface QuizCardProps {\n  /** Quiz data to display */\n  quiz: Quiz;\n  /** Callback when quiz menu is opened */\n  onMenuOpen: (event: React.MouseEvent<HTMLElement>, quiz: Quiz) => void;\n  /** Callback when quiz export is requested */\n  onExport: (quiz: Quiz, format: \"powerpoint\" | \"slides\" | \"json\") => void;\n  /** Callback when quiz preview is requested */\n  onPreview?: (quiz: Quiz) => void;\n  /** Callback when quiz edit is requested */\n  onEdit: (quiz: Quiz) => void;\n}\n\n/**\n * QuizCard Component\n *\n * Renders an individual quiz as a card with all relevant information\n * and action buttons. Includes hover effects and responsive design.\n *\n * @param props - Component props\n * @returns JSX element representing a quiz card\n */\nexport const QuizCard: React.FC<QuizCardProps> = ({\n  quiz,\n  onMenuOpen,\n  onExport,\n  onPreview,\n  onEdit,\n}) => {\n  const [exportDialogOpen, setExportDialogOpen] = React.useState(false);\n\n  /**\n   * Handles preview action with optional callback\n   */\n  const handlePreview = React.useCallback(() => {\n    if (onPreview) {\n      onPreview(quiz);\n    } else {\n      console.log(\"Preview quiz:\", quiz.id);\n    }\n  }, [quiz, onPreview]);\n\n  /**\n   * Handles export button click\n   */\n  const handleExportClick = React.useCallback(() => {\n    setExportDialogOpen(true);\n  }, []);\n\n  /**\n   * Handles export format selection\n   */\n  const handleExportFormat = React.useCallback(\n    (format: \"powerpoint\" | \"slides\" | \"json\") => {\n      onExport(quiz, format);\n    },\n    [quiz, onExport]\n  );\n\n  /**\n   * Handles edit action\n   */\n  const handleEdit = React.useCallback(() => {\n    onEdit(quiz);\n  }, [quiz, onEdit]);\n\n  /**\n   * Handles menu opening\n   */\n  const handleMenuOpen = React.useCallback(\n    (event: React.MouseEvent<HTMLElement>) => {\n      onMenuOpen(event, quiz);\n    },\n    [quiz, onMenuOpen]\n  );\n\n  const totalQuestions = React.useMemo(() => {\n    return quiz.rounds?.flatMap((r) => r?.questions || []).length || 0;\n  }, [quiz.rounds]);\n\n  return (\n    <Grid size={{ xs: 12, sm: 6, md: 4 }} key={quiz.id}>\n      <Zoom in timeout={300}>\n        <Card\n          elevation={2}\n          sx={{\n            height: \"100%\",\n            display: \"flex\",\n            flexDirection: \"column\",\n            justifyContent: \"space-between\",\n            transition: \"all 0.3s ease\",\n            \"&:hover\": {\n              elevation: 4,\n              transform: \"translateY(-2px)\",\n            },\n          }}\n        >\n          <Box>\n            <CardContent sx={{ pb: 1 }}>\n              <Box\n                display=\"flex\"\n                justifyContent=\"space-between\"\n                alignItems=\"center\"\n                mb={1}\n              >\n                <Typography\n                  variant=\"h5\"\n                  component=\"h3\"\n                  fontWeight=\"bold\"\n                  noWrap\n                >\n                  {quiz.title || \"Untitled Quiz\"}\n                </Typography>\n                <IconButton\n                  size=\"small\"\n                  onClick={handleMenuOpen}\n                  aria-label=\"More options\"\n                >\n                  <MoreVertIcon />\n                </IconButton>\n              </Box>\n\n              <Typography\n                variant=\"body2\"\n                color=\"text.secondary\"\n                sx={{\n                  mb: 2,\n                  height: \"40px\",\n                  display: \"-webkit-box\",\n                  WebkitLineClamp: 2,\n                  WebkitBoxOrient: \"vertical\",\n                  overflow: \"hidden\",\n                  textOverflow: \"ellipsis\",\n                }}\n              >\n                {quiz.description || \"No description provided.\"}\n              </Typography>\n\n              <Box\n                display=\"flex\"\n                alignItems=\"center\"\n                gap={2}\n                color=\"text.secondary\"\n              >\n                <Box display=\"flex\" alignItems=\"center\" gap={0.5}>\n                  <ScheduleIcon fontSize=\"small\" />\n                  <Typography variant=\"caption\">\n                    {quiz.estimatedDuration || \"10\"} min\n                  </Typography>\n                </Box>\n                <Box display=\"flex\" alignItems=\"center\" gap={0.5}>\n                  <CategoryIcon fontSize=\"small\" />\n                  <Typography variant=\"caption\">\n                    {quiz.rounds?.length || 0} Rounds\n                  </Typography>\n                </Box>\n                <Box display=\"flex\" alignItems=\"center\" gap={0.5}>\n                  <QuizIcon fontSize=\"small\" />\n                  <Typography variant=\"caption\">\n                    {totalQuestions} Questions\n                  </Typography>\n                </Box>\n              </Box>\n            </CardContent>\n          </Box>\n\n          <CardActions sx={{ p: 2, pt: 1 }}>\n            <Stack direction=\"row\" spacing={1} width=\"100%\">\n              <Button\n                variant=\"contained\"\n                size=\"medium\"\n                startIcon={<PlayIcon />}\n                onClick={handlePreview}\n                sx={{ flex: 1 }}\n              >\n                Play\n              </Button>\n              <Button\n                variant=\"outlined\"\n                size=\"medium\"\n                startIcon={<EditIcon />}\n                onClick={handleEdit}\n                sx={{ flex: 1 }}\n              >\n                Edit\n              </Button>\n              <Button\n                variant=\"outlined\"\n                size=\"medium\"\n                startIcon={<DownloadIcon />}\n                onClick={handleExportClick}\n                sx={{ flex: 1 }}\n              >\n                Export\n              </Button>\n            </Stack>\n          </CardActions>\n        </Card>\n      </Zoom>\n\n      {/* Export Format Dialog */}\n      <ExportFormatDialog\n        open={exportDialogOpen}\n        quiz={quiz}\n        onClose={() => setExportDialogOpen(false)}\n        onExport={handleExportFormat}\n      />\n    </Grid>\n  );\n};\n\nexport default QuizCard;\n","/**\n * Quiz Grid Component\n *\n * Handles the display of quizzes in a responsive grid layout with loading\n * and empty states. Extracted from the monolithic Quizzes.tsx to improve\n * maintainability and follow Single Responsibility Principle.\n *\n * Features:\n * - Responsive grid layout\n * - Loading skeleton animation\n * - Empty state with call-to-action\n * - Quiz card integration\n *\n * @fileoverview Quiz grid layout and state management\n * @version 1.0.0\n * @since December 2025\n */\n\nimport React from \"react\";\nimport {\n  Grid,\n  Card,\n  CardContent,\n  Typography,\n  Button,\n  Skeleton,\n  Box,\n} from \"@mui/material\";\nimport { Add as AddIcon, School as SchoolIcon } from \"@mui/icons-material\";\nimport { QuizCard } from \"../QuizCard\";\nimport type { Quiz } from \"../../types\";\nimport type { QuizCardProps } from \"../QuizCard\";\n\n/**\n * Props for the QuizGrid component\n */\nexport interface QuizGridProps {\n  /** Array of quizzes to display */\n  quizzes: Quiz[];\n  /** Loading state indicator */\n  isLoading: boolean;\n  /** Callback when create quiz is requested */\n  onCreateQuiz: () => void;\n  /** Callback when quiz menu is opened */\n  onMenuOpen: QuizCardProps[\"onMenuOpen\"];\n  /** Callback when quiz export is requested */\n  onExport: QuizCardProps[\"onExport\"];\n  /** Callback when quiz preview is requested */\n  onPreview?: QuizCardProps[\"onPreview\"];\n  /** Callback when quiz edit is requested */\n  onEdit: QuizCardProps[\"onEdit\"];\n}\n\n/**\n * Renders loading skeleton for quiz cards\n *\n * @returns JSX elements representing loading skeleton cards\n */\nconst LoadingSkeleton: React.FC = () => (\n  <>\n    {[1, 2, 3].map((item) => (\n      <Grid size={{ xs: 12, sm: 6, md: 4 }} key={item}>\n        <Card elevation={1}>\n          <CardContent>\n            <Box\n              display=\"flex\"\n              justifyContent=\"space-between\"\n              alignItems=\"flex-start\"\n              mb={2}\n            >\n              <Skeleton variant=\"circular\" width={48} height={48} />\n              <Skeleton variant=\"circular\" width={24} height={24} />\n            </Box>\n            <Skeleton variant=\"text\" sx={{ fontSize: \"1.2rem\", mb: 1 }} />\n            <Skeleton variant=\"text\" height={40} sx={{ mb: 2 }} />\n            <Box display=\"flex\" gap={1} mb={2}>\n              <Skeleton variant=\"rounded\" width={60} height={24} />\n              <Skeleton variant=\"rounded\" width={80} height={24} />\n              <Skeleton variant=\"rounded\" width={40} height={24} />\n            </Box>\n            <Box display=\"flex\" justifyContent=\"space-between\">\n              <Skeleton variant=\"text\" width={100} />\n              <Skeleton variant=\"text\" width={60} />\n            </Box>\n          </CardContent>\n        </Card>\n      </Grid>\n    ))}\n  </>\n);\n\n/**\n * Renders empty state when no quizzes exist\n *\n * @param onCreateQuiz - Callback when create quiz button is clicked\n * @returns JSX element representing empty state\n */\nconst EmptyState: React.FC<{ onCreateQuiz: () => void }> = ({\n  onCreateQuiz,\n}) => (\n  <Grid size={{ xs: 12 }}>\n    <Card\n      elevation={0}\n      sx={{\n        textAlign: \"center\",\n        py: 8,\n        bgcolor: \"background.default\",\n        border: \"2px dashed\",\n        borderColor: \"divider\",\n      }}\n    >\n      <CardContent>\n        <SchoolIcon sx={{ fontSize: 64, color: \"text.secondary\", mb: 2 }} />\n        <Typography variant=\"h5\" gutterBottom>\n          Create Your First Quiz\n        </Typography>\n        <Typography variant=\"body1\" color=\"text.secondary\" paragraph>\n          Get started by creating an interactive quiz with questions, answers,\n          and media. Export to PowerPoint when you're ready to present!\n        </Typography>\n        <Button\n          variant=\"contained\"\n          size=\"large\"\n          startIcon={<AddIcon />}\n          onClick={onCreateQuiz}\n          sx={{ mt: 2 }}\n        >\n          Create Quiz\n        </Button>\n      </CardContent>\n    </Card>\n  </Grid>\n);\n\n/**\n * QuizGrid Component\n *\n * Renders quizzes in a responsive grid layout with appropriate loading\n * and empty states. Manages the display logic for different states.\n *\n * @param props - Component props\n * @returns JSX element representing the quiz grid\n */\nexport const QuizGrid: React.FC<QuizGridProps> = ({\n  quizzes,\n  isLoading,\n  onCreateQuiz,\n  onMenuOpen,\n  onExport,\n  onPreview,\n  onEdit,\n}) => {\n  /**\n   * Renders individual quiz cards\n   */\n  const renderQuizCards = React.useCallback(() => {\n    return quizzes.map((quiz) => (\n      <QuizCard\n        key={quiz.id}\n        quiz={quiz}\n        onMenuOpen={onMenuOpen}\n        onExport={onExport}\n        onPreview={onPreview}\n        onEdit={onEdit}\n      />\n    ));\n  }, [quizzes, onMenuOpen, onExport, onPreview, onEdit]);\n\n  return (\n    <Grid container spacing={3}>\n      {isLoading ? (\n        <LoadingSkeleton />\n      ) : quizzes.length === 0 ? (\n        <EmptyState onCreateQuiz={onCreateQuiz} />\n      ) : (\n        renderQuizCards()\n      )}\n    </Grid>\n  );\n};\n\nexport default QuizGrid;\n","/**\n * Wizard Navigation Hook\n *\n * Focused hook for managing step-by-step navigation through the quiz creation wizard.\n * Handles step progression, validation-based transitions, and step accessibility logic.\n *\n * Extracted from useQuizWizard.ts to follow Single Responsibility Principle.\n * Manages only navigation concerns, leaving validation and data to other hooks.\n *\n * Features:\n * - Current step state management\n * - Step progression with validation checks\n * - Direct step navigation with accessibility controls\n * - Step completion and enablement logic\n * - Integration with validation system\n *\n * @fileoverview Navigation hook for quiz creation wizard\n * @version 1.0.0\n * @since December 2025\n */\n\nimport { useState, useCallback, useMemo } from \"react\";\nimport type { WizardStep, QuizValidation } from \"../types\";\n\n/**\n * Wizard step configuration defining the complete creation flow\n */\nconst WIZARD_STEPS: Omit<WizardStep, \"completed\" | \"active\" | \"enabled\">[] = [\n  {\n    id: \"basic-info\",\n    title: \"Quiz Information\",\n    description:\n      \"Set up basic quiz details like title, description, and category\",\n  },\n  {\n    id: \"questions\",\n    title: \"Add Questions\",\n    description: \"Create and manage your quiz questions with answers\",\n  },\n  {\n    id: \"review-create\",\n    title: \"Review & Create\",\n    description: \"Review your quiz and finalize creation.\",\n  },\n];\n\n/**\n * Navigation state interface\n */\nexport interface NavigationState {\n  /** Current step index (0-based) */\n  currentStep: number;\n  /** Array of wizard steps with completion states */\n  steps: WizardStep[];\n  /** Whether user can proceed to next step */\n  canProceed: boolean;\n}\n\n/**\n * Navigation actions interface\n */\nexport interface NavigationActions {\n  /** Move to next step (if valid) */\n  nextStep: () => void;\n  /** Move to previous step */\n  previousStep: () => void;\n  /** Jump to specific step (if enabled) */\n  goToStep: (stepIndex: number) => void;\n  /** Reset to first step */\n  resetNavigation: () => void;\n}\n\n/**\n * Hook return interface\n */\nexport interface UseWizardNavigationReturn {\n  /** Navigation state */\n  navigation: NavigationState;\n  /** Navigation actions */\n  actions: NavigationActions;\n}\n\n/**\n * Wizard Navigation Hook\n *\n * Manages the step-by-step navigation through the quiz creation wizard.\n * Provides validation-aware navigation that prevents users from advancing\n * without completing required fields in each step.\n *\n * @param validateCurrentStep - Function to validate the current step\n * @returns Navigation state and control functions\n */\nexport const useWizardNavigation = (\n  validateCurrentStep: () => QuizValidation\n): UseWizardNavigationReturn => {\n  // Current wizard step (0-based index)\n  const [currentStep, setCurrentStep] = useState(0);\n\n  /**\n   * Creates wizard steps with current completion and active states\n   * Determines which steps are accessible based on previous completions\n   */\n  const steps = useMemo((): WizardStep[] => {\n    return WIZARD_STEPS.map((step, index) => {\n      // Check if this step is completed by validating it\n      const isCompleted = index < currentStep;\n      const isCurrentAndValid =\n        index === currentStep && validateCurrentStep().isValid;\n\n      return {\n        ...step,\n        completed: isCompleted || isCurrentAndValid,\n        active: index === currentStep,\n        enabled: index <= currentStep || isCompleted,\n      };\n    });\n  }, [currentStep, validateCurrentStep]);\n\n  /**\n   * Determines if wizard can proceed to next step\n   * Based on current step validation\n   */\n  const canProceed = useMemo(() => {\n    const validation = validateCurrentStep();\n    return validation.isValid && currentStep < WIZARD_STEPS.length - 1;\n  }, [validateCurrentStep, currentStep]);\n\n  /**\n   * Moves to the next step in the wizard\n   * Only allowed if current step is valid\n   */\n  const nextStep = useCallback(() => {\n    const validation = validateCurrentStep();\n    if (validation.isValid && currentStep < WIZARD_STEPS.length - 1) {\n      setCurrentStep(currentStep + 1);\n    }\n  }, [currentStep, validateCurrentStep]);\n\n  /**\n   * Moves to the previous step in the wizard\n   * Always allowed unless on first step\n   */\n  const previousStep = useCallback(() => {\n    if (currentStep > 0) {\n      setCurrentStep(currentStep - 1);\n    }\n  }, [currentStep]);\n\n  /**\n   * Jumps directly to a specific step\n   * Only allowed if step is enabled (completed or accessible)\n   *\n   * @param stepIndex - Target step index (0-based)\n   */\n  const goToStep = useCallback(\n    (stepIndex: number) => {\n      if (stepIndex >= 0 && stepIndex < WIZARD_STEPS.length) {\n        const targetStep = steps[stepIndex];\n        if (targetStep.enabled) {\n          setCurrentStep(stepIndex);\n        }\n      }\n    },\n    [steps]\n  );\n\n  /**\n   * Resets navigation to the first step\n   * Used when starting a new wizard session\n   */\n  const resetNavigation = useCallback(() => {\n    setCurrentStep(0);\n  }, []);\n\n  // Build navigation state\n  const navigation: NavigationState = {\n    currentStep,\n    steps,\n    canProceed,\n  };\n\n  // Build navigation actions\n  const actions: NavigationActions = {\n    nextStep,\n    previousStep,\n    goToStep,\n    resetNavigation,\n  };\n\n  return {\n    navigation,\n    actions,\n  };\n};\n\n/**\n * Navigation constants for external use\n */\nexport const NAVIGATION_CONSTANTS = {\n  TOTAL_STEPS: WIZARD_STEPS.length,\n  STEP_IDS: WIZARD_STEPS.map((step) => step.id),\n  FIRST_STEP: 0,\n  LAST_STEP: WIZARD_STEPS.length - 1,\n} as const;\n","/**\n * Quizzes Feature Type Definitions\n *\n * This file contains all TypeScript interfaces and types used throughout\n * the Quizzes feature. Centralized type definitions ensure consistency\n * and maintainability across all components, hooks, and services.\n *\n * Updated for new round-based quiz system with media file support:\n * - IndexedDB storage for large files\n * - Round types determine question types\n * - Media file uploads (pictures, audio, video)\n * - Golden Pyramid special format\n * - Time/points as number inputs with decimal support\n * - Breaking time settings for rounds\n *\n * @fileoverview Type definitions for Quizzes feature\n * @version 2.0.0\n * @since December 2025\n */\n\n/**\n * Supported media types for quiz questions\n */\nexport type MediaType = \"image\" | \"audio\" | \"video\";\n\n/**\n * Quiz question type\n * - single-answer: Single correct answer (renamed from text-answer)\n * - multiple-choice: Multiple choice question with 1-20 possible answers\n * - picture: Picture-based question with file upload\n * - audio: Audio-based question with file upload\n * - video: Video-based question with file upload\n */\nexport type QuestionType =\n  | \"single-answer\"\n  | \"multiple-choice\"\n  | \"picture\"\n  | \"audio\"\n  | \"video\";\n\n/**\n * Supported round types for quiz creation\n * Round type determines available question types and UI behavior\n */\nexport type RoundType =\n  | \"mixed\" // Mixed question types (user can select any type)\n  | \"single-answer-only\" // Only single answer questions (renamed from text-only)\n  | \"multiple-choice\" // Only multiple choice questions\n  | \"picture\" // Only picture questions with image uploads\n  | \"audio\" // Only audio questions with audio uploads\n  | \"video\" // Only video questions with video uploads\n  | \"golden-pyramid\"; // Special 4-question format\n\n/**\n * Round answer reveal mode\n */\nexport type AnswerRevealMode = \"after-each\" | \"after-all\";\n\n/**\n * Quiz difficulty levels for organization and filtering\n */\nexport type QuizDifficulty = \"easy\" | \"medium\" | \"hard\";\n\n/**\n * Quiz categories for organization\n */\nexport type QuizCategory =\n  | \"general\"\n  | \"sports\"\n  | \"history\"\n  | \"science\"\n  | \"geography\"\n  | \"entertainment\"\n  | \"literature\"\n  | \"art\"\n  | \"music\"\n  | \"technology\"\n  | \"custom\";\n\n/**\n * Supported media file types for PowerPoint compatibility\n */\nexport interface SupportedMediaTypes {\n  images: string[]; // ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'tiff', 'svg']\n  audio: string[]; // ['mp3', 'wav', 'wma', 'm4a']\n  video: string[]; // ['mp4', 'mov', 'wmv', 'avi']\n}\n\n/**\n * File size limits for different media types (in bytes)\n */\nexport interface FileSizeLimits {\n  image: number; // 10MB max per image\n  audio: number; // 20MB max per audio file\n  video: number; // 100MB max per video file\n  total: number; // 500MB max total quiz size\n}\n\n/**\n * Media file metadata for storage and display\n */\nexport interface MediaFile {\n  /** Unique identifier for the media file */\n  id: string;\n  /** Original filename with extension */\n  filename: string;\n  /** File type (image/audio/video) */\n  type: \"image\" | \"audio\" | \"video\";\n  /** File size in bytes */\n  size: number;\n  /** Base64 encoded file data for storage */\n  data: string;\n  /** MIME type for proper handling */\n  mimeType: string;\n  /** Thumbnail for images/videos (base64) */\n  thumbnail?: string;\n  /** Duration for audio/video files in seconds */\n  duration?: number;\n  /** Upload timestamp */\n  createdAt: Date;\n}\n\n/**\n * Quiz question interface (updated for new system)\n */\nexport interface QuizQuestion {\n  /** Unique identifier for the question */\n  id: string;\n  /** Question type determines UI and behavior */\n  type: QuestionType;\n  /** The main question text */\n  question: string;\n  /** Possible answers for multiple choice (1-20 answers), empty for single-answer */\n  possibleAnswers: string[];\n  /** Array of correct answer indices for Golden Pyramid (1,2,3,4 correct answers per question) */\n  correctAnswers: number[];\n  /** Single correct answer text for single-answer questions */\n  correctAnswerText?: string;\n  /** Optional explanation shown after answer */\n  explanation?: string;\n  /** Associated media file if any */\n  mediaFile?: MediaFile;\n  /** Question difficulty for organization */\n  difficulty: QuizDifficulty;\n  /** Points awarded for correct answer (decimal support) */\n  points: number;\n  /** Time limit in minutes (decimal support, e.g., 0.5 = 30 seconds) */\n  timeLimit: number;\n  /** Creation timestamp */\n  createdAt: Date;\n  /** Last modified timestamp */\n  updatedAt: Date;\n}\n\n/**\n * Round structure containing questions and round-level settings\n */\nexport interface Round {\n  /** Unique identifier for the round */\n  id: string;\n  /** Display name for the round (e.g., \"Round 1\") */\n  name: string;\n  /** Optional round description */\n  description?: string;\n  /** Round type (determines question types allowed) */\n  type: RoundType;\n  /** Optional round level/difficulty label */\n  level?: string;\n  /** Answer reveal mode for this round */\n  answerRevealMode: AnswerRevealMode;\n  /** Default time per question in this round (in minutes, decimal support) */\n  defaultTimePerQuestion: number;\n  /** Breaking time between rounds in minutes (default 1) */\n  breakingTime: number;\n  /** For Golden Pyramid: time for entire round instead of per question */\n  roundTimeLimit?: number;\n  /** For Golden Pyramid: points for entire round instead of per question */\n  roundPoints?: number;\n  /** List of questions in this round */\n  questions: QuizQuestion[];\n  /** Creation timestamp */\n  createdAt: Date;\n  /** Last modified timestamp */\n  updatedAt: Date;\n}\n\n/**\n * Complete quiz structure containing all quiz data (updated for new system)\n */\nexport interface Quiz {\n  /** Unique identifier for the quiz */\n  id: string;\n  /** Quiz title displayed to users */\n  title: string;\n  /** Optional quiz description */\n  description?: string;\n  /** Quiz category for organization */\n  category: QuizCategory;\n  /** Overall quiz difficulty */\n  difficulty: QuizDifficulty;\n  /** Quiz status for workflow management */\n  status: \"draft\" | \"completed\";\n  /** Array of all rounds in the quiz */\n  rounds: Round[];\n  /** Total estimated duration in minutes (calculated from questions + breaks) */\n  estimatedDuration: number;\n  /** Quiz creation timestamp */\n  createdAt: Date;\n  /** Last modified timestamp */\n  updatedAt: Date;\n  /** Quiz settings */\n  settings: QuizSettings;\n}\n\n/**\n * Quiz settings\n */\nexport interface QuizSettings {\n  /** Default time limit per question in minutes (decimal support) */\n  defaultTimeLimit: number;\n  /** Default points per question (decimal support) */\n  defaultPoints: number;\n  /** Default breaking time between rounds in minutes */\n  defaultBreakingTime: number;\n}\n\n/**\n * Wizard step definition\n */\nexport interface WizardStep {\n  /** Step identifier */\n  id: string;\n  /** Display title for the step */\n  title: string;\n  /** Step description */\n  description: string;\n  /** Whether this step is completed */\n  completed: boolean;\n  /** Whether this step is currently active */\n  active: boolean;\n  /** Whether this step is accessible */\n  enabled: boolean;\n}\n\n/**\n * Quiz validation result\n */\nexport interface QuizValidation {\n  /** Whether the quiz is valid for export/save */\n  isValid: boolean;\n  /** Array of validation error messages */\n  errors: string[];\n  /** Array of validation warning messages */\n  warnings: string[];\n  /** Validation timestamp */\n  validatedAt: Date;\n}\n\n/**\n * Quizzes page component props\n */\nexport interface QuizzesPageProps {\n  /** Optional initial quiz to load */\n  initialQuiz?: Quiz;\n}\n\n/**\n * Quiz wizard component props\n */\nexport interface QuizWizardProps {\n  /** Callback when quiz is successfully created */\n  onQuizCreated: (quiz: Quiz) => void;\n  /** Callback when wizard is cancelled */\n  onCancel: () => void;\n  /** Optional quiz to edit (for edit mode) */\n  editQuiz?: Quiz;\n}\n\n/**\n * Question editor component props\n */\nexport interface QuestionEditorProps {\n  /** Current question being edited */\n  question: QuizQuestion;\n  /** Callback when question is updated */\n  onQuestionUpdate: (question: QuizQuestion) => void;\n  /** Callback when question is deleted */\n  onQuestionDelete: (questionId: string) => void;\n  /** Index of question in the round */\n  questionIndex: number;\n  /** Total number of questions in round */\n  totalQuestions: number;\n  /** Round type to determine UI behavior */\n  roundType: RoundType;\n}\n\n/**\n * Media upload component props\n */\nexport interface MediaUploadProps {\n  /** Accepted file types */\n  acceptedTypes: string[];\n  /** Maximum file size in bytes */\n  maxFileSize: number;\n  /** Callback when file is uploaded */\n  onFileUpload: (file: MediaFile) => void;\n  /** Callback when upload fails */\n  onUploadError: (error: string) => void;\n  /** Current uploaded file (if any) */\n  currentFile?: MediaFile;\n  /** File type being uploaded */\n  fileType: \"image\" | \"audio\" | \"video\";\n}\n\n/**\n * Export options component props\n */\nexport interface ExportOptionsProps {\n  /** Quiz to export */\n  quiz: Quiz;\n  /** Export settings */\n  settings: ExportSettings;\n  /** Callback when settings change */\n  onSettingsChange: (settings: ExportSettings) => void;\n  /** Callback to start export */\n  onStartExport: () => void;\n  /** Whether export is in progress */\n  isExporting: boolean;\n}\n\n/**\n * Quiz management hook return type\n */\nexport interface UseQuizManagementReturn {\n  /** Array of all saved quizzes */\n  quizzes: Quiz[];\n  /** Currently selected/active quiz */\n  currentQuiz: Quiz | null;\n  /** Whether quizzes are being loaded */\n  isLoading: boolean;\n  /** Any error that occurred */\n  error: string | null;\n  /** Create a new quiz */\n  createQuiz: (\n    quizData: Omit<Quiz, \"id\" | \"createdAt\" | \"updatedAt\">\n  ) => Promise<Quiz>;\n  /** Update an existing quiz */\n  updateQuiz: (id: string, updates: Partial<Quiz>) => Promise<Quiz>;\n  /** Delete a quiz */\n  deleteQuiz: (id: string) => Promise<void>;\n  /** Load a specific quiz */\n  loadQuiz: (id: string) => Promise<Quiz | null>;\n  /** Clear current quiz */\n  clearCurrentQuiz: () => void;\n  /** Export quiz to PowerPoint */\n  exportToPowerPoint: (\n    quizId: string,\n    settings?: ExportSettings\n  ) => Promise<void>;\n  /** Set quizzes */\n  setQuizzes: React.Dispatch<React.SetStateAction<Quiz[]>>;\n}\n\n/**\n * Quiz wizard hook return type\n */\nexport interface UseQuizWizardReturn {\n  /** Current wizard step */\n  currentStep: number;\n  /** Array of all wizard steps */\n  steps: WizardStep[];\n  /** Draft quiz being created */\n  draftQuiz: Partial<Quiz>;\n  /** Whether wizard can proceed to next step */\n  canProceed: boolean;\n  /** Move to next step */\n  nextStep: () => void;\n  /** Move to previous step */\n  previousStep: () => void;\n  /** Jump to specific step */\n  goToStep: (stepIndex: number) => void;\n  /** Update draft quiz data */\n  updateDraft: (updates: Partial<Quiz>) => void;\n  /** Validate current step */\n  validateStep: () => QuizValidation;\n  /** Save draft quiz */\n  saveDraft: () => Promise<void>;\n  /** Complete wizard and create quiz */\n  completeWizard: () => Promise<Quiz>;\n  /** Reset wizard to beginning */\n  resetWizard: () => void;\n}\n\n/**\n * File size limits constants\n */\nexport const FILE_SIZE_LIMITS: FileSizeLimits = {\n  image: 10 * 1024 * 1024, // 10MB\n  audio: 20 * 1024 * 1024, // 20MB\n  video: 100 * 1024 * 1024, // 100MB\n  total: 500 * 1024 * 1024, // 500MB\n};\n\n/**\n * Quiz validation constants\n */\nexport const QUIZ_CONSTANTS = {\n  MAX_TITLE_LENGTH: 100,\n  MIN_ROUNDS: 1,\n  MIN_QUESTIONS: 1,\n  MAX_QUESTIONS: 100,\n  MIN_OPTIONS: 2,\n  MAX_OPTIONS: 20,\n  FILE_SIZE_LIMITS: FILE_SIZE_LIMITS,\n} as const;\n\n/**\n * Supported file formats for PowerPoint compatibility\n */\nexport const SUPPORTED_MEDIA_TYPES: SupportedMediaTypes = {\n  images: [\"jpg\", \"jpeg\", \"png\", \"gif\", \"bmp\", \"tiff\", \"svg\"],\n  audio: [\"mp3\", \"wav\", \"wma\", \"m4a\"],\n  video: [\"mp4\", \"mov\", \"wmv\", \"avi\"],\n};\n\n/**\n * Round type configurations\n */\nexport const ROUND_TYPE_CONFIG = {\n  mixed: {\n    label: \"Any Type of Question\",\n    description: \"Questions of any type\",\n    allowedQuestionTypes: [\n      \"single-answer\",\n      \"multiple-choice\",\n      \"picture\",\n      \"audio\",\n      \"video\",\n    ] as QuestionType[],\n    canSelectQuestionType: true,\n  },\n  \"single-answer-only\": {\n    label: \"Question-Answer\",\n    description: \"Only single answer questions\",\n    allowedQuestionTypes: [\"single-answer\"] as QuestionType[],\n    canSelectQuestionType: false,\n  },\n  \"multiple-choice\": {\n    label: \"Multiple Choice Question\",\n    description: \"Only multiple choice questions\",\n    allowedQuestionTypes: [\"multiple-choice\"] as QuestionType[],\n    canSelectQuestionType: false,\n  },\n  picture: {\n    label: \"Picture Question\",\n    description: \"Questions with picture uploads\",\n    allowedQuestionTypes: [\"picture\"] as QuestionType[],\n    canSelectQuestionType: false,\n  },\n  audio: {\n    label: \"Audio Question\",\n    description: \"Questions with audio uploads\",\n    allowedQuestionTypes: [\"audio\"] as QuestionType[],\n    canSelectQuestionType: false,\n  },\n  video: {\n    label: \"Video Question\",\n    description: \"Questions with video uploads\",\n    allowedQuestionTypes: [\"video\"] as QuestionType[],\n    canSelectQuestionType: false,\n  },\n  \"golden-pyramid\": {\n    label: \"Golden Pyramid Question\",\n    description: \"Special 4-question format\",\n    allowedQuestionTypes: [\"multiple-choice\"] as QuestionType[],\n    canSelectQuestionType: false,\n    specialFormat: true,\n    prePopulatedQuestions: 4,\n  },\n} as const;\n","/**\n * Wizard Validation Hook\n *\n * Focused hook for validating quiz data across all wizard steps.\n * Provides step-specific validation logic with comprehensive error checking\n * and user-friendly validation messages.\n *\n * Extracted from useQuizWizard.ts to follow Single Responsibility Principle.\n * Handles all validation concerns, from basic info to complex question validation.\n *\n * Features:\n * - Step-specific validation rules\n * - Comprehensive error and warning collection\n * - Progressive validation (from basic to complex)\n * - Type-safe validation with detailed error messages\n * - Real-time validation feedback\n *\n * @fileoverview Validation hook for quiz creation wizard\n * @version 1.0.0\n * @since December 2025\n */\n\nimport { useCallback } from \"react\";\nimport type { Quiz, QuizValidation } from \"../types\";\nimport { QUIZ_CONSTANTS } from \"../types\";\n\n/**\n * Validation context interface\n */\nexport interface ValidationContext {\n  /** Current step being validated (0-based) */\n  currentStep: number;\n  /** Quiz data to validate */\n  draftQuiz: Partial<Quiz>;\n}\n\n/**\n * Validation actions interface\n */\nexport interface ValidationActions {\n  /** Validates the current step */\n  validateStep: () => QuizValidation;\n  /** Validates a specific step by index */\n  validateSpecificStep: (stepIndex: number) => QuizValidation;\n  /** Validates all steps for final review */\n  validateAllSteps: () => QuizValidation;\n}\n\n/**\n * Hook return interface\n */\nexport interface UseWizardValidationReturn extends ValidationActions {\n  /** Check if current step is valid */\n  isCurrentStepValid: boolean;\n  /** Check if all steps are valid */\n  isWizardComplete: boolean;\n}\n\n/**\n * Wizard Validation Hook\n *\n * Provides comprehensive validation for all steps of the quiz creation wizard.\n * Each step has specific validation requirements that must be met before\n * the user can proceed to the next step.\n *\n * @param context - Validation context with current step and quiz data\n * @returns Validation functions and state\n */\nexport const useWizardValidation = (\n  context: ValidationContext\n): UseWizardValidationReturn => {\n  const { currentStep, draftQuiz } = context;\n\n  /**\n   * Validates basic information step (step 0)\n   * Checks required fields: title, category, difficulty\n   * Provides warnings for optional but recommended fields\n   */\n  const validateBasicInfo = useCallback((): QuizValidation => {\n    const errors: string[] = [];\n    const warnings: string[] = [];\n\n    // Title validation\n    if (!draftQuiz.title?.trim()) {\n      errors.push(\"Quiz title is required\");\n    } else if (draftQuiz.title.length > QUIZ_CONSTANTS.MAX_TITLE_LENGTH) {\n      errors.push(\n        `Title must be ${QUIZ_CONSTANTS.MAX_TITLE_LENGTH} characters or less`\n      );\n    }\n\n    // Category validation\n    if (!draftQuiz.category) {\n      errors.push(\"Quiz category must be selected\");\n    }\n\n    // Difficulty validation\n    if (!draftQuiz.difficulty) {\n      errors.push(\"Quiz difficulty must be selected\");\n    }\n\n    // Description warning (optional but recommended)\n    if (!draftQuiz.description?.trim()) {\n      warnings.push(\n        \"Consider adding a description to help users understand the quiz content\"\n      );\n    }\n\n    return {\n      isValid: errors.length === 0,\n      errors,\n      warnings,\n      validatedAt: new Date(),\n    };\n  }, [draftQuiz]);\n\n  /**\n   * Validates questions step (step 1)\n   * Comprehensive validation of rounds and questions\n   * Checks question text, answer options, and correct answers\n   */\n  const validateQuestions = useCallback((): QuizValidation => {\n    const errors: string[] = [];\n    const warnings: string[] = [];\n\n    // Check if any rounds exist\n    if (!draftQuiz.rounds || draftQuiz.rounds.length < 1) {\n      errors.push(\"Quiz must have at least one round\");\n      return {\n        isValid: false,\n        errors,\n        warnings,\n        validatedAt: new Date(),\n      };\n    }\n\n    // Validate each round and its questions\n    draftQuiz.rounds.forEach((round, rIdx) => {\n      const roundNum = rIdx + 1;\n\n      // Check if round has questions\n      if (!round.questions || round.questions.length < 1) {\n        errors.push(`Round ${roundNum} must have at least one question`);\n        return;\n      }\n\n      // Validate each question in the round\n      round.questions.forEach((question, qIdx) => {\n        // Skip validation if question is undefined or incomplete\n        if (!question || typeof question !== \"object\") {\n          return;\n        }\n\n        const questionNum = qIdx + 1;\n        const questionRef = `Round ${roundNum}, Question ${questionNum}`;\n\n        // Question text validation\n        if (!question.question?.trim()) {\n          errors.push(`${questionRef}: Question text is required`);\n        }\n\n        // Type-specific validation\n        if (question.type === \"single-answer\") {\n          // Single answer validation\n          if (!question.correctAnswerText?.trim()) {\n            warnings.push(`${questionRef}: Consider adding an answer`);\n          }\n        } else if (\n          [\"multiple-choice\", \"picture\", \"audio\", \"video\"].includes(\n            question.type\n          )\n        ) {\n          // Multiple choice and media type validation\n          if (round.type === \"golden-pyramid\") {\n            // Special handling for Golden Pyramid questions - allow partial completion\n            // Users can work on questions gradually and save incomplete ones\n            if (\n              !question.possibleAnswers ||\n              !Array.isArray(question.possibleAnswers) ||\n              question.possibleAnswers.length === 0 ||\n              question.possibleAnswers.every((answer) => !answer?.trim())\n            ) {\n              warnings.push(\n                `${questionRef}: Consider adding at least one answer option`\n              );\n            }\n          } else {\n            // Regular multiple choice validation (including media types)\n            // Allow users to save incomplete questions and work on them gradually\n\n            // Check minimum options\n            if (\n              !question.possibleAnswers ||\n              !Array.isArray(question.possibleAnswers) ||\n              question.possibleAnswers.length < QUIZ_CONSTANTS.MIN_OPTIONS\n            ) {\n              warnings.push(\n                `${questionRef}: Consider adding at least ${QUIZ_CONSTANTS.MIN_OPTIONS} answer options`\n              );\n            }\n\n            // Check correct answer selection - add safety checks\n            if (\n              !question.correctAnswers ||\n              !Array.isArray(question.correctAnswers) ||\n              question.correctAnswers.length === 0\n            ) {\n              warnings.push(\n                `${questionRef}: Consider selecting at least one correct answer`\n              );\n            } else if (\n              question.possibleAnswers &&\n              Array.isArray(question.possibleAnswers)\n            ) {\n              // Validate correct answer indices are within range\n              const possibleAnswersLength =\n                question.possibleAnswers?.length || 0;\n              const invalidIndices = question.correctAnswers.filter(\n                (index) =>\n                  typeof index !== \"number\" ||\n                  index < 0 ||\n                  index >= possibleAnswersLength\n              );\n              if (invalidIndices.length > 0) {\n                warnings.push(\n                  `${questionRef}: Some correct answer selections may be invalid`\n                );\n              }\n            }\n\n            // Check for empty options - convert to warning for gradual completion\n            if (\n              question.possibleAnswers &&\n              Array.isArray(question.possibleAnswers)\n            ) {\n              const emptyOptions = question.possibleAnswers.filter(\n                (opt) => !opt?.trim()\n              );\n              if (emptyOptions.length > 0) {\n                warnings.push(\n                  `${questionRef}: Consider filling in all answer options`\n                );\n              }\n            }\n\n            // Warning for too many options (usability) - add safety checks\n            if (\n              question.possibleAnswers &&\n              Array.isArray(question.possibleAnswers) &&\n              question.possibleAnswers.length > QUIZ_CONSTANTS.MAX_OPTIONS\n            ) {\n              warnings.push(\n                `${questionRef}: Consider limiting to ${QUIZ_CONSTANTS.MAX_OPTIONS} options for better usability`\n              );\n            }\n          }\n        }\n\n        // Question length warnings\n        if (question.question && question.question.length > 200) {\n          warnings.push(`${questionRef}: Long questions may be harder to read`);\n        }\n      });\n\n      // Round-level warnings\n      if (round.questions.length > 10) {\n        warnings.push(\n          `Round ${roundNum}: Many questions in one round may overwhelm users`\n        );\n      }\n    });\n\n    return {\n      isValid: errors.length === 0,\n      errors,\n      warnings,\n      validatedAt: new Date(),\n    };\n  }, [draftQuiz.rounds]);\n\n  /**\n   * Validates review step (step 2)\n   * Final comprehensive validation before quiz creation\n   * Ensures all previous steps are complete and valid\n   */\n  const validateReview = useCallback((): QuizValidation => {\n    const errors: string[] = [];\n    const warnings: string[] = [];\n\n    // Validate basic info completeness\n    const basicInfoValid = !!draftQuiz.title?.trim();\n    if (!basicInfoValid) {\n      errors.push(\"Basic quiz information is incomplete\");\n    }\n\n    // Validate rounds and questions completeness\n    const roundsValid =\n      draftQuiz.rounds &&\n      draftQuiz.rounds.length > 0 &&\n      draftQuiz.rounds.every((r) => r.questions && r.questions.length > 0);\n    if (!roundsValid) {\n      errors.push(\"Quiz must have at least one round with questions\");\n    }\n\n    // Validate settings completeness\n    const settingsValid = !!draftQuiz.settings;\n    if (!settingsValid) {\n      errors.push(\"Quiz settings are required\");\n    }\n\n    // Calculate total questions for duration estimate\n    const totalQuestions =\n      draftQuiz.rounds?.reduce(\n        (sum, round) => sum + (round.questions?.length || 0),\n        0\n      ) || 0;\n\n    // Warnings for quiz structure\n    if (totalQuestions < 5) {\n      warnings.push(\"Quiz has fewer than 5 questions - consider adding more\");\n    }\n    if (totalQuestions > 50) {\n      warnings.push(\n        \"Quiz has many questions - consider splitting into multiple quizzes\"\n      );\n    }\n\n    return {\n      isValid: errors.length === 0,\n      errors,\n      warnings,\n      validatedAt: new Date(),\n    };\n  }, [draftQuiz]);\n\n  /**\n   * Validates the current step based on step index\n   * Routes to appropriate step-specific validation function\n   */\n  const validateStep = useCallback((): QuizValidation => {\n    switch (currentStep) {\n      case 0: // Basic Info Step\n        return validateBasicInfo();\n      case 1: // Questions Step\n        return validateQuestions();\n      case 2: // Review Step\n        return validateReview();\n      default:\n        return {\n          isValid: false,\n          errors: [\"Invalid step\"],\n          warnings: [],\n          validatedAt: new Date(),\n        };\n    }\n  }, [currentStep, validateBasicInfo, validateQuestions, validateReview]);\n\n  /**\n   * Validates a specific step by index\n   * Useful for checking completion of previous steps\n   */\n  const validateSpecificStep = useCallback(\n    (stepIndex: number): QuizValidation => {\n      switch (stepIndex) {\n        case 0:\n          return validateBasicInfo();\n        case 1:\n          return validateQuestions();\n        case 2:\n          return validateReview();\n        default:\n          return {\n            isValid: false,\n            errors: [\"Invalid step index\"],\n            warnings: [],\n            validatedAt: new Date(),\n          };\n      }\n    },\n    [validateBasicInfo, validateQuestions, validateReview]\n  );\n\n  /**\n   * Validates all steps for final quiz creation\n   * Ensures entire wizard is complete and valid\n   */\n  const validateAllSteps = useCallback((): QuizValidation => {\n    const allErrors: string[] = [];\n    const allWarnings: string[] = [];\n\n    // Validate each step\n    [0, 1, 2].forEach((stepIndex) => {\n      const stepValidation = validateSpecificStep(stepIndex);\n      allErrors.push(...stepValidation.errors);\n      allWarnings.push(...stepValidation.warnings);\n    });\n\n    return {\n      isValid: allErrors.length === 0,\n      errors: allErrors,\n      warnings: allWarnings,\n      validatedAt: new Date(),\n    };\n  }, [validateSpecificStep]);\n\n  // Compute derived state\n  const currentStepValidation = validateStep();\n  const isCurrentStepValid = currentStepValidation.isValid;\n  const allStepsValidation = validateAllSteps();\n  const isWizardComplete = allStepsValidation.isValid;\n\n  return {\n    validateStep,\n    validateSpecificStep,\n    validateAllSteps,\n    isCurrentStepValid,\n    isWizardComplete,\n  };\n};\n","/**\n * Wizard Completion Hook\n *\n * Focused hook for managing quiz creation completion and finalization.\n * Handles the final quiz object creation, validation, and data transformation\n * from draft to production-ready quiz.\n *\n * Extracted from useQuizWizard.ts to follow Single Responsibility Principle.\n * Manages only completion concerns, leaving navigation and persistence to other hooks.\n *\n * Features:\n * - Final quiz validation and creation\n * - Data transformation from draft to final format\n * - Automatic timestamp and ID generation\n * - Duration calculation based on question count\n * - Error handling for incomplete data\n *\n * @fileoverview Completion hook for quiz creation wizard\n * @version 1.0.0\n * @since December 2025\n */\n\nimport { useCallback } from \"react\";\nimport type { Quiz, QuizValidation } from \"../types\";\n\n/**\n * Completion context interface\n */\nexport interface CompletionContext {\n  /** Current draft quiz data */\n  draftQuiz: Partial<Quiz>;\n  /** Function to validate all wizard steps */\n  validateAllSteps: () => QuizValidation;\n  /** Function to clear draft after completion */\n  clearDraft: () => void;\n  /** Function to reset draft to defaults */\n  resetDraft: () => void;\n}\n\n/**\n * Completion actions interface\n */\nexport interface CompletionActions {\n  /** Complete wizard and create final quiz */\n  completeWizard: () => Promise<Quiz>;\n  /** Check if wizard can be completed */\n  canComplete: () => boolean;\n  /** Get completion readiness status */\n  getCompletionStatus: () => {\n    ready: boolean;\n    errors: string[];\n    warnings: string[];\n  };\n}\n\n/**\n * Hook return interface\n */\nexport interface UseWizardCompletionReturn extends CompletionActions {\n  /** Whether wizard is ready for completion */\n  isReady: boolean;\n}\n\n/**\n * Wizard Completion Hook\n *\n * Manages the final step of quiz creation - transforming the draft quiz\n * into a complete, production-ready quiz object with all required metadata.\n *\n * @param context - Completion context with draft data and validation\n * @returns Completion functions and status\n */\nexport const useWizardCompletion = (\n  context: CompletionContext\n): UseWizardCompletionReturn => {\n  const { draftQuiz, clearDraft } = context;\n\n  /**\n   * Calculates estimated quiz duration based on content\n   * Uses question count and complexity to estimate time needed\n   *\n   * @param rounds - Quiz rounds to analyze\n   * @returns Estimated duration in minutes\n   */\n  const calculateEstimatedDuration = useCallback(\n    (rounds: Quiz[\"rounds\"]): number => {\n      const totalQuestions = rounds.reduce(\n        (sum, round) => sum + (round.questions?.length || 0),\n        0\n      );\n\n      // Base calculation: 1.5 minutes per question\n      const baseDuration = Math.ceil(totalQuestions * 1.5);\n\n      // Factor in question complexity (longer questions need more time)\n      const complexityFactor = rounds.reduce((factor, round) => {\n        const avgQuestionLength =\n          round.questions.reduce(\n            (sum, q) => sum + (q.question?.length || 0),\n            0\n          ) / round.questions.length;\n\n        // Add time for longer questions\n        return factor + (avgQuestionLength > 100 ? 0.5 : 0);\n      }, 0);\n\n      // Minimum 5 minutes, add complexity time\n      return Math.max(5, baseDuration + Math.ceil(complexityFactor));\n    },\n    []\n  );\n\n  /**\n   * Generates a unique quiz ID or preserves existing one for edits\n   * Combines timestamp and random string for uniqueness for new quizzes\n   * Preserves original ID for quiz edits to prevent duplicates\n   *\n   * @returns Quiz identifier (new for create, existing for edit)\n   */\n  const generateQuizId = useCallback((): string => {\n    // If we have an existing quiz ID (from edit mode), preserve it\n    if (draftQuiz.id && !draftQuiz.id.startsWith(\"draft_\")) {\n      return draftQuiz.id;\n    }\n\n    // For new quizzes, generate unique ID\n    const timestamp = Date.now();\n    const randomPart = Math.random().toString(36).substr(2, 9);\n    return `quiz_${timestamp}_${randomPart}`;\n  }, [draftQuiz.id]);\n\n  /**\n   * Transforms draft quiz into complete quiz object\n   * Adds all required metadata and validates data integrity\n   * Now much more lenient - only requires title\n   * Preserves original quiz ID for edits to prevent duplicates\n   *\n   * @returns Complete quiz object ready for storage\n   */\n  const createCompleteQuiz = useCallback((): Quiz => {\n    // Only require title - everything else gets defaults\n    if (!draftQuiz.title?.trim()) {\n      throw new Error(\"Quiz title is required\");\n    }\n\n    const now = new Date();\n    const isEditMode = draftQuiz.id && !draftQuiz.id.startsWith(\"draft_\");\n\n    // Provide defaults for missing fields\n    const rounds = draftQuiz.rounds || [];\n    const settings = draftQuiz.settings || {\n      allowHints: false,\n      showCorrectAnswers: true,\n      timeLimit: null,\n      randomizeQuestions: false,\n      randomizeAnswers: false,\n    };\n\n    const estimatedDuration = Math.max(\n      rounds.length > 0 ? calculateEstimatedDuration(rounds) : 5,\n      draftQuiz.estimatedDuration || 5\n    );\n\n    // Create complete quiz object with all metadata\n    const completedQuiz: Quiz = {\n      id: generateQuizId(), // This now preserves original ID for edits\n      title: draftQuiz.title.trim(),\n      description: draftQuiz.description?.trim() || \"\",\n      category: draftQuiz.category || \"general\",\n      difficulty: draftQuiz.difficulty || \"medium\",\n      estimatedDuration,\n      // Preserve original creation date for edits, set new for creates\n      createdAt: isEditMode ? draftQuiz.createdAt || now : now,\n      updatedAt: now, // Always update the modification time\n      settings,\n      rounds: rounds.map((round) => ({\n        ...round,\n        // Ensure round metadata\n        id:\n          round.id ||\n          `round_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`,\n        createdAt: round.createdAt || now,\n        updatedAt: round.updatedAt || now,\n        // Process questions with metadata (allow empty questions)\n        questions: (round.questions || []).map((question) => ({\n          ...question,\n          id:\n            question.id ||\n            `q_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`,\n          createdAt: question.createdAt || now,\n          updatedAt: question.updatedAt || now,\n        })),\n      })),\n    };\n\n    return completedQuiz;\n  }, [draftQuiz, calculateEstimatedDuration, generateQuizId]);\n\n  /**\n   * Checks if wizard can be completed\n   * Now much more lenient - only requires title\n   *\n   * @returns True if wizard can be completed\n   */\n  const canComplete = useCallback((): boolean => {\n    // Only require title for completion\n    return !!draftQuiz.title?.trim();\n  }, [draftQuiz.title]);\n\n  /**\n   * Gets detailed completion readiness status\n   * Provides errors and warnings for UI feedback\n   *\n   * @returns Completion status with detailed feedback\n   */\n  const getCompletionStatus = useCallback(() => {\n    const errors: string[] = [];\n    const warnings: string[] = [];\n\n    // Only check for title\n    if (!draftQuiz.title?.trim()) {\n      errors.push(\"Quiz title is required\");\n    }\n\n    // Add warnings for missing optional fields\n    if (!draftQuiz.category) {\n      warnings.push(\"Consider adding a category\");\n    }\n    if (!draftQuiz.difficulty) {\n      warnings.push(\"Consider setting a difficulty level\");\n    }\n    if (!draftQuiz.rounds || draftQuiz.rounds.length === 0) {\n      warnings.push(\"Consider adding some questions\");\n    }\n\n    return {\n      ready: errors.length === 0,\n      errors,\n      warnings,\n    };\n  }, [draftQuiz]);\n\n  /**\n   * Completes the wizard and creates the final quiz\n   * Now bypasses strict validation and only requires title\n   * Clears draft data upon successful completion\n   *\n   * @returns Promise resolving to the completed quiz\n   * @throws Error if title is missing\n   */\n  const completeWizard = useCallback(async (): Promise<Quiz> => {\n    // Only check for title\n    if (!draftQuiz.title?.trim()) {\n      throw new Error(\"Quiz title is required\");\n    }\n\n    try {\n      // Create the complete quiz object\n      const completedQuiz = createCompleteQuiz();\n\n      // Debug log for development troubleshooting\n      if (process.env.NODE_ENV !== \"production\") {\n        // eslint-disable-next-line no-console\n        console.log(\"[WizardCompletion] Quiz created successfully:\", {\n          id: completedQuiz.id,\n          title: completedQuiz.title,\n          rounds: completedQuiz.rounds.length,\n          totalQuestions: completedQuiz.rounds.reduce(\n            (sum, r) => sum + r.questions.length,\n            0\n          ),\n          estimatedDuration: completedQuiz.estimatedDuration,\n        });\n      }\n\n      // Clear draft data after successful creation\n      clearDraft();\n\n      return completedQuiz;\n    } catch (error) {\n      // Log error for debugging\n      console.error(\"[WizardCompletion] Failed to create quiz:\", error);\n\n      // Re-throw with more context\n      if (error instanceof Error) {\n        throw new Error(`Quiz creation failed: ${error.message}`);\n      } else {\n        throw new Error(\"Quiz creation failed due to unknown error\");\n      }\n    }\n  }, [draftQuiz.title, createCompleteQuiz, clearDraft]);\n\n  // Compute derived state\n  const isReady = canComplete();\n\n  return {\n    completeWizard,\n    canComplete,\n    getCompletionStatus,\n    isReady,\n  };\n};\n","/**\n * IndexedDB Service for Quiz Data Persistence\n *\n * Provides a robust IndexedDB-based storage solution for quiz data with\n * support for large media files, auto-save functionality, and fallback\n * to localStorage when IndexedDB is unavailable.\n *\n * Features:\n * - Large file storage (up to 500MB total)\n * - Auto-save with draft management\n * - Data migration from localStorage\n * - Error handling and fallback strategies\n * - Performance monitoring\n *\n * @fileoverview IndexedDB service for quiz data persistence\n * @version 1.0.0\n * @since December 2025\n */\n\nimport type { Quiz, MediaFile } from \"../types\";\n\n/**\n * Database configuration constants\n */\nconst DB_CONFIG = {\n  name: \"QuizzardDB\",\n  version: 1,\n  stores: {\n    quizzes: \"quizzes\",\n    drafts: \"drafts\",\n    mediaFiles: \"mediaFiles\",\n    metadata: \"metadata\",\n  },\n} as const;\n\n/**\n * Storage limits and thresholds\n */\nexport const STORAGE_LIMITS = {\n  TOTAL_QUIZ_SIZE: 500 * 1024 * 1024, // 500MB total\n  SINGLE_IMAGE: 10 * 1024 * 1024, // 10MB per image\n  SINGLE_AUDIO: 20 * 1024 * 1024, // 20MB per audio\n  SINGLE_VIDEO: 100 * 1024 * 1024, // 100MB per video\n  WARNING_THRESHOLD: 400 * 1024 * 1024, // Warn at 400MB\n} as const;\n\n/**\n * Auto-save configuration\n */\nexport const AUTO_SAVE_CONFIG = {\n  DEBOUNCE_DELAY: 30000, // 30 seconds\n  MAX_RETRIES: 3, // Retry failed saves\n  RETRY_DELAY: 5000, // 5 seconds between retries\n  DRAFT_CLEANUP_DAYS: 30, // Remove drafts older than 30 days\n} as const;\n\n/**\n * Database metadata interface\n */\ninterface DatabaseMetadata {\n  version: string;\n  lastSync?: Date;\n  totalSize: number;\n  createdAt: Date;\n  lastCleanup?: Date;\n}\n\n/**\n * Storage operation result\n */\ninterface StorageResult<T = any> {\n  success: boolean;\n  data?: T;\n  error?: string;\n  usedFallback?: boolean;\n}\n\n/**\n * Storage usage information\n */\nexport interface StorageUsage {\n  totalSize: number;\n  quizzesSize: number;\n  draftsSize: number;\n  mediaFilesSize: number;\n  remainingSpace: number;\n  percentageUsed: number;\n  isNearLimit: boolean;\n}\n\n/**\n * IndexedDB Service Class\n */\nclass IndexedDBService {\n  private db: IDBDatabase | null = null;\n  private isInitialized = false;\n  private initPromise: Promise<boolean> | null = null;\n\n  /**\n   * Initialize the IndexedDB database\n   */\n  async initialize(): Promise<boolean> {\n    if (this.initPromise) {\n      return this.initPromise;\n    }\n\n    this.initPromise = this._initializeDB();\n    return this.initPromise;\n  }\n\n  /**\n   * Internal database initialization\n   */\n  private async _initializeDB(): Promise<boolean> {\n    try {\n      // Check if IndexedDB is available\n      if (!window.indexedDB) {\n        console.warn(\"IndexedDB not available, will use localStorage fallback\");\n        return false;\n      }\n\n      return new Promise((resolve, reject) => {\n        const request = indexedDB.open(DB_CONFIG.name, DB_CONFIG.version);\n\n        request.onerror = () => {\n          console.error(\"Failed to open IndexedDB:\", request.error);\n          reject(false);\n        };\n\n        request.onsuccess = () => {\n          this.db = request.result;\n          this.isInitialized = true;\n          console.log(\"IndexedDB initialized successfully\");\n          resolve(true);\n        };\n\n        request.onupgradeneeded = (event) => {\n          const db = (event.target as IDBOpenDBRequest).result;\n\n          // Create object stores\n          if (!db.objectStoreNames.contains(DB_CONFIG.stores.quizzes)) {\n            const quizzesStore = db.createObjectStore(\n              DB_CONFIG.stores.quizzes,\n              {\n                keyPath: \"id\",\n              }\n            );\n            quizzesStore.createIndex(\"status\", \"status\", { unique: false });\n            quizzesStore.createIndex(\"createdAt\", \"createdAt\", {\n              unique: false,\n            });\n            quizzesStore.createIndex(\"category\", \"category\", { unique: false });\n          }\n\n          if (!db.objectStoreNames.contains(DB_CONFIG.stores.drafts)) {\n            const draftsStore = db.createObjectStore(DB_CONFIG.stores.drafts, {\n              keyPath: \"id\",\n            });\n            draftsStore.createIndex(\"lastSaved\", \"lastSaved\", {\n              unique: false,\n            });\n          }\n\n          if (!db.objectStoreNames.contains(DB_CONFIG.stores.mediaFiles)) {\n            const mediaStore = db.createObjectStore(\n              DB_CONFIG.stores.mediaFiles,\n              {\n                keyPath: \"id\",\n              }\n            );\n            mediaStore.createIndex(\"type\", \"type\", { unique: false });\n            mediaStore.createIndex(\"size\", \"size\", { unique: false });\n          }\n\n          if (!db.objectStoreNames.contains(DB_CONFIG.stores.metadata)) {\n            db.createObjectStore(DB_CONFIG.stores.metadata, {\n              keyPath: \"key\",\n            });\n          }\n        };\n      });\n    } catch (error) {\n      console.error(\"IndexedDB initialization failed:\", error);\n      return false;\n    }\n  }\n\n  /**\n   * Execute a transaction with error handling\n   */\n  private async executeTransaction<T>(\n    storeNames: string | string[],\n    mode: IDBTransactionMode,\n    operation: (transaction: IDBTransaction) => Promise<T>\n  ): Promise<StorageResult<T>> {\n    try {\n      if (!this.db) {\n        throw new Error(\"Database not initialized\");\n      }\n\n      const transaction = this.db.transaction(storeNames, mode);\n\n      return new Promise((resolve) => {\n        transaction.oncomplete = () => {\n          // Transaction completed successfully\n        };\n\n        transaction.onerror = () => {\n          resolve({\n            success: false,\n            error: `Transaction failed: ${transaction.error?.message}`,\n          });\n        };\n\n        operation(transaction)\n          .then((data) => {\n            resolve({ success: true, data });\n          })\n          .catch((error) => {\n            resolve({\n              success: false,\n              error: error.message || \"Operation failed\",\n            });\n          });\n      });\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : \"Unknown error\",\n      };\n    }\n  }\n\n  /**\n   * Save a quiz (completed quiz)\n   */\n  async saveQuiz(quiz: Quiz): Promise<StorageResult<Quiz>> {\n    await this.initialize();\n\n    if (!this.isInitialized) {\n      return this.saveQuizFallback(quiz);\n    }\n\n    // Check storage limits before saving\n    const usage = await this.getStorageUsage();\n    const quizSize = this.calculateQuizSize(quiz);\n\n    if (usage.totalSize + quizSize > STORAGE_LIMITS.TOTAL_QUIZ_SIZE) {\n      return {\n        success: false,\n        error:\n          \"Storage limit exceeded. Please delete some quizzes or media files.\",\n      };\n    }\n\n    return this.executeTransaction(\n      [DB_CONFIG.stores.quizzes, DB_CONFIG.stores.mediaFiles],\n      \"readwrite\",\n      async (transaction) => {\n        const quizzesStore = transaction.objectStore(DB_CONFIG.stores.quizzes);\n        const mediaStore = transaction.objectStore(DB_CONFIG.stores.mediaFiles);\n\n        // Save media files first\n        for (const round of quiz.rounds) {\n          for (const question of round.questions) {\n            if (question.mediaFile) {\n              await this.putInStore(mediaStore, question.mediaFile);\n            }\n          }\n        }\n\n        // Save the quiz\n        await this.putInStore(quizzesStore, quiz);\n\n        // Update metadata\n        await this.updateMetadata();\n\n        return quiz;\n      }\n    );\n  }\n\n  /**\n   * Save a draft quiz (auto-save)\n   */\n  async saveDraft(\n    draft: Partial<Quiz> & { id: string }\n  ): Promise<StorageResult<Partial<Quiz>>> {\n    await this.initialize();\n\n    if (!this.isInitialized) {\n      return this.saveDraftFallback(draft);\n    }\n\n    const draftWithTimestamp = {\n      ...draft,\n      lastSaved: new Date(),\n      isDraft: true,\n    };\n\n    return this.executeTransaction(\n      DB_CONFIG.stores.drafts,\n      \"readwrite\",\n      async (transaction) => {\n        const store = transaction.objectStore(DB_CONFIG.stores.drafts);\n        await this.putInStore(store, draftWithTimestamp);\n        return draftWithTimestamp;\n      }\n    );\n  }\n\n  /**\n   * Load all quizzes\n   */\n  async loadQuizzes(): Promise<StorageResult<Quiz[]>> {\n    await this.initialize();\n\n    if (!this.isInitialized) {\n      return this.loadQuizzesFallback();\n    }\n\n    return this.executeTransaction(\n      DB_CONFIG.stores.quizzes,\n      \"readonly\",\n      async (transaction) => {\n        const store = transaction.objectStore(DB_CONFIG.stores.quizzes);\n        const request = store.getAll();\n\n        return new Promise<Quiz[]>((resolve, reject) => {\n          request.onsuccess = () => resolve(request.result || []);\n          request.onerror = () => reject(request.error);\n        });\n      }\n    );\n  }\n\n  /**\n   * Load a specific quiz by ID\n   */\n  async loadQuiz(id: string): Promise<StorageResult<Quiz | null>> {\n    await this.initialize();\n\n    if (!this.isInitialized) {\n      return this.loadQuizFallback(id);\n    }\n\n    return this.executeTransaction(\n      DB_CONFIG.stores.quizzes,\n      \"readonly\",\n      async (transaction) => {\n        const store = transaction.objectStore(DB_CONFIG.stores.quizzes);\n        const request = store.get(id);\n\n        return new Promise<Quiz | null>((resolve, reject) => {\n          request.onsuccess = () => resolve(request.result || null);\n          request.onerror = () => reject(request.error);\n        });\n      }\n    );\n  }\n\n  /**\n   * Load all drafts\n   */\n  async loadDrafts(): Promise<StorageResult<Partial<Quiz>[]>> {\n    await this.initialize();\n\n    if (!this.isInitialized) {\n      return this.loadDraftsFallback();\n    }\n\n    return this.executeTransaction(\n      DB_CONFIG.stores.drafts,\n      \"readonly\",\n      async (transaction) => {\n        const store = transaction.objectStore(DB_CONFIG.stores.drafts);\n        const request = store.getAll();\n\n        return new Promise<Partial<Quiz>[]>((resolve, reject) => {\n          request.onsuccess = () => resolve(request.result || []);\n          request.onerror = () => reject(request.error);\n        });\n      }\n    );\n  }\n\n  /**\n   * Delete a quiz\n   */\n  async deleteQuiz(id: string): Promise<StorageResult<boolean>> {\n    await this.initialize();\n\n    if (!this.isInitialized) {\n      return this.deleteQuizFallback(id);\n    }\n\n    return this.executeTransaction(\n      [DB_CONFIG.stores.quizzes, DB_CONFIG.stores.mediaFiles],\n      \"readwrite\",\n      async (transaction) => {\n        const quizzesStore = transaction.objectStore(DB_CONFIG.stores.quizzes);\n        const mediaStore = transaction.objectStore(DB_CONFIG.stores.mediaFiles);\n\n        // Get quiz to find associated media files\n        const quiz = await this.getFromStore<Quiz>(quizzesStore, id);\n\n        if (quiz) {\n          // Delete associated media files\n          for (const round of quiz.rounds) {\n            for (const question of round.questions) {\n              if (question.mediaFile) {\n                await this.deleteFromStore(mediaStore, question.mediaFile.id);\n              }\n            }\n          }\n        }\n\n        // Delete the quiz\n        await this.deleteFromStore(quizzesStore, id);\n\n        // Update metadata\n        await this.updateMetadata();\n\n        return true;\n      }\n    );\n  }\n\n  /**\n   * Delete a draft\n   */\n  async deleteDraft(id: string): Promise<StorageResult<boolean>> {\n    await this.initialize();\n\n    if (!this.isInitialized) {\n      return this.deleteDraftFallback(id);\n    }\n\n    return this.executeTransaction(\n      DB_CONFIG.stores.drafts,\n      \"readwrite\",\n      async (transaction) => {\n        const store = transaction.objectStore(DB_CONFIG.stores.drafts);\n        await this.deleteFromStore(store, id);\n        return true;\n      }\n    );\n  }\n\n  /**\n   * Get current storage usage\n   */\n  async getStorageUsage(): Promise<StorageUsage> {\n    await this.initialize();\n\n    if (!this.isInitialized) {\n      return this.getStorageUsageFallback();\n    }\n\n    try {\n      const [quizzesResult, draftsResult, mediaResult] = await Promise.all([\n        this.calculateStoreSize(DB_CONFIG.stores.quizzes),\n        this.calculateStoreSize(DB_CONFIG.stores.drafts),\n        this.calculateStoreSize(DB_CONFIG.stores.mediaFiles),\n      ]);\n\n      const totalSize = quizzesResult + draftsResult + mediaResult;\n      const remainingSpace = STORAGE_LIMITS.TOTAL_QUIZ_SIZE - totalSize;\n      const percentageUsed = (totalSize / STORAGE_LIMITS.TOTAL_QUIZ_SIZE) * 100;\n\n      return {\n        totalSize,\n        quizzesSize: quizzesResult,\n        draftsSize: draftsResult,\n        mediaFilesSize: mediaResult,\n        remainingSpace: Math.max(0, remainingSpace),\n        percentageUsed: Math.min(100, percentageUsed),\n        isNearLimit: percentageUsed > 80,\n      };\n    } catch (error) {\n      console.error(\"Error calculating storage usage:\", error);\n      return {\n        totalSize: 0,\n        quizzesSize: 0,\n        draftsSize: 0,\n        mediaFilesSize: 0,\n        remainingSpace: STORAGE_LIMITS.TOTAL_QUIZ_SIZE,\n        percentageUsed: 0,\n        isNearLimit: false,\n      };\n    }\n  }\n\n  /**\n   * Clean up old drafts (older than configured days)\n   */\n  async cleanupOldDrafts(): Promise<StorageResult<number>> {\n    await this.initialize();\n\n    if (!this.isInitialized) {\n      return { success: true, data: 0 };\n    }\n\n    const cutoffDate = new Date();\n    cutoffDate.setDate(\n      cutoffDate.getDate() - AUTO_SAVE_CONFIG.DRAFT_CLEANUP_DAYS\n    );\n\n    return this.executeTransaction(\n      DB_CONFIG.stores.drafts,\n      \"readwrite\",\n      async (transaction) => {\n        const store = transaction.objectStore(DB_CONFIG.stores.drafts);\n        const index = store.index(\"lastSaved\");\n        const range = IDBKeyRange.upperBound(cutoffDate);\n        const request = index.openCursor(range);\n\n        let deletedCount = 0;\n\n        return new Promise<number>((resolve, reject) => {\n          request.onsuccess = (event) => {\n            const cursor = (event.target as IDBRequest).result;\n            if (cursor) {\n              cursor.delete();\n              deletedCount++;\n              cursor.continue();\n            } else {\n              resolve(deletedCount);\n            }\n          };\n          request.onerror = () => reject(request.error);\n        });\n      }\n    );\n  }\n\n  /**\n   * Clear ALL storage data (both IndexedDB and localStorage)\n   * This is used when user explicitly wants to clear all data\n   */\n  async clearAllStorage(): Promise<StorageResult<boolean>> {\n    try {\n      await this.initialize();\n\n      // Clear IndexedDB if available\n      if (this.isInitialized && this.db) {\n        // Clear all object stores\n        const storeNames = [\n          DB_CONFIG.stores.quizzes,\n          DB_CONFIG.stores.drafts,\n          DB_CONFIG.stores.mediaFiles,\n          DB_CONFIG.stores.metadata,\n        ];\n\n        for (const storeName of storeNames) {\n          await this.executeTransaction(\n            storeName,\n            \"readwrite\",\n            async (transaction) => {\n              const store = transaction.objectStore(storeName);\n              return new Promise<void>((resolve, reject) => {\n                const request = store.clear();\n                request.onsuccess = () => resolve();\n                request.onerror = () => reject(request.error);\n              });\n            }\n          );\n        }\n      }\n\n      // Also clear localStorage fallback data\n      try {\n        localStorage.removeItem(\"quizzard_quizzes\");\n        localStorage.removeItem(\"quizzard_drafts\");\n        // Clear any other quiz-related localStorage keys\n        Object.keys(localStorage).forEach((key) => {\n          if (key.startsWith(\"quizzard\") || key.startsWith(\"Quizzard\")) {\n            localStorage.removeItem(key);\n          }\n        });\n      } catch (error) {\n        console.warn(\"Failed to clear localStorage:\", error);\n      }\n\n      return { success: true, data: true };\n    } catch (error) {\n      return {\n        success: false,\n        error:\n          error instanceof Error ? error.message : \"Failed to clear storage\",\n      };\n    }\n  }\n\n  // Helper methods\n  private async putInStore(store: IDBObjectStore, data: any): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const request = store.put(data);\n      request.onsuccess = () => resolve();\n      request.onerror = () => reject(request.error);\n    });\n  }\n\n  private async getFromStore<T>(\n    store: IDBObjectStore,\n    key: string\n  ): Promise<T | null> {\n    return new Promise((resolve, reject) => {\n      const request = store.get(key);\n      request.onsuccess = () => resolve(request.result || null);\n      request.onerror = () => reject(request.error);\n    });\n  }\n\n  private async deleteFromStore(\n    store: IDBObjectStore,\n    key: string\n  ): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const request = store.delete(key);\n      request.onsuccess = () => resolve();\n      request.onerror = () => reject(request.error);\n    });\n  }\n\n  private async calculateStoreSize(storeName: string): Promise<number> {\n    if (!this.db) return 0;\n\n    return new Promise((resolve, reject) => {\n      const transaction = this.db!.transaction(storeName, \"readonly\");\n      const store = transaction.objectStore(storeName);\n      const request = store.getAll();\n\n      request.onsuccess = () => {\n        const items = request.result || [];\n        const size = items.reduce((total, item) => {\n          return total + JSON.stringify(item).length * 2; // Rough byte estimate\n        }, 0);\n        resolve(size);\n      };\n\n      request.onerror = () => reject(request.error);\n    });\n  }\n\n  private calculateQuizSize(quiz: Quiz): number {\n    return JSON.stringify(quiz).length * 2; // Rough byte estimate\n  }\n\n  private async updateMetadata(): Promise<void> {\n    if (!this.db) return;\n\n    const usage = await this.getStorageUsage();\n    const metadata: DatabaseMetadata = {\n      version: \"1.0.0\",\n      totalSize: usage.totalSize,\n      createdAt: new Date(),\n      lastCleanup: new Date(),\n    };\n\n    const transaction = this.db.transaction(\n      DB_CONFIG.stores.metadata,\n      \"readwrite\"\n    );\n    const store = transaction.objectStore(DB_CONFIG.stores.metadata);\n    store.put({ key: \"app_metadata\", ...metadata });\n  }\n\n  // Fallback methods for localStorage\n  private saveQuizFallback(quiz: Quiz): StorageResult<Quiz> {\n    try {\n      const quizzes = this.getQuizzesFromLocalStorage();\n      const existingIndex = quizzes.findIndex((q) => q.id === quiz.id);\n\n      if (existingIndex >= 0) {\n        quizzes[existingIndex] = quiz;\n      } else {\n        quizzes.push(quiz);\n      }\n\n      localStorage.setItem(\"quizzard_quizzes\", JSON.stringify(quizzes));\n      return { success: true, data: quiz, usedFallback: true };\n    } catch (error) {\n      return {\n        success: false,\n        error:\n          \"localStorage save failed: \" +\n          (error instanceof Error ? error.message : \"Unknown error\"),\n        usedFallback: true,\n      };\n    }\n  }\n\n  private saveDraftFallback(\n    draft: Partial<Quiz> & { id: string }\n  ): StorageResult<Partial<Quiz>> {\n    try {\n      const drafts = this.getDraftsFromLocalStorage();\n      const existingIndex = drafts.findIndex((d) => d.id === draft.id);\n\n      const draftWithTimestamp = {\n        ...draft,\n        lastSaved: new Date(),\n        isDraft: true,\n      };\n\n      if (existingIndex >= 0) {\n        drafts[existingIndex] = draftWithTimestamp;\n      } else {\n        drafts.push(draftWithTimestamp);\n      }\n\n      localStorage.setItem(\"quizzard_drafts\", JSON.stringify(drafts));\n      return { success: true, data: draftWithTimestamp, usedFallback: true };\n    } catch (error) {\n      return {\n        success: false,\n        error:\n          \"localStorage draft save failed: \" +\n          (error instanceof Error ? error.message : \"Unknown error\"),\n        usedFallback: true,\n      };\n    }\n  }\n\n  private loadQuizzesFallback(): StorageResult<Quiz[]> {\n    try {\n      const quizzes = this.getQuizzesFromLocalStorage();\n      return { success: true, data: quizzes, usedFallback: true };\n    } catch (error) {\n      return {\n        success: false,\n        error:\n          \"localStorage load failed: \" +\n          (error instanceof Error ? error.message : \"Unknown error\"),\n        usedFallback: true,\n      };\n    }\n  }\n\n  private loadQuizFallback(id: string): StorageResult<Quiz | null> {\n    try {\n      const quizzes = this.getQuizzesFromLocalStorage();\n      const quiz = quizzes.find((q) => q.id === id) || null;\n      return { success: true, data: quiz, usedFallback: true };\n    } catch (error) {\n      return {\n        success: false,\n        error:\n          \"localStorage load failed: \" +\n          (error instanceof Error ? error.message : \"Unknown error\"),\n        usedFallback: true,\n      };\n    }\n  }\n\n  private loadDraftsFallback(): StorageResult<Partial<Quiz>[]> {\n    try {\n      const drafts = this.getDraftsFromLocalStorage();\n      return { success: true, data: drafts, usedFallback: true };\n    } catch (error) {\n      return {\n        success: false,\n        error:\n          \"localStorage drafts load failed: \" +\n          (error instanceof Error ? error.message : \"Unknown error\"),\n        usedFallback: true,\n      };\n    }\n  }\n\n  private deleteQuizFallback(id: string): StorageResult<boolean> {\n    try {\n      const quizzes = this.getQuizzesFromLocalStorage();\n      const filteredQuizzes = quizzes.filter((q) => q.id !== id);\n      localStorage.setItem(\"quizzard_quizzes\", JSON.stringify(filteredQuizzes));\n      return { success: true, data: true, usedFallback: true };\n    } catch (error) {\n      return {\n        success: false,\n        error:\n          \"localStorage delete failed: \" +\n          (error instanceof Error ? error.message : \"Unknown error\"),\n        usedFallback: true,\n      };\n    }\n  }\n\n  private deleteDraftFallback(id: string): StorageResult<boolean> {\n    try {\n      const drafts = this.getDraftsFromLocalStorage();\n      const filteredDrafts = drafts.filter((d) => d.id !== id);\n      localStorage.setItem(\"quizzard_drafts\", JSON.stringify(filteredDrafts));\n      return { success: true, data: true, usedFallback: true };\n    } catch (error) {\n      return {\n        success: false,\n        error:\n          \"localStorage draft delete failed: \" +\n          (error instanceof Error ? error.message : \"Unknown error\"),\n        usedFallback: true,\n      };\n    }\n  }\n\n  private getStorageUsageFallback(): StorageUsage {\n    try {\n      const quizzesData = localStorage.getItem(\"quizzard_quizzes\") || \"[]\";\n      const draftsData = localStorage.getItem(\"quizzard_drafts\") || \"[]\";\n\n      const quizzesSize = quizzesData.length * 2;\n      const draftsSize = draftsData.length * 2;\n      const totalSize = quizzesSize + draftsSize;\n\n      // localStorage has a 5-10MB limit typically\n      const localStorageLimit = 5 * 1024 * 1024; // 5MB\n      const remainingSpace = Math.max(0, localStorageLimit - totalSize);\n      const percentageUsed = (totalSize / localStorageLimit) * 100;\n\n      return {\n        totalSize,\n        quizzesSize,\n        draftsSize,\n        mediaFilesSize: 0, // No separate media storage in localStorage\n        remainingSpace,\n        percentageUsed: Math.min(100, percentageUsed),\n        isNearLimit: percentageUsed > 80,\n      };\n    } catch (error) {\n      return {\n        totalSize: 0,\n        quizzesSize: 0,\n        draftsSize: 0,\n        mediaFilesSize: 0,\n        remainingSpace: 5 * 1024 * 1024,\n        percentageUsed: 0,\n        isNearLimit: false,\n      };\n    }\n  }\n\n  private getQuizzesFromLocalStorage(): Quiz[] {\n    try {\n      const data = localStorage.getItem(\"quizzard_quizzes\");\n      return data ? JSON.parse(data) : [];\n    } catch {\n      return [];\n    }\n  }\n\n  private getDraftsFromLocalStorage(): Partial<Quiz>[] {\n    try {\n      const data = localStorage.getItem(\"quizzard_drafts\");\n      return data ? JSON.parse(data) : [];\n    } catch {\n      return [];\n    }\n  }\n}\n\n// Export singleton instance\nexport const indexedDBService = new IndexedDBService();\n","/**\n * Quiz Storage Hook\n *\n * Provides a React hook interface for quiz data persistence using IndexedDB\n * with auto-save functionality and localStorage fallback.\n *\n * Features:\n * - Automatic draft saving every 30 seconds\n * - Storage usage monitoring\n * - Error handling with user feedback\n * - Seamless fallback to localStorage\n * - Enhanced state synchronization debugging\n *\n * @fileoverview React hook for quiz data storage\n * @version 1.1.0 (Enhanced Synchronization)\n * @since December 2025\n */\n\nimport { useState, useEffect, useCallback, useRef } from \"react\";\nimport {\n  indexedDBService,\n  AUTO_SAVE_CONFIG,\n  type StorageUsage,\n} from \"../services/indexedDBService\";\nimport type { Quiz } from \"../types\";\nimport { useSnackbar } from \"../../../../shared/hooks/useSnackbar\";\nimport React from \"react\";\n\n// Debug mode for development\nconst DEBUG_SYNC = process.env.NODE_ENV === \"development\";\n\n/**\n * Enhanced debug logging for state synchronization\n */\nconst debugLog = (operation: string, data: any) => {\n  if (DEBUG_SYNC) {\n    console.log(` [QuizStorage] ${operation}:`, data);\n  }\n};\n\n/**\n * Auto-save status\n */\nexport type AutoSaveStatus = \"idle\" | \"saving\" | \"saved\" | \"error\";\n\n/**\n * Storage hook state\n */\ninterface UseQuizStorageState {\n  quizzes: Quiz[];\n  drafts: Partial<Quiz>[];\n  isLoading: boolean;\n  storageUsage: StorageUsage | null;\n  autoSaveStatus: AutoSaveStatus;\n  isInitialized: boolean;\n}\n\n/**\n * Storage hook return type\n */\nexport interface UseQuizStorageReturn extends UseQuizStorageState {\n  // Quiz operations\n  saveQuiz: (quiz: Quiz) => Promise<boolean>;\n  loadQuizzes: () => Promise<void>;\n  deleteQuiz: (id: string) => Promise<boolean>;\n\n  // Draft operations\n  saveDraft: (draft: Partial<Quiz> & { id: string }) => Promise<boolean>;\n  loadDrafts: () => Promise<void>;\n  deleteDraft: (id: string) => Promise<boolean>;\n\n  // Auto-save\n  enableAutoSave: (draft: Partial<Quiz> & { id: string }) => void;\n  disableAutoSave: () => void;\n\n  // Storage management\n  refreshStorageUsage: () => Promise<void>;\n  cleanupOldDrafts: () => Promise<number>;\n\n  // Utility\n  initializeStorage: () => Promise<boolean>;\n}\n\n/**\n * Quiz Storage Hook\n */\nexport const useQuizStorage = (): UseQuizStorageReturn => {\n  const { showSnackbar } = useSnackbar();\n\n  // State\n  const [state, setState] = useState<UseQuizStorageState>({\n    quizzes: [],\n    drafts: [],\n    isLoading: false,\n    storageUsage: null,\n    autoSaveStatus: \"idle\",\n    isInitialized: false,\n  });\n\n  // Auto-save refs\n  const autoSaveTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const currentDraftRef = useRef<(Partial<Quiz> & { id: string }) | null>(null);\n  const retryCountRef = useRef(0);\n\n  /**\n   * Initialize storage service\n   */\n  const initializeStorage = useCallback(async (): Promise<boolean> => {\n    try {\n      setState((prev) => ({ ...prev, isLoading: true }));\n\n      const initialized = await indexedDBService.initialize();\n\n      setState((prev) => ({\n        ...prev,\n        isInitialized: initialized,\n        isLoading: false,\n      }));\n\n      if (initialized) {\n        console.log(\" IndexedDB initialized successfully\");\n      } else {\n        console.warn(\" Using localStorage fallback\");\n        showSnackbar(\n          \"Using local storage - some features may be limited\",\n          \"warning\"\n        );\n      }\n\n      return initialized;\n    } catch (error) {\n      console.error(\"Storage initialization failed:\", error);\n      setState((prev) => ({\n        ...prev,\n        isInitialized: false,\n        isLoading: false,\n      }));\n\n      showSnackbar(\"Storage initialization failed\", \"error\");\n      return false;\n    }\n  }, [showSnackbar]);\n\n  /**\n   * Save a completed quiz\n   */\n  const saveQuiz = useCallback(\n    async (quiz: Quiz): Promise<boolean> => {\n      try {\n        setState((prev) => ({ ...prev, isLoading: true }));\n\n        const result = await indexedDBService.saveQuiz(quiz);\n\n        if (result.success) {\n          // Immediately update state\n          setState((prev) => ({\n            ...prev,\n            quizzes: prev.quizzes.some((q) => q.id === quiz.id)\n              ? prev.quizzes.map((q) => (q.id === quiz.id ? quiz : q))\n              : [...prev.quizzes, quiz],\n            isLoading: false,\n          }));\n\n          showSnackbar(\n            result.usedFallback\n              ? \"Quiz saved to local storage\"\n              : \"Quiz saved successfully\",\n            \"success\"\n          );\n\n          // Force reload data to ensure synchronization\n          await Promise.all([\n            loadQuizzes(),\n            loadDrafts(),\n            refreshStorageUsage(),\n          ]);\n\n          return true;\n        } else {\n          setState((prev) => ({ ...prev, isLoading: false }));\n          showSnackbar(result.error || \"Failed to save quiz\", \"error\");\n          return false;\n        }\n      } catch (error) {\n        setState((prev) => ({ ...prev, isLoading: false }));\n        console.error(\"Error saving quiz:\", error);\n        showSnackbar(\"Failed to save quiz\", \"error\");\n        return false;\n      }\n    },\n    [showSnackbar]\n  );\n\n  /**\n   * Load all quizzes\n   */\n  const loadQuizzes = useCallback(async (): Promise<void> => {\n    try {\n      setState((prev) => ({ ...prev, isLoading: true }));\n\n      const result = await indexedDBService.loadQuizzes();\n\n      if (result.success) {\n        setState((prev) => ({\n          ...prev,\n          quizzes: result.data || [],\n          isLoading: false,\n        }));\n\n        if (result.usedFallback) {\n          console.log(\" Loaded quizzes from localStorage\");\n        }\n      } else {\n        setState((prev) => ({ ...prev, isLoading: false }));\n        console.error(\"Failed to load quizzes:\", result.error);\n        showSnackbar(\"Failed to load quizzes\", \"error\");\n      }\n    } catch (error) {\n      setState((prev) => ({ ...prev, isLoading: false }));\n      console.error(\"Error loading quizzes:\", error);\n      showSnackbar(\"Failed to load quizzes\", \"error\");\n    }\n  }, [showSnackbar]);\n\n  /**\n   * Delete a quiz\n   */\n  const deleteQuiz = useCallback(\n    async (id: string): Promise<boolean> => {\n      try {\n        setState((prev) => ({ ...prev, isLoading: true }));\n\n        const result = await indexedDBService.deleteQuiz(id);\n\n        if (result.success) {\n          // Immediately update state\n          setState((prev) => ({\n            ...prev,\n            quizzes: prev.quizzes.filter((q) => q.id !== id),\n            isLoading: false,\n          }));\n\n          // Force reload data to ensure synchronization\n          await Promise.all([\n            loadQuizzes(),\n            (async () => {\n              try {\n                const draftsResult = await indexedDBService.loadDrafts();\n                if (draftsResult.success) {\n                  setState((prev) => ({\n                    ...prev,\n                    drafts: draftsResult.data || [],\n                  }));\n                }\n              } catch (error) {\n                console.error(\"Error reloading drafts:\", error);\n              }\n            })(),\n            (async () => {\n              try {\n                const usage = await indexedDBService.getStorageUsage();\n                setState((prev) => ({ ...prev, storageUsage: usage }));\n              } catch (error) {\n                console.error(\"Error refreshing storage usage:\", error);\n              }\n            })(),\n          ]);\n\n          showSnackbar(\"Quiz deleted successfully\", \"success\");\n\n          return true;\n        } else {\n          setState((prev) => ({ ...prev, isLoading: false }));\n          showSnackbar(result.error || \"Failed to delete quiz\", \"error\");\n          return false;\n        }\n      } catch (error) {\n        setState((prev) => ({ ...prev, isLoading: false }));\n        console.error(\"Error deleting quiz:\", error);\n        showSnackbar(\"Failed to delete quiz\", \"error\");\n        return false;\n      }\n    },\n    [showSnackbar, loadQuizzes]\n  );\n\n  /**\n   * Save a draft\n   */\n  const saveDraft = useCallback(\n    async (draft: Partial<Quiz> & { id: string }): Promise<boolean> => {\n      try {\n        const result = await indexedDBService.saveDraft(draft);\n\n        if (result.success) {\n          setState((prev) => ({\n            ...prev,\n            drafts: prev.drafts.some((d) => d.id === draft.id)\n              ? prev.drafts.map((d) => (d.id === draft.id ? result.data! : d))\n              : [...prev.drafts, result.data!],\n          }));\n\n          return true;\n        } else {\n          console.error(\"Failed to save draft:\", result.error);\n          return false;\n        }\n      } catch (error) {\n        console.error(\"Error saving draft:\", error);\n        return false;\n      }\n    },\n    []\n  );\n\n  /**\n   * Load all drafts\n   */\n  const loadDrafts = useCallback(async (): Promise<void> => {\n    try {\n      const result = await indexedDBService.loadDrafts();\n\n      if (result.success) {\n        setState((prev) => ({\n          ...prev,\n          drafts: result.data || [],\n        }));\n      } else {\n        console.error(\"Failed to load drafts:\", result.error);\n      }\n    } catch (error) {\n      console.error(\"Error loading drafts:\", error);\n    }\n  }, []);\n\n  /**\n   * Delete a draft\n   */\n  const deleteDraft = useCallback(async (id: string): Promise<boolean> => {\n    try {\n      const result = await indexedDBService.deleteDraft(id);\n\n      if (result.success) {\n        setState((prev) => ({\n          ...prev,\n          drafts: prev.drafts.filter((d) => d.id !== id),\n        }));\n\n        return true;\n      } else {\n        console.error(\"Failed to delete draft:\", result.error);\n        return false;\n      }\n    } catch (error) {\n      console.error(\"Error deleting draft:\", error);\n      return false;\n    }\n  }, []);\n\n  /**\n   * Auto-save implementation\n   */\n  const performAutoSave = useCallback(async () => {\n    if (!currentDraftRef.current) return;\n\n    try {\n      setState((prev) => ({ ...prev, autoSaveStatus: \"saving\" }));\n\n      const success = await saveDraft(currentDraftRef.current);\n\n      if (success) {\n        setState((prev) => ({ ...prev, autoSaveStatus: \"saved\" }));\n        retryCountRef.current = 0;\n\n        // Reset status after 2 seconds\n        setTimeout(() => {\n          setState((prev) => ({ ...prev, autoSaveStatus: \"idle\" }));\n        }, 2000);\n      } else {\n        throw new Error(\"Auto-save failed\");\n      }\n    } catch (error) {\n      console.error(\"Auto-save error:\", error);\n      setState((prev) => ({ ...prev, autoSaveStatus: \"error\" }));\n\n      // Retry logic\n      if (retryCountRef.current < AUTO_SAVE_CONFIG.MAX_RETRIES) {\n        retryCountRef.current++;\n        setTimeout(() => {\n          performAutoSave();\n        }, AUTO_SAVE_CONFIG.RETRY_DELAY);\n      } else {\n        showSnackbar(\"Auto-save failed. Please save manually.\", \"error\");\n        setTimeout(() => {\n          setState((prev) => ({ ...prev, autoSaveStatus: \"idle\" }));\n        }, 5000);\n      }\n    }\n  }, [saveDraft, showSnackbar]);\n\n  /**\n   * Enable auto-save for a draft\n   */\n  const enableAutoSave = useCallback(\n    (draft: Partial<Quiz> & { id: string }) => {\n      // Clear existing timeout\n      if (autoSaveTimeoutRef.current) {\n        clearTimeout(autoSaveTimeoutRef.current);\n      }\n\n      // Update current draft\n      currentDraftRef.current = draft;\n\n      // Set up new auto-save timeout\n      autoSaveTimeoutRef.current = setTimeout(() => {\n        performAutoSave();\n      }, AUTO_SAVE_CONFIG.DEBOUNCE_DELAY);\n    },\n    [performAutoSave]\n  );\n\n  /**\n   * Disable auto-save\n   */\n  const disableAutoSave = useCallback(() => {\n    if (autoSaveTimeoutRef.current) {\n      clearTimeout(autoSaveTimeoutRef.current);\n      autoSaveTimeoutRef.current = null;\n    }\n    currentDraftRef.current = null;\n    setState((prev) => ({ ...prev, autoSaveStatus: \"idle\" }));\n  }, []);\n\n  /**\n   * Refresh storage usage information\n   */\n  const refreshStorageUsage = useCallback(async (): Promise<void> => {\n    try {\n      const usage = await indexedDBService.getStorageUsage();\n      setState((prev) => ({ ...prev, storageUsage: usage }));\n\n      // Warn if approaching storage limit\n      if (usage.isNearLimit) {\n        showSnackbar(\n          `Storage is ${usage.percentageUsed.toFixed(\n            1\n          )}% full. Consider deleting old quizzes.`,\n          \"warning\"\n        );\n      }\n    } catch (error) {\n      console.error(\"Error getting storage usage:\", error);\n    }\n  }, [showSnackbar]);\n\n  /**\n   * Clean up old drafts\n   */\n  const cleanupOldDrafts = useCallback(async (): Promise<number> => {\n    try {\n      const result = await indexedDBService.cleanupOldDrafts();\n\n      if (result.success && result.data! > 0) {\n        showSnackbar(`Cleaned up ${result.data} old drafts`, \"info\");\n        await loadDrafts();\n        await refreshStorageUsage();\n      }\n\n      return result.data || 0;\n    } catch (error) {\n      console.error(\"Error cleaning up drafts:\", error);\n      return 0;\n    }\n  }, [loadDrafts, refreshStorageUsage, showSnackbar]);\n\n  // Initialize storage on mount\n  useEffect(() => {\n    initializeStorage();\n  }, [initializeStorage]);\n\n  // Load initial data after initialization\n  useEffect(() => {\n    if (state.isInitialized) {\n      loadQuizzes();\n      loadDrafts();\n      refreshStorageUsage();\n    }\n  }, [state.isInitialized, loadQuizzes, loadDrafts, refreshStorageUsage]);\n\n  // Cleanup auto-save on unmount\n  useEffect(() => {\n    return () => {\n      if (autoSaveTimeoutRef.current) {\n        clearTimeout(autoSaveTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  /**\n   * Enhanced updateDraft: Prevents re-creating a draft if it was deleted externally.\n   * Checks for a deletedRef (if provided) or existence in IndexedDB before saving.\n   */\n  const updateDraft = React.useCallback(\n    async (draft, deletedRef) => {\n      if (deletedRef && deletedRef.current) return; // Do not save if deleted\n      // Optionally, check if draft still exists in IndexedDB before saving\n      // ... existing updateDraft logic ...\n    },\n    [\n      /* existing deps */\n    ]\n  );\n\n  return {\n    // State\n    ...state,\n\n    // Quiz operations\n    saveQuiz,\n    loadQuizzes,\n    deleteQuiz,\n\n    // Draft operations\n    saveDraft,\n    loadDrafts,\n    deleteDraft,\n\n    // Auto-save\n    enableAutoSave,\n    disableAutoSave,\n\n    // Storage management\n    refreshStorageUsage,\n    cleanupOldDrafts,\n\n    // Utility\n    initializeStorage,\n  };\n};\n","/**\n * Enhanced Wizard Persistence Hook with IndexedDB Auto-Save\n *\n * Advanced hook for managing quiz draft persistence with IndexedDB integration.\n * Provides automatic saving, draft recovery, and robust storage management\n * during the quiz creation process.\n *\n * Enhanced Features:\n * - IndexedDB-based storage with auto-save every 30 seconds\n * - Automatic draft recovery on wizard reopen\n * - Storage status monitoring and error handling\n * - Fallback to localStorage if IndexedDB unavailable\n * - Real-time save status feedback\n * - Draft cleanup and lifecycle management\n *\n * @fileoverview Enhanced persistence hook with IndexedDB auto-save\n * @version 3.0.0 (IndexedDB Enhanced)\n * @since December 2025\n */\n\nimport { useCallback, useEffect, useState, useRef } from \"react\";\nimport type { Quiz, QuizSettings } from \"../types\";\nimport { useQuizStorage } from \"../../management/hooks/useQuizStorage\";\n\n/**\n * Default quiz settings for new quizzes\n */\nconst DEFAULT_QUIZ_SETTINGS: QuizSettings = {\n  defaultTimeLimit: 30,\n};\n\n/**\n * Default draft quiz data structure\n */\nconst DEFAULT_DRAFT_QUIZ: Partial<Quiz> = {\n  title: \"\",\n  description: \"\",\n  category: \"general\",\n  difficulty: \"medium\",\n  rounds: [],\n  estimatedDuration: 10,\n  settings: DEFAULT_QUIZ_SETTINGS,\n  status: \"draft\", // Always draft in wizard\n};\n\n/**\n * Enhanced persistence state interface\n */\nexport interface EnhancedPersistenceState {\n  /** Current draft quiz data */\n  draftQuiz: Partial<Quiz>;\n  /** Whether persistence has been initialized */\n  isInitialized: boolean;\n  /** Auto-save status */\n  autoSaveStatus: \"idle\" | \"saving\" | \"saved\" | \"error\";\n  /** Storage error if any */\n  storageError: string | null;\n  /** Last saved timestamp */\n  lastSaved: Date | null;\n}\n\n/**\n * Enhanced persistence actions interface\n */\nexport interface EnhancedPersistenceActions {\n  /** Update draft with new data (triggers auto-save) */\n  updateDraft: (updates: Partial<Quiz>) => void;\n  /** Explicitly save current draft */\n  saveDraft: () => Promise<void>;\n  /** Clear all draft data */\n  clearDraft: () => void;\n  /** Reset draft to defaults */\n  resetDraft: () => void;\n  /** Initialize draft from existing quiz */\n  initializeFromQuiz: (quiz: Partial<Quiz>) => void;\n  /** Recover existing draft if available */\n  recoverDraft: () => Promise<boolean>;\n}\n\n/**\n * Enhanced hook return interface\n */\nexport interface UseWizardPersistenceWithStorageReturn {\n  /** Enhanced persistence state */\n  persistence: EnhancedPersistenceState;\n  /** Enhanced persistence actions */\n  actions: EnhancedPersistenceActions;\n}\n\n/**\n * Enhanced Wizard Persistence Hook with IndexedDB\n *\n * Provides robust draft persistence with IndexedDB storage, auto-save functionality,\n * and comprehensive error handling. Automatically saves drafts every 30 seconds\n * and provides real-time status feedback.\n *\n * @param initialQuiz - Optional initial quiz data to populate draft\n * @returns Enhanced persistence state and control functions\n */\nexport const useWizardPersistenceWithStorage = (\n  initialQuiz?: Partial<Quiz>\n): UseWizardPersistenceWithStorageReturn => {\n  // IndexedDB storage hook\n  const {\n    saveDraft: saveToStorage,\n    loadDrafts,\n    deleteDraft: deleteDraftFromStorage,\n    autoSaveStatus,\n    storageError,\n    clearError,\n    drafts,\n  } = useQuizStorage();\n\n  // Local state\n  const [draftQuiz, setDraftQuiz] = useState<Partial<Quiz>>(DEFAULT_DRAFT_QUIZ);\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [lastSaved, setLastSaved] = useState<Date | null>(null);\n\n  // Auto-save timer ref\n  const autoSaveTimerRef = useRef<NodeJS.Timeout | null>(null);\n  const draftIdRef = useRef<string | null>(null);\n\n  /**\n   * Initialize draft from provided quiz data or recover existing draft\n   */\n  useEffect(() => {\n    if (!isInitialized) {\n      const initializeDraft = async () => {\n        try {\n          if (initialQuiz?.id) {\n            // Editing existing quiz - preserve original ID to prevent duplicates\n            const editDraft = {\n              ...initialQuiz,\n              status: \"draft\" as const,\n              // Preserve original ID for editing to avoid duplicates\n              id: initialQuiz.id,\n            };\n            setDraftQuiz(editDraft);\n            draftIdRef.current = editDraft.id;\n          } else {\n            // Creating new quiz - try to recover existing draft\n            await loadDrafts();\n\n            const existingDraft = drafts.find(\n              (d) => d.title === \"\" || !d.title\n            ); // Find empty/new draft\n\n            if (existingDraft) {\n              setDraftQuiz(existingDraft);\n              draftIdRef.current = existingDraft.id!;\n            } else {\n              // Create new draft\n              const newDraft = {\n                ...DEFAULT_DRAFT_QUIZ,\n                id: `draft_${Date.now()}_${Math.random()\n                  .toString(36)\n                  .substr(2, 9)}`,\n                createdAt: new Date(),\n              };\n              setDraftQuiz(newDraft);\n              draftIdRef.current = newDraft.id;\n            }\n          }\n        } catch (error) {\n          console.warn(\n            \"[WizardPersistence] Failed to initialize draft:\",\n            error\n          );\n          // Fallback to default draft\n          const fallbackDraft = {\n            ...DEFAULT_DRAFT_QUIZ,\n            id: `draft_${Date.now()}_${Math.random()\n              .toString(36)\n              .substr(2, 9)}`,\n            createdAt: new Date(),\n          };\n          setDraftQuiz(fallbackDraft);\n          draftIdRef.current = fallbackDraft.id;\n        } finally {\n          setIsInitialized(true);\n        }\n      };\n\n      initializeDraft();\n    }\n  }, [isInitialized, initialQuiz, loadDrafts, drafts]);\n\n  /**\n   * Auto-save functionality - saves draft every 30 seconds after changes\n   */\n  const scheduleAutoSave = useCallback(() => {\n    // Clear existing timer\n    if (autoSaveTimerRef.current) {\n      clearTimeout(autoSaveTimerRef.current);\n    }\n\n    // Schedule new save\n    autoSaveTimerRef.current = setTimeout(async () => {\n      if (draftQuiz.id && (draftQuiz.title || draftQuiz.rounds?.length)) {\n        try {\n          await saveToStorage(draftQuiz as Quiz);\n          setLastSaved(new Date());\n        } catch (error) {\n          console.error(\"[WizardPersistence] Auto-save failed:\", error);\n        }\n      }\n    }, 30000); // 30 seconds\n  }, [draftQuiz, saveToStorage]);\n\n  /**\n   * Updates draft quiz data with new information\n   * Automatically schedules auto-save after changes\n   */\n  const updateDraft = useCallback(\n    (updates: Partial<Quiz>) => {\n      setDraftQuiz((prev) => {\n        const merged = {\n          ...prev,\n          ...updates,\n          settings: {\n            ...(prev.settings || DEFAULT_QUIZ_SETTINGS),\n            ...(updates.settings || {}),\n          },\n          rounds: updates.rounds !== undefined ? updates.rounds : prev.rounds,\n          updatedAt: new Date(),\n        };\n\n        // Debug log for development\n        if (process.env.NODE_ENV !== \"production\") {\n          console.log(\"[WizardPersistence] updateDraft:\", {\n            updates,\n            previous: prev,\n            merged,\n          });\n        }\n\n        return merged;\n      });\n\n      // Schedule auto-save after update\n      scheduleAutoSave();\n    },\n    [scheduleAutoSave]\n  );\n\n  /**\n   * Explicitly saves current draft to IndexedDB\n   */\n  const saveDraft = useCallback(async (): Promise<void> => {\n    if (!draftQuiz.id) return;\n\n    try {\n      await saveToStorage(draftQuiz as Quiz);\n      setLastSaved(new Date());\n    } catch (error) {\n      console.error(\"[WizardPersistence] Manual save failed:\", error);\n      throw error;\n    }\n  }, [draftQuiz, saveToStorage]);\n\n  /**\n   * Clears current draft from storage and resets to defaults\n   */\n  const clearDraft = useCallback(async () => {\n    // Clear auto-save timer\n    if (autoSaveTimerRef.current) {\n      clearTimeout(autoSaveTimerRef.current);\n      autoSaveTimerRef.current = null;\n    }\n\n    // Delete from storage if it exists\n    if (draftIdRef.current) {\n      try {\n        await deleteDraftFromStorage(draftIdRef.current);\n      } catch (error) {\n        console.warn(\"[WizardPersistence] Failed to delete draft:\", error);\n      }\n    }\n\n    // Reset local state\n    setDraftQuiz(DEFAULT_DRAFT_QUIZ);\n    setLastSaved(null);\n    draftIdRef.current = null;\n    clearError();\n  }, [deleteDraftFromStorage, clearError]);\n\n  /**\n   * Resets draft to default values without deleting from storage\n   */\n  const resetDraft = useCallback(() => {\n    const newDraft = {\n      ...DEFAULT_DRAFT_QUIZ,\n      id: `draft_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      createdAt: new Date(),\n    };\n    setDraftQuiz(newDraft);\n    draftIdRef.current = newDraft.id;\n    setLastSaved(null);\n  }, []);\n\n  /**\n   * Initialize draft from existing quiz data\n   */\n  const initializeFromQuiz = useCallback((quiz: Partial<Quiz>) => {\n    const editDraft = {\n      ...quiz,\n      status: \"draft\" as const,\n      id: `draft_${quiz.id || Date.now()}_${Date.now()}`,\n      updatedAt: new Date(),\n    };\n    setDraftQuiz(editDraft);\n    draftIdRef.current = editDraft.id;\n    setLastSaved(null);\n  }, []);\n\n  /**\n   * Attempt to recover existing draft\n   */\n  const recoverDraft = useCallback(async (): Promise<boolean> => {\n    try {\n      //  TRIGGER DRAFTS LOADING (state will be updated internally)\n      await loadDrafts();\n\n      //  ACCESS DRAFTS FROM STATE, NOT FROM loadDrafts() RETURN VALUE\n      const latestDraft = drafts\n        .filter((d) => d.status === \"draft\")\n        .sort(\n          (a, b) =>\n            new Date(b.updatedAt || 0).getTime() -\n            new Date(a.updatedAt || 0).getTime()\n        )[0];\n\n      if (latestDraft) {\n        setDraftQuiz(latestDraft);\n        draftIdRef.current = latestDraft.id!;\n        setLastSaved(\n          latestDraft.updatedAt ? new Date(latestDraft.updatedAt) : null\n        );\n        return true;\n      }\n      return false;\n    } catch (error) {\n      console.error(\"[WizardPersistence] Draft recovery failed:\", error);\n      return false;\n    }\n  }, [loadDrafts, drafts]);\n\n  // Cleanup auto-save timer on unmount\n  useEffect(() => {\n    return () => {\n      if (autoSaveTimerRef.current) {\n        clearTimeout(autoSaveTimerRef.current);\n      }\n    };\n  }, []);\n\n  return {\n    persistence: {\n      draftQuiz,\n      isInitialized,\n      autoSaveStatus,\n      storageError,\n      lastSaved,\n    },\n    actions: {\n      updateDraft,\n      saveDraft,\n      clearDraft,\n      resetDraft,\n      initializeFromQuiz,\n      recoverDraft,\n    },\n  };\n};\n","/**\n * Enhanced Quiz Creation Wizard Hook with IndexedDB Auto-Save\n */\n\nimport type { Quiz } from \"../types\";\nimport { useWizardNavigation } from \"./useWizardNavigation\";\nimport { useWizardValidation } from \"./useWizardValidation\";\nimport { useWizardPersistenceWithStorage } from \"./useWizardPersistenceWithStorage\";\nimport { useWizardCompletion } from \"./useWizardCompletion\";\n\nexport interface UseQuizWizardWithStorageReturn {\n  currentStep: number;\n  steps: string[];\n  canProceed: boolean;\n  nextStep: () => void;\n  previousStep: () => void;\n  goToStep: (step: number) => void;\n  draftQuiz: Partial<Quiz>;\n  updateDraft: (updates: Partial<Quiz>) => void;\n  saveDraft: () => Promise<void>;\n  autoSaveStatus: \"idle\" | \"saving\" | \"saved\" | \"error\";\n  storageError: string | null;\n  lastSaved: Date | null;\n  validateStep: () => { isValid: boolean; errors: string[] };\n  completeWizard: () => Promise<Quiz>;\n  resetWizard: () => void;\n  recoverDraft: () => Promise<boolean>;\n}\n\nexport const useQuizWizardWithStorage = (\n  initialQuiz?: Partial<Quiz>\n): UseQuizWizardWithStorageReturn => {\n  const {\n    persistence: { draftQuiz, autoSaveStatus, storageError, lastSaved },\n    actions: persistenceActions,\n  } = useWizardPersistenceWithStorage(initialQuiz);\n\n  const validationHook = useWizardValidation({\n    currentStep: 0,\n    draftQuiz,\n  });\n\n  const {\n    navigation: { currentStep, steps, canProceed },\n    actions: navigationActions,\n  } = useWizardNavigation(validationHook.validateStep);\n\n  const updatedValidation = useWizardValidation({\n    currentStep,\n    draftQuiz,\n  });\n\n  const completionHook = useWizardCompletion({\n    draftQuiz,\n    validateAllSteps: updatedValidation.validateAllSteps,\n    clearDraft: persistenceActions.clearDraft,\n    resetDraft: persistenceActions.resetDraft,\n  });\n\n  const resetWizard = (): void => {\n    navigationActions.resetNavigation();\n    persistenceActions.clearDraft();\n  };\n\n  return {\n    currentStep,\n    steps,\n    canProceed,\n    nextStep: navigationActions.nextStep,\n    previousStep: navigationActions.previousStep,\n    goToStep: navigationActions.goToStep,\n    draftQuiz,\n    updateDraft: persistenceActions.updateDraft,\n    saveDraft: persistenceActions.saveDraft,\n    autoSaveStatus,\n    storageError,\n    lastSaved,\n    validateStep: updatedValidation.validateStep,\n    completeWizard: completionHook.completeWizard,\n    resetWizard,\n    recoverDraft: persistenceActions.recoverDraft,\n  };\n};\n","'use client';\nimport { createContext, Component, createElement, useContext, useState, useMemo, forwardRef } from 'react';\n\nconst ErrorBoundaryContext = createContext(null);\n\nconst initialState = {\n  didCatch: false,\n  error: null\n};\nclass ErrorBoundary extends Component {\n  constructor(props) {\n    super(props);\n    this.resetErrorBoundary = this.resetErrorBoundary.bind(this);\n    this.state = initialState;\n  }\n  static getDerivedStateFromError(error) {\n    return {\n      didCatch: true,\n      error\n    };\n  }\n  resetErrorBoundary() {\n    const {\n      error\n    } = this.state;\n    if (error !== null) {\n      var _this$props$onReset, _this$props;\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      (_this$props$onReset = (_this$props = this.props).onReset) === null || _this$props$onReset === void 0 ? void 0 : _this$props$onReset.call(_this$props, {\n        args,\n        reason: \"imperative-api\"\n      });\n      this.setState(initialState);\n    }\n  }\n  componentDidCatch(error, info) {\n    var _this$props$onError, _this$props2;\n    (_this$props$onError = (_this$props2 = this.props).onError) === null || _this$props$onError === void 0 ? void 0 : _this$props$onError.call(_this$props2, error, info);\n  }\n  componentDidUpdate(prevProps, prevState) {\n    const {\n      didCatch\n    } = this.state;\n    const {\n      resetKeys\n    } = this.props;\n\n    // There's an edge case where if the thing that triggered the error happens to *also* be in the resetKeys array,\n    // we'd end up resetting the error boundary immediately.\n    // This would likely trigger a second error to be thrown.\n    // So we make sure that we don't check the resetKeys on the first call of cDU after the error is set.\n\n    if (didCatch && prevState.error !== null && hasArrayChanged(prevProps.resetKeys, resetKeys)) {\n      var _this$props$onReset2, _this$props3;\n      (_this$props$onReset2 = (_this$props3 = this.props).onReset) === null || _this$props$onReset2 === void 0 ? void 0 : _this$props$onReset2.call(_this$props3, {\n        next: resetKeys,\n        prev: prevProps.resetKeys,\n        reason: \"keys\"\n      });\n      this.setState(initialState);\n    }\n  }\n  render() {\n    const {\n      children,\n      fallbackRender,\n      FallbackComponent,\n      fallback\n    } = this.props;\n    const {\n      didCatch,\n      error\n    } = this.state;\n    let childToRender = children;\n    if (didCatch) {\n      const props = {\n        error,\n        resetErrorBoundary: this.resetErrorBoundary\n      };\n      if (typeof fallbackRender === \"function\") {\n        childToRender = fallbackRender(props);\n      } else if (FallbackComponent) {\n        childToRender = createElement(FallbackComponent, props);\n      } else if (fallback !== undefined) {\n        childToRender = fallback;\n      } else {\n        throw error;\n      }\n    }\n    return createElement(ErrorBoundaryContext.Provider, {\n      value: {\n        didCatch,\n        error,\n        resetErrorBoundary: this.resetErrorBoundary\n      }\n    }, childToRender);\n  }\n}\nfunction hasArrayChanged() {\n  let a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  let b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  return a.length !== b.length || a.some((item, index) => !Object.is(item, b[index]));\n}\n\nfunction assertErrorBoundaryContext(value) {\n  if (value == null || typeof value.didCatch !== \"boolean\" || typeof value.resetErrorBoundary !== \"function\") {\n    throw new Error(\"ErrorBoundaryContext not found\");\n  }\n}\n\nfunction useErrorBoundary() {\n  const context = useContext(ErrorBoundaryContext);\n  assertErrorBoundaryContext(context);\n  const [state, setState] = useState({\n    error: null,\n    hasError: false\n  });\n  const memoized = useMemo(() => ({\n    resetBoundary: () => {\n      context.resetErrorBoundary();\n      setState({\n        error: null,\n        hasError: false\n      });\n    },\n    showBoundary: error => setState({\n      error,\n      hasError: true\n    })\n  }), [context.resetErrorBoundary]);\n  if (state.hasError) {\n    throw state.error;\n  }\n  return memoized;\n}\n\nfunction withErrorBoundary(component, errorBoundaryProps) {\n  const Wrapped = forwardRef((props, ref) => createElement(ErrorBoundary, errorBoundaryProps, createElement(component, {\n    ...props,\n    ref\n  })));\n\n  // Format for display in DevTools\n  const name = component.displayName || component.name || \"Unknown\";\n  Wrapped.displayName = \"withErrorBoundary(\".concat(name, \")\");\n  return Wrapped;\n}\n\nexport { ErrorBoundary, ErrorBoundaryContext, useErrorBoundary, withErrorBoundary };\n","/**\n * Quizzes Feature Type Definitions\n *\n * This file contains all TypeScript interfaces and types used throughout\n * the Quizzes feature. Centralized type definitions ensure consistency\n * and maintainability across all components, hooks, and services.\n *\n * Updated for new round-based quiz system with media file support:\n * - IndexedDB storage for large files\n * - Round types determine question types\n * - Media file uploads (pictures, audio, video)\n * - Golden Pyramid special format\n * - Time/points as number inputs with decimal support\n * - Breaking time settings for rounds\n *\n * @fileoverview Type definitions for Quizzes feature\n * @version 2.0.0\n * @since December 2025\n */\n\n/**\n * Supported media types for quiz questions\n */\nexport type MediaType = \"image\" | \"audio\" | \"video\";\n\n/**\n * Quiz question type\n * - single-answer: Single correct answer (renamed from text-answer)\n * - multiple-choice: Multiple choice question with 1-20 possible answers\n * - picture: Picture-based question with file upload\n * - audio: Audio-based question with file upload\n * - video: Video-based question with file upload\n */\nexport type QuestionType =\n  | \"single-answer\"\n  | \"multiple-choice\"\n  | \"picture\"\n  | \"audio\"\n  | \"video\";\n\n/**\n * Supported round types for quiz creation\n * Round type determines available question types and UI behavior\n */\nexport type RoundType =\n  | \"mixed\" // Mixed question types (user can select any type)\n  | \"single-answer-only\" // Only single answer questions (renamed from text-only)\n  | \"multiple-choice\" // Only multiple choice questions\n  | \"picture\" // Only picture questions with image uploads\n  | \"audio\" // Only audio questions with audio uploads\n  | \"video\" // Only video questions with video uploads\n  | \"golden-pyramid\"; // Special 4-question format\n\n/**\n * Round answer reveal mode\n */\nexport type AnswerRevealMode = \"after-each\" | \"after-all\";\n\n/**\n * Quiz difficulty levels for organization and filtering\n */\nexport type QuizDifficulty = \"easy\" | \"medium\" | \"hard\";\n\n/**\n * Quiz categories for organization\n */\nexport type QuizCategory =\n  | \"general\"\n  | \"sports\"\n  | \"history\"\n  | \"science\"\n  | \"geography\"\n  | \"entertainment\"\n  | \"literature\"\n  | \"art\"\n  | \"music\"\n  | \"technology\"\n  | \"custom\";\n\n/**\n * Supported media file types for PowerPoint compatibility\n */\nexport interface SupportedMediaTypes {\n  images: string[]; // ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'tiff', 'svg']\n  audio: string[]; // ['mp3', 'wav', 'wma', 'm4a']\n  video: string[]; // ['mp4', 'mov', 'wmv', 'avi']\n}\n\n/**\n * File size limits for different media types (in bytes)\n */\nexport interface FileSizeLimits {\n  image: number; // 10MB max per image\n  audio: number; // 20MB max per audio file\n  video: number; // 100MB max per video file\n  total: number; // 500MB max total quiz size\n}\n\n/**\n * Media file metadata for storage and display\n */\nexport interface MediaFile {\n  /** Unique identifier for the media file */\n  id: string;\n  /** Original filename with extension */\n  filename: string;\n  /** File type (image/audio/video) */\n  type: \"image\" | \"audio\" | \"video\";\n  /** File size in bytes */\n  size: number;\n  /** Base64 encoded file data for storage */\n  data: string;\n  /** MIME type for proper handling */\n  mimeType: string;\n  /** Thumbnail for images/videos (base64) */\n  thumbnail?: string;\n  /** Duration for audio/video files in seconds */\n  duration?: number;\n  /** Upload timestamp */\n  createdAt: Date;\n}\n\n/**\n * Quiz question interface (updated for new system)\n * Supports both manual creation and AI-generated questions in standard format\n */\nexport interface QuizQuestion {\n  /** Unique identifier for the question */\n  id: string;\n  /** Question type determines UI and behavior */\n  type: QuestionType;\n  /** The main question text */\n  question: string;\n  /** Possible answers for multiple choice (1-20 answers), empty for single-answer */\n  possibleAnswers: string[];\n  /** Array of correct answer indices for Golden Pyramid (1,2,3,4 correct answers per question) */\n  correctAnswers: number[];\n  /** Single correct answer text for single-answer questions */\n  correctAnswerText?: string;\n  /** Optional explanation shown after answer */\n  explanation?: string;\n  /** Associated media file if any */\n  mediaFile?: MediaFile;\n  /** Question difficulty for organization */\n  difficulty: QuizDifficulty;\n  /** Points awarded for correct answer (decimal support) */\n  points: number;\n  /** Time limit in minutes (decimal support, e.g., 0.5 = 30 seconds) */\n  timeLimit: number;\n  /** Creation timestamp */\n  createdAt: Date;\n  /** Last modified timestamp */\n  updatedAt: Date;\n}\n\n/**\n * Round structure containing questions and round-level settings\n */\nexport interface Round {\n  /** Unique identifier for the round */\n  id: string;\n  /** Display name for the round (e.g., \"Round 1\") */\n  name: string;\n  /** Optional round description */\n  description?: string;\n  /** Round type (determines question types allowed) */\n  type: RoundType;\n  /** Optional round level/difficulty label */\n  level?: string;\n  /** Answer reveal mode for this round */\n  answerRevealMode: AnswerRevealMode;\n  /** Default time per question in this round (in minutes, decimal support) */\n  defaultTimePerQuestion: number;\n  /** Breaking time between rounds in minutes (default 1) */\n  breakingTime: number;\n  /** For Golden Pyramid: time for entire round instead of per question */\n  roundTimeLimit?: number;\n  /** For Golden Pyramid: points for entire round instead of per question */\n  roundPoints?: number;\n  /** List of questions in this round */\n  questions: QuizQuestion[];\n  /** Creation timestamp */\n  createdAt: Date;\n  /** Last modified timestamp */\n  updatedAt: Date;\n}\n\n/**\n * Complete quiz structure containing all quiz data (updated for new system)\n */\nexport interface Quiz {\n  /** Unique identifier for the quiz */\n  id: string;\n  /** Quiz title displayed to users */\n  title: string;\n  /** Optional quiz description */\n  description?: string;\n  /** Quiz category for organization */\n  category: QuizCategory;\n  /** Overall quiz difficulty */\n  difficulty: QuizDifficulty;\n  /** Quiz status for workflow management */\n  status: \"draft\" | \"completed\";\n  /** Array of all rounds in the quiz */\n  rounds: Round[];\n  /** Total estimated duration in minutes (calculated from questions + breaks) */\n  estimatedDuration: number;\n  /** Quiz creation timestamp */\n  createdAt: Date;\n  /** Last modified timestamp */\n  updatedAt: Date;\n  /** Quiz settings */\n  settings: QuizSettings;\n  /** Export metadata */\n  exportData?: QuizExportData;\n}\n\n/**\n * Quiz settings\n */\nexport interface QuizSettings {\n  /** Default time limit per question in minutes (decimal support) */\n  defaultTimeLimit: number;\n  /** Default points per question (decimal support) */\n  defaultPoints: number;\n  /** Default breaking time between rounds in minutes */\n  defaultBreakingTime: number;\n}\n\n/**\n * Quiz export metadata\n */\nexport interface QuizExportData {\n  /** Last export timestamp */\n  lastExported: Date;\n  /** Export format used */\n  format: \"google-slides\" | \"json\";\n  /** Export settings used */\n  settings: ExportSettings;\n  /** File size of last export in bytes */\n  fileSize: number;\n  /** Whether presenter notes were included */\n  includePresenterNotes: boolean;\n}\n\n/**\n * Export settings for quiz export (Google Slides and JSON)\n */\nexport interface ExportSettings {\n  /** Include quiz metadata (title, description, etc.) */\n  includeMetadata: boolean;\n  /** Include presenter notes and explanations */\n  includePresenterNotes: boolean;\n  /** Include answer key in export */\n  includeAnswerKey: boolean;\n  /** Font size for questions (Google Slides only) */\n  questionFontSize: number;\n  /** Font size for answer options (Google Slides only) */\n  optionFontSize: number;\n}\n\n/**\n * Wizard step definition\n */\nexport interface WizardStep {\n  /** Step identifier */\n  id: string;\n  /** Display title for the step */\n  title: string;\n  /** Step description */\n  description: string;\n  /** Whether this step is completed */\n  completed: boolean;\n  /** Whether this step is currently active */\n  active: boolean;\n  /** Whether this step is accessible */\n  enabled: boolean;\n}\n\n/**\n * Quiz validation result\n */\nexport interface QuizValidation {\n  /** Whether the quiz is valid for export/save */\n  isValid: boolean;\n  /** Array of validation error messages */\n  errors: string[];\n  /** Array of validation warning messages */\n  warnings: string[];\n  /** Validation timestamp */\n  validatedAt: Date;\n}\n\n/**\n * Quizzes page component props\n */\nexport interface QuizzesPageProps {\n  /** Optional initial quiz to load */\n  initialQuiz?: Quiz;\n}\n\n/**\n * Quiz wizard component props\n */\nexport interface QuizWizardProps {\n  /** Callback when quiz is successfully created */\n  onQuizCreated: (quiz: Quiz) => void;\n  /** Callback when wizard is cancelled */\n  onCancel: () => void;\n  /** Optional quiz to edit (for edit mode) */\n  editQuiz?: Quiz;\n}\n\n/**\n * Question editor component props\n */\nexport interface QuestionEditorProps {\n  /** Current question being edited */\n  question: QuizQuestion;\n  /** Callback when question is updated */\n  onQuestionUpdate: (question: QuizQuestion) => void;\n  /** Callback when question is deleted */\n  onQuestionDelete: (questionId: string) => void;\n  /** Index of question in the round */\n  questionIndex: number;\n  /** Total number of questions in round */\n  totalQuestions: number;\n  /** Round type to determine UI behavior */\n  roundType: RoundType;\n}\n\n/**\n * Media upload component props\n */\nexport interface MediaUploadProps {\n  /** Accepted file types */\n  acceptedTypes: string[];\n  /** Maximum file size in bytes */\n  maxFileSize: number;\n  /** Callback when file is uploaded */\n  onFileUpload: (file: MediaFile) => void;\n  /** Callback when upload fails */\n  onUploadError: (error: string) => void;\n  /** Current uploaded file (if any) */\n  currentFile?: MediaFile;\n  /** File type being uploaded */\n  fileType: \"image\" | \"audio\" | \"video\";\n}\n\n/**\n * Export options component props\n */\nexport interface ExportOptionsProps {\n  /** Quiz to export */\n  quiz: Quiz;\n  /** Export settings */\n  settings: ExportSettings;\n  /** Callback when settings change */\n  onSettingsChange: (settings: ExportSettings) => void;\n  /** Callback to start export */\n  onStartExport: () => void;\n  /** Whether export is in progress */\n  isExporting: boolean;\n}\n\n/**\n * Quiz management hook return type\n */\nexport interface UseQuizManagementReturn {\n  /** Array of all saved quizzes */\n  quizzes: Quiz[];\n  /** Currently selected/active quiz */\n  currentQuiz: Quiz | null;\n  /** Whether quizzes are being loaded */\n  isLoading: boolean;\n  /** Any error that occurred */\n  error: string | null;\n  /** Create a new quiz */\n  createQuiz: (\n    quizData: Omit<Quiz, \"id\" | \"createdAt\" | \"updatedAt\">\n  ) => Promise<Quiz>;\n  /** Update an existing quiz */\n  updateQuiz: (id: string, updates: Partial<Quiz>) => Promise<Quiz>;\n  /** Delete a quiz */\n  deleteQuiz: (id: string) => Promise<void>;\n  /** Load a specific quiz */\n  loadQuiz: (id: string) => Promise<Quiz | null>;\n  /** Clear current quiz */\n  clearCurrentQuiz: () => void;\n  /** Export quiz in supported formats */\n  exportQuiz: (\n    quizId: string,\n    format: \"google-slides\" | \"json\",\n    settings?: ExportSettings\n  ) => Promise<void>;\n  /** Set quizzes */\n  setQuizzes: React.Dispatch<React.SetStateAction<Quiz[]>>;\n}\n\n/**\n * Quiz wizard hook return type\n */\nexport interface UseQuizWizardReturn {\n  /** Current wizard step */\n  currentStep: number;\n  /** Array of all wizard steps */\n  steps: WizardStep[];\n  /** Draft quiz being created */\n  draftQuiz: Partial<Quiz>;\n  /** Whether wizard can proceed to next step */\n  canProceed: boolean;\n  /** Move to next step */\n  nextStep: () => void;\n  /** Move to previous step */\n  previousStep: () => void;\n  /** Jump to specific step */\n  goToStep: (stepIndex: number) => void;\n  /** Update draft quiz data */\n  updateDraft: (updates: Partial<Quiz>) => void;\n  /** Validate current step */\n  validateStep: () => QuizValidation;\n  /** Save draft quiz */\n  saveDraft: () => Promise<void>;\n  /** Complete wizard and create quiz */\n  completeWizard: () => Promise<Quiz>;\n  /** Reset wizard to beginning */\n  resetWizard: () => void;\n}\n\n/**\n * File size limits constants\n */\nexport const FILE_SIZE_LIMITS: FileSizeLimits = {\n  image: 10 * 1024 * 1024, // 10MB\n  audio: 20 * 1024 * 1024, // 20MB\n  video: 100 * 1024 * 1024, // 100MB\n  total: 500 * 1024 * 1024, // 500MB\n};\n\n/**\n * Quiz validation constants\n */\nexport const QUIZ_CONSTANTS = {\n  MAX_TITLE_LENGTH: 100,\n  MIN_ROUNDS: 1,\n  MIN_QUESTIONS: 1,\n  MAX_QUESTIONS: 100,\n  MIN_OPTIONS: 2,\n  MAX_OPTIONS: 20,\n  FILE_SIZE_LIMITS: FILE_SIZE_LIMITS,\n} as const;\n\n/**\n * Supported file formats for PowerPoint compatibility\n */\nexport const SUPPORTED_MEDIA_TYPES: SupportedMediaTypes = {\n  images: [\"jpg\", \"jpeg\", \"png\", \"gif\", \"bmp\", \"tiff\", \"svg\"],\n  audio: [\"mp3\", \"wav\", \"wma\", \"m4a\"],\n  video: [\"mp4\", \"mov\", \"wmv\", \"avi\"],\n};\n\n/**\n * Round type configurations\n */\nexport const ROUND_TYPE_CONFIG = {\n  mixed: {\n    label: \"Any Type of Question\",\n    description: \"Questions of any type\",\n    allowedQuestionTypes: [\n      \"single-answer\",\n      \"multiple-choice\",\n      \"picture\",\n      \"audio\",\n      \"video\",\n    ] as QuestionType[],\n    canSelectQuestionType: true,\n  },\n  \"single-answer-only\": {\n    label: \"Question-Answer\",\n    description: \"Only single answer questions\",\n    allowedQuestionTypes: [\"single-answer\"] as QuestionType[],\n    canSelectQuestionType: false,\n  },\n  \"multiple-choice\": {\n    label: \"Multiple Choice Question\",\n    description: \"Only multiple choice questions\",\n    allowedQuestionTypes: [\"multiple-choice\"] as QuestionType[],\n    canSelectQuestionType: false,\n  },\n  picture: {\n    label: \"Picture Question\",\n    description: \"Questions with picture uploads\",\n    allowedQuestionTypes: [\"picture\"] as QuestionType[],\n    canSelectQuestionType: false,\n  },\n  audio: {\n    label: \"Audio Question\",\n    description: \"Questions with audio uploads\",\n    allowedQuestionTypes: [\"audio\"] as QuestionType[],\n    canSelectQuestionType: false,\n  },\n  video: {\n    label: \"Video Question\",\n    description: \"Questions with video uploads\",\n    allowedQuestionTypes: [\"video\"] as QuestionType[],\n    canSelectQuestionType: false,\n  },\n  \"golden-pyramid\": {\n    label: \"Golden Pyramid Question\",\n    description: \"Special 4-question format\",\n    allowedQuestionTypes: [\"multiple-choice\"] as QuestionType[],\n    canSelectQuestionType: false,\n    specialFormat: true,\n    prePopulatedQuestions: 4,\n  },\n} as const;\n","/**\n * Basic Info Step Component\n *\n * First step of the quiz creation wizard for collecting basic quiz information\n * including title, description, category, difficulty, and author details.\n *\n * Features:\n * - Mobile-first responsive form layout\n * - Real-time validation feedback\n * - Auto-save draft functionality\n * - Category and difficulty selection\n * - Character count indicators\n *\n * @fileoverview Basic information step for quiz creation wizard\n * @version 1.0.0\n * @since December 2025\n */\n\nimport React from \"react\";\nimport {\n  Box,\n  TextField,\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n  Typography,\n  Grid,\n  Chip,\n  FormHelperText,\n  InputAdornment,\n  Button,\n} from \"@mui/material\";\nimport {\n  Category as CategoryIcon,\n  TrendingUp as DifficultyIcon,\n  Delete as DeleteIcon,\n} from \"@mui/icons-material\";\nimport type {\n  Quiz,\n  QuizValidation,\n  QuizCategory,\n  QuizDifficulty,\n} from \"../../types\";\nimport { QUIZ_CONSTANTS } from \"../../types\";\n\n/**\n * Props for the BasicInfoStep component\n */\ninterface BasicInfoStepProps {\n  /** Current draft quiz data */\n  draftQuiz: Partial<Quiz>;\n  /** Function to update draft quiz data */\n  updateDraft: (updates: Partial<Quiz>) => void;\n  /** Current validation state */\n  validation: QuizValidation;\n  /** Function to handle quiz deletion (only shown when editing) */\n  onDeleteQuiz?: () => void;\n  /** Whether this is edit mode (to show delete button) */\n  isEditMode?: boolean;\n  /** Function to handle continuing to questions section */\n  onContinue?: () => void;\n}\n\n/**\n * Available quiz categories with display labels\n */\nconst QUIZ_CATEGORIES: Array<{\n  value: QuizCategory;\n  label: string;\n  description: string;\n}> = [\n  {\n    value: \"general\",\n    label: \"General Knowledge\",\n    description: \"Mixed topics and trivia\",\n  },\n  {\n    value: \"sports\",\n    label: \"Sports\",\n    description: \"Sports, teams, and athletics\",\n  },\n  {\n    value: \"history\",\n    label: \"History\",\n    description: \"Historical events and figures\",\n  },\n  {\n    value: \"science\",\n    label: \"Science\",\n    description: \"Science, technology, and nature\",\n  },\n  {\n    value: \"geography\",\n    label: \"Geography\",\n    description: \"Countries, capitals, and locations\",\n  },\n  {\n    value: \"entertainment\",\n    label: \"Entertainment\",\n    description: \"Movies, TV, and celebrities\",\n  },\n  {\n    value: \"literature\",\n    label: \"Literature\",\n    description: \"Books, authors, and poetry\",\n  },\n  {\n    value: \"art\",\n    label: \"Art\",\n    description: \"Visual arts, paintings, and artists\",\n  },\n  {\n    value: \"music\",\n    label: \"Music\",\n    description: \"Songs, artists, and musical theory\",\n  },\n  {\n    value: \"technology\",\n    label: \"Technology\",\n    description: \"Computers, software, and gadgets\",\n  },\n  { value: \"custom\", label: \"Custom\", description: \"Your own custom category\" },\n];\n\n/**\n * Available difficulty levels with descriptions\n */\nconst DIFFICULTY_LEVELS: Array<{\n  value: QuizDifficulty;\n  label: string;\n  description: string;\n  color: string;\n}> = [\n  {\n    value: \"easy\",\n    label: \"Easy\",\n    description: \"Simple questions for beginners\",\n    color: \"success\",\n  },\n  {\n    value: \"medium\",\n    label: \"Medium\",\n    description: \"Moderate difficulty questions\",\n    color: \"warning\",\n  },\n  {\n    value: \"hard\",\n    label: \"Hard\",\n    description: \"Challenging questions for experts\",\n    color: \"error\",\n  },\n];\n\n/**\n * Basic Info Step Component\n *\n * Collects fundamental quiz information in a user-friendly form.\n * Provides real-time validation and helpful hints for quiz creation.\n *\n * @param props - Component props\n * @returns JSX element representing the basic info step\n */\nexport const BasicInfoStep: React.FC<BasicInfoStepProps> = ({\n  draftQuiz,\n  updateDraft,\n  validation,\n  onDeleteQuiz,\n  isEditMode,\n  onContinue,\n}) => {\n  /**\n   * Gets error message for a specific field\n   */\n  const getFieldError = React.useCallback(\n    (fieldName: string): string | undefined => {\n      return validation.errors.find((error) =>\n        error.toLowerCase().includes(fieldName.toLowerCase())\n      );\n    },\n    [validation.errors]\n  );\n\n  const timeValue = draftQuiz.defaultTimeLimit;\n  const displayTime = timeValue === undefined ? \"\" : Math.round(timeValue / 60);\n  const timeForValidation = timeValue ?? 60; // 60 seconds = 1 minute\n  const isTimeValid = timeForValidation > 0 && timeForValidation <= 3600; // 1 second to 60 minutes\n\n  const getTimeError = () => {\n    if (timeValue !== undefined && !isTimeValid) {\n      if (timeValue <= 0) return \"Time must be > 0 minutes.\";\n      if (timeValue > 3600) return \"Time must be <= 60 minutes.\";\n    }\n    return undefined;\n  };\n\n  const timeError = getTimeError();\n\n  return (\n    <Box sx={{ maxWidth: 1000, mx: \"auto\" }}>\n      <Grid container spacing={4}>\n        {/* Quiz Title */}\n        <Grid size={{ xs: 12 }}>\n          <TextField\n            fullWidth\n            id=\"quiz-title\"\n            name=\"title\"\n            label=\"Quiz Title\"\n            placeholder=\"e.g., General Knowledge Quiz, Science Facts Challenge\"\n            value={draftQuiz.title || \"\"}\n            onChange={(e) => updateDraft({ title: e.target.value })}\n            error={!!getFieldError(\"title\")}\n            helperText={\n              getFieldError(\"title\") ||\n              `${(draftQuiz.title || \"\").length}/${\n                QUIZ_CONSTANTS.MAX_TITLE_LENGTH\n              } characters`\n            }\n            inputProps={{\n              maxLength: QUIZ_CONSTANTS.MAX_TITLE_LENGTH,\n              \"aria-label\": \"Quiz title\",\n            }}\n            size=\"medium\"\n            sx={{ mb: 3 }}\n          />\n        </Grid>\n\n        {/* Quiz Description */}\n        <Grid size={{ xs: 12 }}>\n          <TextField\n            fullWidth\n            id=\"quiz-description\"\n            name=\"description\"\n            multiline\n            rows={4}\n            label=\"Description (Optional)\"\n            placeholder=\"Brief description of what this quiz covers...\"\n            value={draftQuiz.description || \"\"}\n            onChange={(e) => updateDraft({ description: e.target.value })}\n            helperText={`${draftQuiz.description?.length || 0}/500 characters`}\n            inputProps={{\n              maxLength: 500,\n            }}\n            size=\"medium\"\n            sx={{ mb: 3 }}\n          />\n        </Grid>\n\n        {/* Author and Category row */}\n        <Grid size={{ xs: 12, md: 6 }}>\n          <FormControl\n            fullWidth\n            error={!!getFieldError(\"category\")}\n            size=\"medium\"\n          >\n            <InputLabel>Quiz Category</InputLabel>\n            <Select\n              id=\"quiz-category\"\n              name=\"category\"\n              value={draftQuiz.category || \"general\"}\n              onChange={(e) =>\n                updateDraft({ category: e.target.value as QuizCategory })\n              }\n              label=\"Quiz Category\"\n              aria-label=\"Quiz category selection\"\n              startAdornment={\n                <CategoryIcon sx={{ mr: 1, color: \"text.secondary\" }} />\n              }\n            >\n              {QUIZ_CATEGORIES.map((category) => (\n                <MenuItem key={category.value} value={category.value}>\n                  <Box>\n                    <Typography variant=\"body1\">{category.label}</Typography>\n                    <Typography variant=\"caption\" color=\"text.secondary\">\n                      {category.description}\n                    </Typography>\n                  </Box>\n                </MenuItem>\n              ))}\n            </Select>\n            <FormHelperText>\n              {getFieldError(\"category\") ||\n                \"Choose the main topic of your quiz\"}\n            </FormHelperText>\n          </FormControl>\n        </Grid>\n\n        {/* Difficulty Level */}\n        <Grid size={{ xs: 12, md: 6 }}>\n          <FormControl\n            fullWidth\n            error={!!getFieldError(\"difficulty\")}\n            size=\"medium\"\n          >\n            <InputLabel>Difficulty Level</InputLabel>\n            <Select\n              id=\"quiz-difficulty\"\n              name=\"difficulty\"\n              value={draftQuiz.difficulty || \"medium\"}\n              onChange={(e) =>\n                updateDraft({\n                  difficulty: e.target.value as QuizDifficulty,\n                })\n              }\n              label=\"Difficulty Level\"\n              aria-label=\"Difficulty level selection\"\n              startAdornment={\n                <DifficultyIcon sx={{ mr: 1, color: \"text.secondary\" }} />\n              }\n            >\n              {DIFFICULTY_LEVELS.map((level) => (\n                <MenuItem key={level.value} value={level.value}>\n                  <Box display=\"flex\" alignItems=\"center\" gap={2} width=\"100%\">\n                    <Chip\n                      label={level.label}\n                      size=\"small\"\n                      color={level.color as any}\n                      variant=\"outlined\"\n                    />\n                    <Typography variant=\"body2\" color=\"text.secondary\">\n                      {level.description}\n                    </Typography>\n                  </Box>\n                </MenuItem>\n              ))}\n            </Select>\n            <FormHelperText>\n              {getFieldError(\"difficulty\") ||\n                \"Set the challenge level for your quiz\"}\n            </FormHelperText>\n          </FormControl>\n        </Grid>\n\n        <Box sx={{ mt: 3, width: \"100%\" }}>\n          <Typography gutterBottom>Default Time Per Question</Typography>\n          <TextField\n            fullWidth\n            type=\"number\"\n            label=\"1 Minute by Default\"\n            placeholder=\"1 Minute by Default\"\n            value={displayTime}\n            onChange={(e) => {\n              const val = e.target.value;\n              updateDraft({\n                defaultTimeLimit: val === \"\" ? undefined : Number(val) * 60,\n              });\n            }}\n            error={!!timeError}\n            helperText={\n              timeError ||\n              \"This will be the default time limit for each new question. You can override it per question.\"\n            }\n            inputProps={{\n              step: 0.5,\n              min: 0.1,\n              \"aria-label\": \"Default time per question in minutes\",\n            }}\n            InputProps={{\n              endAdornment: (\n                <InputAdornment position=\"end\">minutes</InputAdornment>\n              ),\n            }}\n            size=\"medium\"\n            sx={{\n              mb: 1,\n              \"& .MuiOutlinedInput-root\": {\n                \"&.Mui-error fieldset\": {\n                  borderColor: \"error.main\",\n                },\n              },\n            }}\n          />\n        </Box>\n      </Grid>\n\n      {/* Delete and Continue Buttons Row */}\n      <Box\n        sx={{\n          mt: 4,\n          display: \"flex\",\n          justifyContent: \"space-between\",\n          alignItems: \"center\",\n          gap: 2,\n        }}\n      >\n        {/* Delete Button - only show when editing */}\n        {isEditMode && onDeleteQuiz && (\n          <Button\n            variant=\"outlined\"\n            color=\"error\"\n            onClick={onDeleteQuiz}\n            startIcon={<DeleteIcon />}\n            size=\"large\"\n            sx={{\n              minWidth: { xs: \"auto\", sm: 150 },\n              height: 48,\n              borderColor: \"error.main\",\n              color: \"error.main\",\n              \"&:hover\": {\n                borderColor: \"error.dark\",\n                backgroundColor: \"error.light\",\n                color: \"error.dark\",\n              },\n              // Mobile: Show only icon\n              \"& .MuiButton-startIcon\": {\n                margin: { xs: 0, sm: \"0 8px 0 -4px\" },\n              },\n              \"& .MuiButton-startIcon + *\": {\n                display: { xs: \"none\", sm: \"inline\" },\n              },\n            }}\n          >\n            <Box\n              component=\"span\"\n              sx={{\n                display: { xs: \"none\", sm: \"inline\" },\n              }}\n            >\n              Delete Quiz\n            </Box>\n          </Button>\n        )}\n\n        {/* Spacer to center the Continue button when no delete button */}\n        {!isEditMode && <Box />}\n\n        {/* Continue to Questions Button - always centered */}\n        <Button\n          variant=\"contained\"\n          onClick={onContinue}\n          disabled={!draftQuiz.title?.trim() || !isTimeValid}\n          size=\"large\"\n          sx={{\n            minWidth: { xs: 120, sm: 200 },\n            height: 48,\n            boxShadow: 2,\n            \"&:hover\": {\n              boxShadow: 4,\n            },\n          }}\n        >\n          <Box\n            component=\"span\"\n            sx={{\n              display: { xs: \"none\", sm: \"inline\" },\n            }}\n          >\n            Continue to Questions\n          </Box>\n          <Box\n            component=\"span\"\n            sx={{\n              display: { xs: \"inline\", sm: \"none\" },\n            }}\n          >\n            Continue\n          </Box>\n        </Button>\n      </Box>\n    </Box>\n  );\n};\n","/**\n * Questions Step State Management Hook\n *\n * Custom hook that manages all the complex state for the QuestionsStep component.\n * Extracted from the monolithic component to reduce useState complexity and\n * improve maintainability following React best practices.\n *\n * Features:\n * - Round navigation state\n * - Modal visibility state\n * - AI generation state\n * - Question editing state\n * - Form validation state\n *\n * @fileoverview State management hook for QuestionsStep\n * @version 1.0.0\n * @since December 2025\n */\n\nimport { useState, useCallback, useEffect } from \"react\";\nimport type {\n  Quiz,\n  Round,\n  QuizQuestion,\n  RoundType,\n  AnswerRevealMode,\n  QuizDifficulty,\n} from \"../../../types\";\nimport type { AIQuestionParams } from \"../../../services/aiQuestionService\";\n\n// Types for the hook\nexport interface RoundFormState {\n  description: string;\n  type: RoundType;\n  answerRevealMode: AnswerRevealMode;\n  defaultTimePerQuestion: number;\n  breakingTime: number; // Breaking time in minutes (default 5)\n}\n\nexport interface QuestionsStepState {\n  // Round navigation\n  currentRoundIdx: number;\n\n  // Round modal state\n  roundModalOpen: boolean;\n  roundModalMode: \"add\" | \"edit\";\n  editingRound: Round | null;\n  roundForm: RoundFormState;\n\n  // Question modals\n  manualDialogOpen: boolean;\n  manualQuestion: QuizQuestion | null;\n  editingQuestionId: string | null;\n\n  // AI generation state\n  aiDialogOpen: boolean;\n  aiGenerating: boolean;\n  aiStatus: string;\n  aiError: string;\n  aiErrorDismissed: boolean;\n  aiSettings: AIQuestionParams;\n\n  // Delete confirmations\n  deleteRoundConfirmOpen: boolean;\n  deleteQuestionConfirmOpen: boolean;\n  pendingDeleteQuestionId: string | null;\n}\n\nexport interface QuestionsStepActions {\n  // Round navigation\n  setCurrentRoundIdx: (idx: number) => void;\n  goToPrevRound: () => void;\n  goToNextRound: () => void;\n\n  // Round modal actions\n  openRoundModal: (mode: \"add\" | \"edit\", round?: Round) => void;\n  closeRoundModal: () => void;\n  updateRoundForm: (field: keyof RoundFormState, value: any) => void;\n\n  // Question modal actions\n  openManualDialog: () => void;\n  closeManualDialog: () => void;\n  setManualQuestion: (question: QuizQuestion | null) => void;\n  setEditingQuestionId: (id: string | null) => void;\n\n  // AI generation actions\n  openAIDialog: () => void;\n  closeAIDialog: () => void;\n  setAiGenerating: (generating: boolean) => void;\n  setAiStatus: (status: string) => void;\n  setAiError: (error: string) => void;\n  setAiErrorDismissed: (dismissed: boolean) => void;\n  setAiSettings: (settings: AIQuestionParams) => void;\n\n  // Delete confirmation actions\n  openDeleteRoundConfirm: () => void;\n  closeDeleteRoundConfirm: () => void;\n  openDeleteQuestionConfirm: (questionId: string) => void;\n  closeDeleteQuestionConfirm: () => void;\n}\n\nexport interface UseQuestionsStepStateReturn {\n  state: QuestionsStepState;\n  actions: QuestionsStepActions;\n  derived: {\n    rounds: Round[];\n    currentRound: Round | null;\n    isRoundFormValid: boolean;\n  };\n}\n\n/**\n * Questions Step State Hook\n */\nexport const useQuestionsStepState = (\n  draftQuiz: Partial<Quiz>\n): UseQuestionsStepStateReturn => {\n  // Round navigation state\n  const [currentRoundIdx, setCurrentRoundIdx] = useState(0);\n\n  // Round modal state\n  const [roundModalOpen, setRoundModalOpen] = useState(false);\n  const [roundModalMode, setRoundModalMode] = useState<\"add\" | \"edit\">(\"add\");\n  const [editingRound, setEditingRound] = useState<Round | null>(null);\n\n  // Round form state\n  const [roundForm, setRoundForm] = useState<RoundFormState>({\n    description: \"\",\n    type: \"mixed\",\n    answerRevealMode: \"after-all\",\n    defaultTimePerQuestion: (draftQuiz.defaultTimeLimit || 60) / 60, // Convert seconds to minutes\n    breakingTime: 5, // Changed default to 5 minutes breaking time\n  });\n\n  // Question modal state\n  const [manualDialogOpen, setManualDialogOpen] = useState(false);\n  const [manualQuestion, setManualQuestion] = useState<QuizQuestion | null>(\n    null\n  );\n  const [editingQuestionId, setEditingQuestionId] = useState<string | null>(\n    null\n  );\n\n  // AI generation state\n  const [aiDialogOpen, setAiDialogOpen] = useState(false);\n  const [aiGenerating, setAiGenerating] = useState(false);\n  const [aiStatus, setAiStatus] = useState(\"\");\n  const [aiError, setAiError] = useState(\"\");\n  const [aiErrorDismissed, setAiErrorDismissed] = useState(false);\n  const [aiSettings, setAiSettings] = useState<AIQuestionParams>({\n    questionType: \"text-answer\",\n    language: \"English\",\n    topicHint: \"\",\n    category: \"general\",\n    difficulty: \"medium\",\n    optionsCount: 4,\n  });\n\n  // Delete confirmation state\n  const [deleteRoundConfirmOpen, setDeleteRoundConfirmOpen] = useState(false);\n  const [deleteQuestionConfirmOpen, setDeleteQuestionConfirmOpen] =\n    useState(false);\n  const [pendingDeleteQuestionId, setPendingDeleteQuestionId] = useState<\n    string | null\n  >(null);\n\n  // Derived state\n  const rounds = draftQuiz.rounds || [];\n  const currentRound = rounds[currentRoundIdx] || null;\n\n  // Round form validation - description is now optional\n  const isRoundFormValid =\n    roundForm.type &&\n    roundForm.answerRevealMode &&\n    roundForm.defaultTimePerQuestion >= 0.1 && // Minimum 0.1 minutes (6 seconds)\n    roundForm.breakingTime >= 0.1; // Minimum 0.1 minutes (6 seconds) for breaking time\n\n  // When opening modal for edit, populate form\n  useEffect(() => {\n    if (roundModalOpen && roundModalMode === \"edit\" && editingRound) {\n      setRoundForm({\n        description: editingRound.description || \"\",\n        type: editingRound.type,\n        answerRevealMode: editingRound.answerRevealMode,\n        defaultTimePerQuestion: editingRound.defaultTimePerQuestion,\n        breakingTime: editingRound.breakingTime || 1, // Default to 1 minute if not set\n      });\n    } else if (roundModalOpen && roundModalMode === \"add\") {\n      // Reset form for add mode\n      setRoundForm({\n        description: \"\",\n        type: \"mixed\",\n        answerRevealMode: \"after-all\", // Changed default to \"after-all\"\n        defaultTimePerQuestion: (draftQuiz.defaultTimeLimit || 60) / 60, // Convert seconds to minutes\n        breakingTime: 5, // Changed default to 5 minutes breaking time\n      });\n    }\n  }, [roundModalOpen, roundModalMode, editingRound, draftQuiz]);\n\n  // Actions\n  const actions: QuestionsStepActions = {\n    // Round navigation\n    setCurrentRoundIdx,\n    goToPrevRound: useCallback(() => {\n      setCurrentRoundIdx((prev) => Math.max(0, prev - 1));\n    }, []),\n    goToNextRound: useCallback(() => {\n      setCurrentRoundIdx((prev) => Math.min(rounds.length - 1, prev + 1));\n    }, [rounds.length]),\n\n    // Round modal actions\n    openRoundModal: useCallback((mode: \"add\" | \"edit\", round?: Round) => {\n      setRoundModalMode(mode);\n      setEditingRound(round || null);\n      setRoundModalOpen(true);\n    }, []),\n    closeRoundModal: useCallback(() => {\n      setRoundModalOpen(false);\n      setEditingRound(null);\n    }, []),\n    updateRoundForm: useCallback((field: keyof RoundFormState, value: any) => {\n      setRoundForm((prev) => ({ ...prev, [field]: value }));\n    }, []),\n\n    // Question modal actions\n    openManualDialog: useCallback(() => {\n      setManualDialogOpen(true);\n    }, []),\n    closeManualDialog: useCallback(() => {\n      setManualDialogOpen(false);\n      setManualQuestion(null);\n    }, []),\n    setManualQuestion,\n    setEditingQuestionId,\n\n    // AI generation actions\n    openAIDialog: useCallback(() => {\n      setAiDialogOpen(true);\n      setAiError(\"\");\n      setAiErrorDismissed(false);\n    }, []),\n    closeAIDialog: useCallback(() => {\n      setAiDialogOpen(false);\n    }, []),\n    setAiGenerating,\n    setAiStatus,\n    setAiError,\n    setAiErrorDismissed,\n    setAiSettings,\n\n    // Delete confirmation actions\n    openDeleteRoundConfirm: useCallback(() => {\n      setDeleteRoundConfirmOpen(true);\n    }, []),\n    closeDeleteRoundConfirm: useCallback(() => {\n      setDeleteRoundConfirmOpen(false);\n    }, []),\n    openDeleteQuestionConfirm: useCallback((questionId: string) => {\n      setPendingDeleteQuestionId(questionId);\n      setDeleteQuestionConfirmOpen(true);\n    }, []),\n    closeDeleteQuestionConfirm: useCallback(() => {\n      setDeleteQuestionConfirmOpen(false);\n      setPendingDeleteQuestionId(null);\n    }, []),\n  };\n\n  const state: QuestionsStepState = {\n    currentRoundIdx,\n    roundModalOpen,\n    roundModalMode,\n    editingRound,\n    roundForm,\n    manualDialogOpen,\n    manualQuestion,\n    editingQuestionId,\n    aiDialogOpen,\n    aiGenerating,\n    aiStatus,\n    aiError,\n    aiErrorDismissed,\n    aiSettings,\n    deleteRoundConfirmOpen,\n    deleteQuestionConfirmOpen,\n    pendingDeleteQuestionId,\n  };\n\n  return {\n    state,\n    actions,\n    derived: {\n      rounds,\n      currentRound,\n      isRoundFormValid,\n    },\n  };\n};\n","/**\n * roundInfoContent.ts\n *\n * Maps each round type to a user-friendly description for the info modal.\n * Text is written for non-technical users (children and adults alike).\n *\n * @version 1.0.0\n * @since 2025-06-12\n */\n\nexport type RoundType =\n  | \"mixed\"\n  | \"single-answer\"\n  | \"multiple-choice\"\n  | \"picture\"\n  | \"audio\"\n  | \"video\"\n  | \"golden-pyramid\";\n\n/**\n * User-friendly info text for each round type.\n */\nexport const roundInfoContent: Record<RoundType, string> = {\n  mixed:\n    \"Mixed Types: This round can have any kind of questionmultiple choice, single answer, pictures, audio, or video. Great for variety!\",\n  \"single-answer\":\n    \"Single Answer Only: Every question in this round has just one correct answer. Type your answer in the box. No tricky choicesjust what you know!\",\n  \"multiple-choice\":\n    \"Multiple Choice: Each question gives you a few possible answers. Pick the one you think is right. Only one answer is correct for each question.\",\n  picture:\n    \"Picture Round: Every question shows a picture. You might have to name what's in the picture, answer a question about it, or pick from choices. Look closely!\",\n  audio:\n    \"Audio Round: Listen to a sound or a short clip, then answer the question. You might have to name a song, a person, or guess what's happening.\",\n  video:\n    \"Video Round: Watch a short video, then answer a question about what you saw or heard. Pay attention to details!\",\n  \"golden-pyramid\":\n    \"Golden Pyramid: This special round has 4 steps. Each step is a question with only one correct answer. If you get a question right, you move up to the next step. The questions get harder as you go, and you can win more points the higher you climb!\",\n};\n","import React from \"react\";\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Button,\n  Typography,\n  IconButton,\n} from \"@mui/material\";\nimport InfoOutlinedIcon from \"@mui/icons-material/InfoOutlined\";\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport { roundInfoContent } from \"./roundInfoContent\";\n\n/**\n * Props for RoundInfoModal\n */\nexport interface RoundInfoModalProps {\n  open: boolean;\n  onClose: () => void;\n  roundType:\n    | \"mixed\"\n    | \"single-answer\"\n    | \"multiple-choice\"\n    | \"picture\"\n    | \"audio\"\n    | \"video\"\n    | \"golden-pyramid\";\n}\n\n/**\n * RoundInfoModal\n *\n * Displays a user-friendly explanation of the selected round type.\n * Accessible, keyboard navigable, and dismissible.\n *\n * @param props - RoundInfoModalProps\n */\nexport const RoundInfoModal: React.FC<RoundInfoModalProps> = ({\n  open,\n  onClose,\n  roundType,\n}) => {\n  return (\n    <Dialog\n      open={open}\n      onClose={onClose}\n      aria-labelledby=\"round-info-title\"\n      maxWidth=\"xs\"\n      fullWidth\n    >\n      <DialogTitle\n        id=\"round-info-title\"\n        sx={{ display: \"flex\", alignItems: \"center\", gap: 1 }}\n      >\n        <InfoOutlinedIcon color=\"info\" sx={{ mr: 1 }} />\n        <Typography variant=\"h6\" component=\"span\" sx={{ flex: 1 }}>\n          {getRoundTitle(roundType)}\n        </Typography>\n        <IconButton aria-label=\"Close info\" onClick={onClose} edge=\"end\">\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        <Typography variant=\"body1\" sx={{ mt: 1, mb: 2 }}>\n          {roundInfoContent[roundType]}\n        </Typography>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={onClose} color=\"primary\" variant=\"contained\" autoFocus>\n          Close\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\n/**\n * Returns a user-friendly title for each round type.\n */\nfunction getRoundTitle(\n  type:\n    | \"mixed\"\n    | \"single-answer\"\n    | \"multiple-choice\"\n    | \"picture\"\n    | \"audio\"\n    | \"video\"\n    | \"golden-pyramid\"\n): string {\n  switch (type) {\n    case \"mixed\":\n      return \"Mixed Types Round\";\n    case \"single-answer\":\n      return \"Single Answer Only Round\";\n    case \"multiple-choice\":\n      return \"Multiple Choice Round\";\n    case \"picture\":\n      return \"Picture Round\";\n    case \"audio\":\n      return \"Audio Round\";\n    case \"video\":\n      return \"Video Round\";\n    case \"golden-pyramid\":\n      return \"Golden Pyramid Round\";\n    default:\n      return \"Round Info\";\n  }\n}\n","/**\n * Round Navigation Component\n *\n * Handles navigation between rounds and provides round management actions.\n * This component was extracted from the monolithic QuestionsStep component\n * to improve maintainability and follow Single Responsibility Principle.\n *\n * Features:\n * - Integrated design: < [Round X/Y] [Add] > navigation with beautiful styling\n * - Round button remains central between navigation arrows\n * - Add Round button integrated between Round counter and forward arrow\n * - Responsive design: \"Add Round\" text on web, \"+\" icon on mobile\n * - Beautiful Material-UI styling with gradients and animations\n *\n * @fileoverview Round navigation component for quiz wizard\n * @version 8.0.0 (Integrated Add Round button)\n * @since December 2024\n */\n\nimport React from \"react\";\nimport { Box, Typography, Button, IconButton, Fab } from \"@mui/material\";\nimport {\n  ChevronLeft as ChevronLeftIcon,\n  ChevronRight as ChevronRightIcon,\n  Add as AddIcon,\n  Edit as EditIcon,\n  InfoOutlined as InfoOutlinedIcon,\n} from \"@mui/icons-material\";\nimport type { Round } from \"../../../types\";\nimport { RoundInfoModal } from \"../../components/RoundInfo/RoundInfoModal\";\nimport { roundInfoContent } from \"../../components/RoundInfo/roundInfoContent\";\n\ninterface RoundNavigationProps {\n  /** Array of all rounds */\n  rounds: Round[];\n  /** Current round index */\n  currentRoundIdx: number;\n  /** Current round object */\n  currentRound: Round | null;\n  /** Go to previous round */\n  onPreviousRound: () => void;\n  /** Go to next round */\n  onNextRound: () => void;\n  /** Add new round */\n  onAddRound: () => void;\n  /** Edit current round */\n  onEditRound: () => void;\n  /** Delete current round */\n  onDeleteRound: () => void;\n}\n\n/**\n * Round Navigation Component\n *\n * Provides navigation controls and round management actions for the quiz wizard.\n * Features integrated Add Round button inside the navigation bar.\n *\n * @param props - Component props including rounds data and navigation callbacks\n * @returns JSX element representing the round navigation interface\n */\nexport const RoundNavigation: React.FC<RoundNavigationProps> = ({\n  rounds,\n  currentRoundIdx,\n  currentRound,\n  onPreviousRound,\n  onNextRound,\n  onAddRound,\n  onEditRound,\n  onDeleteRound,\n}) => {\n  const hasRounds = rounds.length > 0;\n  const canGoBack = hasRounds && currentRoundIdx > 0;\n  const canGoForward = hasRounds && currentRoundIdx < rounds.length - 1;\n\n  // Add state for info modal\n  const [infoModalOpen, setInfoModalOpen] = React.useState(false);\n\n  return (\n    <Box sx={{ mb: 3 }}>\n      {/* Integrated Navigation Bar */}\n      <Box\n        sx={{\n          display: \"flex\",\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          gap: { xs: 0.5, sm: 1.5 },\n          p: { xs: 1.5, sm: 2 },\n          borderRadius: 3,\n          bgcolor: \"background.paper\",\n          border: 1,\n          borderColor: \"divider\",\n          boxShadow: \"0 2px 8px rgba(0,0,0,0.08)\",\n          transition: \"all 0.2s ease-in-out\",\n          \"&:hover\": {\n            boxShadow: \"0 4px 16px rgba(0,0,0,0.12)\",\n          },\n        }}\n      >\n        {/* Left Navigation Arrow - At Beginning */}\n        <Fab\n          onClick={onPreviousRound}\n          disabled={!canGoBack}\n          size=\"medium\"\n          sx={{\n            width: { xs: 36, sm: 44 },\n            height: { xs: 36, sm: 44 },\n            minWidth: { xs: 36, sm: 44 },\n            bgcolor: canGoBack ? \"primary.main\" : \"grey.200\",\n            color: canGoBack ? \"white\" : \"grey.400\",\n            boxShadow: canGoBack ? 2 : 1,\n            transition: \"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)\",\n            transform: canGoBack ? \"scale(1)\" : \"scale(0.9)\",\n            \"&:hover\": {\n              bgcolor: canGoBack ? \"primary.dark\" : \"grey.200\",\n              transform: canGoBack ? \"scale(1.05)\" : \"scale(0.9)\",\n              boxShadow: canGoBack ? 3 : 1,\n            },\n            \"&:active\": {\n              transform: canGoBack ? \"scale(0.95)\" : \"scale(0.9)\",\n            },\n            \"&:disabled\": {\n              bgcolor: \"grey.200\",\n              color: \"grey.400\",\n              cursor: \"not-allowed\",\n            },\n          }}\n          aria-label=\"Previous round\"\n        >\n          <ChevronLeftIcon sx={{ fontSize: { xs: \"1.1rem\", sm: \"1.3rem\" } }} />\n        </Fab>\n\n        {/* Spacer for center positioning */}\n        <Box sx={{ flex: 1 }} />\n\n        {/* Center Round Button (Only show if rounds exist) */}\n        {hasRounds ? (\n          <>\n            <Button\n              onClick={onEditRound}\n              endIcon={\n                <EditIcon sx={{ fontSize: { xs: \"0.9rem\", sm: \"1rem\" } }} />\n              }\n              sx={{\n                borderRadius: 3,\n                textTransform: \"none\",\n                fontWeight: 600,\n                fontSize: { xs: \"0.8rem\", sm: \"0.9rem\" },\n                px: { xs: 2, sm: 3 },\n                py: { xs: 1, sm: 1.2 },\n                background: \"linear-gradient(45deg, #1976d2, #42a5f5)\",\n                color: \"white\",\n                boxShadow: \"0 2px 8px rgba(25, 118, 210, 0.3)\",\n                transition: \"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)\",\n                minWidth: { xs: 90, sm: 120 },\n                \"&:hover\": {\n                  background: \"linear-gradient(45deg, #1565c0, #1976d2)\",\n                  boxShadow: \"0 4px 12px rgba(25, 118, 210, 0.4)\",\n                  transform: \"translateY(-1px)\",\n                },\n                \"&:active\": {\n                  transform: \"translateY(0px)\",\n                },\n              }}\n            >\n              <Typography\n                variant=\"inherit\"\n                sx={{\n                  fontWeight: 600,\n                  fontSize: \"inherit\",\n                  whiteSpace: \"nowrap\",\n                }}\n              >\n                Round {currentRoundIdx + 1}/{rounds.length}\n              </Typography>\n            </Button>\n          </>\n        ) : (\n          <Typography\n            variant=\"body2\"\n            sx={{\n              color: \"text.secondary\",\n              fontWeight: 500,\n              px: { xs: 2, sm: 3 },\n              fontSize: { xs: \"0.8rem\", sm: \"0.9rem\" },\n            }}\n          >\n            No rounds yet\n          </Typography>\n        )}\n\n        {/* Add Round Button - Next to Round Button */}\n        <Button\n          onClick={onAddRound}\n          sx={{\n            borderRadius: { xs: \"50%\", sm: 3 }, // Circular on mobile, rounded on web\n            textTransform: \"none\",\n            fontWeight: { xs: 600, sm: 500 },\n            fontSize: { xs: \"1.4rem\", sm: \"0.8rem\" },\n            px: { xs: 0, sm: 3 }, // No horizontal padding on mobile for circular shape\n            py: { xs: 0, sm: 1.2 }, // No vertical padding on mobile for circular shape\n            minWidth: { xs: 40, sm: 120 }, // Match Round button width exactly\n            minHeight: { xs: 40, sm: 44 }, // Match Round button height exactly\n            width: { xs: 40, sm: 120 }, // Fixed dimensions to match Round button\n            height: { xs: 40, sm: 44 }, // Fixed dimensions to match Round button\n            ml: { xs: 0.5, sm: 1 },\n            background: \"linear-gradient(45deg, #4caf50, #66bb6a)\",\n            color: \"white\",\n            boxShadow: \"0 2px 8px rgba(76, 175, 80, 0.3)\",\n            transition: \"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)\",\n            display: \"flex\",\n            alignItems: \"center\",\n            justifyContent: \"center\",\n            \"&:hover\": {\n              background: \"linear-gradient(45deg, #388e3c, #4caf50)\",\n              boxShadow: \"0 4px 12px rgba(76, 175, 80, 0.4)\",\n              transform: \"translateY(-1px)\",\n            },\n            \"&:active\": {\n              transform: \"translateY(0px)\",\n            },\n          }}\n          aria-label=\"Add round\"\n        >\n          {/* Mobile: Show only + icon, perfectly centered */}\n          <Box\n            sx={{\n              display: { xs: \"flex\", sm: \"none\" },\n              alignItems: \"center\",\n              justifyContent: \"center\",\n              width: \"100%\",\n              height: \"100%\",\n            }}\n          >\n            <AddIcon sx={{ fontSize: \"1.6rem\" }} />\n          </Box>\n\n          {/* Web: Show text only */}\n          <Typography\n            variant=\"inherit\"\n            sx={{\n              fontWeight: 600,\n              fontSize: \"inherit\",\n              display: { xs: \"none\", sm: \"block\" },\n              whiteSpace: \"nowrap\",\n            }}\n          >\n            Add Round\n          </Typography>\n        </Button>\n\n        {/* Spacer for end positioning */}\n        <Box sx={{ flex: 1 }} />\n\n        {/* Right Navigation Arrow - At End */}\n        <Fab\n          onClick={onNextRound}\n          disabled={!canGoForward}\n          size=\"medium\"\n          sx={{\n            width: { xs: 36, sm: 44 },\n            height: { xs: 36, sm: 44 },\n            minWidth: { xs: 36, sm: 44 },\n            bgcolor: canGoForward ? \"primary.main\" : \"grey.200\",\n            color: canGoForward ? \"white\" : \"grey.400\",\n            boxShadow: canGoForward ? 2 : 1,\n            transition: \"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)\",\n            transform: canGoForward ? \"scale(1)\" : \"scale(0.9)\",\n            \"&:hover\": {\n              bgcolor: canGoForward ? \"primary.dark\" : \"grey.200\",\n              transform: canGoForward ? \"scale(1.05)\" : \"scale(0.9)\",\n              boxShadow: canGoForward ? 3 : 1,\n            },\n            \"&:active\": {\n              transform: canGoForward ? \"scale(0.95)\" : \"scale(0.9)\",\n            },\n            \"&:disabled\": {\n              bgcolor: \"grey.200\",\n              color: \"grey.400\",\n              cursor: \"not-allowed\",\n            },\n          }}\n          aria-label=\"Next round\"\n        >\n          <ChevronRightIcon sx={{ fontSize: { xs: \"1.1rem\", sm: \"1.3rem\" } }} />\n        </Fab>\n      </Box>\n    </Box>\n  );\n};\n","/**\n * Questions List Component\n *\n * Displays the list of questions in the current round and provides\n * question management actions. Extracted from the monolithic QuestionsStep\n * component to improve maintainability.\n *\n * Features:\n * - Display questions as clickable cards\n * - Empty state when no questions exist\n * - Question difficulty indicators\n * - Question completion status indicators (NEW)\n * - Delete question functionality\n *\n * @fileoverview Questions list component for quiz wizard\n * @version 2.0.0\n * @since December 2025\n */\n\nimport React from \"react\";\nimport {\n  Box,\n  Typography,\n  Card,\n  CardContent,\n  Chip,\n  IconButton,\n  Button,\n} from \"@mui/material\";\nimport {\n  Delete as DeleteIcon,\n  QuestionAnswer as QuestionIcon,\n  CheckCircle as CheckCircleIcon,\n  Warning as WarningIcon,\n  Add as AddIcon,\n  InfoOutlined as InfoOutlinedIcon,\n} from \"@mui/icons-material\";\nimport type { Round, QuizQuestion } from \"../../../types\";\nimport { RoundInfoModal } from \"../../components/RoundInfo/RoundInfoModal\";\n\n/**\n * Props for the QuestionsList component\n */\ninterface QuestionsListProps {\n  /** Current round */\n  currentRound: Round | null;\n  /** Callback when question is clicked for editing */\n  onEditQuestion: (question: QuizQuestion) => void;\n  /** Callback when question should be deleted */\n  onDeleteQuestion: (questionId: string) => void;\n  /** Callback when add round button is clicked (for empty state) */\n  onAddRound?: () => void;\n  /** Callback when add question button is clicked (for empty questions state) */\n  onAddQuestion?: () => void;\n}\n\n/**\n * Helper function to determine if a question is complete\n *\n * @param question - The question to check\n * @param roundType - The type of round this question belongs to\n * @returns true if the question is complete, false otherwise\n */\nconst isQuestionComplete = (\n  question: QuizQuestion,\n  roundType?: string\n): boolean => {\n  // Check if question text is filled\n  if (!question.question || !question.question.trim()) {\n    return false;\n  }\n\n  // For media types, distinguish between single-answer and multiple-choice modes\n  if ([\"picture\", \"audio\", \"video\"].includes(question.type)) {\n    if (question.possibleAnswers.length > 0) {\n      // Multiple choice mode for media: at least 2 non-empty options and a correct answer\n      return (\n        question.possibleAnswers.length >= 2 &&\n        question.possibleAnswers.every((opt) => opt && opt.trim()) &&\n        question.correctAnswers &&\n        question.correctAnswers.length > 0\n      );\n    } else {\n      // Single-answer mode for media: require correctAnswerText\n      return !!(\n        question.correctAnswerText && question.correctAnswerText.trim()\n      );\n    }\n  }\n\n  // Single-answer (non-media)\n  if (question.type === \"single-answer\") {\n    return !!(question.correctAnswerText && question.correctAnswerText.trim());\n  }\n\n  // Golden Pyramid\n  if (roundType === \"golden-pyramid\") {\n    return !!(question.correctAnswerText && question.correctAnswerText.trim());\n  }\n\n  // Regular multiple choice\n  const hasValidAnswers =\n    question.possibleAnswers.length >= 2 &&\n    question.possibleAnswers.every((opt: string) => opt && opt.trim());\n  const hasCorrectAnswer =\n    question.correctAnswers && question.correctAnswers.length > 0;\n  return hasValidAnswers && hasCorrectAnswer;\n};\n\n/**\n * Questions List Component\n *\n * Renders the list of questions for the current round with edit and delete actions.\n * Shows appropriate empty states when no questions exist.\n * Now includes completion status indicators for better user experience.\n * Added \"Add Round\" button in empty state when no rounds exist.\n *\n * @param props - Component props including round data and question callbacks\n * @returns JSX element representing the questions list\n */\nexport const QuestionsList: React.FC<QuestionsListProps> = ({\n  currentRound,\n  onEditQuestion,\n  onDeleteQuestion,\n  onAddRound,\n  onAddQuestion,\n}) => {\n  const [infoModalOpen, setInfoModalOpen] = React.useState(false);\n\n  // Show empty state if no round is selected\n  if (!currentRound) {\n    return (\n      <Card\n        elevation={0}\n        sx={{\n          textAlign: \"center\",\n          py: 6,\n          border: 2,\n          borderStyle: \"dashed\",\n          borderColor: \"divider\",\n          bgcolor: \"background.default\",\n        }}\n      >\n        <CardContent>\n          <QuestionIcon sx={{ fontSize: 64, color: \"text.secondary\", mb: 2 }} />\n          <Typography variant=\"h6\" gutterBottom>\n            No Rounds Yet\n          </Typography>\n          <Typography variant=\"body2\" color=\"text.secondary\" paragraph>\n            Add your first round to begin creating your quiz structure.\n          </Typography>\n          {/* Add Round button - similar to main quizzes page empty state */}\n          {onAddRound && (\n            <Button\n              variant=\"contained\"\n              size=\"large\"\n              startIcon={<AddIcon />}\n              onClick={onAddRound}\n              sx={{ mt: 2 }}\n            >\n              Add Round\n            </Button>\n          )}\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <>\n      {/* Round Info */}\n      <Box sx={{ mb: 2, display: \"flex\", alignItems: \"center\", gap: 1 }}>\n        <Typography variant=\"subtitle1\" color=\"text.secondary\">\n          {currentRound.level ? `Level: ${currentRound.level}` : \"\"} | Reveal:{\" \"}\n          {currentRound.answerRevealMode} | Default Time:{\" \"}\n          {currentRound.defaultTimePerQuestion}min\n        </Typography>\n        <IconButton\n          aria-label=\"Round info\"\n          size=\"small\"\n          onClick={() => setInfoModalOpen(true)}\n        >\n          <InfoOutlinedIcon fontSize=\"small\" />\n        </IconButton>\n      </Box>\n\n      {/* Questions List */}\n      <Box sx={{ display: \"flex\", flexDirection: \"column\", gap: 2 }}>\n        {currentRound.questions.length === 0 ? (\n          <Card\n            elevation={0}\n            sx={{\n              textAlign: \"center\",\n              py: 4,\n              border: 1,\n              borderStyle: \"dashed\",\n              borderColor: \"divider\",\n            }}\n          >\n            <CardContent>\n              <Typography variant=\"body2\" color=\"text.secondary\" paragraph>\n                No questions in this round yet. Add or generate questions to get\n                started.\n              </Typography>\n              {/* Add Question button - only show if callback is provided */}\n              {onAddQuestion && (\n                <Button\n                  variant=\"contained\"\n                  size=\"medium\"\n                  startIcon={<AddIcon />}\n                  onClick={onAddQuestion}\n                  sx={{ mt: 1 }}\n                >\n                  Add Question\n                </Button>\n              )}\n            </CardContent>\n          </Card>\n        ) : (\n          currentRound.questions.map((question, index) => {\n            const isComplete = isQuestionComplete(question, currentRound.type);\n\n            return (\n              <Card\n                key={question.id}\n                elevation={0}\n                sx={{\n                  display: \"flex\",\n                  alignItems: \"center\",\n                  justifyContent: \"space-between\",\n                  px: 2,\n                  py: 1.5,\n                  cursor: \"pointer\",\n                  bgcolor: \"background.paper\",\n                  transition: \"box-shadow 0.2s\",\n                  \"&:hover\": { boxShadow: 4 },\n                }}\n                onClick={() => onEditQuestion(question)}\n                aria-label={`Edit question ${index + 1}`}\n              >\n                {/* Completion Status Icon */}\n                <Box sx={{ mr: 1, display: \"flex\", alignItems: \"center\" }}>\n                  {isComplete ? (\n                    <CheckCircleIcon\n                      sx={{\n                        color: \"success.main\",\n                        fontSize: { xs: 16, sm: 18 },\n                      }}\n                      titleAccess=\"Question complete\"\n                    />\n                  ) : (\n                    <WarningIcon\n                      sx={{\n                        color: \"error.main\",\n                        fontSize: { xs: 16, sm: 18 },\n                      }}\n                      titleAccess=\"Question incomplete\"\n                    />\n                  )}\n                </Box>\n\n                <Typography variant=\"subtitle1\" sx={{ flex: 1 }}>\n                  {index + 1}. {question.question || \"Untitled Question\"}\n                </Typography>\n\n                <Chip\n                  label={question.difficulty}\n                  size=\"small\"\n                  color={\n                    question.difficulty === \"easy\"\n                      ? \"success\"\n                      : question.difficulty === \"medium\"\n                      ? \"warning\"\n                      : \"error\"\n                  }\n                  sx={{ mr: 1 }}\n                />\n\n                <IconButton\n                  size=\"small\"\n                  color=\"error\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    onDeleteQuestion(question.id);\n                  }}\n                  aria-label={`Delete question ${index + 1}`}\n                >\n                  <DeleteIcon fontSize=\"small\" />\n                </IconButton>\n              </Card>\n            );\n          })\n        )}\n      </Box>\n\n      <RoundInfoModal\n        open={infoModalOpen}\n        onClose={() => setInfoModalOpen(false)}\n        roundType={currentRound.type}\n      />\n    </>\n  );\n};\n","/**\n * Question Actions Bar Component\n *\n * Provides action buttons for adding questions (AI generation and manual creation).\n * Extracted from the monolithic QuestionsStep component to improve modularity.\n *\n * Features:\n * - AI question generation button (only for supported round types)\n * - Manual question creation button\n * - Conditional display based on round type restrictions\n *\n * @fileoverview Question actions bar component for quiz wizard\n * @version 2.0.0 (Updated for round restrictions)\n * @since December 2025\n */\n\nimport React from \"react\";\nimport { Box, Button } from \"@mui/material\";\nimport { Add as AddIcon, Psychology as AIIcon } from \"@mui/icons-material\";\nimport type { RoundType } from \"../../../types\";\n\ninterface QuestionActionsBarProps {\n  /** Whether to show the actions bar (when round exists) */\n  showActions: boolean;\n  /** Current round type to determine which buttons to show */\n  roundType?: RoundType;\n  /** Callback to open AI generation dialog */\n  onOpenAIDialog: () => void;\n  /** Callback to open manual question dialog */\n  onOpenManualDialog: () => void;\n}\n\n/**\n * Question Actions Bar Component\n *\n * Renders action buttons for creating questions when a round is selected.\n * Provides both AI generation and manual creation options based on round type.\n *\n * @param props - Component props including visibility, round type, and action callbacks\n * @returns JSX element representing the question actions bar\n */\nexport const QuestionActionsBar: React.FC<QuestionActionsBarProps> = ({\n  showActions,\n  roundType,\n  onOpenAIDialog,\n  onOpenManualDialog,\n}) => {\n  // Don't render if no round is selected\n  if (!showActions || !roundType) {\n    return null;\n  }\n\n  // Golden Pyramid rounds shouldn't have any add buttons (4 questions are pre-populated)\n  if (roundType === \"golden-pyramid\") {\n    return null;\n  }\n\n  // AI Generate button should only appear in Mixed, Single Answer Only, and Multiple Choice rounds\n  const showAIButton = [\n    \"mixed\",\n    \"single-answer-only\",\n    \"multiple-choice\",\n  ].includes(roundType);\n\n  return (\n    <Box sx={{ display: \"flex\", gap: 1, mb: 3 }}>\n      {showAIButton && (\n        <Button\n          variant=\"outlined\"\n          startIcon={<AIIcon />}\n          onClick={onOpenAIDialog}\n          aria-label=\"Generate question with AI\"\n        >\n          AI Generate\n        </Button>\n      )}\n      <Button\n        variant=\"contained\"\n        startIcon={<AddIcon />}\n        onClick={onOpenManualDialog}\n        aria-label=\"Add question manually\"\n      >\n        Add Question\n      </Button>\n    </Box>\n  );\n};\n","/**\n * Question Editor Component (UPDATED FOR NEW SYSTEM)\n *\n * Dedicated component for editing individual quiz questions with support for\n * single answer, multiple choice, and media (image, audio, video) questions.\n * Updated to work with the new round-based question type system.\n *\n * Features:\n * - Round-based question type restrictions\n * - Single answer questions with text input\n * - Multiple choice questions (1-20 answers)\n * - Media upload for picture/audio/video questions\n * - Time limits in minutes with decimal support\n * - Points with decimal support\n * - Improved file type validation\n * - Mobile responsive media display\n *\n * @fileoverview Question editing interface component\n * @version 2.1.0 (Fixed file upload and mobile display)\n * @since December 2025\n */\n\nimport React from \"react\";\nimport {\n  Card,\n  CardContent,\n  Typography,\n  TextField,\n  Button,\n  Box,\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n  IconButton,\n  Stack,\n  Chip,\n  FormControlLabel,\n  Checkbox,\n} from \"@mui/material\";\nimport { Delete as DeleteIcon, Add as AddIcon } from \"@mui/icons-material\";\n\n// Types\nimport type {\n  QuizQuestion,\n  QuestionType,\n  MediaFile,\n  RoundType,\n} from \"../../../types\";\n\n// Constants\nimport { ROUND_TYPE_CONFIG } from \"../../../types\";\n\n/**\n * Props for the QuestionEditor component\n */\ninterface QuestionEditorProps {\n  /** The question being edited */\n  question: QuizQuestion;\n  /** Callback when question is updated */\n  onUpdate: (updates: Partial<QuizQuestion>) => void;\n  /** Round type to determine allowed question types */\n  roundType?: RoundType;\n}\n\n/**\n * Question Editor Component\n */\nexport const QuestionEditor: React.FC<QuestionEditorProps> = ({\n  question,\n  onUpdate,\n  roundType = \"mixed\",\n}) => {\n  const roundConfig = ROUND_TYPE_CONFIG[roundType];\n\n  /**\n   * Handles file upload for media questions\n   */\n  const handleMediaUpload = async (\n    event: React.ChangeEvent<HTMLInputElement>\n  ) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    // Enhanced file type validation with both MIME types and extensions\n    const validTypes = {\n      picture: [\n        \"image/jpeg\",\n        \"image/jpg\",\n        \"image/png\",\n        \"image/webp\",\n        \"image/gif\",\n        \"image/bmp\",\n        \"image/tiff\",\n        \"image/svg+xml\",\n      ],\n      audio: [\n        \"audio/mpeg\",\n        \"audio/mp3\",\n        \"audio/wav\",\n        \"audio/wave\",\n        \"audio/x-wav\",\n        \"audio/wma\",\n        \"audio/mp4\",\n        \"audio/m4a\",\n      ],\n      video: [\n        \"video/mp4\",\n        \"video/webm\",\n        \"video/mov\",\n        \"video/quicktime\",\n        \"video/x-msvideo\",\n        \"video/avi\",\n        \"video/wmv\",\n      ],\n    };\n\n    // Get file extension as backup validation\n    const fileExtension = file.name.split(\".\").pop()?.toLowerCase() || \"\";\n    const validExtensions = {\n      picture: [\"jpg\", \"jpeg\", \"png\", \"webp\", \"gif\", \"bmp\", \"tiff\", \"svg\"],\n      audio: [\"mp3\", \"wav\", \"wma\", \"m4a\"],\n      video: [\"mp4\", \"mov\", \"wmv\", \"avi\", \"webm\"],\n    };\n\n    const questionTypeKey = question.type as keyof typeof validTypes;\n    const isValidMimeType = validTypes[questionTypeKey]?.includes(file.type);\n    const isValidExtension =\n      validExtensions[questionTypeKey]?.includes(fileExtension);\n\n    if (!isValidMimeType && !isValidExtension) {\n      alert(\n        `Unsupported file format. Supported formats: ${validExtensions[\n          questionTypeKey\n        ]?.join(\", \")}`\n      );\n      return;\n    }\n\n    // Check file size limits\n    const sizeLimits = {\n      picture: 10 * 1024 * 1024, // 10MB\n      audio: 20 * 1024 * 1024, // 20MB\n      video: 100 * 1024 * 1024, // 100MB\n    };\n\n    if (file.size > sizeLimits[questionTypeKey]) {\n      const limitMB = sizeLimits[questionTypeKey] / (1024 * 1024);\n      alert(\n        `File too large. Maximum size for ${questionTypeKey} files is ${limitMB}MB`\n      );\n      return;\n    }\n\n    // Convert file to base64 for storage\n    const reader = new FileReader();\n    reader.onload = (ev) => {\n      const mediaFile: MediaFile = {\n        id: `media_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        filename: file.name,\n        type:\n          question.type === \"picture\"\n            ? \"image\"\n            : question.type === \"audio\"\n            ? \"audio\"\n            : \"video\",\n        size: file.size,\n        data: ev.target?.result as string,\n        mimeType: file.type,\n        createdAt: new Date(),\n      };\n      onUpdate({ mediaFile });\n    };\n    reader.readAsDataURL(file);\n  };\n\n  /**\n   * Handles multiple choice option updates\n   */\n  const updateOption = (index: number, value: string) => {\n    const newOptions = [...question.possibleAnswers];\n    newOptions[index] = value;\n    onUpdate({ possibleAnswers: newOptions });\n  };\n\n  /**\n   * Adds a new option (max 20)\n   */\n  const addOption = () => {\n    if (question.possibleAnswers.length < 20) {\n      onUpdate({ possibleAnswers: [...question.possibleAnswers, \"\"] });\n    }\n  };\n\n  /**\n   * Removes an option (min 1 for multiple choice, min 0 for single answer)\n   */\n  const removeOption = (index: number) => {\n    const minOptions = question.type === \"multiple-choice\" ? 2 : 0;\n    if (question.possibleAnswers.length > minOptions) {\n      const newOptions = question.possibleAnswers.filter((_, i) => i !== index);\n      // Update correct answers to remove any that reference the deleted option\n      const newCorrectAnswers = question.correctAnswers\n        .filter((answerIndex) => answerIndex !== index)\n        .map((answerIndex) =>\n          answerIndex > index ? answerIndex - 1 : answerIndex\n        );\n      onUpdate({\n        possibleAnswers: newOptions,\n        correctAnswers: newCorrectAnswers,\n      });\n    }\n  };\n\n  /**\n   * Toggles correct answer selection for multiple choice\n   */\n  const toggleCorrectAnswer = (index: number) => {\n    const currentCorrect = question.correctAnswers || [];\n    const isCorrect = currentCorrect.includes(index);\n\n    let newCorrectAnswers;\n    if (isCorrect) {\n      // Remove from correct answers\n      newCorrectAnswers = currentCorrect.filter((i) => i !== index);\n    } else {\n      // Add to correct answers\n      newCorrectAnswers = [...currentCorrect, index].sort();\n    }\n\n    onUpdate({ correctAnswers: newCorrectAnswers });\n  };\n\n  /**\n   * Renders media upload interface with mobile responsive display\n   */\n  const renderMediaUpload = () => {\n    // Show media upload for media question types OR media round types\n    const isMediaQuestion = [\"picture\", \"audio\", \"video\"].includes(\n      question.type\n    );\n    const isMediaRound = [\"picture\", \"audio\", \"video\"].includes(\n      roundType || \"\"\n    );\n\n    if (!isMediaQuestion && !isMediaRound) {\n      return null;\n    }\n\n    // Determine media type from question type or round type\n    const mediaType = isMediaQuestion ? question.type : roundType;\n\n    return (\n      <Box sx={{ mb: 3 }}>\n        <Typography variant=\"subtitle2\" gutterBottom>\n          Media File\n        </Typography>\n        <Button\n          variant=\"outlined\"\n          component=\"label\"\n          sx={{ mb: 2 }}\n          aria-label={`Upload ${mediaType} file`}\n        >\n          Upload{\" \"}\n          {mediaType && mediaType.charAt(0).toUpperCase() + mediaType.slice(1)}\n          <input\n            type=\"file\"\n            accept={\n              mediaType === \"picture\"\n                ? \".jpg,.jpeg,.png,.webp,.gif,.bmp,.tiff,.svg\"\n                : mediaType === \"audio\"\n                ? \".mp3,.wav,.wma,.m4a\"\n                : \".mp4,.mov,.wmv,.avi,.webm\"\n            }\n            hidden\n            onChange={handleMediaUpload}\n          />\n        </Button>\n\n        {/* Media preview with mobile responsive design */}\n        {question.mediaFile && (\n          <Box sx={{ mb: 2 }}>\n            {mediaType === \"picture\" && (\n              <Box\n                component=\"img\"\n                src={question.mediaFile.data}\n                alt=\"Question media\"\n                sx={{\n                  maxWidth: \"100%\",\n                  width: \"100%\",\n                  maxHeight: { xs: 200, sm: 300, md: 400 },\n                  height: \"auto\",\n                  borderRadius: 2,\n                  objectFit: \"contain\",\n                  border: \"1px solid\",\n                  borderColor: \"divider\",\n                }}\n              />\n            )}\n            {mediaType === \"audio\" && (\n              <Box\n                component=\"audio\"\n                controls\n                src={question.mediaFile.data}\n                sx={{\n                  width: \"100%\",\n                  maxWidth: 400,\n                  height: 40,\n                }}\n              />\n            )}\n            {mediaType === \"video\" && (\n              <Box\n                component=\"video\"\n                controls\n                src={question.mediaFile.data}\n                sx={{\n                  maxWidth: \"100%\",\n                  width: \"100%\",\n                  maxHeight: { xs: 200, sm: 300, md: 400 },\n                  height: \"auto\",\n                  borderRadius: 2,\n                  objectFit: \"contain\",\n                  border: \"1px solid\",\n                  borderColor: \"divider\",\n                }}\n              />\n            )}\n            <Typography variant=\"caption\" display=\"block\" sx={{ mt: 1 }}>\n              {question.mediaFile.filename} (\n              {(question.mediaFile.size / 1024 / 1024).toFixed(2)} MB)\n            </Typography>\n            <Button\n              size=\"small\"\n              color=\"error\"\n              onClick={() => onUpdate({ mediaFile: undefined })}\n              sx={{ mt: 1 }}\n            >\n              Remove File\n            </Button>\n          </Box>\n        )}\n      </Box>\n    );\n  };\n\n  return (\n    <Stack spacing={3} sx={{ mt: 1 }}>\n      {/* Question Type Selection for Media Rounds */}\n      {(roundType === \"picture\" ||\n        roundType === \"audio\" ||\n        roundType === \"video\") && (\n        <FormControl fullWidth>\n          <InputLabel>Question Type</InputLabel>\n          <Select\n            value={question.type}\n            label=\"Question Type\"\n            onChange={(e) => {\n              const newType = e.target.value as QuestionType;\n              const updates: Partial<QuizQuestion> = { type: newType };\n\n              // Reset type-specific fields when changing type\n              if (newType === \"single-answer\") {\n                updates.possibleAnswers = [];\n                updates.correctAnswers = [];\n                updates.correctAnswerText = \"\";\n              } else if (newType === \"multiple-choice\") {\n                updates.possibleAnswers = [\"\", \"\", \"\", \"\"];\n                updates.correctAnswers = [0];\n                updates.correctAnswerText = undefined;\n              }\n\n              onUpdate(updates);\n            }}\n          >\n            <MenuItem value=\"single-answer\">Single Answer</MenuItem>\n            <MenuItem value=\"multiple-choice\">Multiple Choice</MenuItem>\n          </Select>\n        </FormControl>\n      )}\n\n      {/* Question Type Selection for Mixed Rounds */}\n      {roundType === \"mixed\" && (\n        <FormControl fullWidth>\n          <InputLabel>Question Type</InputLabel>\n          <Select\n            value={question.type}\n            label=\"Question Type\"\n            onChange={(e) => {\n              const newType = e.target.value as QuestionType;\n              const updates: Partial<QuizQuestion> = { type: newType };\n\n              // Reset type-specific fields when changing type\n              if (newType === \"single-answer\") {\n                updates.possibleAnswers = [];\n                updates.correctAnswers = [];\n                updates.correctAnswerText = \"\";\n                updates.mediaFile = undefined;\n              } else if (newType === \"multiple-choice\") {\n                updates.possibleAnswers = [\"\", \"\", \"\", \"\"];\n                updates.correctAnswers = [0];\n                updates.correctAnswerText = undefined;\n                updates.mediaFile = undefined;\n              } else {\n                // Media types - default to single answer behavior\n                updates.possibleAnswers = [];\n                updates.correctAnswers = [];\n                updates.correctAnswerText = \"\";\n              }\n\n              onUpdate(updates);\n            }}\n          >\n            {roundConfig.allowedQuestionTypes.map((type) => (\n              <MenuItem key={type} value={type}>\n                {type === \"single-answer\" && \"Single Answer\"}\n                {type === \"multiple-choice\" && \"Multiple Choice\"}\n                {type === \"picture\" && \"Picture Question\"}\n                {type === \"audio\" && \"Audio Question\"}\n                {type === \"video\" && \"Video Question\"}\n              </MenuItem>\n            ))}\n          </Select>\n        </FormControl>\n      )}\n\n      {/* Question Text */}\n      <TextField\n        fullWidth\n        label=\"Question\"\n        value={question.question || \"\"}\n        onChange={(e) => onUpdate({ question: e.target.value })}\n        placeholder=\"Type your question here...\"\n      />\n\n      {/* Media Upload */}\n      {renderMediaUpload()}\n\n      {/* Answer Configuration */}\n      {question.type === \"single-answer\" ||\n      ([\"picture\", \"audio\", \"video\"].includes(question.type) &&\n        question.possibleAnswers.length === 0) ||\n      roundType === \"golden-pyramid\" ? (\n        <Box>\n          <Box\n            sx={{\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              mb: 2,\n            }}\n          >\n            <Typography variant=\"subtitle2\">\n              {roundType === \"golden-pyramid\"\n                ? \"Possible Answers\"\n                : \"Correct Answer\"}\n            </Typography>\n            {/* For media questions, show option to switch to multiple choice */}\n            {[\"picture\", \"audio\", \"video\"].includes(question.type) &&\n              roundType !== \"golden-pyramid\" && (\n                <Button\n                  size=\"small\"\n                  variant=\"outlined\"\n                  onClick={() => {\n                    onUpdate({\n                      possibleAnswers: [\"\", \"\", \"\", \"\"],\n                      correctAnswers: [0],\n                      correctAnswerText: undefined,\n                    });\n                  }}\n                >\n                  Switch to Multiple Choice\n                </Button>\n              )}\n          </Box>\n          <TextField\n            fullWidth\n            label={\n              roundType === \"golden-pyramid\"\n                ? \"Type all possible answers (separated by commas, dots, etc.)\"\n                : \"Type the correct answer\"\n            }\n            value={question.correctAnswerText || \"\"}\n            onChange={(e) => onUpdate({ correctAnswerText: e.target.value })}\n            placeholder={\n              roundType === \"golden-pyramid\"\n                ? \"e.g., Answer 1, Answer 2, Answer 3, Answer 4\"\n                : \"e.g., Sofia, Paris, 1969...\"\n            }\n            helperText={\n              roundType === \"golden-pyramid\"\n                ? \"Enter all possible answers as a single text string. Users can separate with commas, dots, or any format they prefer.\"\n                : \"This is the exact answer participants need to type\"\n            }\n          />\n        </Box>\n      ) : (\n        <Box>\n          <Box\n            sx={{\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              mb: 2,\n            }}\n          >\n            <Typography variant=\"subtitle2\">\n              Answer Options (1-20 options)\n            </Typography>\n            {/* For media questions, show option to switch to single answer */}\n            {[\"picture\", \"audio\", \"video\"].includes(question.type) && (\n              <Button\n                size=\"small\"\n                variant=\"outlined\"\n                onClick={() => {\n                  onUpdate({\n                    possibleAnswers: [],\n                    correctAnswers: [],\n                    correctAnswerText: \"\",\n                  });\n                }}\n              >\n                Switch to Single Answer\n              </Button>\n            )}\n          </Box>\n          <Stack spacing={2}>\n            {question.possibleAnswers.map((option, index) => (\n              <Box\n                key={index}\n                sx={{ display: \"flex\", alignItems: \"center\", gap: 1 }}\n              >\n                <FormControlLabel\n                  control={\n                    <Checkbox\n                      checked={question.correctAnswers.includes(index)}\n                      onChange={() => toggleCorrectAnswer(index)}\n                    />\n                  }\n                  label=\"\"\n                />\n                <TextField\n                  fullWidth\n                  value={option}\n                  onChange={(e) => updateOption(index, e.target.value)}\n                  placeholder={`Enter option ${index + 1}...`}\n                />\n                {question.possibleAnswers.length > 1 && (\n                  <IconButton\n                    onClick={() => removeOption(index)}\n                    color=\"error\"\n                    size=\"small\"\n                  >\n                    <DeleteIcon />\n                  </IconButton>\n                )}\n              </Box>\n            ))}\n\n            {question.possibleAnswers.length < 20 && (\n              <Button\n                startIcon={<AddIcon />}\n                onClick={addOption}\n                variant=\"outlined\"\n                size=\"small\"\n              >\n                Add Option\n              </Button>\n            )}\n          </Stack>\n\n          {question.correctAnswers.length === 0 && (\n            <Typography variant=\"caption\" color=\"error\">\n              Please select at least one correct answer\n            </Typography>\n          )}\n        </Box>\n      )}\n\n      {/* Question Settings */}\n      <Box\n        sx={{\n          display: \"flex\",\n          gap: 2,\n          width: \"100%\",\n          flexWrap: \"nowrap\",\n          alignItems: \"flex-start\",\n        }}\n      >\n        <TextField\n          fullWidth\n          type=\"number\"\n          label=\"Points\"\n          placeholder=\"1\"\n          inputProps={{ min: 0.1, step: 0.1 }}\n          value={question.points || \"\"}\n          onChange={(e) => onUpdate({ points: Number(e.target.value) || 1 })}\n          sx={{ flex: 1, minWidth: 0 }}\n        />\n        <TextField\n          fullWidth\n          type=\"number\"\n          label=\"Time Limit (min)\"\n          placeholder=\"1\"\n          inputProps={{ min: 0.1, step: 0.1 }}\n          value={question.timeLimit || \"\"}\n          onChange={(e) => onUpdate({ timeLimit: Number(e.target.value) || 1 })}\n          sx={{ flex: 1, minWidth: 0 }}\n        />\n        <TextField\n          fullWidth\n          select\n          label=\"Difficulty\"\n          value={question.difficulty}\n          onChange={(e) => onUpdate({ difficulty: e.target.value as any })}\n          sx={{ flex: 1, minWidth: 0 }}\n        >\n          <MenuItem value=\"easy\">Easy</MenuItem>\n          <MenuItem value=\"medium\">Medium</MenuItem>\n          <MenuItem value=\"hard\">Hard</MenuItem>\n        </TextField>\n      </Box>\n\n      {/* Explanation */}\n      <TextField\n        fullWidth\n        label=\"Explanation (optional)\"\n        multiline\n        minRows={2}\n        maxRows={3}\n        value={question.explanation || \"\"}\n        onChange={(e) => onUpdate({ explanation: e.target.value })}\n        placeholder=\"Optional explanation shown after the question...\"\n      />\n    </Stack>\n  );\n};\n","/**\n * Gemini AI Service\n *\n * Comprehensive service for handling communication with Google Gemini API.\n * Provides intelligent question generation with advanced features:\n * - Multilingual support (English, Bulgarian)\n * - Difficulty and category control\n * - Session-based duplicate prevention\n * - Geographic fact-checking for accuracy\n * - Intelligent rate limiting with user feedback\n * - Real-time countdown timers during waits\n *\n * @fileoverview Google Gemini AI integration service\n * @version 2.0.0\n * @since December 2025\n */\n\nimport type {\n  FinalQuestion,\n  GeminiQuestionParams,\n  SessionQuestion,\n} from \"../types\";\n\n/**\n * Response structure from Google Gemini API\n * Represents the JSON format returned by the API service\n */\ninterface GeminiResponse {\n  candidates: Array<{\n    content: {\n      parts: Array<{\n        text: string;\n      }>;\n    };\n  }>;\n}\n\n/**\n * Internal rate limiting information for immediate checks\n * Used for pre-request validation and user feedback\n */\ninterface InternalRateLimitInfo {\n  isRateLimited: boolean;\n  retryAfter?: number;\n  message?: string;\n}\n\n// Rate limiting tracking\nlet lastRequestTime = 0;\nlet requestCount = 0;\nconst RATE_LIMIT_WINDOW = 60000; // 1 minute in milliseconds\nconst MAX_REQUESTS_PER_MINUTE = 15;\nconst MIN_REQUEST_INTERVAL = 4000; // 4 seconds between requests to be safe\n\n/**\n * Check if we're approaching or at rate limits\n * Validates against both per-minute limits and minimum request intervals\n *\n * @returns Object containing rate limit status and wait time information\n */\nfunction checkRateLimit(): InternalRateLimitInfo {\n  const now = Date.now();\n\n  // Reset counter if window has passed\n  if (now - lastRequestTime > RATE_LIMIT_WINDOW) {\n    requestCount = 0;\n  }\n\n  // Check if we're at the limit\n  if (requestCount >= MAX_REQUESTS_PER_MINUTE) {\n    const timeUntilReset = RATE_LIMIT_WINDOW - (now - lastRequestTime);\n    return {\n      isRateLimited: true,\n      retryAfter: Math.ceil(timeUntilReset / 1000),\n      message: `Rate limit reached (${MAX_REQUESTS_PER_MINUTE}/minute). Please wait ${Math.ceil(\n        timeUntilReset / 1000\n      )} seconds.`,\n    };\n  }\n\n  // Check if we need to wait between requests\n  const timeSinceLastRequest = now - lastRequestTime;\n  if (timeSinceLastRequest < MIN_REQUEST_INTERVAL && requestCount > 0) {\n    const waitTime = MIN_REQUEST_INTERVAL - timeSinceLastRequest;\n    return {\n      isRateLimited: true,\n      retryAfter: Math.ceil(waitTime / 1000),\n      message: `Please wait ${Math.ceil(\n        waitTime / 1000\n      )} seconds between requests to avoid rate limits.`,\n    };\n  }\n\n  return { isRateLimited: false };\n}\n\n/**\n * Wait for the specified number of seconds\n *\n * @param seconds - Number of seconds to wait\n * @returns Promise that resolves after the specified time\n */\nfunction wait(seconds: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, seconds * 1000));\n}\n\n/**\n * Generate a question using Google Gemini API with enhanced prompts and variability\n *\n * Main function for generating AI-powered questions with comprehensive features:\n * - Rate limiting with real-time countdown feedback\n * - Session-based duplicate prevention\n * - Enhanced prompts with fact-checking\n * - Geographic accuracy corrections\n * - Multilingual support\n *\n * @param params - Question generation parameters including difficulty, language, category, and session history\n * @param onStatusUpdate - Optional callback for real-time status updates during generation\n * @returns Promise resolving to a complete FinalQuestion object\n * @throws Error if API key missing, network unavailable, or generation fails\n */\nexport const generateQuestionWithGemini = async (\n  params: GeminiQuestionParams = {} as GeminiQuestionParams,\n  onStatusUpdate?: (message: string, isWaiting: boolean) => void\n): Promise<FinalQuestion> => {\n  try {\n    // Check rate limiting first\n    const rateLimitCheck = checkRateLimit();\n    if (rateLimitCheck.isRateLimited) {\n      const waitTime = rateLimitCheck.retryAfter || 4;\n\n      if (onStatusUpdate) {\n        onStatusUpdate(\n          `Please wait ${waitTime} seconds before generating another question...`,\n          true\n        );\n\n        // Show countdown during wait\n        for (let i = waitTime; i > 0; i--) {\n          onStatusUpdate(\n            `Please wait ${i} second${\n              i > 1 ? \"s\" : \"\"\n            } before generating another question...`,\n            true\n          );\n          await wait(1);\n        }\n      } else {\n        await wait(waitTime);\n      }\n\n      if (onStatusUpdate) {\n        onStatusUpdate(\"Generating your question...\", false);\n      }\n    }\n\n    // Check API key\n    const apiKey = import.meta.env.VITE_GEMINI_API_KEY;\n    if (!apiKey) {\n      console.error(\" No API key found\");\n      throw new Error(\n        \"AI service is temporarily unavailable. Please try again later.\"\n      );\n    }\n\n    // Check online status\n    if (!navigator.onLine) {\n      throw new Error(\"Internet connection required\");\n    }\n\n    // Update request tracking\n    requestCount++;\n    lastRequestTime = Date.now();\n\n    if (onStatusUpdate) {\n      onStatusUpdate(\"Generating your question...\", false);\n    }\n\n    // Create enhanced prompt with previous questions and better instructions\n    const prompt = createEnhancedGeminiPrompt(\n      params.difficulty || \"medium\",\n      params.language || \"English\",\n      params.category || \"random\",\n      params.previousQuestions || []\n    );\n\n    const requestBody = {\n      contents: [\n        {\n          parts: [\n            {\n              text: prompt,\n            },\n          ],\n        },\n      ],\n      generationConfig: {\n        temperature: 0.9, // Higher temperature for more variability\n        topK: 40,\n        topP: 0.95,\n        maxOutputTokens: 1024,\n      },\n    };\n\n    const response = await fetch(\n      `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(requestBody),\n      }\n    );\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n\n      // Handle rate limiting from Google's side\n      if (response.status === 429) {\n        const waitTime = 4;\n\n        if (onStatusUpdate) {\n          onStatusUpdate(\n            `API rate limit reached. Waiting ${waitTime} seconds before retrying...`,\n            true\n          );\n        }\n\n        await wait(waitTime);\n\n        if (onStatusUpdate) {\n          onStatusUpdate(\"Retrying your request...\", false);\n        }\n\n        // Retry the request\n        return generateQuestionWithGemini(params, onStatusUpdate);\n      }\n\n      throw new Error(\n        `Gemini API error: ${response.status} - ${\n          errorData.error?.message || \"Unknown error\"\n        }`\n      );\n    }\n\n    const data: GeminiResponse = await response.json();\n\n    if (!data.candidates || data.candidates.length === 0) {\n      throw new Error(\"No response generated from Gemini API\");\n    }\n\n    const generatedText = data.candidates[0].content.parts[0].text;\n\n    // Parse the JSON response\n    const questionData = parseGeminiResponse(generatedText);\n\n    return {\n      id: Math.random().toString(36).substring(7),\n      question: questionData.question,\n      answer: questionData.answer,\n      category: questionData.category,\n      difficulty: questionData.difficulty as \"easy\" | \"medium\" | \"hard\",\n    };\n  } catch (error) {\n    console.error(\"Gemini API error:\", error);\n\n    if (error instanceof Error) {\n      throw error;\n    }\n\n    throw new Error(\"Failed to generate question. Please try again.\");\n  }\n};\n\n/**\n * Create an enhanced prompt for Gemini API with better instructions and previous questions context\n */\n/**\n * Creates an enhanced prompt for Gemini AI with context and fact-checking\n *\n * Builds comprehensive prompts that include:\n * - User preferences for difficulty, language, and category\n * - Session history to prevent duplicate questions\n * - Category-specific fact-checking instructions\n * - Geographic accuracy requirements (especially for Bulgarian content)\n *\n * @param difficulty - Desired difficulty level\n * @param language - Target language for the question\n * @param category - Preferred category or topic\n * @param previousQuestions - Array of previously generated questions to avoid duplicates\n * @returns Complete prompt string for AI generation\n */\nfunction createEnhancedGeminiPrompt(\n  difficulty: string,\n  language: string,\n  category: string,\n  previousQuestions: SessionQuestion[]\n): string {\n  const languageInstruction =\n    language.toLowerCase() === \"bulgarian\"\n      ? \"Generate the question and answer in Bulgarian language.\"\n      : \"Generate the question and answer in English language.\";\n\n  const categoryInstruction =\n    category.toLowerCase() === \"random\" || !category\n      ? \"Choose a random general knowledge topic.\"\n      : `Generate a question about the category: ${category}`;\n\n  const difficultyInstruction = getEnhancedDifficultyInstruction(difficulty);\n\n  // Add previous questions context to avoid duplicates\n  let previousQuestionsContext = \"\";\n  if (previousQuestions.length > 0) {\n    const recentQuestions = previousQuestions.slice(-10); // Last 10 questions\n    previousQuestionsContext = `\\n\\nIMPORTANT: Do NOT repeat any of these recently asked questions. Generate something completely different:\\n${recentQuestions\n      .map((q, i) => `${i + 1}. ${q.question}`)\n      .join(\"\\n\")}`;\n  }\n\n  // Enhanced fact-checking instructions\n  const factCheckingInstruction = getFactCheckingInstruction(category);\n\n  return `You are an expert quiz master with access to accurate, up-to-date information. Generate a single quiz question and its answer.\n\n${languageInstruction}\n${categoryInstruction}\n${difficultyInstruction}\n${factCheckingInstruction}\n${previousQuestionsContext}\n\nCRITICAL REQUIREMENTS:\n- The answer must be 100% factually correct and verifiable\n- For geographic questions, double-check all facts (heights, locations, names)\n- Avoid controversial or ambiguous topics\n- Make the question engaging and educational\n- Ensure the question is unique and not repetitive\n\nIMPORTANT: Respond ONLY with a valid JSON object in this exact format:\n{\n  \"question\": \"Your generated question here\",\n  \"answer\": \"The correct answer here\", \n  \"category\": \"The category of the question\",\n  \"difficulty\": \"${difficulty}\"\n}\n\nDo not include any other text, explanations, or formatting outside the JSON object.`;\n}\n\n/**\n * Get enhanced difficulty-specific instructions with more variation\n *\n * Provides detailed instructions to the AI about question complexity,\n * knowledge requirements, and reasoning depth for each difficulty level.\n *\n * @param difficulty - Target difficulty level (easy, medium, hard, or random)\n * @returns Detailed difficulty instruction for AI prompt\n */\nfunction getEnhancedDifficultyInstruction(difficulty: string): string {\n  switch (difficulty.toLowerCase()) {\n    case \"easy\":\n      return \"Make this an EASY question that most people would know. Use basic, well-known facts that are commonly taught in school or widely known in popular culture.\";\n    case \"hard\":\n      return \"Make this a HARD question that requires specialized knowledge, advanced education, or deep expertise in a specific field. Use complex concepts, technical details, or obscure historical facts.\";\n    case \"medium\":\n    default:\n      return \"Make this a MEDIUM difficulty question that requires some general knowledge and thinking. It should be challenging but not impossible for an educated person to answer.\";\n  }\n}\n\n/**\n * Get fact-checking instructions based on category\n *\n * Provides category-specific fact-checking instructions to ensure accuracy.\n * Includes special handling for Bulgarian geography to correct common AI errors.\n *\n * @param category - Question category to generate fact-checking instructions for\n * @returns Category-specific fact-checking instruction text\n */\nfunction getFactCheckingInstruction(category: string): string {\n  const lowerCategory = category.toLowerCase();\n\n  if (\n    lowerCategory.includes(\"geography\") ||\n    lowerCategory.includes(\"\") ||\n    lowerCategory.includes(\"bulgaria\") ||\n    lowerCategory.includes(\"mountain\") ||\n    lowerCategory.includes(\"peak\")\n  ) {\n    return `\\nFACT-CHECKING FOR GEOGRAPHY: \n- For Bulgarian geography: Verify all mountain peaks, heights, and locations\n- For Smolyan region: The highest peak near Smolyan is Perelik (2,191m), NOT Snezhanka\n- Snezhanka is near Pamporovo but is NOT the highest peak in the Smolyan area\n- Always verify geographical facts against reliable sources\n- Double-check all numerical data (heights, distances, populations)`;\n  }\n\n  if (lowerCategory.includes(\"history\")) {\n    return `\\nFACT-CHECKING FOR HISTORY: \n- Verify all dates, names, and historical events\n- Ensure chronological accuracy\n- Cross-reference multiple historical sources`;\n  }\n\n  if (lowerCategory.includes(\"science\")) {\n    return `\\nFACT-CHECKING FOR SCIENCE: \n- Verify all scientific facts and figures\n- Ensure formulas and laws are correct\n- Use current scientific understanding`;\n  }\n\n  return `\\nFACT-CHECKING: \n- Verify all facts before including them\n- Use reliable, authoritative sources\n- Avoid outdated or disputed information`;\n}\n\n/**\n * Parse Gemini response and extract question data\n *\n * Safely parses JSON response from Gemini AI and extracts question data.\n * Includes robust error handling and fallback mechanisms.\n *\n * @param text - Raw text response from Gemini API\n * @returns Parsed question data with fallback for parsing errors\n */\nfunction parseGeminiResponse(text: string): {\n  question: string;\n  answer: string;\n  category: string;\n  difficulty: string;\n} {\n  try {\n    // Clean the response text\n    const cleanedText = text.trim();\n\n    // Try to find JSON in the response\n    const jsonMatch = cleanedText.match(/\\{[\\s\\S]*\\}/);\n    if (!jsonMatch) {\n      throw new Error(\"No JSON found in response\");\n    }\n\n    const parsed = JSON.parse(jsonMatch[0]);\n\n    // Validate required fields\n    if (!parsed.question || !parsed.answer) {\n      throw new Error(\"Missing required fields in response\");\n    }\n\n    return {\n      question: parsed.question,\n      answer: parsed.answer,\n      category: parsed.category || \"General Knowledge\",\n      difficulty: parsed.difficulty || \"medium\",\n    };\n  } catch (error) {\n    console.error(\"Failed to parse Gemini response:\", text);\n\n    // Fallback: create a basic question if parsing fails\n    return {\n      question: \"What is the capital of France?\",\n      answer: \"Paris\",\n      category: \"Geography\",\n      difficulty: \"easy\",\n    };\n  }\n}\n\n/**\n * Check if the Gemini API is available\n *\n * Validates both API key availability and network connectivity.\n * Provides safe logging that doesn't expose API keys in production.\n *\n * @returns True if API key exists and device is online\n */\nexport const isGeminiAvailable = (): boolean => {\n  const apiKey = import.meta.env.VITE_GEMINI_API_KEY;\n  const isOnline = navigator.onLine;\n\n  // Only log once per session in development to avoid console spam\n  if (import.meta.env.DEV && !(window as any).__GEMINI_LOGGED) {\n    console.log(\" Gemini API Check:\", {\n      hasApiKey: !!apiKey,\n      apiKeyLength: apiKey?.length || 0,\n      isOnline,\n      apiKeyPreview: apiKey ? `${apiKey.substring(0, 10)}...` : \"NOT_SET\",\n    });\n    (window as any).__GEMINI_LOGGED = true;\n  }\n\n  return !!(apiKey && isOnline);\n};\n\n/**\n * Get current rate limit status for UI display\n *\n * Provides real-time information about API usage for user interface.\n * Calculates remaining requests, reset time, and warning thresholds.\n *\n * @returns Object with current rate limiting status and timing information\n */\nexport const getRateLimitStatus = (): {\n  requestsRemaining: number;\n  timeUntilReset: number;\n  isNearLimit: boolean;\n} => {\n  const now = Date.now();\n\n  // Reset counter if window has passed\n  if (now - lastRequestTime > RATE_LIMIT_WINDOW) {\n    requestCount = 0;\n  }\n\n  const requestsRemaining = Math.max(0, MAX_REQUESTS_PER_MINUTE - requestCount);\n  const timeUntilReset = Math.max(\n    0,\n    RATE_LIMIT_WINDOW - (now - lastRequestTime)\n  );\n  const isNearLimit = requestsRemaining <= 3;\n\n  return {\n    requestsRemaining,\n    timeUntilReset: Math.ceil(timeUntilReset / 1000),\n    isNearLimit,\n  };\n};\n","/**\n * AI Question Generation Service for Quizzes\n *\n * Service for generating quiz questions using Google Gemini AI.\n * Builds upon the Final Question AI service to create multiple-choice\n * questions specifically for quiz creation workflow.\n *\n * Features:\n * - Multiple choice question generation (2-6 options)\n * - Text-based questions only (no media)\n * - Category and difficulty support\n * - Session-based duplicate prevention\n * - Rate limiting and error handling\n *\n * @fileoverview AI question generation service for quiz creation\n * @version 1.0.0\n * @since December 2025\n */\n\nimport {\n  generateQuestionWithGemini,\n  isGeminiAvailable,\n  getRateLimitStatus,\n} from \"../../final-question/services/geminiService\";\nimport type { QuizQuestion, QuizCategory, QuizDifficulty } from \"../types\";\nimport type {\n  GeminiQuestionParams,\n  SessionQuestion,\n} from \"../../final-question/types\";\n\n/**\n * Parameters for AI quiz question generation\n */\nexport interface AIQuestionParams {\n  /** Type of question to generate */\n  questionType?: \"text-answer\" | \"text\";\n  /** Preferred question category */\n  category?: QuizCategory | string;\n  /** Difficulty level for the question */\n  difficulty?: QuizDifficulty;\n  /** Language for the question (defaults to English) */\n  language?: string;\n  /** Number of multiple choice options (2-6, only for \"text\" type) */\n  optionsCount?: number;\n  /** Previously generated questions to avoid duplicates */\n  previousQuestions?: QuizQuestion[];\n  /** Additional context or topic specification */\n  topicHint?: string;\n}\n\n/**\n * Result of AI question generation\n */\nexport interface AIQuestionResult {\n  /** Generated quiz question */\n  question: QuizQuestion;\n  /** Whether the generation was successful */\n  success: boolean;\n  /** Error message if generation failed */\n  error?: string;\n}\n\n/**\n * Status callback for real-time updates during generation\n */\nexport type AIGenerationStatusCallback = (\n  message: string,\n  isWaiting: boolean\n) => void;\n\n/**\n * Generate a quiz question using AI\n *\n * Creates either a text-answer or multiple-choice quiz question using the Gemini AI service.\n * For text-answer questions, returns the question with a single correct answer.\n * For multiple-choice questions, generates additional distractor options.\n *\n * @param params - Generation parameters including type, category, difficulty, and options\n * @param onStatusUpdate - Optional callback for real-time status updates\n * @returns Promise resolving to generated quiz question or error\n */\nexport const generateAIQuizQuestion = async (\n  params: AIQuestionParams = {},\n  onStatusUpdate?: AIGenerationStatusCallback\n): Promise<AIQuestionResult> => {\n  try {\n    // Check if AI service is available\n    if (!isGeminiAvailable()) {\n      return {\n        question: createEmptyQuestion(),\n        success: false,\n        error:\n          \"AI service is not available. Please check your connection and try again.\",\n      };\n    }\n\n    // Prepare parameters for Gemini service\n    const geminiParams: GeminiQuestionParams = {\n      difficulty: params.difficulty || \"medium\",\n      language: params.language || \"English\",\n      category:\n        params.topicHint ||\n        mapQuizCategoryToGemini(params.category || \"general\"),\n      previousQuestions: convertQuizQuestionsToSession(\n        params.previousQuestions || []\n      ),\n    };\n\n    // Generate question using Final Question service\n    const finalQuestion = await generateQuestionWithGemini(\n      geminiParams,\n      onStatusUpdate\n    );\n\n    // Determine question type (default to text-answer if not specified)\n    const questionType = params.questionType || \"text-answer\";\n\n    // Convert to appropriate quiz question format\n    const quizQuestion = await convertToQuizQuestion(\n      finalQuestion,\n      questionType,\n      params.optionsCount || 4,\n      params.difficulty || \"medium\"\n    );\n\n    return {\n      question: quizQuestion,\n      success: true,\n    };\n  } catch (error) {\n    const errorMessage =\n      error instanceof Error ? error.message : \"Failed to generate question\";\n\n    return {\n      question: createEmptyQuestion(),\n      success: false,\n      error: errorMessage,\n    };\n  }\n};\n\n/**\n * Convert Final Question to Quiz Question format\n *\n * Takes a generated final question and creates either a single-answer question\n * or a multiple-choice question with distractor options, based on the specified type.\n * Now generates questions in the correct standard format used by the quiz system.\n *\n * @param finalQuestion - The generated final question\n * @param questionType - Type of question to create (\"text-answer\" or \"text\")\n * @param optionsCount - Number of multiple choice options to create (ignored for text-answer)\n * @param difficulty - Difficulty level for option generation\n * @returns Promise resolving to formatted quiz question\n */\nasync function convertToQuizQuestion(\n  finalQuestion: any,\n  questionType: \"text-answer\" | \"text\",\n  optionsCount: number,\n  difficulty: QuizDifficulty\n): Promise<QuizQuestion> {\n  const now = new Date();\n  const baseQuestion = {\n    id: generateQuestionId(),\n    question: finalQuestion.question,\n    difficulty: difficulty,\n    points: calculatePointsForDifficulty(difficulty),\n    timeLimit: 60, // Default to 60 seconds for all AI-generated questions\n    createdAt: now,\n    updatedAt: now,\n  };\n\n  if (questionType === \"text-answer\") {\n    // Create single-answer question using standard format\n    return {\n      ...baseQuestion,\n      type: \"single-answer\",           // Use correct type name\n      possibleAnswers: [],             // Empty for single-answer questions\n      correctAnswers: [],              // Empty for single-answer questions\n      correctAnswerText: finalQuestion.answer,  // Use correct field name\n      explanation: finalQuestion.answer,        // Simple explanation\n    };\n  } else {\n    // Create multiple-choice question using standard format\n    // Generate distractor options using AI\n    const distractors = await generateDistractorOptions(\n      finalQuestion.question,\n      finalQuestion.answer,\n      optionsCount - 1,\n      difficulty\n    );\n\n    // Create all options with correct answer\n    const allOptions = [finalQuestion.answer, ...distractors];\n\n    // Shuffle options and track correct answer position\n    const shuffledOptions = shuffleArray([...allOptions]);\n    const correctAnswerIndex = shuffledOptions.indexOf(finalQuestion.answer);\n\n    // Create multiple-choice quiz question object using standard format\n    return {\n      ...baseQuestion,\n      type: \"multiple-choice\",         // Use correct type name\n      possibleAnswers: shuffledOptions,       // Use correct field name\n      correctAnswers: [correctAnswerIndex],   // Use correct field name (array format)\n      correctAnswerText: \"\",          // Empty for multiple-choice questions\n      explanation: finalQuestion.answer,     // Simple explanation\n    };\n  }\n}\n\n/**\n * Generate distractor options for multiple choice\n *\n * Creates plausible but incorrect options for the multiple choice question.\n * Uses AI to generate contextually appropriate distractors.\n *\n * @param question - The main question text\n * @param correctAnswer - The correct answer\n * @param count - Number of distractors to generate\n * @param difficulty - Difficulty level for distractor complexity\n * @returns Promise resolving to array of distractor options\n */\nasync function generateDistractorOptions(\n  question: string,\n  correctAnswer: string,\n  count: number,\n  difficulty: QuizDifficulty\n): Promise<string[]> {\n  try {\n    // Create prompt for generating distractors\n    const prompt = createDistractorPrompt(\n      question,\n      correctAnswer,\n      count,\n      difficulty\n    );\n\n    // Use Gemini to generate distractors\n    const apiKey = import.meta.env.VITE_GEMINI_API_KEY;\n    if (!apiKey) {\n      return generateFallbackDistractors(correctAnswer, count);\n    }\n\n    const response = await fetch(\n      `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          contents: [{ parts: [{ text: prompt }] }],\n          generationConfig: {\n            temperature: 0.8,\n            topK: 40,\n            topP: 0.9,\n          },\n        }),\n      }\n    );\n\n    if (!response.ok) {\n      return generateFallbackDistractors(correctAnswer, count);\n    }\n\n    const data = await response.json();\n    const text = data.candidates?.[0]?.content?.parts?.[0]?.text || \"\";\n\n    // Parse distractors from response\n    const distractors = parseDistractorsFromResponse(text, count);\n\n    // Ensure we have enough distractors\n    if (distractors.length < count) {\n      const fallbackDistractors = generateFallbackDistractors(\n        correctAnswer,\n        count - distractors.length\n      );\n      return [...distractors, ...fallbackDistractors];\n    }\n\n    return distractors.slice(0, count);\n  } catch (error) {\n    console.warn(\"Failed to generate AI distractors, using fallback:\", error);\n    return generateFallbackDistractors(correctAnswer, count);\n  }\n}\n\n/**\n * Create prompt for distractor generation\n */\nfunction createDistractorPrompt(\n  question: string,\n  correctAnswer: string,\n  count: number,\n  difficulty: QuizDifficulty\n): string {\n  const difficultyInstruction = {\n    easy: \"Make the wrong answers obviously incorrect but still plausible.\",\n    medium:\n      \"Make the wrong answers plausible but clearly distinguishable from the correct answer.\",\n    hard: \"Make the wrong answers very plausible and similar to the correct answer.\",\n  }[difficulty];\n\n  return `Generate ${count} incorrect but plausible answers for this multiple choice question.\n\nQuestion: ${question}\nCorrect Answer: ${correctAnswer}\n\nRequirements:\n- ${difficultyInstruction}\n- Each wrong answer should be on a separate line\n- Make them the same format/length as the correct answer\n- Don't number them or add extra text\n- Make them factually wrong but believable\n- Avoid obviously ridiculous answers\n\nWrong answers:`;\n}\n\n/**\n * Parse distractors from AI response\n */\nfunction parseDistractorsFromResponse(\n  response: string,\n  expectedCount: number\n): string[] {\n  const lines = response\n    .split(\"\\n\")\n    .map((line) => line.trim())\n    .filter((line) => line.length > 0)\n    .filter((line) => !line.match(/^[0-9]+\\.?\\s/)); // Remove numbered items\n\n  return lines.slice(0, expectedCount);\n}\n\n/**\n * Generate fallback distractors when AI fails\n */\nfunction generateFallbackDistractors(\n  correctAnswer: string,\n  count: number\n): string[] {\n  const distractors: string[] = [];\n\n  // Generate simple fallback distractors\n  for (let i = 0; i < count; i++) {\n    if (correctAnswer.match(/^\\d+$/)) {\n      // Numeric answer - generate nearby numbers\n      const num = parseInt(correctAnswer);\n      distractors.push(String(num + (i + 1) * 10));\n    } else if (correctAnswer.match(/^[A-Z]/)) {\n      // Starts with capital - might be a name or place\n      distractors.push(`Alternative ${String.fromCharCode(65 + i)}`);\n    } else {\n      // Generic fallback\n      distractors.push(`Option ${String.fromCharCode(65 + i)}`);\n    }\n  }\n\n  return distractors;\n}\n\n/**\n * Utility functions\n */\n\nfunction createEmptyQuestion(): QuizQuestion {\n  const now = new Date();\n  return {\n    id: generateQuestionId(),\n    type: \"text\",\n    question: \"\",\n    options: [\"\", \"\", \"\", \"\"],\n    correctAnswer: 0,\n    difficulty: \"medium\",\n    points: 1, // Default to 1 point\n    timeLimit: 60, // Default to 60 seconds\n    createdAt: now,\n    updatedAt: now,\n  };\n}\n\nfunction generateQuestionId(): string {\n  return `q_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\nfunction mapQuizCategoryToGemini(category: QuizCategory | string): string {\n  const mapping: Record<string, string> = {\n    general: \"General Knowledge\",\n    sports: \"Sports\",\n    history: \"History\",\n    science: \"Science\",\n    geography: \"Geography\",\n    entertainment: \"Entertainment\",\n    literature: \"Literature\",\n    art: \"Art\",\n    music: \"Music\",\n    technology: \"Technology\",\n    custom: \"General Knowledge\",\n  };\n\n  return mapping[category] || \"General Knowledge\";\n}\n\nfunction convertQuizQuestionsToSession(\n  questions: QuizQuestion[]\n): SessionQuestion[] {\n  return questions.map((q) => ({\n    question: q.question,\n    answer: q.options[q.correctAnswer] || \"\",\n  }));\n}\n\nfunction shuffleArray<T>(array: T[]): T[] {\n  const shuffled = [...array];\n  for (let i = shuffled.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\n  }\n  return shuffled;\n}\n\nfunction calculatePointsForDifficulty(_difficulty: QuizDifficulty): number {\n  // Default to 1 point for all questions regardless of difficulty\n  // User can change this value manually if needed\n  return 1;\n}\n\n/**\n * Check if AI question generation is available\n */\nexport const isAIQuestionGenerationAvailable = (): boolean => {\n  return isGeminiAvailable();\n};\n\n/**\n * Get current rate limit status for AI generation\n */\nexport const getAIQuestionRateLimit = () => {\n  return getRateLimitStatus();\n};\n","/**\n * Questions Step Component (ENHANCED)\n *\n * Manages rounds and questions within the quiz creation workflow.\n * Updated to support round-based question organization with AI generation.\n *\n * Features:\n * - Round management with different types (mixed, single-answer-only, multiple-choice, etc.)\n * - Question creation, editing, and deletion\n * - AI question generation with category and difficulty selection\n * - Round navigation and question organization\n * - Mobile-responsive design with proper spacing\n *\n * @fileoverview Quiz rounds and questions management step\n * @version 2.2.0 (AI Generation Enhanced)\n * @since December 2025\n */\n\nimport React from \"react\";\nimport {\n  Box,\n  Typography,\n  Button,\n  TextField,\n  IconButton,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n  Alert,\n  CircularProgress,\n  Stack,\n  DialogContentText,\n} from \"@mui/material\";\nimport {\n  Delete as DeleteIcon,\n  Close as CloseIcon,\n  Psychology as BrainIcon,\n  ShortText as ShortTextIcon,\n  FormatListBulleted as FormatListBulletedIcon,\n  InfoOutlined as InfoOutlinedIcon,\n} from \"@mui/icons-material\";\nimport { useQuestionsStepState } from \"./hooks/useQuestionsStepState\";\nimport {\n  RoundNavigation,\n  QuestionActionsBar,\n  QuestionsList,\n  QuestionEditor,\n} from \"./components\";\nimport {\n  isAIQuestionGenerationAvailable,\n  getAIQuestionRateLimit,\n  generateAIQuizQuestion,\n} from \"../../services/aiQuestionService\";\nimport { ROUND_TYPE_CONFIG } from \"../../types\";\nimport type {\n  Quiz,\n  Round,\n  QuizQuestion,\n  RoundType,\n  AnswerRevealMode,\n  QuizDifficulty,\n  QuestionType,\n} from \"../../types\";\nimport { RoundInfoModal } from \"../components/RoundInfo/RoundInfoModal\";\nimport { roundInfoContent } from \"../components/RoundInfo/roundInfoContent\";\n\ninterface RoundsQuestionsStepProps {\n  draftQuiz: Partial<Quiz>;\n  updateDraft: (updates: Partial<Quiz>) => void;\n  showValidation: boolean;\n}\n\nexport const RoundsQuestionsStep: React.FC<RoundsQuestionsStepProps> = ({\n  draftQuiz,\n  updateDraft,\n  showValidation,\n}) => {\n  // Use refactored state management hook\n  const { state, actions, derived } = useQuestionsStepState(draftQuiz);\n  const { rounds, currentRound, isRoundFormValid } = derived;\n\n  // Updated round types for new system\n  const ROUND_TYPES: { value: RoundType; label: string }[] = [\n    { value: \"mixed\", label: \"Mixed Types\" },\n    { value: \"single-answer\", label: \"Single Answer Only\" },\n    { value: \"multiple-choice\", label: \"Multiple Choice\" },\n    { value: \"picture\", label: \"Picture Round\" },\n    { value: \"audio\", label: \"Audio Round\" },\n    { value: \"video\", label: \"Video Round\" },\n    { value: \"golden-pyramid\", label: \"Golden Pyramid\" },\n  ];\n  const REVEAL_MODES: { value: AnswerRevealMode; label: string }[] = [\n    { value: \"after-each\", label: \"After Each Question\" },\n    { value: \"after-all\", label: \"After All Questions\" },\n  ];\n\n  // Add state for info modal\n  const [infoModalOpen, setInfoModalOpen] = React.useState(false);\n  const [infoModalRoundType, setInfoModalRoundType] = React.useState<\n    keyof typeof roundInfoContent | null\n  >(null);\n\n  const handleRoundSave = () => {\n    if (!isRoundFormValid) return;\n    const roundIndex =\n      state.roundModalMode === \"add\" ? rounds.length : state.currentRoundIdx;\n    const round = {\n      id:\n        state.editingRound?.id ||\n        `round_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      name: `Round ${roundIndex + 1}`,\n      description: state.roundForm.description,\n      type: state.roundForm.type as RoundType,\n      answerRevealMode: state.roundForm.answerRevealMode as AnswerRevealMode,\n      defaultTimePerQuestion: Number(state.roundForm.defaultTimePerQuestion),\n      breakingTime: Number(state.roundForm.breakingTime),\n      level: (draftQuiz.difficulty as QuizDifficulty) || \"medium\", // Inherit from quiz level\n      questions: state.editingRound?.questions || [],\n      createdAt: state.editingRound?.createdAt || new Date(),\n      updatedAt: new Date(),\n    };\n\n    // Golden Pyramid special logic: Auto-populate 4 questions\n    if (\n      state.roundForm.type === \"golden-pyramid\" &&\n      round.questions.length === 0\n    ) {\n      const goldenPyramidQuestions = Array.from({ length: 4 }, (_, index) => ({\n        id: `question_${Date.now()}_${index}_${Math.random()\n          .toString(36)\n          .substr(2, 9)}`,\n        type: \"multiple-choice\" as QuestionType,\n        question: \"\",\n        possibleAnswers: Array.from({ length: index + 1 }, () => \"\"), // 1,2,3,4 answer fields (empty)\n        correctAnswers: Array.from({ length: index + 1 }, (_, i) => i), // All answers are correct for Golden Pyramid\n        correctAnswerText: \"\",\n        explanation: \"\",\n        mediaFile: undefined,\n        difficulty: (draftQuiz.difficulty as QuizDifficulty) || \"medium\", // Inherit from quiz level\n        points: 1,\n        timeLimit: Number(state.roundForm.defaultTimePerQuestion),\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      }));\n      round.questions = goldenPyramidQuestions;\n    }\n\n    handleSaveRound(round);\n  };\n\n  /**\n   * Render AI generation dialog\n   */\n  const renderAIDialog = React.useCallback(\n    () => (\n      <Dialog\n        open={state.aiDialogOpen}\n        onClose={actions.closeAIDialog}\n        maxWidth=\"sm\"\n        fullWidth\n      >\n        <DialogTitle>\n          <Box display=\"flex\" alignItems=\"center\" gap={1}>\n            <BrainIcon color=\"primary\" />\n            Generate AI Question\n          </Box>\n        </DialogTitle>\n        <DialogContent>\n          <Stack spacing={3} sx={{ mt: 1 }}>\n            {/* AI Status */}\n            {(state.aiGenerating || state.aiStatus) && (\n              <Alert\n                severity=\"info\"\n                icon={\n                  state.aiGenerating ? (\n                    <CircularProgress size={20} />\n                  ) : undefined\n                }\n              >\n                {state.aiStatus || \"Generating question...\"}\n              </Alert>\n            )}\n\n            {/* Error */}\n            {state.aiError && !state.aiErrorDismissed && (\n              <Alert\n                severity=\"error\"\n                action={\n                  <IconButton\n                    size=\"small\"\n                    onClick={() => actions.setAiErrorDismissed(true)}\n                    aria-label=\"Dismiss error\"\n                  >\n                    <CloseIcon fontSize=\"small\" />\n                  </IconButton>\n                }\n              >\n                {state.aiError}\n              </Alert>\n            )}\n\n            {/* Question Type - Only show for Mixed rounds */}\n            {currentRound?.type === \"mixed\" && (\n              <FormControl fullWidth>\n                <InputLabel>Question Type</InputLabel>\n                <Select\n                  value={state.aiSettings.questionType || \"text-answer\"}\n                  onChange={(e) =>\n                    actions.setAiSettings({\n                      ...state.aiSettings,\n                      questionType: e.target.value as \"text-answer\" | \"text\",\n                    })\n                  }\n                  label=\"Question Type\"\n                >\n                  <MenuItem value=\"text-answer\">\n                    <Box sx={{ display: \"flex\", alignItems: \"center\", gap: 1 }}>\n                      <ShortTextIcon fontSize=\"small\" />\n                      Single Answer\n                    </Box>\n                  </MenuItem>\n                  <MenuItem value=\"text\">\n                    <Box sx={{ display: \"flex\", alignItems: \"center\", gap: 1 }}>\n                      <FormatListBulletedIcon fontSize=\"small\" />\n                      Multiple Choice\n                    </Box>\n                  </MenuItem>\n                </Select>\n              </FormControl>\n            )}\n\n            {/* Language Selection */}\n            <FormControl fullWidth>\n              <InputLabel>Language</InputLabel>\n              <Select\n                value={state.aiSettings.language || \"English\"}\n                onChange={(e) =>\n                  actions.setAiSettings({\n                    ...state.aiSettings,\n                    language: e.target.value,\n                  })\n                }\n                label=\"Language\"\n              >\n                <MenuItem value=\"English\">English</MenuItem>\n                <MenuItem value=\"Bulgarian\">Bulgarian</MenuItem>\n              </Select>\n            </FormControl>\n\n            {/* Topic Input */}\n            <TextField\n              fullWidth\n              label=\"Topic (optional)\"\n              placeholder=\"e.g., Ancient Rome, Quantum Physics, Football...\"\n              value={state.aiSettings.topicHint || \"\"}\n              onChange={(e) =>\n                actions.setAiSettings({\n                  ...state.aiSettings,\n                  topicHint: e.target.value,\n                })\n              }\n              helperText=\"Leave empty for random topic\"\n            />\n\n            {/* Category */}\n            <FormControl fullWidth>\n              <InputLabel>Category</InputLabel>\n              <Select\n                value={state.aiSettings.category || \"general\"}\n                onChange={(e) =>\n                  actions.setAiSettings({\n                    ...state.aiSettings,\n                    category: e.target.value as QuizCategory,\n                  })\n                }\n                label=\"Category\"\n              >\n                <MenuItem value=\"general\">General Knowledge</MenuItem>\n                <MenuItem value=\"science\">Science</MenuItem>\n                <MenuItem value=\"history\">History</MenuItem>\n                <MenuItem value=\"geography\">Geography</MenuItem>\n                <MenuItem value=\"sports\">Sports</MenuItem>\n                <MenuItem value=\"entertainment\">Entertainment</MenuItem>\n                <MenuItem value=\"literature\">Literature</MenuItem>\n                <MenuItem value=\"art\">Art</MenuItem>\n                <MenuItem value=\"music\">Music</MenuItem>\n                <MenuItem value=\"technology\">Technology</MenuItem>\n              </Select>\n            </FormControl>\n\n            {/* Difficulty */}\n            <FormControl fullWidth>\n              <InputLabel>Difficulty</InputLabel>\n              <Select\n                value={state.aiSettings.difficulty || \"medium\"}\n                onChange={(e) =>\n                  actions.setAiSettings({\n                    ...state.aiSettings,\n                    difficulty: e.target.value as QuizDifficulty,\n                  })\n                }\n                label=\"Difficulty\"\n              >\n                <MenuItem value=\"easy\">Easy</MenuItem>\n                <MenuItem value=\"medium\">Medium</MenuItem>\n                <MenuItem value=\"hard\">Hard</MenuItem>\n              </Select>\n            </FormControl>\n\n            {/* Options Count - Only show for multiple choice */}\n            {(state.aiSettings.questionType === \"text\" ||\n              (currentRound?.type === \"multiple-choice\" &&\n                currentRound.type !== \"mixed\")) && (\n              <FormControl fullWidth>\n                <InputLabel>Number of Options</InputLabel>\n                <Select\n                  value={state.aiSettings.optionsCount || 4}\n                  onChange={(e) =>\n                    actions.setAiSettings({\n                      ...state.aiSettings,\n                      optionsCount: Number(e.target.value),\n                    })\n                  }\n                  label=\"Number of Options\"\n                >\n                  <MenuItem value={2}>2 Options</MenuItem>\n                  <MenuItem value={3}>3 Options</MenuItem>\n                  <MenuItem value={4}>4 Options</MenuItem>\n                  <MenuItem value={5}>5 Options</MenuItem>\n                  <MenuItem value={6}>6 Options</MenuItem>\n                </Select>\n              </FormControl>\n            )}\n\n            {/* Rate limit info */}\n            {isAIQuestionGenerationAvailable() && (\n              <Box sx={{ p: 2, bgcolor: \"background.paper\", borderRadius: 1 }}>\n                <Typography variant=\"body2\" color=\"text.secondary\">\n                  AI questions remaining:{\" \"}\n                  {getAIQuestionRateLimit().requestsRemaining}/15 per minute\n                </Typography>\n              </Box>\n            )}\n          </Stack>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={actions.closeAIDialog}>Cancel</Button>\n          <Button\n            onClick={async () => {\n              actions.setAiGenerating(true);\n              actions.setAiError(null);\n              actions.setAiErrorDismissed(false);\n\n              try {\n                // Determine question type based on round type\n                let questionType = state.aiSettings.questionType;\n                if (currentRound?.type === \"single-answer\") {\n                  questionType = \"text-answer\";\n                } else if (currentRound?.type === \"multiple-choice\") {\n                  questionType = \"text\";\n                }\n\n                const result = await generateAIQuizQuestion({\n                  questionType: questionType || \"text-answer\",\n                  language: state.aiSettings.language || \"English\",\n                  topicHint: state.aiSettings.topicHint,\n                  category: state.aiSettings.category || \"general\",\n                  difficulty: state.aiSettings.difficulty || \"medium\",\n                  optionsCount: state.aiSettings.optionsCount || 4,\n                });\n\n                if (result.success && result.question) {\n                  // Add the AI-generated question to the current round\n                  const newQuestion: QuizQuestion = {\n                    ...result.question,\n                    id: `q_${Date.now()}_${Math.random()\n                      .toString(36)\n                      .substr(2, 9)}`,\n                    difficulty: state.aiSettings.difficulty || \"medium\",\n                    points: 1,\n                    timeLimit: currentRound?.defaultTimePerQuestion || 1,\n                    createdAt: new Date(),\n                    updatedAt: new Date(),\n                  };\n\n                  const updatedRound: Round = {\n                    ...currentRound!,\n                    questions: [\n                      ...(currentRound?.questions || []),\n                      newQuestion,\n                    ],\n                    updatedAt: new Date(),\n                  };\n\n                  updateDraft({\n                    rounds: rounds.map((r, idx) =>\n                      idx === state.currentRoundIdx ? updatedRound : r\n                    ),\n                  });\n\n                  actions.setAiStatus(\"Question generated successfully!\");\n                  setTimeout(() => {\n                    actions.closeAIDialog();\n                    actions.setAiStatus(null);\n                  }, 1500);\n                } else {\n                  actions.setAiError(\n                    result.error || \"Failed to generate question\"\n                  );\n                }\n              } catch (error) {\n                actions.setAiError(\n                  error instanceof Error\n                    ? error.message\n                    : \"Unknown error occurred\"\n                );\n              } finally {\n                actions.setAiGenerating(false);\n              }\n            }}\n            variant=\"contained\"\n            disabled={state.aiGenerating || !isAIQuestionGenerationAvailable()}\n          >\n            {state.aiGenerating ? \"Generating...\" : \"Generate\"}\n          </Button>\n        </DialogActions>\n      </Dialog>\n    ),\n    [\n      state.aiDialogOpen,\n      state.aiGenerating,\n      state.aiStatus,\n      state.aiError,\n      state.aiErrorDismissed,\n      state.aiSettings,\n      currentRound,\n      rounds,\n      state.currentRoundIdx,\n      actions,\n      updateDraft,\n    ]\n  );\n\n  // Handler to open manual question modal\n  const openManualDialog = () => {\n    if (!currentRound) return;\n\n    // Get round type configuration\n    const roundConfig = ROUND_TYPE_CONFIG[currentRound.type];\n\n    // Determine default question type based on round type\n    let defaultQuestionType: QuestionType;\n    if (currentRound.type === \"picture\") {\n      defaultQuestionType = \"picture\"; // Picture rounds use picture question type\n    } else if (currentRound.type === \"audio\") {\n      defaultQuestionType = \"audio\"; // Audio rounds use audio question type\n    } else if (currentRound.type === \"video\") {\n      defaultQuestionType = \"video\"; // Video rounds use video question type\n    } else if (currentRound.type === \"golden-pyramid\") {\n      defaultQuestionType = \"single-answer\"; // Golden Pyramid uses single-answer with comma-separated text\n    } else if (roundConfig.canSelectQuestionType) {\n      defaultQuestionType = \"single-answer\"; // Mixed rounds default to single-answer\n    } else {\n      defaultQuestionType = roundConfig.allowedQuestionTypes[0]; // Auto-set for specific rounds\n    }\n\n    // Create question with appropriate defaults based on question type\n    let questionDefaults;\n    if (\n      defaultQuestionType === \"single-answer\" ||\n      currentRound.type === \"golden-pyramid\"\n    ) {\n      questionDefaults = {\n        possibleAnswers: [],\n        correctAnswers: [],\n        correctAnswerText: \"\",\n        question: \"\", // Ensure question is empty\n      };\n    } else if (defaultQuestionType === \"multiple-choice\") {\n      // Multiple Choice round: default 4 answers\n      questionDefaults = {\n        possibleAnswers: [\"\", \"\", \"\", \"\"],\n        correctAnswers: [0],\n        correctAnswerText: undefined,\n      };\n    } else if ([\"picture\", \"audio\", \"video\"].includes(defaultQuestionType)) {\n      // Media types: default to single-answer behavior but keep media type\n      questionDefaults = {\n        possibleAnswers: [],\n        correctAnswers: [],\n        correctAnswerText: \"\",\n      };\n    } else {\n      // Fallback for other types\n      questionDefaults = {\n        possibleAnswers: [\"\"],\n        correctAnswers: [0],\n        correctAnswerText: undefined,\n      };\n    }\n\n    actions.setManualQuestion({\n      id: `q_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      type: defaultQuestionType,\n      question: \"\",\n      ...questionDefaults,\n      explanation: \"\",\n      mediaFile: undefined,\n      difficulty: (draftQuiz.difficulty as QuizDifficulty) || \"medium\",\n      points: 1,\n      timeLimit: currentRound.defaultTimePerQuestion || 1, // Use round's time setting in minutes\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    });\n    actions.openManualDialog();\n  };\n\n  // Required fields check for Save button\n  const manualQuestionValid =\n    state.manualQuestion &&\n    state.manualQuestion.question.trim() &&\n    (() => {\n      const q = state.manualQuestion;\n      // For single-answer mode (no options), require correctAnswerText\n      if (\n        q.type === \"single-answer\" ||\n        ([\"picture\", \"audio\", \"video\"].includes(q.type) &&\n          q.possibleAnswers.length === 0) ||\n        currentRound?.type === \"golden-pyramid\"\n      ) {\n        return q.correctAnswerText && q.correctAnswerText.trim();\n      }\n      // For multiple choice mode (options present), require at least 2 non-empty options and a correct answer\n      if (\n        ([\"picture\", \"audio\", \"video\"].includes(q.type) &&\n          q.possibleAnswers.length > 0) ||\n        (![\"picture\", \"audio\", \"video\"].includes(q.type) &&\n          q.type !== \"single-answer\")\n      ) {\n        return (\n          q.possibleAnswers.length >= 2 &&\n          q.possibleAnswers.every((opt) => opt.trim()) &&\n          q.correctAnswers.length > 0\n        );\n      }\n      return false;\n    })();\n\n  // Handler: Add new round\n  const handleAddRound = () => {\n    actions.openRoundModal(\"add\");\n  };\n\n  // Handler: Edit current round\n  const handleEditRound = () => {\n    actions.openRoundModal(\"edit\", currentRound || undefined);\n  };\n\n  // Handler: Save round (add or edit)\n  const handleSaveRound = (round: Round) => {\n    if (state.roundModalMode === \"add\") {\n      updateDraft({ rounds: [...rounds, round] });\n      actions.setCurrentRoundIdx(rounds.length); // Go to new round\n    } else if (state.roundModalMode === \"edit\" && currentRound) {\n      updateDraft({\n        rounds: rounds.map((r, idx) =>\n          idx === state.currentRoundIdx ? round : r\n        ),\n      });\n    }\n    actions.closeRoundModal();\n  };\n\n  // Get available round types for editing\n  const getAvailableRoundTypes = () => {\n    if (state.roundModalMode === \"edit\" && state.editingRound) {\n      // Golden Pyramid can never change type\n      if (state.editingRound.type === \"golden-pyramid\") {\n        return [{ value: \"golden-pyramid\", label: \"Golden Pyramid\" }];\n      }\n\n      // If round has questions, can only change to Mixed\n      if (state.editingRound.questions.length > 0) {\n        return [\n          {\n            value: state.editingRound.type,\n            label: ROUND_TYPE_CONFIG[state.editingRound.type].label,\n          },\n          { value: \"mixed\", label: \"Mixed Types\" },\n        ].filter(\n          (item, index, self) =>\n            index === self.findIndex((t) => t.value === item.value)\n        ); // Remove duplicates\n      }\n    }\n\n    // For new rounds or rounds without questions, show all types except golden pyramid in edit mode\n    return ROUND_TYPES.filter(\n      (type) =>\n        state.roundModalMode === \"add\" || type.value !== \"golden-pyramid\"\n    );\n  };\n\n  // Handler: Delete current round (with confirmation)\n  const requestDeleteRound = () => {\n    actions.openDeleteRoundConfirm();\n  };\n  const handleConfirmDeleteRound = () => {\n    if (!currentRound) return;\n    const newRounds = rounds.filter((_, idx) => idx !== state.currentRoundIdx);\n    updateDraft({ rounds: newRounds });\n    actions.setCurrentRoundIdx(Math.max(0, state.currentRoundIdx - 1));\n    actions.closeDeleteRoundConfirm();\n  };\n  const handleCancelDeleteRound = () => actions.closeDeleteRoundConfirm();\n\n  // Handler: Delete question in current round (with confirmation)\n  const requestDeleteQuestion = (questionId: string) => {\n    actions.openDeleteQuestionConfirm(questionId);\n  };\n  const handleConfirmDeleteQuestion = () => {\n    if (!currentRound || !state.pendingDeleteQuestionId) return;\n    const updatedQuestions = currentRound.questions.filter(\n      (q) => q.id !== state.pendingDeleteQuestionId\n    );\n    const updatedRound: Round = {\n      ...currentRound,\n      questions: updatedQuestions,\n      updatedAt: new Date(),\n    };\n    updateDraft({\n      rounds: rounds.map((r, idx) =>\n        idx === state.currentRoundIdx ? updatedRound : r\n      ),\n    });\n    if (state.editingQuestionId === state.pendingDeleteQuestionId)\n      actions.setEditingQuestionId(null);\n\n    // Close the manual dialog if we're deleting the question being edited\n    if (state.manualQuestion?.id === state.pendingDeleteQuestionId) {\n      actions.closeManualDialog();\n    }\n\n    actions.closeDeleteQuestionConfirm();\n  };\n  const handleCancelDeleteQuestion = () => {\n    actions.closeDeleteQuestionConfirm();\n  };\n\n  return (\n    <Box sx={{ maxWidth: 1000, mx: \"auto\" }}>\n      {/* Refactored Round Navigation Component */}\n      <RoundNavigation\n        rounds={rounds}\n        currentRoundIdx={state.currentRoundIdx}\n        currentRound={currentRound}\n        onPreviousRound={actions.goToPrevRound}\n        onNextRound={actions.goToNextRound}\n        onAddRound={handleAddRound}\n        onEditRound={handleEditRound}\n        onDeleteRound={requestDeleteRound}\n      />\n\n      {/* Refactored Question Actions Bar */}\n      <QuestionActionsBar\n        showActions={!!currentRound}\n        roundType={currentRound?.type}\n        onOpenAIDialog={actions.openAIDialog}\n        onOpenManualDialog={openManualDialog}\n      />\n\n      {/* Refactored Questions List */}\n      <QuestionsList\n        currentRound={currentRound}\n        onEditQuestion={(question) => {\n          actions.setManualQuestion(question);\n          actions.openManualDialog();\n        }}\n        onDeleteQuestion={requestDeleteQuestion}\n        onAddRound={handleAddRound}\n        onAddQuestion={openManualDialog}\n      />\n\n      {/* AI Dialog */}\n      {renderAIDialog()}\n\n      {/* Manual Question Dialog */}\n      <Dialog\n        open={state.manualDialogOpen}\n        onClose={actions.closeManualDialog}\n        maxWidth=\"sm\"\n        fullWidth\n      >\n        <DialogTitle>\n          {state.manualQuestion &&\n          currentRound?.questions.some((q) => q.id === state.manualQuestion?.id)\n            ? `Edit ${\n                currentRound\n                  ? (() => {\n                      const label = ROUND_TYPE_CONFIG[currentRound.type].label;\n                      return label.includes(\"Question\")\n                        ? label\n                        : `${label} Question`;\n                    })()\n                  : \"Question\"\n              }`\n            : `Add ${\n                currentRound\n                  ? (() => {\n                      const label = ROUND_TYPE_CONFIG[currentRound.type].label;\n                      return label.includes(\"Question\")\n                        ? label\n                        : `${label} Question`;\n                    })()\n                  : \"Question\"\n              }`}\n        </DialogTitle>\n        <DialogContent>\n          {state.manualQuestion && (\n            <QuestionEditor\n              question={state.manualQuestion}\n              roundType={currentRound?.type}\n              onUpdate={(updates) =>\n                actions.setManualQuestion(\n                  state.manualQuestion\n                    ? {\n                        ...state.manualQuestion,\n                        ...updates,\n                        updatedAt: new Date(),\n                      }\n                    : null\n                )\n              }\n            />\n          )}\n        </DialogContent>\n        <DialogActions\n          sx={{\n            display: \"flex\",\n            justifyContent: \"space-between\",\n            alignItems: \"center\",\n            px: 3,\n            py: 2,\n          }}\n        >\n          {/* Delete Button - Left Side (Only show when editing existing question) */}\n          {state.manualQuestion &&\n            currentRound?.questions.some(\n              (q) => q.id === state.manualQuestion?.id\n            ) && (\n              <IconButton\n                onClick={() => {\n                  if (state.manualQuestion?.id) {\n                    requestDeleteQuestion(state.manualQuestion.id);\n                  }\n                }}\n                color=\"error\"\n                sx={{\n                  bgcolor: \"error.50\",\n                  \"&:hover\": {\n                    bgcolor: \"error.100\",\n                  },\n                }}\n                aria-label=\"Delete question\"\n              >\n                <DeleteIcon />\n              </IconButton>\n            )}\n\n          {/* Spacer for Add mode */}\n          {!(\n            state.manualQuestion &&\n            currentRound?.questions.some(\n              (q) => q.id === state.manualQuestion?.id\n            )\n          ) && <Box />}\n\n          {/* Cancel and Save Buttons - Right Side */}\n          <Box sx={{ display: \"flex\", gap: 1 }}>\n            <Button onClick={actions.closeManualDialog}>Cancel</Button>\n            <Button\n              onClick={() => {\n                if (!state.manualQuestion) return;\n                // If editing, update the question in the round\n                if (\n                  currentRound?.questions.some(\n                    (q) => q.id === state.manualQuestion?.id\n                  )\n                ) {\n                  const updatedQuestions = currentRound.questions.map((q) =>\n                    q.id === state.manualQuestion?.id ? state.manualQuestion : q\n                  );\n                  const updatedRound: Round = {\n                    ...currentRound!,\n                    questions: updatedQuestions,\n                    updatedAt: new Date(),\n                  };\n                  updateDraft({\n                    rounds: rounds.map((r, idx) =>\n                      idx === state.currentRoundIdx ? updatedRound : r\n                    ),\n                  });\n                } else {\n                  // If adding, add the question to the round\n                  const updatedRound: Round = {\n                    ...currentRound!,\n                    questions: [\n                      ...(currentRound?.questions || []),\n                      state.manualQuestion,\n                    ],\n                    updatedAt: new Date(),\n                  };\n                  updateDraft({\n                    rounds: rounds.map((r, idx) =>\n                      idx === state.currentRoundIdx ? updatedRound : r\n                    ),\n                  });\n                }\n                actions.closeManualDialog();\n              }}\n              variant=\"contained\"\n              disabled={!manualQuestionValid}\n            >\n              Save\n            </Button>\n          </Box>\n        </DialogActions>\n      </Dialog>\n\n      {/* Round Modal for Add/Edit */}\n      <Dialog\n        open={state.roundModalOpen}\n        onClose={actions.closeRoundModal}\n        maxWidth=\"sm\"\n        fullWidth\n      >\n        <DialogTitle>\n          {state.roundModalMode === \"add\" ? \"Add Round\" : \"Edit Round\"}\n        </DialogTitle>\n        <DialogContent>\n          <Box\n            component=\"form\"\n            sx={{ display: \"flex\", flexDirection: \"column\", gap: 3, mt: 1 }}\n          >\n            <FormControl fullWidth required>\n              <InputLabel>Round Type</InputLabel>\n              <Select\n                value={state.roundForm.type}\n                label=\"Round Type\"\n                onChange={(e) =>\n                  actions.updateRoundForm(\"type\", e.target.value)\n                }\n                aria-label=\"Round type\"\n                renderValue={(selected) => {\n                  // Find the label for the selected value\n                  const found = getAvailableRoundTypes().find(\n                    (rt) => rt.value === selected\n                  );\n                  return found ? found.label : selected;\n                }}\n              >\n                {getAvailableRoundTypes().map((rt) => (\n                  <MenuItem\n                    key={rt.value}\n                    value={rt.value}\n                    sx={{\n                      display: \"flex\",\n                      alignItems: \"center\",\n                      justifyContent: \"space-between\",\n                    }}\n                  >\n                    <span>{rt.label}</span>\n                    <IconButton\n                      aria-label={`Info about ${rt.label}`}\n                      size=\"small\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        setInfoModalRoundType(\n                          rt.value as keyof typeof roundInfoContent\n                        );\n                        setInfoModalOpen(true);\n                      }}\n                      sx={{ ml: 2 }}\n                    >\n                      <InfoOutlinedIcon fontSize=\"small\" />\n                    </IconButton>\n                  </MenuItem>\n                ))}\n              </Select>\n            </FormControl>\n            <FormControl fullWidth required>\n              <InputLabel>Answer Reveal Mode</InputLabel>\n              <Select\n                value={state.roundForm.answerRevealMode}\n                label=\"Answer Reveal Mode\"\n                onChange={(e) =>\n                  actions.updateRoundForm(\"answerRevealMode\", e.target.value)\n                }\n                aria-label=\"Answer reveal mode\"\n              >\n                {REVEAL_MODES.map((rm) => (\n                  <MenuItem key={rm.value} value={rm.value}>\n                    {rm.label}\n                  </MenuItem>\n                ))}\n              </Select>\n            </FormControl>\n            <Box>\n              <Typography gutterBottom>\n                Default Time Per Question (minutes)\n              </Typography>\n              <TextField\n                type=\"number\"\n                fullWidth\n                label=\"Minutes\"\n                inputProps={{\n                  min: 0.1,\n                  max: 10,\n                  step: 0.1,\n                }}\n                value={state.roundForm.defaultTimePerQuestion}\n                onChange={(e) => {\n                  let val = Number(e.target.value);\n                  if (val < 0.1) val = 0.1;\n                  if (val > 10) val = 10;\n                  actions.updateRoundForm(\"defaultTimePerQuestion\", val);\n                }}\n                helperText=\"Time limit per question (0.5 = 30 seconds, 1 = 60 seconds)\"\n                aria-label=\"Default time per question in minutes\"\n              />\n            </Box>\n            <Box>\n              <Typography gutterBottom>Breaking Time (minutes)</Typography>\n              <TextField\n                type=\"number\"\n                fullWidth\n                label=\"Minutes\"\n                placeholder=\"5\"\n                inputProps={{\n                  min: 0.1,\n                  max: 10,\n                  step: 0.1,\n                }}\n                value={state.roundForm.breakingTime || \"\"}\n                onChange={(e) => {\n                  let val = Number(e.target.value) || 5; // Default to 5 if empty\n                  if (val < 0.1) val = 0.1;\n                  if (val > 10) val = 10;\n                  actions.updateRoundForm(\"breakingTime\", val);\n                }}\n                helperText=\"Break time between rounds (default 5 minutes)\"\n                aria-label=\"Breaking time between rounds in minutes\"\n              />\n            </Box>\n            <TextField\n              label=\"Round Description (Optional)\"\n              value={state.roundForm.description}\n              onChange={(e) =>\n                actions.updateRoundForm(\"description\", e.target.value)\n              }\n              fullWidth\n              multiline\n              minRows={2}\n              maxRows={4}\n              inputProps={{ maxLength: 120 }}\n              aria-label=\"Round description\"\n              helperText=\"Optional description for this round\"\n            />\n          </Box>\n        </DialogContent>\n        <DialogActions\n          sx={{\n            display: \"flex\",\n            justifyContent: \"space-between\",\n            alignItems: \"center\",\n            px: 3,\n            py: 2,\n          }}\n        >\n          {/* Delete Button - Left Side (Only show when editing) */}\n          {state.roundModalMode === \"edit\" && rounds.length > 0 && (\n            <IconButton\n              onClick={requestDeleteRound}\n              color=\"error\"\n              sx={{\n                bgcolor: \"error.50\",\n                \"&:hover\": {\n                  bgcolor: \"error.100\",\n                },\n              }}\n              aria-label=\"Delete round\"\n            >\n              <DeleteIcon />\n            </IconButton>\n          )}\n\n          {/* Spacer for Add mode */}\n          {state.roundModalMode === \"add\" && <Box />}\n\n          {/* Cancel and Save Buttons - Right Side */}\n          <Box sx={{ display: \"flex\", gap: 1 }}>\n            <Button onClick={actions.closeRoundModal}>Cancel</Button>\n            <Button\n              onClick={handleRoundSave}\n              variant=\"contained\"\n              disabled={!isRoundFormValid}\n            >\n              Save\n            </Button>\n          </Box>\n        </DialogActions>\n      </Dialog>\n\n      {/* Validation for Next button: ensure at least one round and each round has at least one question */}\n      {showValidation && rounds.some((r) => r.questions.length === 0) && (\n        <Alert severity=\"error\" sx={{ mt: 2 }}>\n          Each round must have at least one question to proceed.\n        </Alert>\n      )}\n\n      {/* Confirmation dialogs */}\n      <Dialog\n        open={state.deleteRoundConfirmOpen}\n        onClose={handleCancelDeleteRound}\n        aria-labelledby=\"delete-round-dialog-title\"\n        aria-describedby=\"delete-round-dialog-description\"\n      >\n        <DialogTitle id=\"delete-round-dialog-title\">\n          Confirm Delete Round\n        </DialogTitle>\n        <DialogContent>\n          <DialogContentText id=\"delete-round-dialog-description\">\n            Are you sure you want to delete this round? All questions in this\n            round will be lost. This action cannot be undone.\n          </DialogContentText>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={handleCancelDeleteRound} color=\"primary\" autoFocus>\n            Cancel\n          </Button>\n          <Button\n            onClick={handleConfirmDeleteRound}\n            color=\"error\"\n            variant=\"contained\"\n          >\n            Delete\n          </Button>\n        </DialogActions>\n      </Dialog>\n      <Dialog\n        open={state.deleteQuestionConfirmOpen}\n        onClose={handleCancelDeleteQuestion}\n        aria-labelledby=\"delete-question-dialog-title\"\n        aria-describedby=\"delete-question-dialog-description\"\n      >\n        <DialogTitle id=\"delete-question-dialog-title\">\n          Confirm Delete Question\n        </DialogTitle>\n        <DialogContent>\n          <DialogContentText id=\"delete-question-dialog-description\">\n            Are you sure you want to delete this question? This action cannot be\n            undone.\n          </DialogContentText>\n        </DialogContent>\n        <DialogActions>\n          <Button\n            onClick={handleCancelDeleteQuestion}\n            color=\"primary\"\n            autoFocus\n          >\n            Cancel\n          </Button>\n          <Button\n            onClick={handleConfirmDeleteQuestion}\n            color=\"error\"\n            variant=\"contained\"\n          >\n            Delete\n          </Button>\n        </DialogActions>\n      </Dialog>\n\n      {/* Info Modal for round type */}\n      <RoundInfoModal\n        open={infoModalOpen && !!infoModalRoundType}\n        onClose={() => setInfoModalOpen(false)}\n        roundType={infoModalRoundType || \"mixed\"}\n      />\n    </Box>\n  );\n};\n\nexport default RoundsQuestionsStep;\n","/**\n * Quiz Creation Wizard Modal Component - Simplified Version\n *\n * Simplified full-screen modal for quiz creation with floating action buttons.\n * No complex stepping system - just basic info and questions in one flow.\n *\n * New Layout:\n * - Main app header at the top (always visible)\n * - Scrollable content with basic info and questions\n * - Two floating action buttons: Edit Quiz and Save Quiz\n * - Save confirmation dialog with quiz summary\n *\n * @fileoverview Simplified quiz creation wizard modal component\n * @version 5.0.0\n * @since December 2025\n */\n\nimport React, { useState, useCallback, useEffect } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  Fade,\n  Typography,\n  Box,\n  Fab,\n  Card,\n  CardContent,\n  Chip,\n  Button,\n  DialogTitle,\n  DialogActions,\n  Divider,\n} from \"@mui/material\";\nimport {\n  Edit as EditIcon,\n  Save as SaveIcon,\n  Delete as DeleteIcon,\n  Category as CategoryIcon,\n  QuestionAnswer as QuestionIcon,\n  Timer as TimerIcon,\n  CheckCircle as CheckIcon,\n} from \"@mui/icons-material\";\nimport type { QuizWizardProps } from \"../../types\";\nimport { useQuizWizardWithStorage } from \"../../hooks\";\nimport { ErrorBoundary } from \"react-error-boundary\";\nimport Header from \"../../../../../shared/components/Header\";\nimport { useTheme } from \"../../../../../shared/hooks/useTheme\";\n\n// Import step components\nimport { BasicInfoStep } from \"../../steps/BasicInfoStep\";\nimport { RoundsQuestionsStep } from \"../../steps/QuestionsStep\";\n\n/**\n * Quiz Creation Wizard Modal - Simplified Version\n *\n * Simplified interface for creating quizzes with floating action buttons.\n * Combines basic info and questions in a single scrollable view.\n *\n * @param props - Component props including callbacks and optional edit quiz\n * @returns JSX element representing the simplified wizard modal\n */\nexport const QuizWizardModal: React.FC<\n  QuizWizardProps & { onQuizDeleted?: (id: string) => void }\n> = ({ onQuizCreated, onCancel, editQuiz, onQuizDeleted }) => {\n  // === THEME INTEGRATION ===\n  const { mode, handleThemeChange } = useTheme();\n\n  // === LOCAL STATE ===\n  const [showBasicInfo, setShowBasicInfo] = useState(true);\n  const [showSaveDialog, setShowSaveDialog] = useState(false);\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [isDeleting, setIsDeleting] = useState(false);\n  const [isOpen, setIsOpen] = useState(true); // Local state to control modal open/close\n  const [deleted, setDeleted] = useState(false);\n\n  // === ENHANCED WIZARD STATE WITH INDEXEDDB ===\n  const {\n    draftQuiz,\n    updateDraft,\n    resetWizard,\n    completeWizard,\n    // Enhanced auto-save features\n    autoSaveStatus,\n    storageError,\n    lastSaved,\n  } = useQuizWizardWithStorage(editQuiz);\n\n  // === COMPUTED VALUES ===\n  const totalQuestions =\n    draftQuiz.rounds?.flatMap((r) => r.questions).length || 0;\n  const totalRounds = draftQuiz.rounds?.length || 0;\n\n  // Enhanced validation - allow saving with minimal content to support iterative quiz building\n  const canSave = !!(\n    (\n      draftQuiz.title?.trim() || // Has title, OR\n      totalQuestions > 0 || // Has at least one question, OR\n      draftQuiz.description?.trim() || // Has description, OR\n      draftQuiz.category || // Has category selected, OR\n      draftQuiz.difficulty\n    ) // Has difficulty selected\n  );\n\n  // === EVENT HANDLERS ===\n  /**\n   * Handles closing the wizard modal\n   * Auto-saves the draft and shows confirmation message\n   */\n  const handleClose = useCallback(() => {\n    // Check if there are unsaved changes\n    const hasChanges = draftQuiz.title || totalQuestions > 0;\n\n    if (hasChanges) {\n      // Auto-save happens in the background, just close\n      setTimeout(() => {\n        setIsOpen(false);\n        onCancel();\n      }, 100);\n    } else {\n      setIsOpen(false);\n      onCancel();\n    }\n  }, [draftQuiz.title, totalQuestions, onCancel]);\n\n  /**\n   * Handles clicking the Edit Quiz button\n   * Scrolls to basic info section\n   */\n  const handleEditQuiz = useCallback(() => {\n    setShowBasicInfo(true);\n    // Scroll to top\n    const content = document.querySelector('[data-testid=\"wizard-content\"]');\n    if (content) {\n      content.scrollTo({ top: 0, behavior: \"smooth\" });\n    }\n  }, []);\n\n  /**\n   * Handles clicking the Save Quiz button\n   * Shows the save confirmation dialog\n   */\n  const handleSaveQuiz = useCallback(() => {\n    if (canSave) {\n      setShowSaveDialog(true);\n    }\n  }, [canSave]);\n\n  /**\n   * Handles confirming the save action\n   * Creates the quiz and closes the modal\n   */\n  const handleConfirmSave = useCallback(async () => {\n    setIsSubmitting(true);\n\n    try {\n      const completedQuiz = await completeWizard();\n      onQuizCreated(completedQuiz);\n      resetWizard(); // Clear draft for next time\n      setShowSaveDialog(false);\n      onCancel(); // Close the wizard modal after save\n    } catch (error) {\n      console.error(\"Error saving quiz:\", error);\n      // Keep dialog open on error\n    } finally {\n      setIsSubmitting(false);\n    }\n  }, [completeWizard, onQuizCreated, resetWizard, onCancel]);\n\n  /**\n   * Handles canceling the save action\n   */\n  const handleCancelSave = useCallback(() => {\n    setShowSaveDialog(false);\n  }, []);\n\n  /**\n   * Handles clicking the Delete Quiz button\n   * Shows the delete confirmation dialog\n   */\n  const handleDeleteQuiz = useCallback(() => {\n    if (editQuiz) {\n      setShowDeleteDialog(true);\n    }\n  }, [editQuiz]);\n\n  /**\n   * Handles confirming the delete action\n   * Deletes the quiz and closes the modal\n   */\n  const handleConfirmDelete = useCallback(async () => {\n    if (!editQuiz) return;\n\n    setIsDeleting(true);\n\n    try {\n      // Import the delete functionality from the storage service\n      const { indexedDBService } = await import(\n        \"../../../management/services/indexedDBService\"\n      );\n      const result = await indexedDBService.deleteQuiz(editQuiz.id);\n\n      if (result.success) {\n        // Notify parent of deletion before closing\n        if (onQuizDeleted) onQuizDeleted(editQuiz.id);\n        onCancel();\n      } else {\n        throw new Error(result.error || \"Failed to delete quiz\");\n      }\n    } catch (error) {\n      console.error(\"Error deleting quiz:\", error);\n      // Keep dialog open on error\n    } finally {\n      setIsDeleting(false);\n      setShowDeleteDialog(false);\n    }\n  }, [editQuiz, onCancel, onQuizDeleted]);\n\n  /**\n   * Handles canceling the delete action\n   */\n  const handleCancelDelete = useCallback(() => {\n    setShowDeleteDialog(false);\n  }, []);\n\n  useEffect(() => {\n    // Listen for 'QUIZ_DELETED' events (cross-tab)\n    const bc = new window.BroadcastChannel(\"quizzard-quiz-events\");\n    const handler = (event: MessageEvent) => {\n      if (\n        event.data?.type === \"QUIZ_DELETED\" &&\n        event.data.id === draftQuiz?.id\n      ) {\n        setDeleted(true);\n      }\n    };\n    bc.addEventListener(\"message\", handler);\n    return () => {\n      bc.removeEventListener(\"message\", handler);\n      bc.close();\n    };\n  }, [draftQuiz?.id]);\n\n  // If deleted, close the modal or show a message\n  useEffect(() => {\n    if (deleted) {\n      // Option 1: Close the modal immediately\n      if (typeof onCancel === \"function\") onCancel();\n      // Option 2: Show a deleted message (uncomment if preferred)\n      // setShowDeletedMessage(true);\n    }\n  }, [deleted, onCancel]);\n\n  // === RENDER ===\n\n  return (\n    <ErrorBoundary\n      fallback={\n        <Dialog open fullScreen>\n          <DialogContent\n            sx={{\n              display: \"flex\",\n              alignItems: \"center\",\n              justifyContent: \"center\",\n              bgcolor: \"background.default\",\n            }}\n          >\n            <Typography variant=\"h6\" color=\"error\" textAlign=\"center\">\n              Something went wrong in the quiz wizard.\n              <br />\n              Please refresh the page and try again.\n            </Typography>\n          </DialogContent>\n        </Dialog>\n      }\n    >\n      <Dialog\n        open={isOpen}\n        onClose={handleClose}\n        fullScreen\n        PaperProps={{\n          sx: {\n            bgcolor: \"background.default\",\n            backgroundImage: \"none\",\n            display: \"flex\",\n            flexDirection: \"column\",\n            height: \"100vh\",\n          },\n        }}\n        TransitionComponent={Fade}\n        transitionDuration={300}\n      >\n        {/* Main App Header - with proper theme integration and z-index */}\n        <Box sx={{ zIndex: 1400, position: \"relative\" }}>\n          <Header mode={mode} onThemeChange={handleThemeChange} />\n        </Box>\n\n        {/* Main content area - scrollable */}\n        <DialogContent\n          data-testid=\"wizard-content\"\n          sx={{\n            flex: 1,\n            p: 0,\n            display: \"flex\",\n            flexDirection: \"column\",\n            overflow: \"auto\",\n          }}\n        >\n          <Box\n            sx={{\n              maxWidth: 1200,\n              mx: \"auto\",\n              width: \"100%\",\n              px: { xs: 2, sm: 3, md: 4 },\n              py: { xs: 2, sm: 3 },\n            }}\n          >\n            {/* Basic Info Section */}\n            {showBasicInfo && (\n              <Box sx={{ mb: 4 }}>\n                <Typography variant=\"h4\" gutterBottom fontWeight={600}>\n                  Quiz Details\n                </Typography>\n                <BasicInfoStep\n                  draftQuiz={draftQuiz}\n                  updateDraft={updateDraft}\n                  validation={{\n                    isValid: true,\n                    errors: [],\n                    warnings: [],\n                    validatedAt: new Date(),\n                  }}\n                  onDeleteQuiz={editQuiz ? handleDeleteQuiz : undefined}\n                  isEditMode={!!editQuiz}\n                  onContinue={() => setShowBasicInfo(false)}\n                />\n              </Box>\n            )}\n\n            {/* Questions Section */}\n            {!showBasicInfo && (\n              <Box>\n                <RoundsQuestionsStep\n                  draftQuiz={draftQuiz}\n                  updateDraft={updateDraft}\n                  showValidation={false}\n                />\n              </Box>\n            )}\n          </Box>\n        </DialogContent>\n\n        {/* Floating Action Buttons - only show when not in basic info mode */}\n        {!showBasicInfo && (\n          <>\n            {/* Right side buttons */}\n            <Box\n              sx={{\n                position: \"fixed\",\n                bottom: { xs: 16, sm: 24 },\n                right: { xs: 16, sm: 24 },\n                display: \"flex\",\n                flexDirection: \"row\",\n                gap: 2,\n                zIndex: 1300,\n              }}\n            >\n              {/* Edit Quiz Button */}\n              <Box\n                sx={{\n                  display: { xs: \"block\", sm: \"none\" },\n                }}\n              >\n                <Fab\n                  color=\"secondary\"\n                  onClick={handleEditQuiz}\n                  sx={{\n                    boxShadow: 3,\n                    \"&:hover\": {\n                      boxShadow: 6,\n                    },\n                  }}\n                >\n                  <EditIcon />\n                </Fab>\n              </Box>\n              <Box\n                sx={{\n                  display: { xs: \"none\", sm: \"block\" },\n                }}\n              >\n                <Button\n                  variant=\"contained\"\n                  color=\"secondary\"\n                  onClick={handleEditQuiz}\n                  startIcon={<EditIcon />}\n                  sx={{\n                    boxShadow: 3,\n                    \"&:hover\": {\n                      boxShadow: 6,\n                    },\n                    minWidth: 120,\n                    height: 56,\n                  }}\n                >\n                  Edit Quiz\n                </Button>\n              </Box>\n\n              {/* Save Quiz Button */}\n              <Box\n                sx={{\n                  display: { xs: \"block\", sm: \"none\" },\n                }}\n              >\n                <Fab\n                  color=\"primary\"\n                  onClick={handleSaveQuiz}\n                  disabled={!canSave}\n                  sx={{\n                    boxShadow: 3,\n                    \"&:hover\": {\n                      boxShadow: 6,\n                    },\n                    \"&.Mui-disabled\": {\n                      bgcolor: \"action.disabled\",\n                    },\n                  }}\n                >\n                  <SaveIcon />\n                </Fab>\n              </Box>\n              <Box\n                sx={{\n                  display: { xs: \"none\", sm: \"block\" },\n                }}\n              >\n                <Button\n                  variant=\"contained\"\n                  color=\"primary\"\n                  onClick={handleSaveQuiz}\n                  disabled={!canSave}\n                  startIcon={<SaveIcon />}\n                  sx={{\n                    boxShadow: 3,\n                    \"&:hover\": {\n                      boxShadow: 6,\n                    },\n                    \"&.Mui-disabled\": {\n                      bgcolor: \"action.disabled\",\n                    },\n                    minWidth: 120,\n                    height: 56,\n                  }}\n                >\n                  Save Quiz\n                </Button>\n              </Box>\n            </Box>\n          </>\n        )}\n\n        {/* Save Confirmation Dialog */}\n        <Dialog\n          open={showSaveDialog}\n          onClose={handleCancelSave}\n          maxWidth=\"sm\"\n          fullWidth\n          PaperProps={{\n            sx: {\n              borderRadius: 2,\n              boxShadow: 24,\n            },\n          }}\n        >\n          <DialogTitle\n            sx={{\n              display: \"flex\",\n              alignItems: \"center\",\n              gap: 2,\n              pb: 2,\n            }}\n          >\n            <CheckIcon color=\"success\" />\n            <Typography variant=\"h6\" fontWeight={600}>\n              Save Quiz\n            </Typography>\n          </DialogTitle>\n\n          <DialogContent sx={{ pb: 2 }}>\n            <Card\n              variant=\"outlined\"\n              sx={{\n                mb: 3,\n                bgcolor: \"background.paper\",\n                border: \"1px solid\",\n                borderColor: \"divider\",\n              }}\n            >\n              <CardContent>\n                <Typography variant=\"h6\" gutterBottom fontWeight={600}>\n                  {draftQuiz.title}\n                </Typography>\n\n                {draftQuiz.description && (\n                  <Typography\n                    variant=\"body2\"\n                    color=\"text.secondary\"\n                    paragraph\n                    sx={{ mb: 2 }}\n                  >\n                    {draftQuiz.description}\n                  </Typography>\n                )}\n\n                <Box sx={{ display: \"flex\", gap: 1, flexWrap: \"wrap\", mb: 2 }}>\n                  <Chip\n                    icon={<CategoryIcon />}\n                    label={draftQuiz.category || \"General\"}\n                    size=\"small\"\n                    variant=\"outlined\"\n                  />\n                  <Chip\n                    icon={<TimerIcon />}\n                    label={`${totalRounds} Round${\n                      totalRounds !== 1 ? \"s\" : \"\"\n                    }`}\n                    size=\"small\"\n                    variant=\"filled\"\n                    color=\"secondary\"\n                  />\n                  <Chip\n                    icon={<QuestionIcon />}\n                    label={`${totalQuestions} Question${\n                      totalQuestions !== 1 ? \"s\" : \"\"\n                    }`}\n                    size=\"small\"\n                    variant=\"filled\"\n                    color=\"primary\"\n                  />\n                </Box>\n\n                <Divider sx={{ my: 2 }} />\n\n                <Typography variant=\"body2\" color=\"text.secondary\">\n                  <strong>Difficulty:</strong>{\" \"}\n                  {draftQuiz.difficulty || \"Not set\"}\n                </Typography>\n              </CardContent>\n            </Card>\n\n            <Typography\n              variant=\"body2\"\n              color=\"text.secondary\"\n              textAlign=\"center\"\n            >\n              Are you ready to save this quiz? You can always edit it later.\n            </Typography>\n          </DialogContent>\n\n          <DialogActions sx={{ px: 3, pb: 3, gap: 1 }}>\n            <Button\n              onClick={handleCancelSave}\n              variant=\"outlined\"\n              disabled={isSubmitting}\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleConfirmSave}\n              variant=\"contained\"\n              disabled={isSubmitting}\n              startIcon={isSubmitting ? null : <SaveIcon />}\n            >\n              {isSubmitting ? \"Saving...\" : \"Save Quiz\"}\n            </Button>\n          </DialogActions>\n        </Dialog>\n\n        {/* Delete Confirmation Dialog */}\n        <Dialog\n          open={showDeleteDialog}\n          onClose={handleCancelDelete}\n          maxWidth=\"sm\"\n          fullWidth\n          PaperProps={{\n            sx: {\n              borderRadius: 2,\n              boxShadow: 24,\n            },\n          }}\n        >\n          <DialogTitle\n            sx={{\n              display: \"flex\",\n              alignItems: \"center\",\n              gap: 2,\n              pb: 2,\n            }}\n          >\n            <DeleteIcon color=\"error\" />\n            <Typography variant=\"h6\" fontWeight={600}>\n              Delete Quiz\n            </Typography>\n          </DialogTitle>\n\n          <DialogContent sx={{ pb: 2 }}>\n            <Typography variant=\"body1\" paragraph>\n              Are you sure you want to delete this quiz?\n            </Typography>\n\n            <Card\n              variant=\"outlined\"\n              sx={{\n                mb: 3,\n                bgcolor: \"background.paper\",\n                border: \"1px solid\",\n                borderColor: \"divider\",\n              }}\n            >\n              <CardContent>\n                <Typography variant=\"h6\" gutterBottom fontWeight={600}>\n                  {editQuiz?.title}\n                </Typography>\n\n                {editQuiz?.description && (\n                  <Typography\n                    variant=\"body2\"\n                    color=\"text.secondary\"\n                    paragraph\n                    sx={{ mb: 2 }}\n                  >\n                    {editQuiz.description}\n                  </Typography>\n                )}\n\n                <Box sx={{ display: \"flex\", gap: 1, flexWrap: \"wrap\", mb: 2 }}>\n                  <Chip\n                    icon={<CategoryIcon />}\n                    label={editQuiz?.category || \"General\"}\n                    size=\"small\"\n                    variant=\"outlined\"\n                  />\n                  <Chip\n                    icon={<TimerIcon />}\n                    label={`${editQuiz?.rounds?.length || 0} Round${\n                      (editQuiz?.rounds?.length || 0) !== 1 ? \"s\" : \"\"\n                    }`}\n                    size=\"small\"\n                    variant=\"filled\"\n                    color=\"secondary\"\n                  />\n                  <Chip\n                    icon={<QuestionIcon />}\n                    label={`${\n                      editQuiz?.rounds?.flatMap((r) => r.questions).length || 0\n                    } Question${\n                      (editQuiz?.rounds?.flatMap((r) => r.questions).length ||\n                        0) !== 1\n                        ? \"s\"\n                        : \"\"\n                    }`}\n                    size=\"small\"\n                    variant=\"filled\"\n                    color=\"primary\"\n                  />\n                </Box>\n              </CardContent>\n            </Card>\n\n            <Typography\n              variant=\"body2\"\n              color=\"error\"\n              textAlign=\"center\"\n              fontWeight={500}\n            >\n              This action cannot be undone. The quiz will be permanently\n              deleted.\n            </Typography>\n          </DialogContent>\n\n          <DialogActions sx={{ px: 3, pb: 3, gap: 1 }}>\n            <Button\n              onClick={handleCancelDelete}\n              variant=\"outlined\"\n              disabled={isDeleting}\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleConfirmDelete}\n              variant=\"contained\"\n              color=\"error\"\n              disabled={isDeleting}\n              startIcon={isDeleting ? null : <DeleteIcon />}\n            >\n              {isDeleting ? \"Deleting...\" : \"Delete Quiz\"}\n            </Button>\n          </DialogActions>\n        </Dialog>\n      </Dialog>\n    </ErrorBoundary>\n  );\n};\n","/**\n * Quiz Actions Component\n *\n * Handles all quiz-related actions including menu interactions, modals,\n * and confirmation dialogs. Extracted from the monolithic Quizzes.tsx\n * to improve maintainability and follow Single Responsibility Principle.\n *\n * Features:\n * - Context menu for quiz actions (Edit, Export, Delete)\n * - Delete confirmation dialog\n * - Quiz wizard modal integration\n * - Floating action button\n *\n * @fileoverview Quiz actions and interactions management\n * @version 1.0.0\n * @since December 2025\n */\n\nimport React from \"react\";\nimport {\n  Menu,\n  MenuItem,\n  ListItemIcon,\n  ListItemText,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogContentText,\n  DialogActions,\n  Button,\n  Fab,\n} from \"@mui/material\";\nimport {\n  Edit as EditIcon,\n  Delete as DeleteIcon,\n  Download as DownloadIcon,\n  Add as AddIcon,\n  Slideshow as GoogleSlidesIcon,\n  Code as JSONIcon,\n} from \"@mui/icons-material\";\nimport { QuizWizardModal } from \"../../../creation-editing/components\";\nimport type { Quiz } from \"../../types\";\n\n/**\n * Props for the QuizActions component\n */\nexport interface QuizActionsProps {\n  /** Currently selected quiz for menu actions */\n  selectedQuiz: Quiz | null;\n  /** Menu anchor element */\n  menuAnchorEl: HTMLElement | null;\n  /** Quiz being edited in wizard */\n  editingQuiz: Quiz | null;\n  /** Whether wizard modal is open */\n  isWizardOpen: boolean;\n  /** Whether delete confirmation dialog is open */\n  deleteConfirmOpen: boolean;\n  /** Quiz pending deletion */\n  pendingDeleteQuiz: Quiz | null;\n  /** Callback when menu should close */\n  onMenuClose: () => void;\n  /** Callback when quiz edit is requested */\n  onEditQuiz: (quiz: Quiz) => void;\n  /** Callback when quiz export is requested */\n  onExportQuiz: (quiz: Quiz, format: \"slides\" | \"json\") => void;\n  /** Callback when quiz deletion is requested */\n  onRequestDeleteQuiz: (quiz: Quiz) => void;\n  /** Callback when quiz deletion is confirmed */\n  onConfirmDeleteQuiz: () => void;\n  /** Callback when quiz deletion is cancelled */\n  onCancelDeleteQuiz: () => void;\n  /** Callback when quiz creation is requested */\n  onCreateQuiz: () => void;\n  /** Callback when quiz wizard is cancelled */\n  onWizardCancel: () => void;\n  /** Callback when quiz is created/updated */\n  onQuizCreated: (quiz: Quiz) => void;\n}\n\n/**\n * QuizActions Component\n *\n * Manages all quiz-related actions and interactions including menus,\n * modals, and dialogs. Provides a centralized location for action handling.\n *\n * @param props - Component props\n * @returns JSX element representing quiz actions and interactions\n */\nexport const QuizActions: React.FC<QuizActionsProps> = ({\n  selectedQuiz,\n  menuAnchorEl,\n  editingQuiz,\n  isWizardOpen,\n  deleteConfirmOpen,\n  pendingDeleteQuiz,\n  onMenuClose,\n  onEditQuiz,\n  onExportQuiz,\n  onRequestDeleteQuiz,\n  onConfirmDeleteQuiz,\n  onCancelDeleteQuiz,\n  onCreateQuiz,\n  onWizardCancel,\n  onQuizCreated,\n}) => {\n  /**\n   * Handles edit menu item click\n   */\n  const handleEditClick = React.useCallback(() => {\n    if (selectedQuiz) {\n      onEditQuiz(selectedQuiz);\n      onMenuClose();\n    }\n  }, [selectedQuiz, onEditQuiz, onMenuClose]);\n\n  // PowerPoint export removed - function removed for clean slate\n\n  /**\n   * Handles Google Slides export menu item click (disabled)\n   */\n  const handleSlidesExport = React.useCallback(() => {\n    if (selectedQuiz) {\n      onExportQuiz(selectedQuiz, \"slides\");\n      onMenuClose();\n    }\n  }, [selectedQuiz, onExportQuiz, onMenuClose]);\n\n  /**\n   * Handles JSON export menu item click (disabled)\n   */\n  const handleJSONExport = React.useCallback(() => {\n    if (selectedQuiz) {\n      onExportQuiz(selectedQuiz, \"json\");\n      onMenuClose();\n    }\n  }, [selectedQuiz, onExportQuiz, onMenuClose]);\n\n  /**\n   * Handles delete menu item click\n   */\n  const handleDeleteClick = React.useCallback(() => {\n    if (selectedQuiz) {\n      onRequestDeleteQuiz(selectedQuiz);\n      onMenuClose();\n    }\n  }, [selectedQuiz, onRequestDeleteQuiz, onMenuClose]);\n\n  return (\n    <>\n      {/* Quiz options menu */}\n      <Menu\n        anchorEl={menuAnchorEl}\n        open={Boolean(menuAnchorEl)}\n        onClose={onMenuClose}\n        transformOrigin={{ horizontal: \"right\", vertical: \"top\" }}\n        anchorOrigin={{ horizontal: \"right\", vertical: \"bottom\" }}\n      >\n        <MenuItem onClick={handleEditClick}>\n          <ListItemIcon>\n            <EditIcon fontSize=\"small\" />\n          </ListItemIcon>\n          <ListItemText>Edit Quiz</ListItemText>\n        </MenuItem>\n        <MenuItem onClick={handleSlidesExport} disabled>\n          <ListItemIcon>\n            <GoogleSlidesIcon fontSize=\"small\" />\n          </ListItemIcon>\n          <ListItemText>Export to Google Slides</ListItemText>\n        </MenuItem>\n        <MenuItem onClick={handleJSONExport} disabled>\n          <ListItemIcon>\n            <JSONIcon fontSize=\"small\" />\n          </ListItemIcon>\n          <ListItemText>Export as JSON</ListItemText>\n        </MenuItem>\n        <MenuItem onClick={handleDeleteClick} sx={{ color: \"error.main\" }}>\n          <ListItemIcon>\n            <DeleteIcon fontSize=\"small\" color=\"error\" />\n          </ListItemIcon>\n          <ListItemText>Delete Quiz</ListItemText>\n        </MenuItem>\n      </Menu>\n\n      {/* Floating Action Button for quiz creation */}\n      <Fab\n        color=\"primary\"\n        aria-label=\"Create new quiz\"\n        onClick={onCreateQuiz}\n        sx={{\n          position: \"fixed\",\n          bottom: 80,\n          right: 24,\n          zIndex: 1000,\n        }}\n      >\n        <AddIcon />\n      </Fab>\n\n      {/* Quiz Creation/Edit Wizard Modal */}\n      {isWizardOpen && (\n        <QuizWizardModal\n          onQuizCreated={onQuizCreated}\n          onCancel={onWizardCancel}\n          editQuiz={editingQuiz || undefined}\n          onQuizDeleted={() => {\n            window.location.reload();\n          }}\n        />\n      )}\n\n      {/* Delete Confirmation Dialog */}\n      <Dialog\n        open={deleteConfirmOpen}\n        onClose={onCancelDeleteQuiz}\n        aria-labelledby=\"delete-quiz-dialog-title\"\n        aria-describedby=\"delete-quiz-dialog-description\"\n      >\n        <DialogTitle id=\"delete-quiz-dialog-title\">Confirm Delete</DialogTitle>\n        <DialogContent>\n          <DialogContentText id=\"delete-quiz-dialog-description\">\n            Are you sure you want to delete this quiz? This action cannot be\n            undone.\n          </DialogContentText>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={onCancelDeleteQuiz} color=\"primary\" autoFocus>\n            Cancel\n          </Button>\n          <Button\n            onClick={onConfirmDeleteQuiz}\n            color=\"error\"\n            variant=\"contained\"\n          >\n            Delete\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nexport default QuizActions;\n","/**\n * Storage Modal Component\n *\n * Beautiful modal dialog for displaying storage usage, quiz list with sizes,\n * and storage management actions. Provides a clean interface for users to\n * monitor and manage their quiz storage.\n *\n * Features:\n * - Storage usage visualization with animated progress\n * - Detailed quiz list with individual storage sizes\n * - Storage cleanup functionality with confirmation\n * - Beautiful Material-UI design with animations\n * - Responsive layout for mobile and desktop\n *\n * @fileoverview Storage management modal component\n * @version 1.0.0\n * @since December 2025\n */\n\nimport React, { useState, useMemo } from \"react\";\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Box,\n  Typography,\n  Button,\n  IconButton,\n  LinearProgress,\n  List,\n  ListItem,\n  ListItemText,\n  ListItemIcon,\n  Divider,\n  Chip,\n  Alert,\n  Fade,\n  Zoom,\n  useTheme,\n  useMediaQuery,\n} from \"@mui/material\";\nimport {\n  Close as CloseIcon,\n  Storage as StorageIcon,\n  Delete as DeleteIcon,\n  Quiz as QuizIcon,\n  Edit as DraftIcon,\n  BarChart as ChartIcon,\n  CleaningServices as CleanIcon,\n  Warning as WarningIcon,\n} from \"@mui/icons-material\";\nimport type { Quiz } from \"../../types\";\nimport type { StorageUsage } from \"../../services/indexedDBService\";\n\n/**\n * Props for the StorageModal component\n */\ninterface StorageModalProps {\n  /** Whether the modal is open */\n  open: boolean;\n  /** Callback to close the modal */\n  onClose: () => void;\n  /** Storage usage information */\n  storageUsage: StorageUsage | null;\n  /** Array of all quizzes (including drafts) */\n  quizzes: Quiz[];\n  /** Number of drafts */\n  draftsCount: number;\n  /** Callback to cleanup storage */\n  onCleanupStorage: () => void;\n  /** Callback to refresh storage info */\n  onRefreshStorage: () => void;\n}\n\n/**\n * Storage Modal Component\n *\n * Renders a beautiful modal with storage information, quiz list, and management actions.\n */\nexport const StorageModal: React.FC<StorageModalProps> = ({\n  open,\n  onClose,\n  storageUsage,\n  quizzes,\n  draftsCount,\n  onCleanupStorage,\n  onRefreshStorage,\n}) => {\n  const theme = useTheme();\n  const isMobile = useMediaQuery(theme.breakpoints.down(\"sm\"));\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\n\n  // Format file size helper\n  const formatSize = (bytes: number) => {\n    if (bytes === 0) return \"0 B\";\n    const k = 1024;\n    const sizes = [\"B\", \"KB\", \"MB\", \"GB\"];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return `${parseFloat((bytes / Math.pow(k, i)).toFixed(1))} ${sizes[i]}`;\n  };\n\n  // Calculate individual quiz sizes (estimated)\n  const quizzesWithSizes = useMemo(() => {\n    return quizzes.map((quiz) => {\n      // Estimate size based on content\n      const baseSize = 1024; // 1KB base\n      const questionSize = (quiz.rounds?.length || 0) * 512; // 512B per round\n      const titleSize = (quiz.title?.length || 0) * 2; // 2B per character\n      const descSize = (quiz.description?.length || 0) * 2;\n      const estimatedSize = baseSize + questionSize + titleSize + descSize;\n\n      return {\n        ...quiz,\n        estimatedSize,\n      };\n    });\n  }, [quizzes]);\n\n  // Handle cleanup confirmation\n  const handleCleanupClick = () => {\n    setShowDeleteConfirm(true);\n  };\n\n  const handleConfirmCleanup = () => {\n    onCleanupStorage();\n    setShowDeleteConfirm(false);\n    onClose();\n  };\n\n  const handleCancelCleanup = () => {\n    setShowDeleteConfirm(false);\n  };\n\n  // Storage usage percentage\n  const usagePercentage = storageUsage?.percentageUsed || 0;\n  const isNearLimit = storageUsage?.isNearLimit || false;\n\n  return (\n    <>\n      <Dialog\n        open={open}\n        onClose={onClose}\n        maxWidth=\"md\"\n        fullWidth\n        fullScreen={isMobile}\n        TransitionComponent={Zoom}\n        transitionDuration={300}\n        PaperProps={{\n          sx: {\n            borderRadius: isMobile ? 0 : 3,\n            maxHeight: isMobile ? \"100%\" : \"90vh\",\n          },\n        }}\n      >\n        {/* Header */}\n        <DialogTitle\n          sx={{\n            background: `linear-gradient(135deg, ${theme.palette.primary.main}, ${theme.palette.primary.dark})`,\n            color: \"white\",\n            textAlign: \"center\",\n            position: \"relative\",\n            py: 3,\n          }}\n        >\n          <Box\n            display=\"flex\"\n            alignItems=\"center\"\n            justifyContent=\"center\"\n            gap={2}\n          >\n            <StorageIcon sx={{ fontSize: 28 }} />\n            <Typography variant=\"h5\" component=\"div\" fontWeight=\"bold\">\n              Storage\n            </Typography>\n          </Box>\n\n          <IconButton\n            onClick={onClose}\n            sx={{\n              position: \"absolute\",\n              right: 8,\n              top: 8,\n              color: \"white\",\n              bgcolor: \"rgba(255,255,255,0.1)\",\n              \"&:hover\": {\n                bgcolor: \"rgba(255,255,255,0.2)\",\n              },\n            }}\n          >\n            <CloseIcon />\n          </IconButton>\n        </DialogTitle>\n\n        {/* Content */}\n        <DialogContent sx={{ p: 0 }}>\n          {/* Storage Usage Section */}\n          <Box sx={{ p: 3, bgcolor: \"background.default\" }}>\n            <Box display=\"flex\" alignItems=\"center\" gap={2} mb={2}>\n              <ChartIcon color=\"primary\" />\n              <Typography variant=\"h6\" fontWeight=\"600\">\n                Current Usage\n              </Typography>\n            </Box>\n\n            {storageUsage && (\n              <Fade in timeout={500}>\n                <Box>\n                  <Box\n                    display=\"flex\"\n                    justifyContent=\"space-between\"\n                    alignItems=\"center\"\n                    mb={1}\n                  >\n                    <Typography variant=\"body2\" color=\"text.secondary\">\n                      {formatSize(storageUsage.totalSize)} / 500 MB\n                    </Typography>\n                    <Typography\n                      variant=\"body2\"\n                      fontWeight=\"600\"\n                      color={isNearLimit ? \"warning.main\" : \"text.primary\"}\n                    >\n                      {usagePercentage.toFixed(1)}% used\n                    </Typography>\n                  </Box>\n\n                  <LinearProgress\n                    variant=\"determinate\"\n                    value={Math.min(usagePercentage, 100)}\n                    color={isNearLimit ? \"warning\" : \"primary\"}\n                    sx={{\n                      height: 12,\n                      borderRadius: 6,\n                      bgcolor: \"rgba(0,0,0,0.1)\",\n                      \"& .MuiLinearProgress-bar\": {\n                        borderRadius: 6,\n                        background: isNearLimit\n                          ? `linear-gradient(90deg, ${theme.palette.warning.main}, ${theme.palette.warning.dark})`\n                          : `linear-gradient(90deg, ${theme.palette.primary.main}, ${theme.palette.primary.dark})`,\n                      },\n                    }}\n                  />\n\n                  {isNearLimit && (\n                    <Alert\n                      severity=\"warning\"\n                      icon={<WarningIcon />}\n                      sx={{ mt: 2, borderRadius: 2 }}\n                    >\n                      Storage is nearly full. Consider cleaning up old quizzes.\n                    </Alert>\n                  )}\n                </Box>\n              </Fade>\n            )}\n          </Box>\n\n          <Divider />\n\n          {/* Quiz List Section */}\n          <Box sx={{ p: 3 }}>\n            <Box display=\"flex\" alignItems=\"center\" gap={2} mb={2}>\n              <QuizIcon color=\"primary\" />\n              <Typography variant=\"h6\" fontWeight=\"600\">\n                Quiz Storage\n              </Typography>\n              <Chip\n                label={`${quizzesWithSizes.length} items`}\n                size=\"small\"\n                color=\"primary\"\n                variant=\"outlined\"\n              />\n            </Box>\n\n            {quizzesWithSizes.length === 0 ? (\n              <Box textAlign=\"center\" py={4}>\n                <Typography variant=\"body2\" color=\"text.secondary\">\n                  No quizzes found\n                </Typography>\n              </Box>\n            ) : (\n              <List sx={{ maxHeight: 300, overflow: \"auto\" }}>\n                {quizzesWithSizes.map((quiz, index) => (\n                  <Fade in timeout={300 + index * 100} key={quiz.id}>\n                    <ListItem\n                      sx={{\n                        borderRadius: 2,\n                        mb: 1,\n                        bgcolor: \"background.paper\",\n                        border: 1,\n                        borderColor: \"divider\",\n                        \"&:hover\": {\n                          bgcolor: \"action.hover\",\n                        },\n                      }}\n                    >\n                      <ListItemIcon>\n                        {quiz.isDraft ? (\n                          <DraftIcon color=\"secondary\" />\n                        ) : (\n                          <QuizIcon color=\"primary\" />\n                        )}\n                      </ListItemIcon>\n                      <ListItemText\n                        primary={\n                          <Box display=\"flex\" alignItems=\"center\" gap={1}>\n                            <Typography variant=\"body1\" noWrap>\n                              {quiz.title}\n                            </Typography>\n                            {quiz.isDraft && (\n                              <Chip\n                                label=\"Draft\"\n                                size=\"small\"\n                                color=\"secondary\"\n                                variant=\"outlined\"\n                              />\n                            )}\n                          </Box>\n                        }\n                        secondary={\n                          <Typography variant=\"caption\" color=\"text.secondary\">\n                            {quiz.rounds?.length || 0} rounds  Created{\" \"}\n                            {new Date(quiz.createdAt).toLocaleDateString()}\n                          </Typography>\n                        }\n                      />\n                      <Typography\n                        variant=\"body2\"\n                        fontWeight=\"600\"\n                        color=\"primary.main\"\n                      >\n                        {formatSize(quiz.estimatedSize)}\n                      </Typography>\n                    </ListItem>\n                  </Fade>\n                ))}\n              </List>\n            )}\n          </Box>\n        </DialogContent>\n\n        {/* Actions */}\n        <DialogActions\n          sx={{\n            p: 3,\n            bgcolor: \"background.default\",\n            borderTop: 1,\n            borderColor: \"divider\",\n            gap: 2,\n          }}\n        >\n          <Button\n            onClick={handleCleanupClick}\n            startIcon={<CleanIcon />}\n            color=\"error\"\n            variant=\"outlined\"\n            disabled={quizzesWithSizes.length === 0}\n            sx={{\n              borderRadius: 2,\n              textTransform: \"none\",\n              fontWeight: 600,\n            }}\n          >\n            Clear All Storage\n          </Button>\n\n          <Box sx={{ flex: 1 }} />\n\n          <Button\n            onClick={onClose}\n            variant=\"contained\"\n            sx={{\n              borderRadius: 2,\n              textTransform: \"none\",\n              fontWeight: 600,\n              px: 4,\n            }}\n          >\n            OK\n          </Button>\n        </DialogActions>\n      </Dialog>\n\n      {/* Delete Confirmation Dialog */}\n      <Dialog\n        open={showDeleteConfirm}\n        onClose={handleCancelCleanup}\n        maxWidth=\"sm\"\n        fullWidth\n        TransitionComponent={Fade}\n      >\n        <DialogTitle sx={{ textAlign: \"center\", pt: 3 }}>\n          <WarningIcon sx={{ fontSize: 48, color: \"warning.main\", mb: 2 }} />\n          <Typography variant=\"h6\" fontWeight=\"600\">\n            Clear All Storage\n          </Typography>\n        </DialogTitle>\n\n        <DialogContent sx={{ textAlign: \"center\", pb: 2 }}>\n          <Typography variant=\"body1\" color=\"text.secondary\">\n            Are you sure you want to clear all quiz storage? This will\n            permanently delete <strong>ALL quizzes and drafts</strong> from your\n            device.\n          </Typography>\n          <Typography\n            variant=\"body2\"\n            color=\"error.main\"\n            sx={{ mt: 2, fontWeight: 600 }}\n          >\n            This action cannot be undone.\n          </Typography>\n        </DialogContent>\n\n        <DialogActions sx={{ p: 3, gap: 2 }}>\n          <Button\n            onClick={handleCancelCleanup}\n            variant=\"outlined\"\n            sx={{ borderRadius: 2, textTransform: \"none\", fontWeight: 600 }}\n            autoFocus\n          >\n            Cancel\n          </Button>\n          <Button\n            onClick={handleConfirmCleanup}\n            color=\"error\"\n            variant=\"contained\"\n            sx={{ borderRadius: 2, textTransform: \"none\", fontWeight: 600 }}\n          >\n            Clear All Storage\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nexport default StorageModal;\n","/**\n * Enhanced Quiz State Manager Hook\n *\n * Provides robust state synchronization with debugging and error recovery\n * for quiz management operations.\n *\n * @fileoverview Enhanced state manager for quiz operations\n * @version 1.0.0\n * @since December 2025\n */\n\nimport { useState, useEffect, useCallback, useRef } from \"react\";\nimport { useQuizStorage } from \"./useQuizStorage\";\nimport type { Quiz } from \"../types\";\n\n// Debug mode for development\nconst DEBUG_SYNC = process.env.NODE_ENV === \"development\";\n\n/**\n * Enhanced debug logging for state synchronization\n */\nconst debugLog = (operation: string, data: any) => {\n  if (DEBUG_SYNC) {\n    console.log(` [QuizStateManager] ${operation}:`, data);\n  }\n};\n\n/**\n * State synchronization status\n */\nexport type SyncStatus = \"idle\" | \"syncing\" | \"synced\" | \"error\";\n\n/**\n * Enhanced state manager interface\n */\nexport interface UseQuizStateManagerReturn {\n  // State data\n  quizzes: Quiz[];\n  drafts: Partial<Quiz>[];\n  isLoading: boolean;\n  syncStatus: SyncStatus;\n\n  // Operations with enhanced synchronization\n  deleteQuizWithSync: (id: string) => Promise<boolean>;\n  saveQuizWithSync: (quiz: Quiz) => Promise<boolean>;\n  forceRefreshAll: () => Promise<void>;\n\n  // Debug utilities\n  getDebugInfo: () => object;\n}\n\n/**\n * Enhanced Quiz State Manager Hook\n */\nexport const useQuizStateManager = (): UseQuizStateManagerReturn => {\n  const {\n    quizzes,\n    drafts,\n    isLoading,\n    deleteQuiz,\n    saveQuiz,\n    loadQuizzes,\n    loadDrafts,\n    refreshStorageUsage,\n    deleteDraft,\n  } = useQuizStorage();\n\n  const [syncStatus, setSyncStatus] = useState<SyncStatus>(\"idle\");\n  const lastSyncRef = useRef<number>(0);\n\n  /**\n   * Force refresh all data with comprehensive synchronization\n   */\n  const forceRefreshAll = useCallback(async (): Promise<void> => {\n    try {\n      setSyncStatus(\"syncing\");\n      debugLog(\"Force refresh all data\", { timestamp: Date.now() });\n\n      await Promise.all([loadQuizzes(), loadDrafts(), refreshStorageUsage()]);\n\n      lastSyncRef.current = Date.now();\n      setSyncStatus(\"synced\");\n\n      // Reset to idle after 2 seconds\n      setTimeout(() => setSyncStatus(\"idle\"), 2000);\n\n      debugLog(\"Force refresh completed\", {\n        quizzesCount: quizzes.length,\n        draftsCount: drafts.length,\n        timestamp: lastSyncRef.current,\n      });\n    } catch (error) {\n      debugLog(\"Force refresh failed\", error);\n      setSyncStatus(\"error\");\n\n      // Reset to idle after 5 seconds\n      setTimeout(() => setSyncStatus(\"idle\"), 5000);\n      throw error;\n    }\n  }, [\n    loadQuizzes,\n    loadDrafts,\n    refreshStorageUsage,\n    quizzes.length,\n    drafts.length,\n  ]);\n\n  /**\n   * Enhanced delete with comprehensive synchronization\n   * Now also deletes any draft with the same ID as the quiz being deleted.\n   * Ensures no ghost quizzes/drafts remain after deletion.\n   * Broadcasts a 'QUIZ_DELETED' event for cross-tab/modal cleanup.\n   */\n  const deleteQuizWithSync = useCallback(\n    async (id: string): Promise<boolean> => {\n      try {\n        setSyncStatus(\"syncing\");\n        debugLog(\"Delete quiz with sync\", { id, quizCount: quizzes.length });\n\n        // Delete the quiz from storage\n        const success = await deleteQuiz(id);\n\n        // Also delete any draft with the same ID\n        await deleteDraft(id);\n\n        // Broadcast deletion event for wizard cleanup (cross-tab)\n        try {\n          const bc = new window.BroadcastChannel(\"quizzard-quiz-events\");\n          bc.postMessage({ type: \"QUIZ_DELETED\", id });\n          bc.close();\n        } catch (e) {\n          // Fallback: no-op if BroadcastChannel not supported\n        }\n\n        // Reload quizzes and drafts\n        await loadQuizzes();\n        await loadDrafts();\n        await refreshStorageUsage();\n        setSyncStatus(\"idle\");\n        return success;\n      } catch (error) {\n        setSyncStatus(\"error\");\n        debugLog(\"Delete quiz with sync error\", error);\n        return false;\n      }\n    },\n    [\n      deleteQuiz,\n      deleteDraft,\n      loadQuizzes,\n      loadDrafts,\n      refreshStorageUsage,\n      quizzes.length,\n    ]\n  );\n\n  /**\n   * Enhanced save with comprehensive synchronization\n   */\n  const saveQuizWithSync = useCallback(\n    async (quiz: Quiz): Promise<boolean> => {\n      try {\n        setSyncStatus(\"syncing\");\n        debugLog(\"Save quiz with sync\", { id: quiz.id, title: quiz.title });\n\n        const success = await saveQuiz(quiz);\n\n        if (success) {\n          // Force complete data refresh\n          await forceRefreshAll();\n          debugLog(\"Save and refresh completed\", {\n            id: quiz.id,\n            title: quiz.title,\n          });\n          return true;\n        }\n\n        setSyncStatus(\"error\");\n        return false;\n      } catch (error) {\n        debugLog(\"Save with sync failed\", { id: quiz.id, error });\n        setSyncStatus(\"error\");\n        return false;\n      }\n    },\n    [saveQuiz, forceRefreshAll]\n  );\n\n  /**\n   * Get comprehensive debug information\n   */\n  const getDebugInfo = useCallback(() => {\n    return {\n      quizzesCount: quizzes.length,\n      draftsCount: drafts.length,\n      isLoading,\n      syncStatus,\n      lastSync: lastSyncRef.current,\n      lastSyncAge: Date.now() - lastSyncRef.current,\n      quizIds: quizzes.map((q) => q.id),\n      draftIds: drafts.map((d) => d.id),\n    };\n  }, [quizzes, drafts, isLoading, syncStatus]);\n\n  // Auto-refresh on component mount\n  useEffect(() => {\n    forceRefreshAll();\n  }, []);\n\n  return {\n    quizzes,\n    drafts,\n    isLoading,\n    syncStatus,\n    deleteQuizWithSync,\n    saveQuizWithSync,\n    forceRefreshAll,\n    getDebugInfo,\n  };\n};\n","/**\n * Quizzes Page State Management Hook with IndexedDB Storage\n *\n * Enhanced version of useQuizzesPageState that integrates IndexedDB storage\n * with auto-save functionality and storage usage monitoring.\n *\n * Features:\n * - IndexedDB storage with localStorage fallback\n * - Auto-save for draft quizzes\n * - Storage usage monitoring and warnings\n * - Enhanced error handling\n * - All original UI state management\n *\n * @fileoverview Enhanced state management hook with IndexedDB storage\n * @version 3.0.0\n * @since December 2025\n */\n\nimport React from \"react\";\nimport { useQuizStorage } from \"./useQuizStorage\";\nimport { useQuizStateManager } from \"./useQuizStateManager\";\nimport { useSnackbar } from \"../../../../shared/hooks/useSnackbar\";\nimport { indexedDBService } from \"../services/indexedDBService\";\nimport type { Quiz } from \"../types\";\nimport type { AutoSaveStatus } from \"./useQuizStorage\";\n\n/**\n * Enhanced state interface for Quizzes page with storage\n */\nexport interface QuizzesPageStateWithStorage {\n  // Error handling\n  errorDismissed: boolean;\n\n  // Wizard state\n  isWizardOpen: boolean;\n  editingQuiz: Quiz | null;\n\n  // Menu state\n  menuAnchorEl: HTMLElement | null;\n  selectedQuiz: Quiz | null;\n\n  // Delete confirmation state\n  deleteConfirmOpen: boolean;\n  pendingDeleteQuiz: Quiz | null;\n\n  // Storage state\n  autoSaveStatus: AutoSaveStatus;\n  storageWarningDismissed: boolean;\n}\n\n/**\n * Enhanced action handlers interface for Quizzes page with storage\n */\nexport interface QuizzesPageActionsWithStorage {\n  // Error handling\n  dismissError: () => void;\n  dismissStorageWarning: () => void;\n\n  // Quiz creation and editing\n  handleCreateQuiz: () => void;\n  handleEditQuiz: (quiz: Quiz) => void;\n  handleQuizCreated: (quiz: Quiz) => void;\n  handleWizardCancel: () => void;\n\n  // Quiz actions\n  handleExportQuiz: (quiz: Quiz, format: \"slides\" | \"json\") => void;\n\n  // Menu actions\n  handleMenuOpen: (event: React.MouseEvent<HTMLElement>, quiz: Quiz) => void;\n  handleMenuClose: () => void;\n\n  // Delete actions\n  handleRequestDeleteQuiz: (quiz: Quiz) => void;\n  handleConfirmDeleteQuiz: () => void;\n  handleCancelDeleteQuiz: () => void;\n\n  // Storage actions\n  handleCleanupDrafts: () => void;\n  handleRefreshStorage: () => void;\n\n  // New action for quiz deletion\n  handleQuizDeleted: () => void;\n}\n\n/**\n * Return type for the useQuizzesPageStateWithStorage hook\n */\nexport interface UseQuizzesPageStateWithStorageReturn {\n  // Quiz management state and actions from storage\n  quizzes: Quiz[];\n  drafts: Partial<Quiz>[];\n  isLoading: boolean;\n  error: string | null;\n  storageUsage: any; // StorageUsage type from storage hook\n  isInitialized: boolean;\n\n  // UI state\n  state: QuizzesPageStateWithStorage;\n\n  // Action handlers\n  actions: QuizzesPageActionsWithStorage;\n}\n\n/**\n * Enhanced Quizzes Page State Hook with IndexedDB Storage\n *\n * Manages all state and event handlers for the Quizzes page with\n * enhanced storage capabilities using IndexedDB and auto-save.\n *\n * @returns Object containing enhanced state, actions, and storage functionality\n */\nexport const useQuizzesPageStateWithStorage = (\n  onQuizDeleted?: () => void,\n  reloadKey?: number\n): UseQuizzesPageStateWithStorageReturn => {\n  // Storage hook for IndexedDB operations\n  const {\n    quizzes,\n    drafts,\n    isLoading,\n    storageUsage,\n    autoSaveStatus,\n    isInitialized,\n    saveQuiz,\n    deleteQuiz,\n    enableAutoSave,\n    disableAutoSave,\n    cleanupOldDrafts,\n    refreshStorageUsage,\n    loadQuizzes,\n    loadDrafts,\n  } = useQuizStorage();\n\n  // Export functionality removed - all exports coming soon\n\n  const { showSnackbar } = useSnackbar();\n\n  // Enhanced state manager for better synchronization\n  const { deleteQuizWithSync } = useQuizStateManager();\n\n  // UI state management\n  const [errorDismissed, setErrorDismissed] = React.useState<boolean>(false);\n  const [isWizardOpen, setIsWizardOpen] = React.useState<boolean>(false);\n  const [editingQuiz, setEditingQuiz] = React.useState<Quiz | null>(null);\n  const [menuAnchorEl, setMenuAnchorEl] = React.useState<HTMLElement | null>(\n    null\n  );\n  const [selectedQuiz, setSelectedQuiz] = React.useState<Quiz | null>(null);\n  const [deleteConfirmOpen, setDeleteConfirmOpen] = React.useState(false);\n  const [pendingDeleteQuiz, setPendingDeleteQuiz] = React.useState<Quiz | null>(\n    null\n  );\n\n  const [storageWarningDismissed, setStorageWarningDismissed] =\n    React.useState(false);\n\n  // Error state (can come from storage operations)\n  const [localError, setLocalError] = React.useState<string | null>(null);\n\n  // Reset dismissed state when error changes\n  React.useEffect(() => {\n    if (localError) {\n      setErrorDismissed(false);\n    }\n  }, [localError]);\n\n  // Reset storage warning when storage usage changes\n  React.useEffect(() => {\n    if (storageUsage?.isNearLimit) {\n      setStorageWarningDismissed(false);\n    }\n  }, [storageUsage?.isNearLimit]);\n\n  /**\n   * Handles dismissing error messages\n   */\n  const dismissError = React.useCallback(() => {\n    setErrorDismissed(true);\n    setLocalError(null);\n  }, []);\n\n  /**\n   * Handles dismissing storage warning\n   */\n  const dismissStorageWarning = React.useCallback(() => {\n    setStorageWarningDismissed(true);\n  }, []);\n\n  /**\n   * Handles opening the quiz creation wizard\n   */\n  const handleCreateQuiz = React.useCallback(() => {\n    setEditingQuiz(null);\n    setIsWizardOpen(true);\n  }, []);\n\n  /**\n   * Handles editing an existing quiz\n   */\n  const handleEditQuiz = React.useCallback((quiz: Quiz) => {\n    setEditingQuiz(quiz);\n    setIsWizardOpen(true);\n    setMenuAnchorEl(null);\n  }, []);\n\n  /**\n   * Handles quiz creation completion with IndexedDB storage\n   */\n  const handleQuizCreated = React.useCallback(\n    async (quiz: Quiz) => {\n      try {\n        // Set status to completed before saving\n        const completedQuiz: Quiz = {\n          ...quiz,\n          status: \"completed\",\n          updatedAt: new Date(),\n        };\n\n        const success = await saveQuiz(completedQuiz);\n\n        if (success) {\n          if (editingQuiz) {\n            showSnackbar(\"Quiz updated successfully!\", \"success\");\n          } else {\n            showSnackbar(\"Quiz created successfully!\", \"success\");\n          }\n\n          setIsWizardOpen(false);\n          setEditingQuiz(null);\n\n          // Disable auto-save since quiz is now completed\n          disableAutoSave();\n\n          // Refresh storage usage\n          await refreshStorageUsage();\n        } else {\n          throw new Error(\"Failed to save quiz to storage\");\n        }\n      } catch (error) {\n        const message =\n          error instanceof Error ? error.message : \"Failed to save quiz\";\n        setLocalError(message);\n        showSnackbar(message, \"error\");\n      }\n    },\n    [editingQuiz, saveQuiz, showSnackbar, disableAutoSave, refreshStorageUsage]\n  );\n\n  /**\n   * Handles wizard cancellation\n   */\n  const handleWizardCancel = React.useCallback(() => {\n    setIsWizardOpen(false);\n    setEditingQuiz(null);\n    disableAutoSave();\n  }, [disableAutoSave]);\n\n  /**\n   * Handles export requests (coming soon)\n   */\n  const handleExportQuiz = React.useCallback(\n    async (quiz: Quiz, format: \"slides\" | \"json\") => {\n      try {\n        // All export formats are currently disabled - coming soon\n        const formatNames = {\n          slides: \"Google Slides\",\n          json: \"JSON\",\n        };\n\n        showSnackbar(`${formatNames[format]} export coming soon!`, \"info\");\n        setMenuAnchorEl(null);\n      } catch (error) {\n        const message =\n          error instanceof Error ? error.message : \"Export failed\";\n        setLocalError(message);\n        showSnackbar(message, \"error\");\n      }\n    },\n    [showSnackbar]\n  );\n\n  /**\n   * Handles opening context menu for quiz actions\n   */\n  const handleMenuOpen = React.useCallback(\n    (event: React.MouseEvent<HTMLElement>, quiz: Quiz) => {\n      setMenuAnchorEl(event.currentTarget);\n      setSelectedQuiz(quiz);\n    },\n    []\n  );\n\n  /**\n   * Handles closing context menu\n   */\n  const handleMenuClose = React.useCallback(() => {\n    setMenuAnchorEl(null);\n    setSelectedQuiz(null);\n  }, []);\n\n  /**\n   * Handles requesting quiz deletion\n   */\n  const handleRequestDeleteQuiz = React.useCallback((quiz: Quiz) => {\n    setPendingDeleteQuiz(quiz);\n    setDeleteConfirmOpen(true);\n    setMenuAnchorEl(null);\n  }, []);\n\n  /**\n   * Handles confirming quiz deletion with enhanced sync and UI refresh\n   */\n  const handleConfirmDeleteQuiz = React.useCallback(async () => {\n    if (!pendingDeleteQuiz) return;\n\n    try {\n      const success = await deleteQuizWithSync(pendingDeleteQuiz.id);\n\n      if (success) {\n        showSnackbar(\"Quiz deleted successfully!\", \"success\");\n        if (onQuizDeleted) onQuizDeleted();\n      }\n    } catch (error) {\n      console.error(\"Error deleting quiz:\", error);\n      setLocalError(\"Failed to delete quiz\");\n    } finally {\n      setDeleteConfirmOpen(false);\n      setPendingDeleteQuiz(null);\n    }\n  }, [pendingDeleteQuiz, deleteQuizWithSync, showSnackbar, onQuizDeleted]);\n\n  /**\n   * Handles cancelling quiz deletion\n   */\n  const handleCancelDeleteQuiz = React.useCallback(() => {\n    setDeleteConfirmOpen(false);\n    setPendingDeleteQuiz(null);\n  }, []);\n\n  /**\n   * Handles cleanup of all storage (now directly executes - confirmation handled by StorageModal)\n   */\n  const handleCleanupDrafts = React.useCallback(async () => {\n    try {\n      // Use clearAllStorage to remove everything instead of just old drafts\n      const result = await indexedDBService.clearAllStorage();\n\n      if (result.success) {\n        showSnackbar(\"All storage cleared successfully!\", \"success\");\n\n        // Refresh storage usage and reload quizzes\n        await refreshStorageUsage();\n        await loadQuizzes(); // This will reload the quiz list\n        await loadDrafts(); // This will reload the drafts list\n      } else {\n        throw new Error(result.error || \"Failed to clear storage\");\n      }\n    } catch (error) {\n      const message =\n        error instanceof Error ? error.message : \"Failed to clear storage\";\n      setLocalError(message);\n      showSnackbar(message, \"error\");\n    }\n  }, [showSnackbar, refreshStorageUsage, loadQuizzes, loadDrafts]);\n\n  /**\n   * Handles refreshing storage usage\n   */\n  const handleRefreshStorage = React.useCallback(async () => {\n    try {\n      await refreshStorageUsage();\n      showSnackbar(\"Storage information refreshed\", \"info\");\n    } catch (error) {\n      const message =\n        error instanceof Error ? error.message : \"Failed to refresh storage\";\n      setLocalError(message);\n      showSnackbar(message, \"error\");\n    }\n  }, [refreshStorageUsage, showSnackbar]);\n\n  // Auto-save draft when editing\n  React.useEffect(() => {\n    if (isWizardOpen && editingQuiz) {\n      const draftQuiz = {\n        ...editingQuiz,\n        status: \"draft\" as const,\n        lastSaved: new Date(),\n      };\n      enableAutoSave(draftQuiz);\n    }\n\n    return () => {\n      if (!isWizardOpen) {\n        disableAutoSave();\n      }\n    };\n  }, [isWizardOpen, editingQuiz, enableAutoSave, disableAutoSave]);\n\n  // Effect: Reload quizzes and drafts from storage when reloadKey changes\n  React.useEffect(() => {\n    loadQuizzes();\n    loadDrafts();\n  }, [reloadKey]);\n\n  return {\n    // Storage state\n    quizzes,\n    drafts,\n    isLoading,\n    error: localError,\n    storageUsage,\n    isInitialized,\n\n    // UI state\n    state: {\n      errorDismissed,\n      isWizardOpen,\n      editingQuiz,\n      menuAnchorEl,\n      selectedQuiz,\n      deleteConfirmOpen,\n      pendingDeleteQuiz,\n      autoSaveStatus,\n      storageWarningDismissed,\n    },\n\n    // Action handlers\n    actions: {\n      dismissError,\n      dismissStorageWarning,\n      handleCreateQuiz,\n      handleEditQuiz,\n      handleQuizCreated,\n      handleWizardCancel,\n      handleExportQuiz,\n      handleMenuOpen,\n      handleMenuClose,\n      handleRequestDeleteQuiz,\n      handleConfirmDeleteQuiz,\n      handleCancelDeleteQuiz,\n      handleCleanupDrafts,\n      handleRefreshStorage,\n      handleQuizDeleted: () => {}, // Placeholder for handleQuizDeleted\n    },\n  };\n};\n","/**\n * Quizzes Main Page Component (REFACTORED + INDEXED DB)\n *\n * Primary interface for the Quizzes feature providing quiz creation, management,\n * and export functionality. Enhanced with IndexedDB storage, auto-save, and\n * storage monitoring capabilities.\n *\n * REFACTORING CHANGES:\n * - Extracted QuizCard component for individual quiz display\n * - Extracted QuizGrid component for layout and state management\n * - Extracted QuizActions component for interactions and modals\n * - Extracted useQuizzesPageState hook for state management\n * - Maintained 100% functionality and styling compatibility\n * - Improved maintainability and testability\n *\n * STORAGE ENHANCEMENTS:\n * - IndexedDB storage with localStorage fallback\n * - Auto-save functionality for drafts\n * - Storage usage monitoring and warnings\n * - 500MB storage capacity with media file support\n * - Draft management with cleanup\n *\n * Features:\n * - Quiz creation wizard integration\n * - Quiz library management and search\n * - PowerPoint export functionality\n * - Mobile-first responsive design\n * - Beautiful dashboard interface\n * - Quiz statistics and analytics\n * - Storage status monitoring\n *\n * @fileoverview Enhanced main page component with IndexedDB storage\n * @version 3.0.0 (IndexedDB Enhanced)\n * @since December 2025\n */\n\nimport React from \"react\";\nimport {\n  Box,\n  Typography,\n  Button,\n  Container,\n  Alert,\n  IconButton,\n} from \"@mui/material\";\nimport {\n  Add as AddIcon,\n  Close as CloseIcon,\n  Storage as StorageIcon,\n} from \"@mui/icons-material\";\nimport { QuizGrid, QuizActions } from \"../management/components\";\nimport { StorageModal } from \"../management/components/StorageStatus\";\nimport { useQuizzesPageStateWithStorage } from \"../management/hooks\";\nimport type { QuizzesPageProps } from \"../types\";\nimport type { Quiz, QuizCategory, QuizDifficulty, Round } from \"../types\";\nimport { ErrorBoundary } from \"../../../shared/components\";\nimport { useGoogleAuth } from \"../../../shared/hooks/useGoogleAuth\";\n\n/**\n * Main Quizzes Page Component (ENHANCED WITH STORAGE)\n *\n * Provides comprehensive quiz management interface using extracted components\n * and hooks with IndexedDB storage capabilities. Now includes storage monitoring\n * and auto-save functionality.\n *\n * @returns JSX element representing the quizzes page\n */\nexport const Quizzes: React.FC<QuizzesPageProps> = () => {\n  const { isAuthenticated } = useGoogleAuth();\n\n  /**\n   * Robust reload mechanism for quiz deletion\n   *\n   * When a quiz is deleted (from any source), increment reloadKey to force the\n   * useQuizzesPageStateWithStorage hook to re-fetch quizzes and drafts from storage.\n   * This ensures the UI always reflects the latest state and prevents ghost quizzes.\n   */\n  const [reloadKey, setReloadKey] = React.useState(0);\n  const reloadQuizzes = React.useCallback(() => {\n    setReloadKey((prev) => prev + 1);\n  }, []);\n\n  // Use storage-enhanced state management hook, pass reloadQuizzes as onQuizDeleted\n  const { quizzes, drafts, isLoading, error, state, actions, storageUsage } =\n    useQuizzesPageStateWithStorage(reloadQuizzes, reloadKey);\n\n  // Storage modal state\n  const [storageModalOpen, setStorageModalOpen] = React.useState(false);\n\n  // Helper to get the full quiz object by ID (from quizzes or drafts)\n  const getFullQuizObject = React.useCallback(\n    (quizId: string) => {\n      const allOriginalQuizzes: (Quiz | Partial<Quiz>)[] = [\n        ...quizzes,\n        ...drafts,\n      ];\n      return allOriginalQuizzes.find(\n        (q) => q && String(q.id) === String(quizId)\n      );\n    },\n    [quizzes, drafts]\n  );\n\n  const handleExportWrapper = React.useCallback(\n    (quiz: Quiz) => {\n      const fullQuiz = getFullQuizObject(quiz.id);\n      if (fullQuiz) {\n        actions.handleExportQuiz(fullQuiz as Quiz);\n      } else {\n        console.error(\n          `Could not find full quiz object with id: ${quiz.id} for export.`\n        );\n      }\n    },\n    [actions, getFullQuizObject]\n  );\n\n  const handleEditWrapper = React.useCallback(\n    (quiz: Quiz) => {\n      const fullQuiz = getFullQuizObject(quiz.id);\n      if (fullQuiz) {\n        actions.handleEditQuiz(fullQuiz as Quiz);\n      } else {\n        console.error(\n          `Could not find full quiz object with id: ${quiz.id} for edit.`\n        );\n      }\n    },\n    [actions, getFullQuizObject]\n  );\n\n  const handleMenuOpenWrapper = React.useCallback(\n    (event: React.MouseEvent<HTMLElement>, quiz: Quiz) => {\n      const fullQuiz = getFullQuizObject(quiz.id);\n      if (fullQuiz) {\n        actions.handleMenuOpen(event, fullQuiz as Quiz);\n      } else {\n        console.error(\n          `Could not find full quiz object with id: ${quiz.id} for menu.`\n        );\n      }\n    },\n    [actions, getFullQuizObject]\n  );\n\n  // Combine quizzes and drafts for display\n  const allQuizzes = React.useMemo(() => {\n    // Helper to validate category\n    const validCategories: QuizCategory[] = [\n      \"general\",\n      \"sports\",\n      \"history\",\n      \"science\",\n      \"geography\",\n      \"entertainment\",\n      \"literature\",\n      \"art\",\n      \"music\",\n      \"technology\",\n      \"custom\",\n    ];\n    const sanitizeCategory = (cat: unknown): QuizCategory => {\n      if (\n        typeof cat === \"string\" &&\n        validCategories.includes(cat as QuizCategory)\n      ) {\n        return cat as QuizCategory;\n      }\n      return \"general\";\n    };\n\n    // Helper to sanitize difficulty\n    const sanitizeDifficulty = (diff: unknown): QuizDifficulty => {\n      if (\n        typeof diff === \"string\" &&\n        [\"easy\", \"medium\", \"hard\"].includes(diff)\n      ) {\n        return diff as QuizDifficulty;\n      }\n      return \"medium\";\n    };\n\n    // Helper to sanitize estimated duration\n    const sanitizeDuration = (duration: unknown): number => {\n      if (typeof duration === \"number\" && !isNaN(duration)) {\n        return Math.max(1, Math.min(1000, duration)); // Clamp between 1-1000 minutes\n      }\n      if (\n        duration &&\n        typeof duration === \"object\" &&\n        \"valueOf\" in duration &&\n        typeof duration.valueOf === \"function\"\n      ) {\n        const value = duration.valueOf();\n        if (typeof value === \"number\" && !isNaN(value)) {\n          return Math.max(1, Math.min(1000, value));\n        }\n      }\n      return 10; // Default 10 minutes\n    };\n\n    // Helper to sanitize dates\n    const sanitizeDate = (date: unknown): Date => {\n      if (date instanceof Date) {\n        return date;\n      }\n      if (typeof date === \"string\" || typeof date === \"number\") {\n        const parsed = new Date(date);\n        if (!isNaN(parsed.getTime())) {\n          return parsed;\n        }\n      }\n      return new Date();\n    };\n\n    // Helper to sanitize settings\n    const sanitizeSettings = (settings: unknown) => {\n      const defaultSettings = {\n        defaultTimeLimit: 1,\n        defaultPoints: 1,\n        defaultBreakingTime: 5,\n      };\n\n      if (settings && typeof settings === \"object\") {\n        const settingsObj = settings as Record<string, unknown>;\n        return {\n          defaultTimeLimit:\n            typeof settingsObj.defaultTimeLimit === \"number\"\n              ? settingsObj.defaultTimeLimit\n              : defaultSettings.defaultTimeLimit,\n          defaultPoints:\n            typeof settingsObj.defaultPoints === \"number\"\n              ? settingsObj.defaultPoints\n              : defaultSettings.defaultPoints,\n          defaultBreakingTime:\n            typeof settingsObj.defaultBreakingTime === \"number\"\n              ? settingsObj.defaultBreakingTime\n              : defaultSettings.defaultBreakingTime,\n        };\n      }\n      return defaultSettings;\n    };\n\n    // Helper to sanitize rounds\n    const sanitizeRounds = (rounds: unknown): Round[] => {\n      if (Array.isArray(rounds)) {\n        return rounds.filter(\n          (round) => round && typeof round === \"object\"\n        ) as Round[];\n      }\n      return [];\n    };\n\n    // Helper to sanitize tags\n    const sanitizeTags = (tags: unknown): string[] => {\n      if (Array.isArray(tags)) {\n        return tags.filter((tag) => typeof tag === \"string\").slice(0, 10); // Limit to 10 tags\n      }\n      return [];\n    };\n\n    const defaultSettings = {\n      defaultTimeLimit: 1,\n      defaultPoints: 1,\n      defaultBreakingTime: 5,\n    };\n\n    // Convert drafts to Quiz format with isDraft flag\n    const draftQuizzes = drafts\n      .filter((draft) => draft && draft.id && draft.title)\n      .map((draft) => ({\n        ...draft,\n        id: String(draft.id || \"\"),\n        title: String(draft.title || \"Untitled Draft\"),\n        description: String(draft.description || \"Draft quiz in progress...\"),\n        rounds: sanitizeRounds(draft.rounds),\n        category: sanitizeCategory(draft.category),\n        difficulty: sanitizeDifficulty(draft.difficulty),\n        tags: sanitizeTags((draft as unknown as Record<string, unknown>).tags),\n        status: \"draft\" as const,\n        createdAt: sanitizeDate(draft.createdAt),\n        updatedAt: sanitizeDate(draft.updatedAt),\n        isDraft: true,\n        estimatedDuration: sanitizeDuration(draft.estimatedDuration),\n        settings: sanitizeSettings(draft.settings),\n      }));\n\n    // Filter out any draft whose ID matches a quiz (prevents ghost/duplicate quizzes)\n    const quizIds = new Set(quizzes.map((q) => String(q.id)));\n    const filteredDraftQuizzes = draftQuizzes.filter(\n      (draft) => !quizIds.has(draft.id)\n    );\n\n    // Combine and sort by most recently updated\n    return [...quizzes, ...filteredDraftQuizzes]\n      .map((q) => ({\n        ...q,\n        id: String(q.id || \"\"),\n        title: String(q.title || \"Untitled Quiz\"),\n        description: String(q.description || \"\"),\n        rounds: sanitizeRounds(q.rounds),\n        estimatedDuration: sanitizeDuration(q.estimatedDuration),\n        createdAt: sanitizeDate(q.createdAt),\n        updatedAt: sanitizeDate(q.updatedAt),\n        category: sanitizeCategory(q.category),\n        difficulty: sanitizeDifficulty(q.difficulty),\n        tags: sanitizeTags((q as unknown as Record<string, unknown>).tags),\n        settings: sanitizeSettings(q.settings),\n      }))\n      .sort(\n        (a, b) =>\n          new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime()\n      );\n  }, [quizzes, drafts]);\n\n  const totalQuizCount = allQuizzes.length;\n\n  // Only show info if currentRound is defined and type is golden-pyramid\n  const currentRound = state.selectedQuiz?.rounds.find(\n    (round) => round.type === \"golden-pyramid\"\n  );\n\n  return (\n    <ErrorBoundary\n      fallback={\n        <Alert severity=\"error\">\n          Something went wrong in the quiz list. Please refresh the page.\n        </Alert>\n      }\n    >\n      <Container maxWidth=\"xl\" sx={{ py: 3 }}>\n        {/* Header section */}\n        <Box mb={4}>\n          <Typography variant=\"h4\" component=\"h1\" gutterBottom>\n            My Quizzes ({totalQuizCount})\n          </Typography>\n\n          {/* Login warning message */}\n          {!isAuthenticated && (\n            <Alert\n              severity=\"info\"\n              sx={{\n                mt: 2,\n                backgroundColor: (theme) =>\n                  theme.palette.mode === \"dark\"\n                    ? \"rgba(2, 136, 209, 0.1)\"\n                    : \"rgba(2, 136, 209, 0.05)\",\n                \"& .MuiAlert-icon\": {\n                  color: (theme) => theme.palette.info.main,\n                },\n              }}\n            >\n              Sign in to save your quizzes and access them across devices. Open\n              the menu to log in.\n            </Alert>\n          )}\n        </Box>\n\n        {/* Error display */}\n        {error && !state.errorDismissed && (\n          <Alert\n            severity=\"error\"\n            sx={{ mb: 3 }}\n            action={\n              <IconButton\n                size=\"small\"\n                onClick={actions.dismissError}\n                aria-label=\"Dismiss error\"\n              >\n                <CloseIcon fontSize=\"small\" />\n              </IconButton>\n            }\n          >\n            {error}\n          </Alert>\n        )}\n\n        {/* Storage warning */}\n        {storageUsage?.isNearLimit && !state.storageWarningDismissed && (\n          <Alert\n            severity=\"warning\"\n            sx={{ mb: 3 }}\n            action={\n              <IconButton\n                size=\"small\"\n                onClick={actions.dismissStorageWarning}\n                aria-label=\"Dismiss storage warning\"\n              >\n                <CloseIcon fontSize=\"small\" />\n              </IconButton>\n            }\n          >\n            Storage is nearly full (\n            {(() => {\n              const usage = storageUsage?.usagePercentage;\n              if (typeof usage === \"number\" && !isNaN(usage)) {\n                return Math.round(Math.max(0, Math.min(100, usage)));\n              }\n              return 0;\n            })()}\n            % used). Consider cleaning up old drafts or exporting quizzes to\n            free up space.\n          </Alert>\n        )}\n\n        {/* Action Buttons - only show when we have quizzes */}\n        {totalQuizCount > 0 && (\n          <Box\n            sx={{\n              mb: 4,\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n            }}\n          >\n            <Button\n              variant=\"contained\"\n              startIcon={<AddIcon />}\n              onClick={actions.handleCreateQuiz}\n              sx={{\n                borderRadius: 2,\n                textTransform: \"none\",\n                fontWeight: 600,\n              }}\n            >\n              <Box\n                component=\"span\"\n                sx={{\n                  display: { xs: \"none\", sm: \"inline\" },\n                }}\n              >\n                Create New Quiz\n              </Box>\n              <Box\n                component=\"span\"\n                sx={{\n                  display: { xs: \"inline\", sm: \"none\" },\n                }}\n              >\n                Create\n              </Box>\n            </Button>\n            <Button\n              variant=\"outlined\"\n              startIcon={<StorageIcon />}\n              onClick={() => setStorageModalOpen(true)}\n              sx={{\n                borderRadius: 2,\n                textTransform: \"none\",\n                fontWeight: 600,\n              }}\n            >\n              Storage\n            </Button>\n          </Box>\n        )}\n\n        {/* Quizzes grid - now using extracted component */}\n        <ErrorBoundary>\n          <QuizGrid\n            quizzes={allQuizzes}\n            isLoading={isLoading}\n            onCreateQuiz={actions.handleCreateQuiz}\n            onMenuOpen={handleMenuOpenWrapper}\n            onExport={handleExportWrapper}\n            onEdit={handleEditWrapper}\n          />\n        </ErrorBoundary>\n\n        {/* Quiz actions - now using extracted component */}\n        <QuizActions\n          selectedQuiz={state.selectedQuiz}\n          menuAnchorEl={state.menuAnchorEl}\n          editingQuiz={state.editingQuiz}\n          isWizardOpen={state.isWizardOpen}\n          deleteConfirmOpen={state.deleteConfirmOpen}\n          pendingDeleteQuiz={state.pendingDeleteQuiz}\n          onMenuClose={actions.handleMenuClose}\n          onEditQuiz={actions.handleEditQuiz}\n          onExportQuiz={actions.handleExportQuiz}\n          onRequestDeleteQuiz={actions.handleRequestDeleteQuiz}\n          onConfirmDeleteQuiz={actions.handleConfirmDeleteQuiz}\n          onCancelDeleteQuiz={actions.handleCancelDeleteQuiz}\n          onCreateQuiz={actions.handleCreateQuiz}\n          onWizardCancel={actions.handleWizardCancel}\n          onQuizCreated={actions.handleQuizCreated}\n        />\n\n        {/* Storage Modal */}\n        <StorageModal\n          open={storageModalOpen}\n          onClose={() => setStorageModalOpen(false)}\n          storageUsage={storageUsage}\n          quizzes={allQuizzes}\n          draftsCount={drafts.length}\n          onCleanupStorage={actions.handleCleanupDrafts}\n          onRefreshStorage={actions.handleRefreshStorage}\n        />\n      </Container>\n    </ErrorBoundary>\n  );\n};\n\n// Add default export for React.lazy()\nexport default Quizzes;\n"],"file":"assets/Quizzes-pFEsjht7.js"}