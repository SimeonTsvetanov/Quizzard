var V=Object.defineProperty;var Y=(e,t,n)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var P=(e,t,n)=>Y(e,typeof t!="symbol"?t+"":t,n);import{r as h,j as i,B as f,v as w,ao as Q,o as X,p as Z,ag as k,I as L,R as ee,a8 as te,Q as ne,q as ie,a2 as se,aY as re,aZ as ae,a_ as oe,O as A,a$ as le,aW as ce,z as ue,aF as de,S as ge,az as G,aA as D,aB as $,aC as b,a3 as he,s as fe}from"./mui-BQKkqNmK.js";import{u as me}from"./useSnackbar-DQ6Syohs.js";import"./vendor-Csw2ODfV.js";const v={MAX_REQUESTS_PER_MINUTE:15,RATE_LIMIT_WINDOW:6e4,MIN_REQUEST_INTERVAL:4e3};class pe{constructor(){P(this,"lastRequestTime",0);P(this,"requestCount",0)}checkRateLimit(){const t=Date.now();t-this.lastRequestTime>v.RATE_LIMIT_WINDOW&&(this.requestCount=0);const n=Math.max(0,v.MAX_REQUESTS_PER_MINUTE-this.requestCount),r=Math.max(0,v.RATE_LIMIT_WINDOW-(t-this.lastRequestTime));if(this.requestCount>=v.MAX_REQUESTS_PER_MINUTE){const s=Math.ceil(r/1e3);return{isRateLimited:!0,retryAfter:s,message:`Rate limit reached (${v.MAX_REQUESTS_PER_MINUTE}/minute). Please wait ${s} seconds.`,requestsRemaining:0,timeUntilReset:s,isNearLimit:!0}}const a=t-this.lastRequestTime;if(a<v.MIN_REQUEST_INTERVAL&&this.requestCount>0){const s=v.MIN_REQUEST_INTERVAL-a,u=Math.ceil(s/1e3);return{isRateLimited:!0,retryAfter:u,message:`Please wait ${u} seconds between requests to avoid rate limits.`,requestsRemaining:n,timeUntilReset:Math.ceil(r/1e3),isNearLimit:n<=3}}return{isRateLimited:!1,requestsRemaining:n,timeUntilReset:Math.ceil(r/1e3),isNearLimit:n<=3}}recordRequest(){this.requestCount++,this.lastRequestTime=Date.now()}getStatus(){return this.checkRateLimit()}}const O=new pe,ye=async(e,t)=>{for(let n=e;n>0;n--)t&&t(n),await new Promise(r=>setTimeout(r,1e3))},we=()=>O.checkRateLimit(),xe=()=>{O.recordRequest()},Ie=()=>O.getStatus(),be=async e=>{const t=we();t.isRateLimited&&t.retryAfter&&(e?(await ye(t.retryAfter,n=>{e(`Please wait ${n} second${n!==1?"s":""} before generating another question...`,!0)}),e("Generating your question...",!1)):await new Promise(n=>setTimeout(n,t.retryAfter*1e3)))},ve=e=>{const{difficulty:t,language:n,category:r,previousQuestions:a}=e,s=qe(n),u=Ee(r),o=je(t),m=Ce(a),g=Re(r);return`You are an expert quiz master with access to accurate, up-to-date information. Generate a single quiz question and its answer.

${s}
${u}
${o}
${g}
${m}

CRITICAL REQUIREMENTS:
- The answer must be 100% factually correct and verifiable
- For geographic questions, double-check all facts (heights, locations, names)
- Avoid controversial or ambiguous topics
- Make the question engaging and educational
- Ensure the question is unique and not repetitive

IMPORTANT: Respond ONLY with a valid JSON object in this exact format:
{
  "question": "Your generated question here",
  "answer": "The correct answer here", 
  "category": "The category of the question",
  "difficulty": "${t}"
}

Do not include any other text, explanations, or formatting outside the JSON object.`};function qe(e){switch(e.toLowerCase()){case"bulgarian":case"bg":return"Generate the question and answer in Bulgarian language. Use proper Bulgarian Cyrillic characters and grammar.";case"english":case"en":default:return"Generate the question and answer in English language."}}function Ee(e){return!e||e.toLowerCase()==="random"?"Choose a random general knowledge topic from areas like geography, history, science, literature, arts, sports, or current events.":`Generate a question about the category: ${e}. Stay focused on this topic while ensuring the question is interesting and educational.`}function je(e){switch(e.toLowerCase()){case"easy":return`Make this an EASY question that most people would know. Use basic, well-known facts that are:
- Commonly taught in elementary or high school
- Widely known in popular culture
- Basic geographical locations (capitals, famous landmarks)
- Simple historical events or dates
- Fundamental scientific concepts`;case"hard":return`Make this a HARD question that requires specialized knowledge or expertise. Include:
- Advanced technical or scientific concepts
- Obscure historical details or lesser-known events
- Specialized terminology or professional knowledge
- Complex relationships between concepts
- Details that require deep study or research to know`;case"medium":default:return`Make this a MEDIUM difficulty question that requires some general knowledge and thinking. It should be:
- Challenging but not impossible for an educated person
- More than basic facts but not requiring specialized expertise
- Encouraging critical thinking or making connections
- Accessible to someone with good general knowledge
- Engaging and educational without being frustrating`}}function Ce(e){return e.length===0?"":`

IMPORTANT: Do NOT repeat any of these recently asked questions. Generate something completely different:
${e.slice(-10).map((n,r)=>`${r+1}. ${n.question}`).join(`
`)}`}function Re(e){const t=e.toLowerCase();return t.includes("geography")||t.includes("смолян")||t.includes("bulgaria")||t.includes("mountain")||t.includes("peak")||t.includes("geographic")?`
FACT-CHECKING FOR GEOGRAPHY: 
- For Bulgarian geography: Verify all mountain peaks, heights, and locations
- For Smolyan region: The highest peak near Smolyan is Perelik (2,191m), NOT Snezhanka
- Snezhanka is near Pamporovo but is NOT the highest peak in the Smolyan area
- Always verify geographical facts against reliable sources
- Double-check all numerical data (heights, distances, populations)
- Confirm current political boundaries and country names`:t.includes("history")||t.includes("historical")?`
FACT-CHECKING FOR HISTORY: 
- Verify all dates, names, and historical events
- Ensure chronological accuracy and cause-effect relationships
- Cross-reference multiple historical sources
- Avoid disputed historical interpretations
- Confirm spelling of historical figures and places`:t.includes("science")||t.includes("scientific")||t.includes("physics")||t.includes("chemistry")||t.includes("biology")?`
FACT-CHECKING FOR SCIENCE: 
- Verify all scientific facts, figures, and formulas
- Ensure laws and theories are correctly stated
- Use current scientific understanding and discoveries
- Double-check units of measurement and calculations
- Avoid outdated scientific information`:`
FACT-CHECKING: 
- Verify all facts before including them in the question
- Use reliable, authoritative sources for verification
- Avoid outdated, disputed, or controversial information
- Double-check numerical data and proper names
- Ensure information is current and accurate`}const S={temperature:.9,topK:40,topP:.95,maxOutputTokens:1024},Te=()=>!!navigator.onLine;function Ae(){const e="AIzaSyAzhUzT7hqprvBPcz96iN8j0zdAw84pBb4";if(e.length<20)throw new Error("Invalid API configuration. Please contact support.");return e}function Se(e){const{prompt:t,temperature:n=S.temperature,topK:r=S.topK,topP:a=S.topP,maxOutputTokens:s=S.maxOutputTokens}=e;return{contents:[{parts:[{text:t}]}],generationConfig:{temperature:n,topK:r,topP:a,maxOutputTokens:s}}}const U=async(e,t)=>{if(!navigator.onLine)throw new Error("Internet connection required");const n=Ae(),r=Se(e);try{t&&t("Contacting AI service...",!1);const a=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});a.ok||await ke(a,e,t);const s=await a.json();if(!s.candidates||s.candidates.length===0)throw new Error("No response generated from AI service");const u=s.candidates[0].content.parts[0].text;if(!u||typeof u!="string")throw new Error("Invalid response format from AI service");return u}catch(a){throw console.error("Gemini API error:",a),a instanceof Error?a:new Error("Failed to generate question. Please try again.")}};async function ke(e,t,n){var s;let r={};try{r=await e.json()}catch{}if(e.status===429){if(n){n("API rate limit reached. Waiting 4 seconds before retrying...",!0);for(let o=4;o>0;o--)n(`API rate limit reached. Retrying in ${o} second${o!==1?"s":""}...`,!0),await new Promise(m=>setTimeout(m,1e3));n("Retrying your request...",!1)}else await new Promise(o=>setTimeout(o,4*1e3));return U(t,n)}const a=((s=r.error)==null?void 0:s.message)||"Unknown API error";switch(e.status){case 400:throw new Error(`Invalid request: ${a}`);case 401:throw new Error("API key is invalid or expired");case 403:throw new Error("API access forbidden - check your API key permissions");case 404:throw new Error("AI service endpoint not found");case 500:case 502:case 503:case 504:throw new Error("AI service is temporarily unavailable. Please try again.");default:throw new Error(`API error (${e.status}): ${a}`)}}const Le=e=>{try{const t=Qe(e),n=Me(t);return n.isValid?(n.warnings.length>0,Pe(t)):(console.warn("Question data validation failed:",n.errors),_())}catch(t){return console.error("Failed to parse Gemini response:",{error:t instanceof Error?t.message:"Unknown error",responseText:e.substring(0,200)+"..."}),_()}};function Qe(e){const t=e.trim();if(!t)throw new Error("Empty response text");try{const a=JSON.parse(t);if(N(a))return a}catch{}const n=t.match(/\{[\s\S]*\}/);if(n)try{const a=JSON.parse(n[0]);if(N(a))return a}catch{}const r=t.match(/\{[^}]*"question"[^}]*\}/s);if(r)try{const a=JSON.parse(r[0]);if(N(a))return a}catch{}throw new Error("No valid JSON structure found in response")}function N(e){return e&&typeof e=="object"&&typeof e.question=="string"&&typeof e.answer=="string"}function Me(e){const t=[],n=[];(!e.question||e.question.trim().length<10)&&t.push("Question text is missing or too short"),(!e.answer||e.answer.trim().length<1)&&t.push("Answer text is missing"),e.question&&e.question.length>500&&n.push("Question is unusually long"),e.answer&&e.answer.length>200&&n.push("Answer is unusually long"),(!e.category||e.category.trim().length===0)&&n.push("Category is missing, will use default");const r=["easy","medium","hard"];return(!e.difficulty||!r.includes(e.difficulty.toLowerCase()))&&n.push("Invalid difficulty, will use default"),e.question&&!e.question.trim().endsWith("?")&&n.push("Question does not end with a question mark"),{isValid:t.length===0,errors:t,warnings:n}}function Pe(e){var s;const t=e.question.trim(),n=e.answer.trim(),r=((s=e.category)==null?void 0:s.trim())||"General Knowledge",a=Ne(e.difficulty);return{id:B(),question:t,answer:n,category:r,difficulty:a}}function Ne(e){switch(e==null?void 0:e.toLowerCase().trim()){case"easy":case"simple":case"beginner":return"easy";case"hard":case"difficult":case"expert":case"advanced":return"hard";case"medium":case"moderate":case"intermediate":default:return"medium"}}function B(){return Math.random().toString(36).substring(2,9)}function _(){const e=[{question:"What is the capital of France?",answer:"Paris",category:"Geography",difficulty:"easy"},{question:"Who wrote the play 'Romeo and Juliet'?",answer:"William Shakespeare",category:"Literature",difficulty:"easy"},{question:"What is the largest planet in our solar system?",answer:"Jupiter",category:"Science",difficulty:"easy"}],t=Math.floor(Math.random()*e.length),n=e[t];return{id:B(),...n}}const z=async(e={},t)=>{try{await be(t);const n=ve({difficulty:e.difficulty||"medium",language:e.language||"English",category:e.category||"random",previousQuestions:e.previousQuestions||[]}),r=await U({prompt:n},t);return xe(),Le(r)}catch(n){throw console.error("Question generation error:",n),n instanceof Error?n:new Error("Failed to generate question. Please try again.")}},Oe=()=>{const[e,t]=h.useState(null),[n,r]=h.useState(!1),[a,s]=h.useState(!1),[u,o]=h.useState(""),[m,g]=h.useState(null),[E,R]=h.useState(navigator.onLine),[x,j]=h.useState(!1),[M,y]=h.useState({requestsRemaining:15,timeUntilReset:0,isNearLimit:!1}),[p,T]=h.useState({difficulty:"",language:"",category:""}),[C,q]=h.useState([]);h.useEffect(()=>{const c=()=>R(!0),l=()=>R(!1);return window.addEventListener("online",c),window.addEventListener("offline",l),()=>{window.removeEventListener("online",c),window.removeEventListener("offline",l)}},[]),h.useEffect(()=>{const c=()=>{y(Ie())};c();const l=setInterval(c,1e3);return()=>clearInterval(l)},[]),h.useEffect(()=>{x||q([])},[x]);const d=(c,l)=>{o(c),s(l),l||r(!0)},F=async()=>{if(!E){g("Internet connection required to generate questions");return}if(!Te()){g("AI service is not available. Please check your connection.");return}r(!0),s(!1),g(null),o("Preparing to generate question...");try{const l={difficulty:p.difficulty||"medium",language:p.language||"English",category:p.category||"random",previousQuestions:C},I=await z(l,d);t(I),o("Question generated successfully!"),q(W=>[...W,{question:I.question,answer:I.answer}].slice(-20)),setTimeout(()=>{o("")},2e3)}catch(l){const I=l instanceof Error?l.message:"Failed to generate question";g(I),o(""),console.error("Question generation error:",l)}finally{r(!1),s(!1)}},H=async()=>{if(!e){await F();return}if(!E){g("Internet connection required to refresh questions");return}r(!0),s(!1),g(null),o("Refreshing question...");try{const c={difficulty:p.difficulty||e.difficulty||"medium",language:p.language||"English",category:p.category||e.category||"random",previousQuestions:C},l=await z(c,d);t(l),o("Question refreshed successfully!"),q(I=>[...I,{question:l.question,answer:l.answer}].slice(-20)),setTimeout(()=>{o("")},2e3)}catch(c){const l=c instanceof Error?c.message:"Failed to refresh question";g(l),o(""),console.error("Question refresh error:",c)}finally{r(!1),s(!1)}},K=c=>{T(l=>({...l,...c})),g(null)},J=()=>{T({difficulty:"",language:"",category:""}),g(null),o(""),q([])};return{question:e,isLoading:n,isWaiting:a,statusMessage:u,error:m,isOnline:E,isModalOpen:x,rateLimitInfo:M,sessionQuestionCount:C.length,setIsModalOpen:j,generateNewQuestion:F,refreshQuestion:H,settings:p,updateSettings:K,clearSettings:J}},Fe=({question:e,isRefreshing:t=!1})=>i.jsxs(f,{sx:{p:2,bgcolor:"background.default",borderRadius:2,boxShadow:n=>n.shadows[2],opacity:t?.5:1,transform:t?"scale(0.98)":"scale(1)",transition:"all 0.3s ease-in-out","&:hover":{boxShadow:n=>n.shadows[4],transform:t?"scale(0.98)":"translateY(-2px)"}},children:[i.jsxs(w,{variant:"h6",fontWeight:600,color:"primary.main",sx:{mb:2,display:"flex",alignItems:"center",gap:.5},children:["❓ ",e.question]}),i.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:1,mb:2},children:[i.jsx(w,{variant:"subtitle2",color:"text.secondary",sx:{fontWeight:500},children:"Answer:"}),i.jsx(w,{variant:"body1",color:"text.primary",sx:{fontSize:"1rem",lineHeight:1.5},children:e.answer})]}),i.jsxs(f,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:2},children:[e.category&&i.jsx(Q,{label:e.category,size:"small",color:"primary",variant:"outlined"}),e.difficulty&&i.jsx(Q,{label:e.difficulty,size:"small",color:e.difficulty==="easy"?"success":e.difficulty==="medium"?"warning":"error",variant:"outlined"})]})]}),We=({open:e,question:t,isRefreshing:n,isGenerating:r,onClose:a,onRefresh:s,onCopy:u})=>i.jsxs(X,{open:e,onClose:a,maxWidth:"sm",fullWidth:!0,"aria-labelledby":"final-question-modal-title",disableRestoreFocus:!0,PaperProps:{sx:{borderRadius:2,maxHeight:"90vh"}},children:[i.jsxs(Z,{id:"final-question-modal-title",sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pb:1},children:[i.jsx(w,{variant:"h6",component:"div",children:"Final Question"}),i.jsxs(f,{sx:{display:"flex",gap:1},children:[i.jsx(k,{title:"Generate new question",children:i.jsx("span",{children:i.jsx(L,{onClick:s,disabled:r||n,size:"small","aria-label":"Generate new question",children:i.jsx(ee,{})})})}),i.jsx(k,{title:"Copy question",children:i.jsx("span",{children:i.jsx(L,{onClick:u,disabled:!t,size:"small","aria-label":"Copy question",children:i.jsx(te,{})})})}),i.jsx(k,{title:"Close",children:i.jsx(L,{onClick:a,size:"small","aria-label":"Close modal",children:i.jsx(ne,{})})})]})]}),i.jsx(ie,{id:"final-question-modal-content",sx:{pt:1},children:t?i.jsx(f,{sx:{opacity:n?.5:1,transform:n?"scale(0.98)":"scale(1)",transition:"all 0.3s ease-in-out"},children:i.jsx(Fe,{question:t,isRefreshing:n})}):i.jsx(f,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:200,textAlign:"center"},children:i.jsx(w,{variant:"body1",color:"text.secondary",children:"No question generated yet."})})})]}),Ue=()=>{const{question:e,isLoading:t,isWaiting:n,statusMessage:r,error:a,isOnline:s,isModalOpen:u,rateLimitInfo:o,sessionQuestionCount:m,setIsModalOpen:g,generateNewQuestion:E,refreshQuestion:R,settings:x,updateSettings:j,clearSettings:M}=Oe(),{showSnackbar:y}=me(),p=async()=>{if(!s){y("Internet connection required to generate questions","error");return}try{await E(),g(!0)}catch(d){console.error("Error generating question:",d),y(d instanceof Error?d.message:"Failed to generate question","error")}},T=async()=>{if(!s){y("Internet connection required to refresh questions","error");return}try{await R()}catch(d){y(d instanceof Error?d.message:"Failed to refresh question","error")}},C=()=>{M(),y("Settings cleared","info")},q=()=>n?"Please Wait...":t?"Generating with AI...":s?"Generate Final Question":"Internet Required";return i.jsx(se,{maxWidth:"md",children:i.jsxs(f,{py:4,children:[i.jsx(w,{variant:"h4",component:"h1",gutterBottom:!0,align:"center",children:"Final Question"}),i.jsxs(f,{display:"flex",justifyContent:"center",gap:1,mb:2,flexWrap:"wrap",children:[i.jsx(Q,{icon:s?i.jsx(re,{}):i.jsx(ae,{}),label:s?`Online - AI Ready | ${o.requestsRemaining}/15 RPM`:"Offline - Internet Required",color:s?o.isNearLimit?"warning":"success":"error",variant:"outlined"}),m>0&&i.jsx(Q,{label:`Session: ${m} question${m!==1?"s":""}`,color:"info",variant:"outlined",size:"small"})]}),i.jsx(oe,{in:!!r,children:i.jsx(A,{severity:n?"info":"success",sx:{mb:2},icon:n?i.jsx(le,{}):void 0,children:r})}),(t||n)&&i.jsx(f,{sx:{mb:2},children:i.jsx(ce,{variant:n?"indeterminate":"query",color:n?"warning":"primary"})}),a&&i.jsx(A,{severity:"error",sx:{mb:3},children:a}),!s&&i.jsx(A,{severity:"warning",sx:{mb:3},children:"Internet connection is required to generate questions using AI. Please check your connection and try again."}),o.isNearLimit&&s&&i.jsxs(A,{severity:"warning",sx:{mb:3},children:["You're approaching the rate limit (",o.requestsRemaining," ","requests remaining).",o.timeUntilReset>0&&` Limit resets in ${Math.floor(o.timeUntilReset/60)}:${(o.timeUntilReset%60).toString().padStart(2,"0")}.`]}),i.jsxs(ue,{elevation:2,sx:{p:3,borderRadius:2,maxWidth:600,mx:"auto",opacity:n?.8:1,transition:"opacity 0.3s ease"},children:[i.jsxs(f,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[i.jsx(w,{variant:"h6",component:"h2",children:"AI Question Settings"}),i.jsx(k,{title:"Clear all settings",children:i.jsx(L,{onClick:C,color:"error",size:"small","aria-label":"Clear all settings",disabled:t||n,children:i.jsx(de,{})})})]}),i.jsxs(ge,{spacing:3,children:[i.jsxs(G,{fullWidth:!0,disabled:t||n,children:[i.jsx(D,{id:"difficulty-label",children:"Difficulty"}),i.jsxs($,{labelId:"difficulty-label",value:x.difficulty||"",label:"Difficulty",onChange:d=>j({difficulty:d.target.value}),children:[i.jsx(b,{value:"",children:"Random"}),i.jsx(b,{value:"easy",children:"Easy"}),i.jsx(b,{value:"medium",children:"Medium"}),i.jsx(b,{value:"hard",children:"Hard"})]})]}),i.jsxs(G,{fullWidth:!0,disabled:t||n,children:[i.jsx(D,{id:"language-label",children:"Language"}),i.jsxs($,{labelId:"language-label",value:x.language||"",label:"Language",onChange:d=>j({language:d.target.value}),children:[i.jsx(b,{value:"",children:"English (Default)"}),i.jsx(b,{value:"English",children:"English"}),i.jsx(b,{value:"Bulgarian",children:"Bulgarian"})]})]}),i.jsx(he,{fullWidth:!0,label:"Category (optional)",placeholder:"e.g., Science, History, Sports...",value:x.category||"",onChange:d=>j({category:d.target.value}),helperText:"Leave empty for random category",disabled:t||n}),i.jsx(fe,{variant:"contained",color:"primary",onClick:p,disabled:t||n||!s,fullWidth:!0,size:"large",sx:{py:1.5,fontSize:"1.1rem",fontWeight:600,mt:2},children:q()}),i.jsxs(w,{variant:"caption",color:"text.secondary",align:"center",sx:{mt:1},children:["Powered by Google Gemini AI • Supports English & Bulgarian",s&&i.jsxs(i.Fragment,{children:[i.jsx("br",{}),"Rate limit: 15 requests/minute • Smart duplicate prevention"]})]})]})]}),i.jsx(We,{open:u,onClose:()=>g(!1),question:e,isRefreshing:t,isGenerating:t,onRefresh:T,onCopy:()=>{e&&(navigator.clipboard.writeText(`Q: ${e.question}
A: ${e.answer}`),y("Question copied to clipboard!","success"))}})]})})};export{Ue as default};
//# sourceMappingURL=FinalQuestionPage-BBkwSJjy.js.map
