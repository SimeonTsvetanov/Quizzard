var St=Object.defineProperty;var zt=(i,t,r)=>t in i?St(i,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[t]=r;var qe=(i,t,r)=>zt(i,typeof t!="symbol"?t+"":t,r);import{j as e,D as U,a as K,b as H,B as S,T as D,L as ot,as as lt,at as ct,k as dt,l as Ct,m as je,n as Se,e as Z,f as E,Y as T,au as oe,av as ut,Z as de,ag as xe,I as J,aw as At,ax as Dt,ay as Le,a2 as Be,az as kt,x as Pe,ab as Tt,aA as Ae,aB as It,aC as ae,aD as Et,a7 as ue,r as m,a5 as V,aE as ee,aF as te,aG as se,aH as F,aI as Je,aq as ne,ar as Qt,aJ as Mt,aK as he,aL as Ye,W as Me,aM as Re,ae as Rt,af as Ft,aN as Ge,d as ht,aO as Ve,aP as mt,aQ as qt,aR as Ot,V as pe,C as Lt,aS as Pt,aT as Wt,aU as Ue,K as Oe,aV as Ne,aW as Xe,i as ft,aX as Nt,w as _t,ah as $t,aY as gt,aZ as Bt,a_ as Gt,a$ as Vt,a4 as Ut}from"./mui-C3MZkJ_-.js";import{a as Ht,_ as Yt,H as Kt,E as et}from"./index-_-JDN6r9.js";import{u as pt}from"./useSnackbar-1fKnI7tw.js";import"./vendor-DJG_os-6.js";const Zt=[{id:"slides",label:"Export to Google Slides",icon:lt,disabled:!0,description:"Export quiz as a Google Slides presentation (Coming Soon)"},{id:"json",label:"Export as JSON",icon:ct,disabled:!0,description:"Export quiz data in JSON format (Coming Soon)"}],Jt=({open:i,quiz:t,onClose:r,onExport:s})=>{const n=l=>{s(l),r()};return e.jsxs(U,{open:i,onClose:r,"aria-labelledby":"export-format-dialog-title",maxWidth:"sm",fullWidth:!0,children:[e.jsxs(K,{id:"export-format-dialog-title",children:["Export Quiz: ",t.title]}),e.jsx(H,{children:e.jsxs(S,{sx:{py:1},children:[e.jsx(D,{variant:"body1",gutterBottom:!0,children:"Choose an export format:"}),e.jsx(ot,{children:Zt.map(l=>e.jsx(dt,{disablePadding:!0,children:e.jsxs(Ct,{onClick:()=>n(l.id),disabled:l.disabled,children:[e.jsx(je,{children:e.jsx(l.icon,{})}),e.jsx(Se,{primary:l.label,secondary:l.description})]})},l.id))}),e.jsx(D,{variant:"body2",color:"text.secondary",sx:{mt:2,fontStyle:"italic"},children:"Export functionality coming soon! These features are planned for future releases."})]})}),e.jsx(Z,{children:e.jsx(E,{onClick:r,children:"Cancel"})})]})},Xt=({quiz:i,onMenuOpen:t,onExport:r,onPreview:s,onEdit:n})=>{var j;const[l,u]=T.useState(!1),a=T.useCallback(()=>{s?s(i):console.log("Preview quiz:",i.id)},[i,s]),f=T.useCallback(()=>{u(!0)},[]),v=T.useCallback(y=>{r(i,y)},[i,r]),o=T.useCallback(()=>{n(i)},[i,n]),h=T.useCallback(y=>{t(y,i)},[i,t]),x=T.useMemo(()=>{var y;return((y=i.rounds)==null?void 0:y.flatMap(w=>(w==null?void 0:w.questions)||[]).length)||0},[i.rounds]);return e.jsxs(oe,{size:{xs:12,sm:6,md:4},children:[e.jsx(ut,{in:!0,timeout:300,children:e.jsxs(de,{elevation:2,sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",transition:"all 0.3s ease","&:hover":{elevation:4,transform:"translateY(-2px)"}},children:[e.jsx(S,{children:e.jsxs(xe,{sx:{pb:1},children:[e.jsxs(S,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[e.jsx(D,{variant:"h5",component:"h3",fontWeight:"bold",noWrap:!0,children:i.title||"Untitled Quiz"}),e.jsx(J,{size:"small",onClick:h,"aria-label":"More options",children:e.jsx(At,{})})]}),e.jsx(D,{variant:"body2",color:"text.secondary",sx:{mb:2,height:"40px",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:i.description||"No description provided."}),e.jsxs(S,{display:"flex",alignItems:"center",gap:2,color:"text.secondary",children:[e.jsxs(S,{display:"flex",alignItems:"center",gap:.5,children:[e.jsx(Dt,{fontSize:"small"}),e.jsxs(D,{variant:"caption",children:[i.estimatedDuration||"10"," min"]})]}),e.jsxs(S,{display:"flex",alignItems:"center",gap:.5,children:[e.jsx(Le,{fontSize:"small"}),e.jsxs(D,{variant:"caption",children:[((j=i.rounds)==null?void 0:j.length)||0," Rounds"]})]}),e.jsxs(S,{display:"flex",alignItems:"center",gap:.5,children:[e.jsx(Be,{fontSize:"small"}),e.jsxs(D,{variant:"caption",children:[x," Questions"]})]})]})]})}),e.jsx(kt,{sx:{p:2,pt:1},children:e.jsxs(Pe,{direction:"row",spacing:1,width:"100%",children:[e.jsx(E,{variant:"contained",size:"medium",startIcon:e.jsx(Tt,{}),onClick:a,sx:{flex:1},children:"Play"}),e.jsx(E,{variant:"outlined",size:"medium",startIcon:e.jsx(Ae,{}),onClick:o,sx:{flex:1},children:"Edit"}),e.jsx(E,{variant:"outlined",size:"medium",startIcon:e.jsx(It,{}),onClick:f,sx:{flex:1},children:"Export"})]})})]})}),e.jsx(Jt,{open:l,quiz:i,onClose:()=>u(!1),onExport:v})]},i.id)},es=()=>e.jsx(e.Fragment,{children:[1,2,3].map(i=>e.jsx(oe,{size:{xs:12,sm:6,md:4},children:e.jsx(de,{elevation:1,children:e.jsxs(xe,{children:[e.jsxs(S,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsx(ae,{variant:"circular",width:48,height:48}),e.jsx(ae,{variant:"circular",width:24,height:24})]}),e.jsx(ae,{variant:"text",sx:{fontSize:"1.2rem",mb:1}}),e.jsx(ae,{variant:"text",height:40,sx:{mb:2}}),e.jsxs(S,{display:"flex",gap:1,mb:2,children:[e.jsx(ae,{variant:"rounded",width:60,height:24}),e.jsx(ae,{variant:"rounded",width:80,height:24}),e.jsx(ae,{variant:"rounded",width:40,height:24})]}),e.jsxs(S,{display:"flex",justifyContent:"space-between",children:[e.jsx(ae,{variant:"text",width:100}),e.jsx(ae,{variant:"text",width:60})]})]})})},i))}),ts=({onCreateQuiz:i})=>e.jsx(oe,{size:{xs:12},children:e.jsx(de,{elevation:0,sx:{textAlign:"center",py:8,bgcolor:"background.default",border:"2px dashed",borderColor:"divider"},children:e.jsxs(xe,{children:[e.jsx(Et,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(D,{variant:"h5",gutterBottom:!0,children:"Create Your First Quiz"}),e.jsx(D,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Get started by creating an interactive quiz with questions, answers, and media. Export to PowerPoint when you're ready to present!"}),e.jsx(E,{variant:"contained",size:"large",startIcon:e.jsx(ue,{}),onClick:i,sx:{mt:2},children:"Create Quiz"})]})})}),ss=({quizzes:i,isLoading:t,onCreateQuiz:r,onMenuOpen:s,onExport:n,onPreview:l,onEdit:u})=>{const a=T.useCallback(()=>i.map(f=>e.jsx(Xt,{quiz:f,onMenuOpen:s,onExport:n,onPreview:l,onEdit:u},f.id)),[i,s,n,l,u]);return e.jsx(oe,{container:!0,spacing:3,children:t?e.jsx(es,{}):i.length===0?e.jsx(ts,{onCreateQuiz:r}):a()})},Te=[{id:"basic-info",title:"Quiz Information",description:"Set up basic quiz details like title, description, and category"},{id:"questions",title:"Add Questions",description:"Create and manage your quiz questions with answers"},{id:"review-create",title:"Review & Create",description:"Review your quiz and finalize creation."}],rs=i=>{const[t,r]=m.useState(0),s=m.useMemo(()=>Te.map((h,x)=>{const j=x<t,y=x===t&&i().isValid;return{...h,completed:j||y,active:x===t,enabled:x<=t||j}}),[t,i]),n=m.useMemo(()=>i().isValid&&t<Te.length-1,[i,t]),l=m.useCallback(()=>{i().isValid&&t<Te.length-1&&r(t+1)},[t,i]),u=m.useCallback(()=>{t>0&&r(t-1)},[t]),a=m.useCallback(h=>{h>=0&&h<Te.length&&s[h].enabled&&r(h)},[s]),f=m.useCallback(()=>{r(0)},[]);return{navigation:{currentStep:t,steps:s,canProceed:n},actions:{nextStep:l,previousStep:u,goToStep:a,resetNavigation:f}}};Te.map(i=>i.id);const we={MAX_TITLE_LENGTH:100,MIN_OPTIONS:2,MAX_OPTIONS:20},tt=i=>{const{currentStep:t,draftQuiz:r}=i,s=m.useCallback(()=>{var w,z;const j=[],y=[];return(w=r.title)!=null&&w.trim()?r.title.length>we.MAX_TITLE_LENGTH&&j.push(`Title must be ${we.MAX_TITLE_LENGTH} characters or less`):j.push("Quiz title is required"),r.category||j.push("Quiz category must be selected"),r.difficulty||j.push("Quiz difficulty must be selected"),(z=r.description)!=null&&z.trim()||y.push("Consider adding a description to help users understand the quiz content"),{isValid:j.length===0,errors:j,warnings:y,validatedAt:new Date}},[r]),n=m.useCallback(()=>{const j=[],y=[];return!r.rounds||r.rounds.length<1?(j.push("Quiz must have at least one round"),{isValid:!1,errors:j,warnings:y,validatedAt:new Date}):(r.rounds.forEach((w,z)=>{const Q=z+1;if(!w.questions||w.questions.length<1){j.push(`Round ${Q} must have at least one question`);return}w.questions.forEach((c,p)=>{var L,A,I;if(!c||typeof c!="object")return;const b=p+1,C=`Round ${Q}, Question ${b}`;if((L=c.question)!=null&&L.trim()||j.push(`${C}: Question text is required`),c.type==="single-answer")(A=c.correctAnswerText)!=null&&A.trim()||y.push(`${C}: Consider adding an answer`);else if(["multiple-choice","picture","audio","video"].includes(c.type))if(w.type==="golden-pyramid")(!c.possibleAnswers||!Array.isArray(c.possibleAnswers)||c.possibleAnswers.length===0||c.possibleAnswers.every(M=>!(M!=null&&M.trim())))&&y.push(`${C}: Consider adding at least one answer option`);else{if((!c.possibleAnswers||!Array.isArray(c.possibleAnswers)||c.possibleAnswers.length<we.MIN_OPTIONS)&&y.push(`${C}: Consider adding at least ${we.MIN_OPTIONS} answer options`),!c.correctAnswers||!Array.isArray(c.correctAnswers)||c.correctAnswers.length===0)y.push(`${C}: Consider selecting at least one correct answer`);else if(c.possibleAnswers&&Array.isArray(c.possibleAnswers)){const M=((I=c.possibleAnswers)==null?void 0:I.length)||0;c.correctAnswers.filter(N=>typeof N!="number"||N<0||N>=M).length>0&&y.push(`${C}: Some correct answer selections may be invalid`)}c.possibleAnswers&&Array.isArray(c.possibleAnswers)&&c.possibleAnswers.filter(O=>!(O!=null&&O.trim())).length>0&&y.push(`${C}: Consider filling in all answer options`),c.possibleAnswers&&Array.isArray(c.possibleAnswers)&&c.possibleAnswers.length>we.MAX_OPTIONS&&y.push(`${C}: Consider limiting to ${we.MAX_OPTIONS} options for better usability`)}c.question&&c.question.length>200&&y.push(`${C}: Long questions may be harder to read`)}),w.questions.length>10&&y.push(`Round ${Q}: Many questions in one round may overwhelm users`)}),{isValid:j.length===0,errors:j,warnings:y,validatedAt:new Date})},[r.rounds]),l=m.useCallback(()=>{var p,b;const j=[],y=[];!!((p=r.title)!=null&&p.trim())||j.push("Basic quiz information is incomplete"),r.rounds&&r.rounds.length>0&&r.rounds.every(C=>C.questions&&C.questions.length>0)||j.push("Quiz must have at least one round with questions"),!!r.settings||j.push("Quiz settings are required");const c=((b=r.rounds)==null?void 0:b.reduce((C,L)=>{var A;return C+(((A=L.questions)==null?void 0:A.length)||0)},0))||0;return c<5&&y.push("Quiz has fewer than 5 questions - consider adding more"),c>50&&y.push("Quiz has many questions - consider splitting into multiple quizzes"),{isValid:j.length===0,errors:j,warnings:y,validatedAt:new Date}},[r]),u=m.useCallback(()=>{switch(t){case 0:return s();case 1:return n();case 2:return l();default:return{isValid:!1,errors:["Invalid step"],warnings:[],validatedAt:new Date}}},[t,s,n,l]),a=m.useCallback(j=>{switch(j){case 0:return s();case 1:return n();case 2:return l();default:return{isValid:!1,errors:["Invalid step index"],warnings:[],validatedAt:new Date}}},[s,n,l]),f=m.useCallback(()=>{const j=[],y=[];return[0,1,2].forEach(w=>{const z=a(w);j.push(...z.errors),y.push(...z.warnings)}),{isValid:j.length===0,errors:j,warnings:y,validatedAt:new Date}},[a]),o=u().isValid,x=f().isValid;return{validateStep:u,validateSpecificStep:a,validateAllSteps:f,isCurrentStepValid:o,isWizardComplete:x}},is=i=>{const{draftQuiz:t,clearDraft:r}=i,s=m.useCallback(o=>{const h=o.reduce((y,w)=>{var z;return y+(((z=w.questions)==null?void 0:z.length)||0)},0),x=Math.ceil(h*1.5),j=o.reduce((y,w)=>{const z=w.questions.reduce((Q,c)=>{var p;return Q+(((p=c.question)==null?void 0:p.length)||0)},0)/w.questions.length;return y+(z>100?.5:0)},0);return Math.max(5,x+Math.ceil(j))},[]),n=m.useCallback(()=>{if(t.id&&!t.id.startsWith("draft_"))return t.id;const o=Date.now(),h=Math.random().toString(36).substr(2,9);return`quiz_${o}_${h}`},[t.id]),l=m.useCallback(()=>{var z,Q;if(!((z=t.title)!=null&&z.trim()))throw new Error("Quiz title is required");const o=new Date,h=t.id&&!t.id.startsWith("draft_"),x=t.rounds||[],j=t.settings||{allowHints:!1,showCorrectAnswers:!0,timeLimit:null,randomizeQuestions:!1,randomizeAnswers:!1},y=Math.max(x.length>0?s(x):5,t.estimatedDuration||5);return{id:n(),title:t.title.trim(),description:((Q=t.description)==null?void 0:Q.trim())||"",category:t.category||"general",difficulty:t.difficulty||"medium",estimatedDuration:y,createdAt:h&&t.createdAt||o,updatedAt:o,settings:j,rounds:x.map(c=>({...c,id:c.id||`round_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,createdAt:c.createdAt||o,updatedAt:c.updatedAt||o,questions:(c.questions||[]).map(p=>({...p,id:p.id||`q_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,createdAt:p.createdAt||o,updatedAt:p.updatedAt||o}))}))}},[t,s,n]),u=m.useCallback(()=>{var o;return!!((o=t.title)!=null&&o.trim())},[t.title]),a=m.useCallback(()=>{var x;const o=[],h=[];return(x=t.title)!=null&&x.trim()||o.push("Quiz title is required"),t.category||h.push("Consider adding a category"),t.difficulty||h.push("Consider setting a difficulty level"),(!t.rounds||t.rounds.length===0)&&h.push("Consider adding some questions"),{ready:o.length===0,errors:o,warnings:h}},[t]),f=m.useCallback(async()=>{var o;if(!((o=t.title)!=null&&o.trim()))throw new Error("Quiz title is required");try{const h=l();return r(),h}catch(h){throw console.error("[WizardCompletion] Failed to create quiz:",h),h instanceof Error?new Error(`Quiz creation failed: ${h.message}`):new Error("Quiz creation failed due to unknown error")}},[t.title,l,r]),v=u();return{completeWizard:f,canComplete:u,getCompletionStatus:a,isReady:v}},R={name:"QuizzardDB",version:1,stores:{quizzes:"quizzes",drafts:"drafts",mediaFiles:"mediaFiles",metadata:"metadata"}},Ie={TOTAL_QUIZ_SIZE:500*1024*1024,SINGLE_IMAGE:10*1024*1024,SINGLE_AUDIO:20*1024*1024,SINGLE_VIDEO:100*1024*1024,WARNING_THRESHOLD:400*1024*1024},Qe={DEBOUNCE_DELAY:3e4,MAX_RETRIES:3,RETRY_DELAY:5e3,DRAFT_CLEANUP_DAYS:30};class ns{constructor(){qe(this,"db",null);qe(this,"isInitialized",!1);qe(this,"initPromise",null)}async initialize(){return this.initPromise?this.initPromise:(this.initPromise=this._initializeDB(),this.initPromise)}async _initializeDB(){try{return window.indexedDB?new Promise((t,r)=>{const s=indexedDB.open(R.name,R.version);s.onerror=()=>{console.error("Failed to open IndexedDB:",s.error),r(!1)},s.onsuccess=()=>{this.db=s.result,this.isInitialized=!0,console.log("IndexedDB initialized successfully"),t(!0)},s.onupgradeneeded=n=>{const l=n.target.result;if(!l.objectStoreNames.contains(R.stores.quizzes)){const u=l.createObjectStore(R.stores.quizzes,{keyPath:"id"});u.createIndex("status","status",{unique:!1}),u.createIndex("createdAt","createdAt",{unique:!1}),u.createIndex("category","category",{unique:!1})}if(l.objectStoreNames.contains(R.stores.drafts)||l.createObjectStore(R.stores.drafts,{keyPath:"id"}).createIndex("lastSaved","lastSaved",{unique:!1}),!l.objectStoreNames.contains(R.stores.mediaFiles)){const u=l.createObjectStore(R.stores.mediaFiles,{keyPath:"id"});u.createIndex("type","type",{unique:!1}),u.createIndex("size","size",{unique:!1})}l.objectStoreNames.contains(R.stores.metadata)||l.createObjectStore(R.stores.metadata,{keyPath:"key"})}}):(console.warn("IndexedDB not available, will use localStorage fallback"),!1)}catch(t){return console.error("IndexedDB initialization failed:",t),!1}}async executeTransaction(t,r,s){try{if(!this.db)throw new Error("Database not initialized");const n=this.db.transaction(t,r);return new Promise(l=>{n.oncomplete=()=>{},n.onerror=()=>{var u;l({success:!1,error:`Transaction failed: ${(u=n.error)==null?void 0:u.message}`})},s(n).then(u=>{l({success:!0,data:u})}).catch(u=>{l({success:!1,error:u.message||"Operation failed"})})})}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error"}}}async saveQuiz(t){if(await this.initialize(),!this.isInitialized)return this.saveQuizFallback(t);const r=await this.getStorageUsage(),s=this.calculateQuizSize(t);return r.totalSize+s>Ie.TOTAL_QUIZ_SIZE?{success:!1,error:"Storage limit exceeded. Please delete some quizzes or media files."}:this.executeTransaction([R.stores.quizzes,R.stores.mediaFiles],"readwrite",async n=>{const l=n.objectStore(R.stores.quizzes),u=n.objectStore(R.stores.mediaFiles);for(const a of t.rounds)for(const f of a.questions)f.mediaFile&&await this.putInStore(u,f.mediaFile);return await this.putInStore(l,t),await this.updateMetadata(),t})}async saveDraft(t){if(await this.initialize(),!this.isInitialized)return this.saveDraftFallback(t);const r={...t,lastSaved:new Date,isDraft:!0};return this.executeTransaction(R.stores.drafts,"readwrite",async s=>{const n=s.objectStore(R.stores.drafts);return await this.putInStore(n,r),r})}async loadQuizzes(){return await this.initialize(),this.isInitialized?this.executeTransaction(R.stores.quizzes,"readonly",async t=>{const s=t.objectStore(R.stores.quizzes).getAll();return new Promise((n,l)=>{s.onsuccess=()=>n(s.result||[]),s.onerror=()=>l(s.error)})}):this.loadQuizzesFallback()}async loadQuiz(t){return await this.initialize(),this.isInitialized?this.executeTransaction(R.stores.quizzes,"readonly",async r=>{const n=r.objectStore(R.stores.quizzes).get(t);return new Promise((l,u)=>{n.onsuccess=()=>l(n.result||null),n.onerror=()=>u(n.error)})}):this.loadQuizFallback(t)}async loadDrafts(){return await this.initialize(),this.isInitialized?this.executeTransaction(R.stores.drafts,"readonly",async t=>{const s=t.objectStore(R.stores.drafts).getAll();return new Promise((n,l)=>{s.onsuccess=()=>n(s.result||[]),s.onerror=()=>l(s.error)})}):this.loadDraftsFallback()}async deleteQuiz(t){return await this.initialize(),this.isInitialized?this.executeTransaction([R.stores.quizzes,R.stores.mediaFiles],"readwrite",async r=>{const s=r.objectStore(R.stores.quizzes),n=r.objectStore(R.stores.mediaFiles),l=await this.getFromStore(s,t);if(l)for(const u of l.rounds)for(const a of u.questions)a.mediaFile&&await this.deleteFromStore(n,a.mediaFile.id);return await this.deleteFromStore(s,t),await this.updateMetadata(),!0}):this.deleteQuizFallback(t)}async deleteDraft(t){return await this.initialize(),this.isInitialized?this.executeTransaction(R.stores.drafts,"readwrite",async r=>{const s=r.objectStore(R.stores.drafts);return await this.deleteFromStore(s,t),!0}):this.deleteDraftFallback(t)}async getStorageUsage(){if(await this.initialize(),!this.isInitialized)return this.getStorageUsageFallback();try{const[t,r,s]=await Promise.all([this.calculateStoreSize(R.stores.quizzes),this.calculateStoreSize(R.stores.drafts),this.calculateStoreSize(R.stores.mediaFiles)]),n=t+r+s,l=Ie.TOTAL_QUIZ_SIZE-n,u=n/Ie.TOTAL_QUIZ_SIZE*100;return{totalSize:n,quizzesSize:t,draftsSize:r,mediaFilesSize:s,remainingSpace:Math.max(0,l),percentageUsed:Math.min(100,u),isNearLimit:u>80}}catch(t){return console.error("Error calculating storage usage:",t),{totalSize:0,quizzesSize:0,draftsSize:0,mediaFilesSize:0,remainingSpace:Ie.TOTAL_QUIZ_SIZE,percentageUsed:0,isNearLimit:!1}}}async cleanupOldDrafts(){if(await this.initialize(),!this.isInitialized)return{success:!0,data:0};const t=new Date;return t.setDate(t.getDate()-Qe.DRAFT_CLEANUP_DAYS),this.executeTransaction(R.stores.drafts,"readwrite",async r=>{const n=r.objectStore(R.stores.drafts).index("lastSaved"),l=IDBKeyRange.upperBound(t),u=n.openCursor(l);let a=0;return new Promise((f,v)=>{u.onsuccess=o=>{const h=o.target.result;h?(h.delete(),a++,h.continue()):f(a)},u.onerror=()=>v(u.error)})})}async clearAllStorage(){try{if(await this.initialize(),this.isInitialized&&this.db){const t=[R.stores.quizzes,R.stores.drafts,R.stores.mediaFiles,R.stores.metadata];for(const r of t)await this.executeTransaction(r,"readwrite",async s=>{const n=s.objectStore(r);return new Promise((l,u)=>{const a=n.clear();a.onsuccess=()=>l(),a.onerror=()=>u(a.error)})})}try{localStorage.removeItem("quizzard_quizzes"),localStorage.removeItem("quizzard_drafts"),Object.keys(localStorage).forEach(t=>{(t.startsWith("quizzard")||t.startsWith("Quizzard"))&&localStorage.removeItem(t)})}catch(t){console.warn("Failed to clear localStorage:",t)}return{success:!0,data:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to clear storage"}}}async putInStore(t,r){return new Promise((s,n)=>{const l=t.put(r);l.onsuccess=()=>s(),l.onerror=()=>n(l.error)})}async getFromStore(t,r){return new Promise((s,n)=>{const l=t.get(r);l.onsuccess=()=>s(l.result||null),l.onerror=()=>n(l.error)})}async deleteFromStore(t,r){return new Promise((s,n)=>{const l=t.delete(r);l.onsuccess=()=>s(),l.onerror=()=>n(l.error)})}async calculateStoreSize(t){return this.db?new Promise((r,s)=>{const u=this.db.transaction(t,"readonly").objectStore(t).getAll();u.onsuccess=()=>{const f=(u.result||[]).reduce((v,o)=>v+JSON.stringify(o).length*2,0);r(f)},u.onerror=()=>s(u.error)}):0}calculateQuizSize(t){return JSON.stringify(t).length*2}async updateMetadata(){if(!this.db)return;const r={version:"1.0.0",totalSize:(await this.getStorageUsage()).totalSize,createdAt:new Date,lastCleanup:new Date};this.db.transaction(R.stores.metadata,"readwrite").objectStore(R.stores.metadata).put({key:"app_metadata",...r})}saveQuizFallback(t){try{const r=this.getQuizzesFromLocalStorage(),s=r.findIndex(n=>n.id===t.id);return s>=0?r[s]=t:r.push(t),localStorage.setItem("quizzard_quizzes",JSON.stringify(r)),{success:!0,data:t,usedFallback:!0}}catch(r){return{success:!1,error:"localStorage save failed: "+(r instanceof Error?r.message:"Unknown error"),usedFallback:!0}}}saveDraftFallback(t){try{const r=this.getDraftsFromLocalStorage(),s=r.findIndex(l=>l.id===t.id),n={...t,lastSaved:new Date,isDraft:!0};return s>=0?r[s]=n:r.push(n),localStorage.setItem("quizzard_drafts",JSON.stringify(r)),{success:!0,data:n,usedFallback:!0}}catch(r){return{success:!1,error:"localStorage draft save failed: "+(r instanceof Error?r.message:"Unknown error"),usedFallback:!0}}}loadQuizzesFallback(){try{return{success:!0,data:this.getQuizzesFromLocalStorage(),usedFallback:!0}}catch(t){return{success:!1,error:"localStorage load failed: "+(t instanceof Error?t.message:"Unknown error"),usedFallback:!0}}}loadQuizFallback(t){try{return{success:!0,data:this.getQuizzesFromLocalStorage().find(n=>n.id===t)||null,usedFallback:!0}}catch(r){return{success:!1,error:"localStorage load failed: "+(r instanceof Error?r.message:"Unknown error"),usedFallback:!0}}}loadDraftsFallback(){try{return{success:!0,data:this.getDraftsFromLocalStorage(),usedFallback:!0}}catch(t){return{success:!1,error:"localStorage drafts load failed: "+(t instanceof Error?t.message:"Unknown error"),usedFallback:!0}}}deleteQuizFallback(t){try{const s=this.getQuizzesFromLocalStorage().filter(n=>n.id!==t);return localStorage.setItem("quizzard_quizzes",JSON.stringify(s)),{success:!0,data:!0,usedFallback:!0}}catch(r){return{success:!1,error:"localStorage delete failed: "+(r instanceof Error?r.message:"Unknown error"),usedFallback:!0}}}deleteDraftFallback(t){try{const s=this.getDraftsFromLocalStorage().filter(n=>n.id!==t);return localStorage.setItem("quizzard_drafts",JSON.stringify(s)),{success:!0,data:!0,usedFallback:!0}}catch(r){return{success:!1,error:"localStorage draft delete failed: "+(r instanceof Error?r.message:"Unknown error"),usedFallback:!0}}}getStorageUsageFallback(){try{const t=localStorage.getItem("quizzard_quizzes")||"[]",r=localStorage.getItem("quizzard_drafts")||"[]",s=t.length*2,n=r.length*2,l=s+n,u=5*1024*1024,a=Math.max(0,u-l),f=l/u*100;return{totalSize:l,quizzesSize:s,draftsSize:n,mediaFilesSize:0,remainingSpace:a,percentageUsed:Math.min(100,f),isNearLimit:f>80}}catch{return{totalSize:0,quizzesSize:0,draftsSize:0,mediaFilesSize:0,remainingSpace:5*1024*1024,percentageUsed:0,isNearLimit:!1}}}getQuizzesFromLocalStorage(){try{const t=localStorage.getItem("quizzard_quizzes");return t?JSON.parse(t):[]}catch{return[]}}getDraftsFromLocalStorage(){try{const t=localStorage.getItem("quizzard_drafts");return t?JSON.parse(t):[]}catch{return[]}}}const Y=new ns,as=Object.freeze(Object.defineProperty({__proto__:null,AUTO_SAVE_CONFIG:Qe,STORAGE_LIMITS:Ie,indexedDBService:Y},Symbol.toStringTag,{value:"Module"})),Ke=()=>{const{showSnackbar:i}=pt(),[t,r]=m.useState({quizzes:[],drafts:[],isLoading:!1,storageUsage:null,autoSaveStatus:"idle",isInitialized:!1}),s=m.useRef(null),n=m.useRef(null),l=m.useRef(0),u=m.useCallback(async()=>{try{r(p=>({...p,isLoading:!0}));const c=await Y.initialize();return r(p=>({...p,isInitialized:c,isLoading:!1})),c?console.log("âœ… IndexedDB initialized successfully"):(console.warn("âš ï¸ Using localStorage fallback"),i("Using local storage - some features may be limited","warning")),c}catch(c){return console.error("Storage initialization failed:",c),r(p=>({...p,isInitialized:!1,isLoading:!1})),i("Storage initialization failed","error"),!1}},[i]),a=m.useCallback(async c=>{try{r(b=>({...b,isLoading:!0}));const p=await Y.saveQuiz(c);return p.success?(r(b=>({...b,quizzes:b.quizzes.some(C=>C.id===c.id)?b.quizzes.map(C=>C.id===c.id?c:C):[...b.quizzes,c],isLoading:!1})),i(p.usedFallback?"Quiz saved to local storage":"Quiz saved successfully","success"),await Promise.all([f(),h(),z()]),!0):(r(b=>({...b,isLoading:!1})),i(p.error||"Failed to save quiz","error"),!1)}catch(p){return r(b=>({...b,isLoading:!1})),console.error("Error saving quiz:",p),i("Failed to save quiz","error"),!1}},[i]),f=m.useCallback(async()=>{try{r(p=>({...p,isLoading:!0}));const c=await Y.loadQuizzes();c.success?(r(p=>({...p,quizzes:c.data||[],isLoading:!1})),c.usedFallback&&console.log("ðŸ“¦ Loaded quizzes from localStorage")):(r(p=>({...p,isLoading:!1})),console.error("Failed to load quizzes:",c.error),i("Failed to load quizzes","error"))}catch(c){r(p=>({...p,isLoading:!1})),console.error("Error loading quizzes:",c),i("Failed to load quizzes","error")}},[i]),v=m.useCallback(async c=>{try{r(b=>({...b,isLoading:!0}));const p=await Y.deleteQuiz(c);return p.success?(r(b=>({...b,quizzes:b.quizzes.filter(C=>C.id!==c),isLoading:!1})),await Promise.all([f(),(async()=>{try{const b=await Y.loadDrafts();b.success&&r(C=>({...C,drafts:b.data||[]}))}catch(b){console.error("Error reloading drafts:",b)}})(),(async()=>{try{const b=await Y.getStorageUsage();r(C=>({...C,storageUsage:b}))}catch(b){console.error("Error refreshing storage usage:",b)}})()]),i("Quiz deleted successfully","success"),!0):(r(b=>({...b,isLoading:!1})),i(p.error||"Failed to delete quiz","error"),!1)}catch(p){return r(b=>({...b,isLoading:!1})),console.error("Error deleting quiz:",p),i("Failed to delete quiz","error"),!1}},[i,f]),o=m.useCallback(async c=>{try{const p=await Y.saveDraft(c);return p.success?(r(b=>({...b,drafts:b.drafts.some(C=>C.id===c.id)?b.drafts.map(C=>C.id===c.id?p.data:C):[...b.drafts,p.data]})),!0):(console.error("Failed to save draft:",p.error),!1)}catch(p){return console.error("Error saving draft:",p),!1}},[]),h=m.useCallback(async()=>{try{const c=await Y.loadDrafts();c.success?r(p=>({...p,drafts:c.data||[]})):console.error("Failed to load drafts:",c.error)}catch(c){console.error("Error loading drafts:",c)}},[]),x=m.useCallback(async c=>{try{const p=await Y.deleteDraft(c);return p.success?(r(b=>({...b,drafts:b.drafts.filter(C=>C.id!==c)})),!0):(console.error("Failed to delete draft:",p.error),!1)}catch(p){return console.error("Error deleting draft:",p),!1}},[]),j=m.useCallback(async()=>{if(n.current)try{if(r(p=>({...p,autoSaveStatus:"saving"})),await o(n.current))r(p=>({...p,autoSaveStatus:"saved"})),l.current=0,setTimeout(()=>{r(p=>({...p,autoSaveStatus:"idle"}))},2e3);else throw new Error("Auto-save failed")}catch(c){console.error("Auto-save error:",c),r(p=>({...p,autoSaveStatus:"error"})),l.current<Qe.MAX_RETRIES?(l.current++,setTimeout(()=>{j()},Qe.RETRY_DELAY)):(i("Auto-save failed. Please save manually.","error"),setTimeout(()=>{r(p=>({...p,autoSaveStatus:"idle"}))},5e3))}},[o,i]),y=m.useCallback(c=>{s.current&&clearTimeout(s.current),n.current=c,s.current=setTimeout(()=>{j()},Qe.DEBOUNCE_DELAY)},[j]),w=m.useCallback(()=>{s.current&&(clearTimeout(s.current),s.current=null),n.current=null,r(c=>({...c,autoSaveStatus:"idle"}))},[]),z=m.useCallback(async()=>{try{const c=await Y.getStorageUsage();r(p=>({...p,storageUsage:c})),c.isNearLimit&&i(`Storage is ${c.percentageUsed.toFixed(1)}% full. Consider deleting old quizzes.`,"warning")}catch(c){console.error("Error getting storage usage:",c)}},[i]),Q=m.useCallback(async()=>{try{const c=await Y.cleanupOldDrafts();return c.success&&c.data>0&&(i(`Cleaned up ${c.data} old drafts`,"info"),await h(),await z()),c.data||0}catch(c){return console.error("Error cleaning up drafts:",c),0}},[h,z,i]);return m.useEffect(()=>{u()},[u]),m.useEffect(()=>{t.isInitialized&&(f(),h(),z())},[t.isInitialized,f,h,z]),m.useEffect(()=>()=>{s.current&&clearTimeout(s.current)},[]),T.useCallback(async(c,p)=>{p&&p.current},[]),{...t,saveQuiz:a,loadQuizzes:f,deleteQuiz:v,saveDraft:o,loadDrafts:h,deleteDraft:x,enableAutoSave:y,disableAutoSave:w,refreshStorageUsage:z,cleanupOldDrafts:Q,initializeStorage:u}},xt={defaultTimeLimit:30},ke={title:"",description:"",category:"general",difficulty:"medium",rounds:[],estimatedDuration:10,settings:xt,status:"draft"},os=i=>{const{saveDraft:t,loadDrafts:r,deleteDraft:s,autoSaveStatus:n,storageError:l,clearError:u,drafts:a}=Ke(),[f,v]=m.useState(ke),[o,h]=m.useState(!1),[x,j]=m.useState(null),y=m.useRef(null),w=m.useRef(null);m.useEffect(()=>{o||(async()=>{try{if(i!=null&&i.id){const I={...i,status:"draft",id:i.id};v(I),w.current=I.id}else{await r();const I=a.find(M=>M.title===""||!M.title);if(I)v(I),w.current=I.id;else{const M={...ke,id:`draft_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date};v(M),w.current=M.id}}}catch(I){console.warn("[WizardPersistence] Failed to initialize draft:",I);const M={...ke,id:`draft_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date};v(M),w.current=M.id}finally{h(!0)}})()},[o,i,r,a]);const z=m.useCallback(()=>{y.current&&clearTimeout(y.current),y.current=setTimeout(async()=>{var A;if(f.id&&(f.title||(A=f.rounds)!=null&&A.length))try{await t(f),j(new Date)}catch(I){console.error("[WizardPersistence] Auto-save failed:",I)}},3e4)},[f,t]),Q=m.useCallback(A=>{v(I=>({...I,...A,settings:{...I.settings||xt,...A.settings||{}},rounds:A.rounds!==void 0?A.rounds:I.rounds,updatedAt:new Date})),z()},[z]),c=m.useCallback(async()=>{if(f.id)try{await t(f),j(new Date)}catch(A){throw console.error("[WizardPersistence] Manual save failed:",A),A}},[f,t]),p=m.useCallback(async()=>{if(y.current&&(clearTimeout(y.current),y.current=null),w.current)try{await s(w.current)}catch(A){console.warn("[WizardPersistence] Failed to delete draft:",A)}v(ke),j(null),w.current=null,u()},[s,u]),b=m.useCallback(()=>{const A={...ke,id:`draft_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date};v(A),w.current=A.id,j(null)},[]),C=m.useCallback(A=>{const I={...A,status:"draft",id:`draft_${A.id||Date.now()}_${Date.now()}`,updatedAt:new Date};v(I),w.current=I.id,j(null)},[]),L=m.useCallback(async()=>{try{await r();const A=a.filter(I=>I.status==="draft").sort((I,M)=>new Date(M.updatedAt||0).getTime()-new Date(I.updatedAt||0).getTime())[0];return A?(v(A),w.current=A.id,j(A.updatedAt?new Date(A.updatedAt):null),!0):!1}catch(A){return console.error("[WizardPersistence] Draft recovery failed:",A),!1}},[r,a]);return m.useEffect(()=>()=>{y.current&&clearTimeout(y.current)},[]),{persistence:{draftQuiz:f,isInitialized:o,autoSaveStatus:n,storageError:l,lastSaved:x},actions:{updateDraft:Q,saveDraft:c,clearDraft:p,resetDraft:b,initializeFromQuiz:C,recoverDraft:L}}},ls=i=>{const{persistence:{draftQuiz:t,autoSaveStatus:r,storageError:s,lastSaved:n},actions:l}=os(i),u=tt({currentStep:0,draftQuiz:t}),{navigation:{currentStep:a,steps:f,canProceed:v},actions:o}=rs(u.validateStep),h=tt({currentStep:a,draftQuiz:t}),x=is({draftQuiz:t,clearDraft:l.clearDraft,resetDraft:l.resetDraft}),j=()=>{o.resetNavigation(),l.clearDraft()};return{currentStep:a,steps:f,canProceed:v,nextStep:o.nextStep,previousStep:o.previousStep,goToStep:o.goToStep,draftQuiz:t,updateDraft:l.updateDraft,saveDraft:l.saveDraft,autoSaveStatus:r,storageError:s,lastSaved:n,validateStep:h.validateStep,completeWizard:x.completeWizard,resetWizard:j,recoverDraft:l.recoverDraft}},cs=m.createContext(null),_e={didCatch:!1,error:null};class ds extends m.Component{constructor(t){super(t),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=_e}static getDerivedStateFromError(t){return{didCatch:!0,error:t}}resetErrorBoundary(){const{error:t}=this.state;if(t!==null){for(var r,s,n=arguments.length,l=new Array(n),u=0;u<n;u++)l[u]=arguments[u];(r=(s=this.props).onReset)===null||r===void 0||r.call(s,{args:l,reason:"imperative-api"}),this.setState(_e)}}componentDidCatch(t,r){var s,n;(s=(n=this.props).onError)===null||s===void 0||s.call(n,t,r)}componentDidUpdate(t,r){const{didCatch:s}=this.state,{resetKeys:n}=this.props;if(s&&r.error!==null&&us(t.resetKeys,n)){var l,u;(l=(u=this.props).onReset)===null||l===void 0||l.call(u,{next:n,prev:t.resetKeys,reason:"keys"}),this.setState(_e)}}render(){const{children:t,fallbackRender:r,FallbackComponent:s,fallback:n}=this.props,{didCatch:l,error:u}=this.state;let a=t;if(l){const f={error:u,resetErrorBoundary:this.resetErrorBoundary};if(typeof r=="function")a=r(f);else if(s)a=m.createElement(s,f);else if(n!==void 0)a=n;else throw u}return m.createElement(cs.Provider,{value:{didCatch:l,error:u,resetErrorBoundary:this.resetErrorBoundary}},a)}}function us(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return i.length!==t.length||i.some((r,s)=>!Object.is(r,t[s]))}const st={MAX_TITLE_LENGTH:100},Ee={mixed:{label:"Any Type of Question",description:"Questions of any type",allowedQuestionTypes:["single-answer","multiple-choice","picture","audio","video"],canSelectQuestionType:!0},"single-answer-only":{label:"Question-Answer",description:"Only single answer questions",allowedQuestionTypes:["single-answer"],canSelectQuestionType:!1},"multiple-choice":{label:"Multiple Choice Question",description:"Only multiple choice questions",allowedQuestionTypes:["multiple-choice"],canSelectQuestionType:!1},picture:{label:"Picture Question",description:"Questions with picture uploads",allowedQuestionTypes:["picture"],canSelectQuestionType:!1},audio:{label:"Audio Question",description:"Questions with audio uploads",allowedQuestionTypes:["audio"],canSelectQuestionType:!1},video:{label:"Video Question",description:"Questions with video uploads",allowedQuestionTypes:["video"],canSelectQuestionType:!1},"golden-pyramid":{label:"Golden Pyramid Question",description:"Special 4-question format",allowedQuestionTypes:["multiple-choice"],canSelectQuestionType:!1,specialFormat:!0,prePopulatedQuestions:4}},hs=[{value:"general",label:"General Knowledge",description:"Mixed topics and trivia"},{value:"sports",label:"Sports",description:"Sports, teams, and athletics"},{value:"history",label:"History",description:"Historical events and figures"},{value:"science",label:"Science",description:"Science, technology, and nature"},{value:"geography",label:"Geography",description:"Countries, capitals, and locations"},{value:"entertainment",label:"Entertainment",description:"Movies, TV, and celebrities"},{value:"literature",label:"Literature",description:"Books, authors, and poetry"},{value:"art",label:"Art",description:"Visual arts, paintings, and artists"},{value:"music",label:"Music",description:"Songs, artists, and musical theory"},{value:"technology",label:"Technology",description:"Computers, software, and gadgets"},{value:"custom",label:"Custom",description:"Your own custom category"}],ms=[{value:"easy",label:"Easy",description:"Simple questions for beginners",color:"success"},{value:"medium",label:"Medium",description:"Moderate difficulty questions",color:"warning"},{value:"hard",label:"Hard",description:"Challenging questions for experts",color:"error"}],fs=({draftQuiz:i,updateDraft:t,validation:r,onDeleteQuiz:s,isEditMode:n,onContinue:l})=>{var j,y;const u=T.useCallback(w=>r.errors.find(z=>z.toLowerCase().includes(w.toLowerCase())),[r.errors]),a=i.defaultTimeLimit,f=a===void 0?"":Math.round(a/60),v=a??60,o=v>0&&v<=3600,x=(()=>{if(a!==void 0&&!o){if(a<=0)return"Time must be > 0 minutes.";if(a>3600)return"Time must be <= 60 minutes."}})();return e.jsxs(S,{sx:{maxWidth:1e3,mx:"auto"},children:[e.jsxs(oe,{container:!0,spacing:4,children:[e.jsx(oe,{size:{xs:12},children:e.jsx(V,{fullWidth:!0,id:"quiz-title",name:"title",label:"Quiz Title",placeholder:"e.g., General Knowledge Quiz, Science Facts Challenge",value:i.title||"",onChange:w=>t({title:w.target.value}),error:!!u("title"),helperText:u("title")||`${(i.title||"").length}/${st.MAX_TITLE_LENGTH} characters`,inputProps:{maxLength:st.MAX_TITLE_LENGTH,"aria-label":"Quiz title"},size:"medium",sx:{mb:3}})}),e.jsx(oe,{size:{xs:12},children:e.jsx(V,{fullWidth:!0,id:"quiz-description",name:"description",multiline:!0,rows:4,label:"Description (Optional)",placeholder:"Brief description of what this quiz covers...",value:i.description||"",onChange:w=>t({description:w.target.value}),helperText:`${((j=i.description)==null?void 0:j.length)||0}/500 characters`,inputProps:{maxLength:500},size:"medium",sx:{mb:3}})}),e.jsx(oe,{size:{xs:12,md:6},children:e.jsxs(ee,{fullWidth:!0,error:!!u("category"),size:"medium",children:[e.jsx(te,{children:"Quiz Category"}),e.jsx(se,{id:"quiz-category",name:"category",value:i.category||"general",onChange:w=>t({category:w.target.value}),label:"Quiz Category","aria-label":"Quiz category selection",startAdornment:e.jsx(Le,{sx:{mr:1,color:"text.secondary"}}),children:hs.map(w=>e.jsx(F,{value:w.value,children:e.jsxs(S,{children:[e.jsx(D,{variant:"body1",children:w.label}),e.jsx(D,{variant:"caption",color:"text.secondary",children:w.description})]})},w.value))}),e.jsx(Je,{children:u("category")||"Choose the main topic of your quiz"})]})}),e.jsx(oe,{size:{xs:12,md:6},children:e.jsxs(ee,{fullWidth:!0,error:!!u("difficulty"),size:"medium",children:[e.jsx(te,{children:"Difficulty Level"}),e.jsx(se,{id:"quiz-difficulty",name:"difficulty",value:i.difficulty||"medium",onChange:w=>t({difficulty:w.target.value}),label:"Difficulty Level","aria-label":"Difficulty level selection",startAdornment:e.jsx(Qt,{sx:{mr:1,color:"text.secondary"}}),children:ms.map(w=>e.jsx(F,{value:w.value,children:e.jsxs(S,{display:"flex",alignItems:"center",gap:2,width:"100%",children:[e.jsx(ne,{label:w.label,size:"small",color:w.color,variant:"outlined"}),e.jsx(D,{variant:"body2",color:"text.secondary",children:w.description})]})},w.value))}),e.jsx(Je,{children:u("difficulty")||"Set the challenge level for your quiz"})]})}),e.jsxs(S,{sx:{mt:3,width:"100%"},children:[e.jsx(D,{gutterBottom:!0,children:"Default Time Per Question"}),e.jsx(V,{fullWidth:!0,type:"number",label:"1 Minute by Default",placeholder:"1 Minute by Default",value:f,onChange:w=>{const z=w.target.value;t({defaultTimeLimit:z===""?void 0:Number(z)*60})},error:!!x,helperText:x||"This will be the default time limit for each new question. You can override it per question.",inputProps:{step:.5,min:.1,"aria-label":"Default time per question in minutes"},InputProps:{endAdornment:e.jsx(Mt,{position:"end",children:"minutes"})},size:"medium",sx:{mb:1,"& .MuiOutlinedInput-root":{"&.Mui-error fieldset":{borderColor:"error.main"}}}})]})]}),e.jsxs(S,{sx:{mt:4,display:"flex",justifyContent:"space-between",alignItems:"center",gap:2},children:[n&&s&&e.jsx(E,{variant:"outlined",color:"error",onClick:s,startIcon:e.jsx(he,{}),size:"large",sx:{minWidth:{xs:"auto",sm:150},height:48,borderColor:"error.main",color:"error.main","&:hover":{borderColor:"error.dark",backgroundColor:"error.light",color:"error.dark"},"& .MuiButton-startIcon":{margin:{xs:0,sm:"0 8px 0 -4px"}},"& .MuiButton-startIcon + *":{display:{xs:"none",sm:"inline"}}},children:e.jsx(S,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:"Delete Quiz"})}),!n&&e.jsx(S,{}),e.jsxs(E,{variant:"contained",onClick:l,disabled:!((y=i.title)!=null&&y.trim())||!o,size:"large",sx:{minWidth:{xs:120,sm:200},height:48,boxShadow:2,"&:hover":{boxShadow:4}},children:[e.jsx(S,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:"Continue to Questions"}),e.jsx(S,{component:"span",sx:{display:{xs:"inline",sm:"none"}},children:"Continue"})]})]})]})},gs=i=>{const[t,r]=m.useState(0),[s,n]=m.useState(!1),[l,u]=m.useState("add"),[a,f]=m.useState(null),[v,o]=m.useState({description:"",type:"mixed",answerRevealMode:"after-all",defaultTimePerQuestion:(i.defaultTimeLimit||60)/60,breakingTime:5}),[h,x]=m.useState(!1),[j,y]=m.useState(null),[w,z]=m.useState(null),[Q,c]=m.useState(!1),[p,b]=m.useState(!1),[C,L]=m.useState(""),[A,I]=m.useState(""),[M,O]=m.useState(!1),[N,$]=m.useState({questionType:"text-answer",language:"English",topicHint:"",category:"general",difficulty:"medium",optionsCount:4}),[g,d]=m.useState(!1),[k,q]=m.useState(!1),[_,X]=m.useState(null),re=i.rounds||[],ie=re[t]||null,me=v.type&&v.answerRevealMode&&v.defaultTimePerQuestion>=.1&&v.breakingTime>=.1;m.useEffect(()=>{s&&l==="edit"&&a?o({description:a.description||"",type:a.type,answerRevealMode:a.answerRevealMode,defaultTimePerQuestion:a.defaultTimePerQuestion,breakingTime:a.breakingTime||1}):s&&l==="add"&&o({description:"",type:"mixed",answerRevealMode:"after-all",defaultTimePerQuestion:(i.defaultTimeLimit||60)/60,breakingTime:5})},[s,l,a,i]);const le={setCurrentRoundIdx:r,goToPrevRound:m.useCallback(()=>{r(B=>Math.max(0,B-1))},[]),goToNextRound:m.useCallback(()=>{r(B=>Math.min(re.length-1,B+1))},[re.length]),openRoundModal:m.useCallback((B,ce)=>{u(B),f(ce||null),n(!0)},[]),closeRoundModal:m.useCallback(()=>{n(!1),f(null)},[]),updateRoundForm:m.useCallback((B,ce)=>{o(ye=>({...ye,[B]:ce}))},[]),openManualDialog:m.useCallback(()=>{x(!0)},[]),closeManualDialog:m.useCallback(()=>{x(!1),y(null)},[]),setManualQuestion:y,setEditingQuestionId:z,openAIDialog:m.useCallback(()=>{c(!0),I(""),O(!1)},[]),closeAIDialog:m.useCallback(()=>{c(!1)},[]),setAiGenerating:b,setAiStatus:L,setAiError:I,setAiErrorDismissed:O,setAiSettings:$,openDeleteRoundConfirm:m.useCallback(()=>{d(!0)},[]),closeDeleteRoundConfirm:m.useCallback(()=>{d(!1)},[]),openDeleteQuestionConfirm:m.useCallback(B=>{X(B),q(!0)},[]),closeDeleteQuestionConfirm:m.useCallback(()=>{q(!1),X(null)},[])};return{state:{currentRoundIdx:t,roundModalOpen:s,roundModalMode:l,editingRound:a,roundForm:v,manualDialogOpen:h,manualQuestion:j,editingQuestionId:w,aiDialogOpen:Q,aiGenerating:p,aiStatus:C,aiError:A,aiErrorDismissed:M,aiSettings:N,deleteRoundConfirmOpen:g,deleteQuestionConfirmOpen:k,pendingDeleteQuestionId:_},actions:le,derived:{rounds:re,currentRound:ie,isRoundFormValid:me}}},ps={mixed:"Mixed Types: This round can have any kind of questionâ€”multiple choice, single answer, pictures, audio, or video. Great for variety!","single-answer":"Single Answer Only: Every question in this round has just one correct answer. Type your answer in the box. No tricky choicesâ€”just what you know!","multiple-choice":"Multiple Choice: Each question gives you a few possible answers. Pick the one you think is right. Only one answer is correct for each question.",picture:"Picture Round: Every question shows a picture. You might have to name what's in the picture, answer a question about it, or pick from choices. Look closely!",audio:"Audio Round: Listen to a sound or a short clip, then answer the question. You might have to name a song, a person, or guess what's happening.",video:"Video Round: Watch a short video, then answer a question about what you saw or heard. Pay attention to details!","golden-pyramid":"Golden Pyramid: This special round has 4 steps. Each step is a question with only one correct answer. If you get a question right, you move up to the next step. The questions get harder as you go, and you can win more points the higher you climb!"},yt=({open:i,onClose:t,roundType:r})=>e.jsxs(U,{open:i,onClose:t,"aria-labelledby":"round-info-title",maxWidth:"xs",fullWidth:!0,children:[e.jsxs(K,{id:"round-info-title",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ye,{color:"info",sx:{mr:1}}),e.jsx(D,{variant:"h6",component:"span",sx:{flex:1},children:xs(r)}),e.jsx(J,{"aria-label":"Close info",onClick:t,edge:"end",children:e.jsx(Me,{})})]}),e.jsx(H,{children:e.jsx(D,{variant:"body1",sx:{mt:1,mb:2},children:ps[r]})}),e.jsx(Z,{children:e.jsx(E,{onClick:t,color:"primary",variant:"contained",autoFocus:!0,children:"Close"})})]});function xs(i){switch(i){case"mixed":return"Mixed Types Round";case"single-answer":return"Single Answer Only Round";case"multiple-choice":return"Multiple Choice Round";case"picture":return"Picture Round";case"audio":return"Audio Round";case"video":return"Video Round";case"golden-pyramid":return"Golden Pyramid Round";default:return"Round Info"}}const ys=({rounds:i,currentRoundIdx:t,currentRound:r,onPreviousRound:s,onNextRound:n,onAddRound:l,onEditRound:u,onDeleteRound:a})=>{const f=i.length>0,v=f&&t>0,o=f&&t<i.length-1,[h,x]=T.useState(!1);return e.jsx(S,{sx:{mb:3},children:e.jsxs(S,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:{xs:.5,sm:1.5},p:{xs:1.5,sm:2},borderRadius:3,bgcolor:"background.paper",border:1,borderColor:"divider",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",transition:"all 0.2s ease-in-out","&:hover":{boxShadow:"0 4px 16px rgba(0,0,0,0.12)"}},children:[e.jsx(Re,{onClick:s,disabled:!v,size:"medium",sx:{width:{xs:36,sm:44},height:{xs:36,sm:44},minWidth:{xs:36,sm:44},bgcolor:v?"primary.main":"grey.200",color:v?"white":"grey.400",boxShadow:v?2:1,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",transform:v?"scale(1)":"scale(0.9)","&:hover":{bgcolor:v?"primary.dark":"grey.200",transform:v?"scale(1.05)":"scale(0.9)",boxShadow:v?3:1},"&:active":{transform:v?"scale(0.95)":"scale(0.9)"},"&:disabled":{bgcolor:"grey.200",color:"grey.400",cursor:"not-allowed"}},"aria-label":"Previous round",children:e.jsx(Rt,{sx:{fontSize:{xs:"1.1rem",sm:"1.3rem"}}})}),e.jsx(S,{sx:{flex:1}}),f?e.jsx(e.Fragment,{children:e.jsx(E,{onClick:u,endIcon:e.jsx(Ae,{sx:{fontSize:{xs:"0.9rem",sm:"1rem"}}}),sx:{borderRadius:3,textTransform:"none",fontWeight:600,fontSize:{xs:"0.8rem",sm:"0.9rem"},px:{xs:2,sm:3},py:{xs:1,sm:1.2},background:"linear-gradient(45deg, #1976d2, #42a5f5)",color:"white",boxShadow:"0 2px 8px rgba(25, 118, 210, 0.3)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",minWidth:{xs:90,sm:120},"&:hover":{background:"linear-gradient(45deg, #1565c0, #1976d2)",boxShadow:"0 4px 12px rgba(25, 118, 210, 0.4)",transform:"translateY(-1px)"},"&:active":{transform:"translateY(0px)"}},children:e.jsxs(D,{variant:"inherit",sx:{fontWeight:600,fontSize:"inherit",whiteSpace:"nowrap"},children:["Round ",t+1,"/",i.length]})})}):e.jsx(D,{variant:"body2",sx:{color:"text.secondary",fontWeight:500,px:{xs:2,sm:3},fontSize:{xs:"0.8rem",sm:"0.9rem"}},children:"No rounds yet"}),e.jsxs(E,{onClick:l,sx:{borderRadius:{xs:"50%",sm:3},textTransform:"none",fontWeight:{xs:600,sm:500},fontSize:{xs:"1.4rem",sm:"0.8rem"},px:{xs:0,sm:3},py:{xs:0,sm:1.2},minWidth:{xs:40,sm:120},minHeight:{xs:40,sm:44},width:{xs:40,sm:120},height:{xs:40,sm:44},ml:{xs:.5,sm:1},background:"linear-gradient(45deg, #4caf50, #66bb6a)",color:"white",boxShadow:"0 2px 8px rgba(76, 175, 80, 0.3)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",display:"flex",alignItems:"center",justifyContent:"center","&:hover":{background:"linear-gradient(45deg, #388e3c, #4caf50)",boxShadow:"0 4px 12px rgba(76, 175, 80, 0.4)",transform:"translateY(-1px)"},"&:active":{transform:"translateY(0px)"}},"aria-label":"Add round",children:[e.jsx(S,{sx:{display:{xs:"flex",sm:"none"},alignItems:"center",justifyContent:"center",width:"100%",height:"100%"},children:e.jsx(ue,{sx:{fontSize:"1.6rem"}})}),e.jsx(D,{variant:"inherit",sx:{fontWeight:600,fontSize:"inherit",display:{xs:"none",sm:"block"},whiteSpace:"nowrap"},children:"Add Round"})]}),e.jsx(S,{sx:{flex:1}}),e.jsx(Re,{onClick:n,disabled:!o,size:"medium",sx:{width:{xs:36,sm:44},height:{xs:36,sm:44},minWidth:{xs:36,sm:44},bgcolor:o?"primary.main":"grey.200",color:o?"white":"grey.400",boxShadow:o?2:1,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",transform:o?"scale(1)":"scale(0.9)","&:hover":{bgcolor:o?"primary.dark":"grey.200",transform:o?"scale(1.05)":"scale(0.9)",boxShadow:o?3:1},"&:active":{transform:o?"scale(0.95)":"scale(0.9)"},"&:disabled":{bgcolor:"grey.200",color:"grey.400",cursor:"not-allowed"}},"aria-label":"Next round",children:e.jsx(Ft,{sx:{fontSize:{xs:"1.1rem",sm:"1.3rem"}}})})]})})},bs=(i,t)=>{if(!i.question||!i.question.trim())return!1;if(["picture","audio","video"].includes(i.type))return i.possibleAnswers.length>0?i.possibleAnswers.length>=2&&i.possibleAnswers.every(n=>n&&n.trim())&&i.correctAnswers&&i.correctAnswers.length>0:!!(i.correctAnswerText&&i.correctAnswerText.trim());if(i.type==="single-answer"||t==="golden-pyramid")return!!(i.correctAnswerText&&i.correctAnswerText.trim());const r=i.possibleAnswers.length>=2&&i.possibleAnswers.every(n=>n&&n.trim()),s=i.correctAnswers&&i.correctAnswers.length>0;return r&&s},ws=({currentRound:i,onEditQuestion:t,onDeleteQuestion:r,onAddRound:s,onAddQuestion:n})=>{const[l,u]=T.useState(!1);return i?e.jsxs(e.Fragment,{children:[e.jsxs(S,{sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsxs(D,{variant:"subtitle1",color:"text.secondary",children:[i.level?`Level: ${i.level}`:""," | Reveal:"," ",i.answerRevealMode," | Default Time:"," ",i.defaultTimePerQuestion,"min"]}),e.jsx(J,{"aria-label":"Round info",size:"small",onClick:()=>u(!0),children:e.jsx(Ye,{fontSize:"small"})})]}),e.jsx(S,{sx:{display:"flex",flexDirection:"column",gap:2},children:i.questions.length===0?e.jsx(de,{elevation:0,sx:{textAlign:"center",py:4,border:1,borderStyle:"dashed",borderColor:"divider"},children:e.jsxs(xe,{children:[e.jsx(D,{variant:"body2",color:"text.secondary",paragraph:!0,children:"No questions in this round yet. Add or generate questions to get started."}),n&&e.jsx(E,{variant:"contained",size:"medium",startIcon:e.jsx(ue,{}),onClick:n,sx:{mt:1},children:"Add Question"})]})}):i.questions.map((a,f)=>{const v=bs(a,i.type);return e.jsxs(de,{elevation:0,sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,py:1.5,cursor:"pointer",bgcolor:"background.paper",transition:"box-shadow 0.2s","&:hover":{boxShadow:4}},onClick:()=>t(a),"aria-label":`Edit question ${f+1}`,children:[e.jsx(S,{sx:{mr:1,display:"flex",alignItems:"center"},children:v?e.jsx(ht,{sx:{color:"success.main",fontSize:{xs:16,sm:18}},titleAccess:"Question complete"}):e.jsx(Ve,{sx:{color:"error.main",fontSize:{xs:16,sm:18}},titleAccess:"Question incomplete"})}),e.jsxs(D,{variant:"subtitle1",sx:{flex:1},children:[f+1,". ",a.question||"Untitled Question"]}),e.jsx(ne,{label:a.difficulty,size:"small",color:a.difficulty==="easy"?"success":a.difficulty==="medium"?"warning":"error",sx:{mr:1}}),e.jsx(J,{size:"small",color:"error",onClick:o=>{o.stopPropagation(),r(a.id)},"aria-label":`Delete question ${f+1}`,children:e.jsx(he,{fontSize:"small"})})]},a.id)})}),e.jsx(yt,{open:l,onClose:()=>u(!1),roundType:i.type})]}):e.jsx(de,{elevation:0,sx:{textAlign:"center",py:6,border:2,borderStyle:"dashed",borderColor:"divider",bgcolor:"background.default"},children:e.jsxs(xe,{children:[e.jsx(Ge,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(D,{variant:"h6",gutterBottom:!0,children:"No Rounds Yet"}),e.jsx(D,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Add your first round to begin creating your quiz structure."}),s&&e.jsx(E,{variant:"contained",size:"large",startIcon:e.jsx(ue,{}),onClick:s,sx:{mt:2},children:"Add Round"})]})})},vs=({showActions:i,roundType:t,onOpenAIDialog:r,onOpenManualDialog:s})=>{if(!i||!t||t==="golden-pyramid")return null;const n=["mixed","single-answer-only","multiple-choice"].includes(t);return e.jsxs(S,{sx:{display:"flex",gap:1,mb:3},children:[n&&e.jsx(E,{variant:"outlined",startIcon:e.jsx(mt,{}),onClick:r,"aria-label":"Generate question with AI",children:"AI Generate"}),e.jsx(E,{variant:"contained",startIcon:e.jsx(ue,{}),onClick:s,"aria-label":"Add question manually",children:"Add Question"})]})},js=({question:i,onUpdate:t,roundType:r="mixed"})=>{const s=Ee[r],n=async o=>{var b,C,L,A,I;const h=(b=o.target.files)==null?void 0:b[0];if(!h)return;const x={picture:["image/jpeg","image/jpg","image/png","image/webp","image/gif","image/bmp","image/tiff","image/svg+xml"],audio:["audio/mpeg","audio/mp3","audio/wav","audio/wave","audio/x-wav","audio/wma","audio/mp4","audio/m4a"],video:["video/mp4","video/webm","video/mov","video/quicktime","video/x-msvideo","video/avi","video/wmv"]},j=((C=h.name.split(".").pop())==null?void 0:C.toLowerCase())||"",y={picture:["jpg","jpeg","png","webp","gif","bmp","tiff","svg"],audio:["mp3","wav","wma","m4a"],video:["mp4","mov","wmv","avi","webm"]},w=i.type,z=(L=x[w])==null?void 0:L.includes(h.type),Q=(A=y[w])==null?void 0:A.includes(j);if(!z&&!Q){alert(`Unsupported file format. Supported formats: ${(I=y[w])==null?void 0:I.join(", ")}`);return}const c={picture:10*1024*1024,audio:20*1024*1024,video:100*1024*1024};if(h.size>c[w]){const M=c[w]/1048576;alert(`File too large. Maximum size for ${w} files is ${M}MB`);return}const p=new FileReader;p.onload=M=>{var N;const O={id:`media_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,filename:h.name,type:i.type==="picture"?"image":i.type==="audio"?"audio":"video",size:h.size,data:(N=M.target)==null?void 0:N.result,mimeType:h.type,createdAt:new Date};t({mediaFile:O})},p.readAsDataURL(h)},l=(o,h)=>{const x=[...i.possibleAnswers];x[o]=h,t({possibleAnswers:x})},u=()=>{i.possibleAnswers.length<20&&t({possibleAnswers:[...i.possibleAnswers,""]})},a=o=>{const h=i.type==="multiple-choice"?2:0;if(i.possibleAnswers.length>h){const x=i.possibleAnswers.filter((y,w)=>w!==o),j=i.correctAnswers.filter(y=>y!==o).map(y=>y>o?y-1:y);t({possibleAnswers:x,correctAnswers:j})}},f=o=>{const h=i.correctAnswers||[],x=h.includes(o);let j;x?j=h.filter(y=>y!==o):j=[...h,o].sort(),t({correctAnswers:j})},v=()=>{const o=["picture","audio","video"].includes(i.type),h=["picture","audio","video"].includes(r||"");if(!o&&!h)return null;const x=o?i.type:r;return e.jsxs(S,{sx:{mb:3},children:[e.jsx(D,{variant:"subtitle2",gutterBottom:!0,children:"Media File"}),e.jsxs(E,{variant:"outlined",component:"label",sx:{mb:2},"aria-label":`Upload ${x} file`,children:["Upload"," ",x&&x.charAt(0).toUpperCase()+x.slice(1),e.jsx("input",{type:"file",accept:x==="picture"?".jpg,.jpeg,.png,.webp,.gif,.bmp,.tiff,.svg":x==="audio"?".mp3,.wav,.wma,.m4a":".mp4,.mov,.wmv,.avi,.webm",hidden:!0,onChange:n})]}),i.mediaFile&&e.jsxs(S,{sx:{mb:2},children:[x==="picture"&&e.jsx(S,{component:"img",src:i.mediaFile.data,alt:"Question media",sx:{maxWidth:"100%",width:"100%",maxHeight:{xs:200,sm:300,md:400},height:"auto",borderRadius:2,objectFit:"contain",border:"1px solid",borderColor:"divider"}}),x==="audio"&&e.jsx(S,{component:"audio",controls:!0,src:i.mediaFile.data,sx:{width:"100%",maxWidth:400,height:40}}),x==="video"&&e.jsx(S,{component:"video",controls:!0,src:i.mediaFile.data,sx:{maxWidth:"100%",width:"100%",maxHeight:{xs:200,sm:300,md:400},height:"auto",borderRadius:2,objectFit:"contain",border:"1px solid",borderColor:"divider"}}),e.jsxs(D,{variant:"caption",display:"block",sx:{mt:1},children:[i.mediaFile.filename," (",(i.mediaFile.size/1024/1024).toFixed(2)," MB)"]}),e.jsx(E,{size:"small",color:"error",onClick:()=>t({mediaFile:void 0}),sx:{mt:1},children:"Remove File"})]})]})};return e.jsxs(Pe,{spacing:3,sx:{mt:1},children:[(r==="picture"||r==="audio"||r==="video")&&e.jsxs(ee,{fullWidth:!0,children:[e.jsx(te,{children:"Question Type"}),e.jsxs(se,{value:i.type,label:"Question Type",onChange:o=>{const h=o.target.value,x={type:h};h==="single-answer"?(x.possibleAnswers=[],x.correctAnswers=[],x.correctAnswerText=""):h==="multiple-choice"&&(x.possibleAnswers=["","","",""],x.correctAnswers=[0],x.correctAnswerText=void 0),t(x)},children:[e.jsx(F,{value:"single-answer",children:"Single Answer"}),e.jsx(F,{value:"multiple-choice",children:"Multiple Choice"})]})]}),r==="mixed"&&e.jsxs(ee,{fullWidth:!0,children:[e.jsx(te,{children:"Question Type"}),e.jsx(se,{value:i.type,label:"Question Type",onChange:o=>{const h=o.target.value,x={type:h};h==="single-answer"?(x.possibleAnswers=[],x.correctAnswers=[],x.correctAnswerText="",x.mediaFile=void 0):h==="multiple-choice"?(x.possibleAnswers=["","","",""],x.correctAnswers=[0],x.correctAnswerText=void 0,x.mediaFile=void 0):(x.possibleAnswers=[],x.correctAnswers=[],x.correctAnswerText=""),t(x)},children:s.allowedQuestionTypes.map(o=>e.jsxs(F,{value:o,children:[o==="single-answer"&&"Single Answer",o==="multiple-choice"&&"Multiple Choice",o==="picture"&&"Picture Question",o==="audio"&&"Audio Question",o==="video"&&"Video Question"]},o))})]}),e.jsx(V,{fullWidth:!0,label:"Question",value:i.question||"",onChange:o=>t({question:o.target.value}),placeholder:"Type your question here..."}),v(),i.type==="single-answer"||["picture","audio","video"].includes(i.type)&&i.possibleAnswers.length===0||r==="golden-pyramid"?e.jsxs(S,{children:[e.jsxs(S,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(D,{variant:"subtitle2",children:r==="golden-pyramid"?"Possible Answers":"Correct Answer"}),["picture","audio","video"].includes(i.type)&&r!=="golden-pyramid"&&e.jsx(E,{size:"small",variant:"outlined",onClick:()=>{t({possibleAnswers:["","","",""],correctAnswers:[0],correctAnswerText:void 0})},children:"Switch to Multiple Choice"})]}),e.jsx(V,{fullWidth:!0,label:r==="golden-pyramid"?"Type all possible answers (separated by commas, dots, etc.)":"Type the correct answer",value:i.correctAnswerText||"",onChange:o=>t({correctAnswerText:o.target.value}),placeholder:r==="golden-pyramid"?"e.g., Answer 1, Answer 2, Answer 3, Answer 4":"e.g., Sofia, Paris, 1969...",helperText:r==="golden-pyramid"?"Enter all possible answers as a single text string. Users can separate with commas, dots, or any format they prefer.":"This is the exact answer participants need to type"})]}):e.jsxs(S,{children:[e.jsxs(S,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(D,{variant:"subtitle2",children:"Answer Options (1-20 options)"}),["picture","audio","video"].includes(i.type)&&e.jsx(E,{size:"small",variant:"outlined",onClick:()=>{t({possibleAnswers:[],correctAnswers:[],correctAnswerText:""})},children:"Switch to Single Answer"})]}),e.jsxs(Pe,{spacing:2,children:[i.possibleAnswers.map((o,h)=>e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(qt,{control:e.jsx(Ot,{checked:i.correctAnswers.includes(h),onChange:()=>f(h)}),label:""}),e.jsx(V,{fullWidth:!0,value:o,onChange:x=>l(h,x.target.value),placeholder:`Enter option ${h+1}...`}),i.possibleAnswers.length>1&&e.jsx(J,{onClick:()=>a(h),color:"error",size:"small",children:e.jsx(he,{})})]},h)),i.possibleAnswers.length<20&&e.jsx(E,{startIcon:e.jsx(ue,{}),onClick:u,variant:"outlined",size:"small",children:"Add Option"})]}),i.correctAnswers.length===0&&e.jsx(D,{variant:"caption",color:"error",children:"Please select at least one correct answer"})]}),e.jsxs(S,{sx:{display:"flex",gap:2,width:"100%",flexWrap:"nowrap",alignItems:"flex-start"},children:[e.jsx(V,{fullWidth:!0,type:"number",label:"Points",placeholder:"1",inputProps:{min:.1,step:.1},value:i.points||"",onChange:o=>t({points:Number(o.target.value)||1}),sx:{flex:1,minWidth:0}}),e.jsx(V,{fullWidth:!0,type:"number",label:"Time Limit (min)",placeholder:"1",inputProps:{min:.1,step:.1},value:i.timeLimit||"",onChange:o=>t({timeLimit:Number(o.target.value)||1}),sx:{flex:1,minWidth:0}}),e.jsxs(V,{fullWidth:!0,select:!0,label:"Difficulty",value:i.difficulty,onChange:o=>t({difficulty:o.target.value}),sx:{flex:1,minWidth:0},children:[e.jsx(F,{value:"easy",children:"Easy"}),e.jsx(F,{value:"medium",children:"Medium"}),e.jsx(F,{value:"hard",children:"Hard"})]})]}),e.jsx(V,{fullWidth:!0,label:"Explanation (optional)",multiline:!0,minRows:2,maxRows:3,value:i.explanation||"",onChange:o=>t({explanation:o.target.value}),placeholder:"Optional explanation shown after the question..."})]})};let ze=0,Ce=0;const We=6e4,He=15,rt=4e3;function Ss(){const i=Date.now();if(i-ze>We&&(Ce=0),Ce>=He){const r=We-(i-ze);return{isRateLimited:!0,retryAfter:Math.ceil(r/1e3),message:`Rate limit reached (${He}/minute). Please wait ${Math.ceil(r/1e3)} seconds.`}}const t=i-ze;if(t<rt&&Ce>0){const r=rt-t;return{isRateLimited:!0,retryAfter:Math.ceil(r/1e3),message:`Please wait ${Math.ceil(r/1e3)} seconds between requests to avoid rate limits.`}}return{isRateLimited:!1}}function it(i){return new Promise(t=>setTimeout(t,i*1e3))}const bt=async(i={},t)=>{var r;try{const s=Ss();if(s.isRateLimited){const h=s.retryAfter||4;t||await it(h)}const n="AIzaSyAzhUzT7hqprvBPcz96iN8j0zdAw84pBb4";if(!navigator.onLine)throw new Error("Internet connection required");Ce++,ze=Date.now();const u={contents:[{parts:[{text:zs(i.difficulty||"medium",i.language||"English",i.category||"random",i.previousQuestions||[])}]}],generationConfig:{temperature:.9,topK:40,topP:.95,maxOutputTokens:1024}},a=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!a.ok){const h=await a.json().catch(()=>({}));if(a.status===429)return await it(4),bt(i,t);throw new Error(`Gemini API error: ${a.status} - ${((r=h.error)==null?void 0:r.message)||"Unknown error"}`)}const f=await a.json();if(!f.candidates||f.candidates.length===0)throw new Error("No response generated from Gemini API");const v=f.candidates[0].content.parts[0].text,o=Ds(v);return{id:Math.random().toString(36).substring(7),question:o.question,answer:o.answer,category:o.category,difficulty:o.difficulty}}catch(s){throw console.error("Gemini API error:",s),s instanceof Error?s:new Error("Failed to generate question. Please try again.")}};function zs(i,t,r,s){const n=t.toLowerCase()==="bulgarian"?"Generate the question and answer in Bulgarian language.":"Generate the question and answer in English language.",l=r.toLowerCase()==="random"?"Choose a random general knowledge topic.":`Generate a question about the category: ${r}`,u=Cs(i);let a="";s.length>0&&(a=`

IMPORTANT: Do NOT repeat any of these recently asked questions. Generate something completely different:
${s.slice(-10).map((o,h)=>`${h+1}. ${o.question}`).join(`
`)}`);const f=As(r);return`You are an expert quiz master with access to accurate, up-to-date information. Generate a single quiz question and its answer.

${n}
${l}
${u}
${f}
${a}

CRITICAL REQUIREMENTS:
- The answer must be 100% factually correct and verifiable
- For geographic questions, double-check all facts (heights, locations, names)
- Avoid controversial or ambiguous topics
- Make the question engaging and educational
- Ensure the question is unique and not repetitive

IMPORTANT: Respond ONLY with a valid JSON object in this exact format:
{
  "question": "Your generated question here",
  "answer": "The correct answer here", 
  "category": "The category of the question",
  "difficulty": "${i}"
}

Do not include any other text, explanations, or formatting outside the JSON object.`}function Cs(i){switch(i.toLowerCase()){case"easy":return"Make this an EASY question that most people would know. Use basic, well-known facts that are commonly taught in school or widely known in popular culture.";case"hard":return"Make this a HARD question that requires specialized knowledge, advanced education, or deep expertise in a specific field. Use complex concepts, technical details, or obscure historical facts.";case"medium":default:return"Make this a MEDIUM difficulty question that requires some general knowledge and thinking. It should be challenging but not impossible for an educated person to answer."}}function As(i){const t=i.toLowerCase();return t.includes("geography")||t.includes("ÑÐ¼Ð¾Ð»ÑÐ½")||t.includes("bulgaria")||t.includes("mountain")||t.includes("peak")?`
FACT-CHECKING FOR GEOGRAPHY: 
- For Bulgarian geography: Verify all mountain peaks, heights, and locations
- For Smolyan region: The highest peak near Smolyan is Perelik (2,191m), NOT Snezhanka
- Snezhanka is near Pamporovo but is NOT the highest peak in the Smolyan area
- Always verify geographical facts against reliable sources
- Double-check all numerical data (heights, distances, populations)`:t.includes("history")?`
FACT-CHECKING FOR HISTORY: 
- Verify all dates, names, and historical events
- Ensure chronological accuracy
- Cross-reference multiple historical sources`:t.includes("science")?`
FACT-CHECKING FOR SCIENCE: 
- Verify all scientific facts and figures
- Ensure formulas and laws are correct
- Use current scientific understanding`:`
FACT-CHECKING: 
- Verify all facts before including them
- Use reliable, authoritative sources
- Avoid outdated or disputed information`}function Ds(i){try{const r=i.trim().match(/\{[\s\S]*\}/);if(!r)throw new Error("No JSON found in response");const s=JSON.parse(r[0]);if(!s.question||!s.answer)throw new Error("Missing required fields in response");return{question:s.question,answer:s.answer,category:s.category||"General Knowledge",difficulty:s.difficulty||"medium"}}catch{return console.error("Failed to parse Gemini response:",i),{question:"What is the capital of France?",answer:"Paris",category:"Geography",difficulty:"easy"}}}const wt=()=>!!navigator.onLine,ks=()=>{const i=Date.now();i-ze>We&&(Ce=0);const t=Math.max(0,He-Ce),r=Math.max(0,We-(i-ze)),s=t<=3;return{requestsRemaining:t,timeUntilReset:Math.ceil(r/1e3),isNearLimit:s}},Ts=async(i={},t)=>{try{if(!wt())return{question:nt(),success:!1,error:"AI service is not available. Please check your connection and try again."};const r={difficulty:i.difficulty||"medium",language:i.language||"English",category:i.topicHint||Rs(i.category||"general"),previousQuestions:Fs(i.previousQuestions||[])},s=await bt(r,t),n=i.questionType||"text-answer";return{question:await Is(s,n,i.optionsCount||4,i.difficulty||"medium"),success:!0}}catch(r){const s=r instanceof Error?r.message:"Failed to generate question";return{question:nt(),success:!1,error:s}}};async function Is(i,t,r,s){const n=new Date,l={id:vt(),question:i.question,difficulty:s,points:Os(),timeLimit:60,createdAt:n,updatedAt:n};if(t==="text-answer")return{...l,type:"single-answer",possibleAnswers:[],correctAnswers:[],correctAnswerText:i.answer,explanation:i.answer};{const u=await Es(i.question,i.answer,r-1,s),a=[i.answer,...u],f=qs([...a]),v=f.indexOf(i.answer);return{...l,type:"multiple-choice",possibleAnswers:f,correctAnswers:[v],correctAnswerText:"",explanation:i.answer}}}async function Es(i,t,r,s){var n,l,u,a,f;try{const v=Qs(i,t,r,s),o="AIzaSyAzhUzT7hqprvBPcz96iN8j0zdAw84pBb4",h=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${o}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:v}]}],generationConfig:{temperature:.8,topK:40,topP:.9}})});if(!h.ok)return $e(t,r);const j=((f=(a=(u=(l=(n=(await h.json()).candidates)==null?void 0:n[0])==null?void 0:l.content)==null?void 0:u.parts)==null?void 0:a[0])==null?void 0:f.text)||"",y=Ms(j,r);if(y.length<r){const w=$e(t,r-y.length);return[...y,...w]}return y.slice(0,r)}catch(v){return console.warn("Failed to generate AI distractors, using fallback:",v),$e(t,r)}}function Qs(i,t,r,s){const n={easy:"Make the wrong answers obviously incorrect but still plausible.",medium:"Make the wrong answers plausible but clearly distinguishable from the correct answer.",hard:"Make the wrong answers very plausible and similar to the correct answer."}[s];return`Generate ${r} incorrect but plausible answers for this multiple choice question.

Question: ${i}
Correct Answer: ${t}

Requirements:
- ${n}
- Each wrong answer should be on a separate line
- Make them the same format/length as the correct answer
- Don't number them or add extra text
- Make them factually wrong but believable
- Avoid obviously ridiculous answers

Wrong answers:`}function Ms(i,t){return i.split(`
`).map(s=>s.trim()).filter(s=>s.length>0).filter(s=>!s.match(/^[0-9]+\.?\s/)).slice(0,t)}function $e(i,t){const r=[];for(let s=0;s<t;s++)if(i.match(/^\d+$/)){const n=parseInt(i);r.push(String(n+(s+1)*10))}else i.match(/^[A-Z]/)?r.push(`Alternative ${String.fromCharCode(65+s)}`):r.push(`Option ${String.fromCharCode(65+s)}`);return r}function nt(){const i=new Date;return{id:vt(),type:"text",question:"",options:["","","",""],correctAnswer:0,difficulty:"medium",points:1,timeLimit:60,createdAt:i,updatedAt:i}}function vt(){return`q_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function Rs(i){return{general:"General Knowledge",sports:"Sports",history:"History",science:"Science",geography:"Geography",entertainment:"Entertainment",literature:"Literature",art:"Art",music:"Music",technology:"Technology",custom:"General Knowledge"}[i]||"General Knowledge"}function Fs(i){return i.map(t=>({question:t.question,answer:t.options[t.correctAnswer]||""}))}function qs(i){const t=[...i];for(let r=t.length-1;r>0;r--){const s=Math.floor(Math.random()*(r+1));[t[r],t[s]]=[t[s],t[r]]}return t}function Os(i){return 1}const at=()=>wt(),Ls=()=>ks(),Ps=({draftQuiz:i,updateDraft:t,showValidation:r})=>{const{state:s,actions:n,derived:l}=gs(i),{rounds:u,currentRound:a,isRoundFormValid:f}=l,v=[{value:"mixed",label:"Mixed Types"},{value:"single-answer",label:"Single Answer Only"},{value:"multiple-choice",label:"Multiple Choice"},{value:"picture",label:"Picture Round"},{value:"audio",label:"Audio Round"},{value:"video",label:"Video Round"},{value:"golden-pyramid",label:"Golden Pyramid"}],o=[{value:"after-each",label:"After Each Question"},{value:"after-all",label:"After All Questions"}],[h,x]=T.useState(!1),[j,y]=T.useState(null),w=()=>{var k,q,_;if(!f)return;const g=s.roundModalMode==="add"?u.length:s.currentRoundIdx,d={id:((k=s.editingRound)==null?void 0:k.id)||`round_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:`Round ${g+1}`,description:s.roundForm.description,type:s.roundForm.type,answerRevealMode:s.roundForm.answerRevealMode,defaultTimePerQuestion:Number(s.roundForm.defaultTimePerQuestion),breakingTime:Number(s.roundForm.breakingTime),level:i.difficulty||"medium",questions:((q=s.editingRound)==null?void 0:q.questions)||[],createdAt:((_=s.editingRound)==null?void 0:_.createdAt)||new Date,updatedAt:new Date};if(s.roundForm.type==="golden-pyramid"&&d.questions.length===0){const X=Array.from({length:4},(re,ie)=>({id:`question_${Date.now()}_${ie}_${Math.random().toString(36).substr(2,9)}`,type:"multiple-choice",question:"",possibleAnswers:Array.from({length:ie+1},()=>""),correctAnswers:Array.from({length:ie+1},(me,le)=>le),correctAnswerText:"",explanation:"",mediaFile:void 0,difficulty:i.difficulty||"medium",points:1,timeLimit:Number(s.roundForm.defaultTimePerQuestion),createdAt:new Date,updatedAt:new Date}));d.questions=X}C(d)},z=T.useCallback(()=>e.jsxs(U,{open:s.aiDialogOpen,onClose:n.closeAIDialog,maxWidth:"sm",fullWidth:!0,children:[e.jsx(K,{children:e.jsxs(S,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(mt,{color:"primary"}),"Generate AI Question"]})}),e.jsx(H,{children:e.jsxs(Pe,{spacing:3,sx:{mt:1},children:[(s.aiGenerating||s.aiStatus)&&e.jsx(pe,{severity:"info",icon:s.aiGenerating?e.jsx(Lt,{size:20}):void 0,children:s.aiStatus||"Generating question..."}),s.aiError&&!s.aiErrorDismissed&&e.jsx(pe,{severity:"error",action:e.jsx(J,{size:"small",onClick:()=>n.setAiErrorDismissed(!0),"aria-label":"Dismiss error",children:e.jsx(Me,{fontSize:"small"})}),children:s.aiError}),(a==null?void 0:a.type)==="mixed"&&e.jsxs(ee,{fullWidth:!0,children:[e.jsx(te,{children:"Question Type"}),e.jsxs(se,{value:s.aiSettings.questionType||"text-answer",onChange:g=>n.setAiSettings({...s.aiSettings,questionType:g.target.value}),label:"Question Type",children:[e.jsx(F,{value:"text-answer",children:e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Pt,{fontSize:"small"}),"Single Answer"]})}),e.jsx(F,{value:"text",children:e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Wt,{fontSize:"small"}),"Multiple Choice"]})})]})]}),e.jsxs(ee,{fullWidth:!0,children:[e.jsx(te,{children:"Language"}),e.jsxs(se,{value:s.aiSettings.language||"English",onChange:g=>n.setAiSettings({...s.aiSettings,language:g.target.value}),label:"Language",children:[e.jsx(F,{value:"English",children:"English"}),e.jsx(F,{value:"Bulgarian",children:"Bulgarian"})]})]}),e.jsx(V,{fullWidth:!0,label:"Topic (optional)",placeholder:"e.g., Ancient Rome, Quantum Physics, Football...",value:s.aiSettings.topicHint||"",onChange:g=>n.setAiSettings({...s.aiSettings,topicHint:g.target.value}),helperText:"Leave empty for random topic"}),e.jsxs(ee,{fullWidth:!0,children:[e.jsx(te,{children:"Category"}),e.jsxs(se,{value:s.aiSettings.category||"general",onChange:g=>n.setAiSettings({...s.aiSettings,category:g.target.value}),label:"Category",children:[e.jsx(F,{value:"general",children:"General Knowledge"}),e.jsx(F,{value:"science",children:"Science"}),e.jsx(F,{value:"history",children:"History"}),e.jsx(F,{value:"geography",children:"Geography"}),e.jsx(F,{value:"sports",children:"Sports"}),e.jsx(F,{value:"entertainment",children:"Entertainment"}),e.jsx(F,{value:"literature",children:"Literature"}),e.jsx(F,{value:"art",children:"Art"}),e.jsx(F,{value:"music",children:"Music"}),e.jsx(F,{value:"technology",children:"Technology"})]})]}),e.jsxs(ee,{fullWidth:!0,children:[e.jsx(te,{children:"Difficulty"}),e.jsxs(se,{value:s.aiSettings.difficulty||"medium",onChange:g=>n.setAiSettings({...s.aiSettings,difficulty:g.target.value}),label:"Difficulty",children:[e.jsx(F,{value:"easy",children:"Easy"}),e.jsx(F,{value:"medium",children:"Medium"}),e.jsx(F,{value:"hard",children:"Hard"})]})]}),(s.aiSettings.questionType==="text"||(a==null?void 0:a.type)==="multiple-choice"&&a.type!=="mixed")&&e.jsxs(ee,{fullWidth:!0,children:[e.jsx(te,{children:"Number of Options"}),e.jsxs(se,{value:s.aiSettings.optionsCount||4,onChange:g=>n.setAiSettings({...s.aiSettings,optionsCount:Number(g.target.value)}),label:"Number of Options",children:[e.jsx(F,{value:2,children:"2 Options"}),e.jsx(F,{value:3,children:"3 Options"}),e.jsx(F,{value:4,children:"4 Options"}),e.jsx(F,{value:5,children:"5 Options"}),e.jsx(F,{value:6,children:"6 Options"})]})]}),at()&&e.jsx(S,{sx:{p:2,bgcolor:"background.paper",borderRadius:1},children:e.jsxs(D,{variant:"body2",color:"text.secondary",children:["AI questions remaining:"," ",Ls().requestsRemaining,"/15 per minute"]})})]})}),e.jsxs(Z,{children:[e.jsx(E,{onClick:n.closeAIDialog,children:"Cancel"}),e.jsx(E,{onClick:async()=>{n.setAiGenerating(!0),n.setAiError(null),n.setAiErrorDismissed(!1);try{let g=s.aiSettings.questionType;(a==null?void 0:a.type)==="single-answer"?g="text-answer":(a==null?void 0:a.type)==="multiple-choice"&&(g="text");const d=await Ts({questionType:g||"text-answer",language:s.aiSettings.language||"English",topicHint:s.aiSettings.topicHint,category:s.aiSettings.category||"general",difficulty:s.aiSettings.difficulty||"medium",optionsCount:s.aiSettings.optionsCount||4});if(d.success&&d.question){const k={...d.question,id:`q_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,difficulty:s.aiSettings.difficulty||"medium",points:1,timeLimit:(a==null?void 0:a.defaultTimePerQuestion)||1,createdAt:new Date,updatedAt:new Date},q={...a,questions:[...(a==null?void 0:a.questions)||[],k],updatedAt:new Date};t({rounds:u.map((_,X)=>X===s.currentRoundIdx?q:_)}),n.setAiStatus("Question generated successfully!"),setTimeout(()=>{n.closeAIDialog(),n.setAiStatus(null)},1500)}else n.setAiError(d.error||"Failed to generate question")}catch(g){n.setAiError(g instanceof Error?g.message:"Unknown error occurred")}finally{n.setAiGenerating(!1)}},variant:"contained",disabled:s.aiGenerating||!at(),children:s.aiGenerating?"Generating...":"Generate"})]})]}),[s.aiDialogOpen,s.aiGenerating,s.aiStatus,s.aiError,s.aiErrorDismissed,s.aiSettings,a,u,s.currentRoundIdx,n,t]),Q=()=>{if(!a)return;const g=Ee[a.type];let d;a.type==="picture"?d="picture":a.type==="audio"?d="audio":a.type==="video"?d="video":a.type==="golden-pyramid"||g.canSelectQuestionType?d="single-answer":d=g.allowedQuestionTypes[0];let k;d==="single-answer"||a.type==="golden-pyramid"?k={possibleAnswers:[],correctAnswers:[],correctAnswerText:"",question:""}:d==="multiple-choice"?k={possibleAnswers:["","","",""],correctAnswers:[0],correctAnswerText:void 0}:["picture","audio","video"].includes(d)?k={possibleAnswers:[],correctAnswers:[],correctAnswerText:""}:k={possibleAnswers:[""],correctAnswers:[0],correctAnswerText:void 0},n.setManualQuestion({id:`q_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:d,question:"",...k,explanation:"",mediaFile:void 0,difficulty:i.difficulty||"medium",points:1,timeLimit:a.defaultTimePerQuestion||1,createdAt:new Date,updatedAt:new Date}),n.openManualDialog()},c=s.manualQuestion&&s.manualQuestion.question.trim()&&(()=>{const g=s.manualQuestion;return g.type==="single-answer"||["picture","audio","video"].includes(g.type)&&g.possibleAnswers.length===0||(a==null?void 0:a.type)==="golden-pyramid"?g.correctAnswerText&&g.correctAnswerText.trim():["picture","audio","video"].includes(g.type)&&g.possibleAnswers.length>0||!["picture","audio","video"].includes(g.type)&&g.type!=="single-answer"?g.possibleAnswers.length>=2&&g.possibleAnswers.every(d=>d.trim())&&g.correctAnswers.length>0:!1})(),p=()=>{n.openRoundModal("add")},b=()=>{n.openRoundModal("edit",a||void 0)},C=g=>{s.roundModalMode==="add"?(t({rounds:[...u,g]}),n.setCurrentRoundIdx(u.length)):s.roundModalMode==="edit"&&a&&t({rounds:u.map((d,k)=>k===s.currentRoundIdx?g:d)}),n.closeRoundModal()},L=()=>{if(s.roundModalMode==="edit"&&s.editingRound){if(s.editingRound.type==="golden-pyramid")return[{value:"golden-pyramid",label:"Golden Pyramid"}];if(s.editingRound.questions.length>0)return[{value:s.editingRound.type,label:Ee[s.editingRound.type].label},{value:"mixed",label:"Mixed Types"}].filter((g,d,k)=>d===k.findIndex(q=>q.value===g.value))}return v.filter(g=>s.roundModalMode==="add"||g.value!=="golden-pyramid")},A=()=>{n.openDeleteRoundConfirm()},I=()=>{if(!a)return;const g=u.filter((d,k)=>k!==s.currentRoundIdx);t({rounds:g}),n.setCurrentRoundIdx(Math.max(0,s.currentRoundIdx-1)),n.closeDeleteRoundConfirm()},M=()=>n.closeDeleteRoundConfirm(),O=g=>{n.openDeleteQuestionConfirm(g)},N=()=>{var k;if(!a||!s.pendingDeleteQuestionId)return;const g=a.questions.filter(q=>q.id!==s.pendingDeleteQuestionId),d={...a,questions:g,updatedAt:new Date};t({rounds:u.map((q,_)=>_===s.currentRoundIdx?d:q)}),s.editingQuestionId===s.pendingDeleteQuestionId&&n.setEditingQuestionId(null),((k=s.manualQuestion)==null?void 0:k.id)===s.pendingDeleteQuestionId&&n.closeManualDialog(),n.closeDeleteQuestionConfirm()},$=()=>{n.closeDeleteQuestionConfirm()};return e.jsxs(S,{sx:{maxWidth:1e3,mx:"auto"},children:[e.jsx(ys,{rounds:u,currentRoundIdx:s.currentRoundIdx,currentRound:a,onPreviousRound:n.goToPrevRound,onNextRound:n.goToNextRound,onAddRound:p,onEditRound:b,onDeleteRound:A}),e.jsx(vs,{showActions:!!a,roundType:a==null?void 0:a.type,onOpenAIDialog:n.openAIDialog,onOpenManualDialog:Q}),e.jsx(ws,{currentRound:a,onEditQuestion:g=>{n.setManualQuestion(g),n.openManualDialog()},onDeleteQuestion:O,onAddRound:p,onAddQuestion:Q}),z(),e.jsxs(U,{open:s.manualDialogOpen,onClose:n.closeManualDialog,maxWidth:"sm",fullWidth:!0,children:[e.jsx(K,{children:s.manualQuestion&&(a!=null&&a.questions.some(g=>{var d;return g.id===((d=s.manualQuestion)==null?void 0:d.id)}))?`Edit ${a?(()=>{const g=Ee[a.type].label;return g.includes("Question")?g:`${g} Question`})():"Question"}`:`Add ${a?(()=>{const g=Ee[a.type].label;return g.includes("Question")?g:`${g} Question`})():"Question"}`}),e.jsx(H,{children:s.manualQuestion&&e.jsx(js,{question:s.manualQuestion,roundType:a==null?void 0:a.type,onUpdate:g=>n.setManualQuestion(s.manualQuestion?{...s.manualQuestion,...g,updatedAt:new Date}:null)})}),e.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:3,py:2},children:[s.manualQuestion&&(a==null?void 0:a.questions.some(g=>{var d;return g.id===((d=s.manualQuestion)==null?void 0:d.id)}))&&e.jsx(J,{onClick:()=>{var g;(g=s.manualQuestion)!=null&&g.id&&O(s.manualQuestion.id)},color:"error",sx:{bgcolor:"error.50","&:hover":{bgcolor:"error.100"}},"aria-label":"Delete question",children:e.jsx(he,{})}),!(s.manualQuestion&&(a!=null&&a.questions.some(g=>{var d;return g.id===((d=s.manualQuestion)==null?void 0:d.id)})))&&e.jsx(S,{}),e.jsxs(S,{sx:{display:"flex",gap:1},children:[e.jsx(E,{onClick:n.closeManualDialog,children:"Cancel"}),e.jsx(E,{onClick:()=>{if(s.manualQuestion){if(a!=null&&a.questions.some(g=>{var d;return g.id===((d=s.manualQuestion)==null?void 0:d.id)})){const g=a.questions.map(k=>{var q;return k.id===((q=s.manualQuestion)==null?void 0:q.id)?s.manualQuestion:k}),d={...a,questions:g,updatedAt:new Date};t({rounds:u.map((k,q)=>q===s.currentRoundIdx?d:k)})}else{const g={...a,questions:[...(a==null?void 0:a.questions)||[],s.manualQuestion],updatedAt:new Date};t({rounds:u.map((d,k)=>k===s.currentRoundIdx?g:d)})}n.closeManualDialog()}},variant:"contained",disabled:!c,children:"Save"})]})]})]}),e.jsxs(U,{open:s.roundModalOpen,onClose:n.closeRoundModal,maxWidth:"sm",fullWidth:!0,children:[e.jsx(K,{children:s.roundModalMode==="add"?"Add Round":"Edit Round"}),e.jsx(H,{children:e.jsxs(S,{component:"form",sx:{display:"flex",flexDirection:"column",gap:3,mt:1},children:[e.jsxs(ee,{fullWidth:!0,required:!0,children:[e.jsx(te,{children:"Round Type"}),e.jsx(se,{value:s.roundForm.type,label:"Round Type",onChange:g=>n.updateRoundForm("type",g.target.value),"aria-label":"Round type",renderValue:g=>{const d=L().find(k=>k.value===g);return d?d.label:g},children:L().map(g=>e.jsxs(F,{value:g.value,sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("span",{children:g.label}),e.jsx(J,{"aria-label":`Info about ${g.label}`,size:"small",onClick:d=>{d.stopPropagation(),y(g.value),x(!0)},sx:{ml:2},children:e.jsx(Ye,{fontSize:"small"})})]},g.value))})]}),e.jsxs(ee,{fullWidth:!0,required:!0,children:[e.jsx(te,{children:"Answer Reveal Mode"}),e.jsx(se,{value:s.roundForm.answerRevealMode,label:"Answer Reveal Mode",onChange:g=>n.updateRoundForm("answerRevealMode",g.target.value),"aria-label":"Answer reveal mode",children:o.map(g=>e.jsx(F,{value:g.value,children:g.label},g.value))})]}),e.jsxs(S,{children:[e.jsx(D,{gutterBottom:!0,children:"Default Time Per Question (minutes)"}),e.jsx(V,{type:"number",fullWidth:!0,label:"Minutes",inputProps:{min:.1,max:10,step:.1},value:s.roundForm.defaultTimePerQuestion,onChange:g=>{let d=Number(g.target.value);d<.1&&(d=.1),d>10&&(d=10),n.updateRoundForm("defaultTimePerQuestion",d)},helperText:"Time limit per question (0.5 = 30 seconds, 1 = 60 seconds)","aria-label":"Default time per question in minutes"})]}),e.jsxs(S,{children:[e.jsx(D,{gutterBottom:!0,children:"Breaking Time (minutes)"}),e.jsx(V,{type:"number",fullWidth:!0,label:"Minutes",placeholder:"5",inputProps:{min:.1,max:10,step:.1},value:s.roundForm.breakingTime||"",onChange:g=>{let d=Number(g.target.value)||5;d<.1&&(d=.1),d>10&&(d=10),n.updateRoundForm("breakingTime",d)},helperText:"Break time between rounds (default 5 minutes)","aria-label":"Breaking time between rounds in minutes"})]}),e.jsx(V,{label:"Round Description (Optional)",value:s.roundForm.description,onChange:g=>n.updateRoundForm("description",g.target.value),fullWidth:!0,multiline:!0,minRows:2,maxRows:4,inputProps:{maxLength:120},"aria-label":"Round description",helperText:"Optional description for this round"})]})}),e.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:3,py:2},children:[s.roundModalMode==="edit"&&u.length>0&&e.jsx(J,{onClick:A,color:"error",sx:{bgcolor:"error.50","&:hover":{bgcolor:"error.100"}},"aria-label":"Delete round",children:e.jsx(he,{})}),s.roundModalMode==="add"&&e.jsx(S,{}),e.jsxs(S,{sx:{display:"flex",gap:1},children:[e.jsx(E,{onClick:n.closeRoundModal,children:"Cancel"}),e.jsx(E,{onClick:w,variant:"contained",disabled:!f,children:"Save"})]})]})]}),r&&u.some(g=>g.questions.length===0)&&e.jsx(pe,{severity:"error",sx:{mt:2},children:"Each round must have at least one question to proceed."}),e.jsxs(U,{open:s.deleteRoundConfirmOpen,onClose:M,"aria-labelledby":"delete-round-dialog-title","aria-describedby":"delete-round-dialog-description",children:[e.jsx(K,{id:"delete-round-dialog-title",children:"Confirm Delete Round"}),e.jsx(H,{children:e.jsx(Ue,{id:"delete-round-dialog-description",children:"Are you sure you want to delete this round? All questions in this round will be lost. This action cannot be undone."})}),e.jsxs(Z,{children:[e.jsx(E,{onClick:M,color:"primary",autoFocus:!0,children:"Cancel"}),e.jsx(E,{onClick:I,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsxs(U,{open:s.deleteQuestionConfirmOpen,onClose:$,"aria-labelledby":"delete-question-dialog-title","aria-describedby":"delete-question-dialog-description",children:[e.jsx(K,{id:"delete-question-dialog-title",children:"Confirm Delete Question"}),e.jsx(H,{children:e.jsx(Ue,{id:"delete-question-dialog-description",children:"Are you sure you want to delete this question? This action cannot be undone."})}),e.jsxs(Z,{children:[e.jsx(E,{onClick:$,color:"primary",autoFocus:!0,children:"Cancel"}),e.jsx(E,{onClick:N,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsx(yt,{open:h&&!!j,onClose:()=>x(!1),roundType:j||"mixed"})]})},Ws=({onQuizCreated:i,onCancel:t,editQuiz:r,onQuizDeleted:s})=>{var re,ie,me,le,De,B,ce,ye;const{mode:n,handleThemeChange:l}=Ht(),[u,a]=m.useState(!0),[f,v]=m.useState(!1),[o,h]=m.useState(!1),[x,j]=m.useState(!1),[y,w]=m.useState(!1),[z,Q]=m.useState(!0),[c,p]=m.useState(!1),{draftQuiz:b,updateDraft:C,resetWizard:L,completeWizard:A}=ls(r),I=((re=b.rounds)==null?void 0:re.flatMap(P=>P.questions).length)||0,M=((ie=b.rounds)==null?void 0:ie.length)||0,O=!!((me=b.title)!=null&&me.trim()||I>0||(le=b.description)!=null&&le.trim()||b.category||b.difficulty),N=m.useCallback(()=>{b.title||I>0?setTimeout(()=>{Q(!1),t()},100):(Q(!1),t())},[b.title,I,t]),$=m.useCallback(()=>{a(!0);const P=document.querySelector('[data-testid="wizard-content"]');P&&P.scrollTo({top:0,behavior:"smooth"})},[]),g=m.useCallback(()=>{O&&v(!0)},[O]),d=m.useCallback(async()=>{j(!0);try{const P=await A();i(P),L(),v(!1),t()}catch(P){console.error("Error saving quiz:",P)}finally{j(!1)}},[A,i,L,t]),k=m.useCallback(()=>{v(!1)},[]),q=m.useCallback(()=>{r&&h(!0)},[r]),_=m.useCallback(async()=>{if(r){w(!0);try{const{indexedDBService:P}=await Yt(async()=>{const{indexedDBService:be}=await Promise.resolve().then(()=>as);return{indexedDBService:be}},void 0),fe=await P.deleteQuiz(r.id);if(fe.success)s&&s(r.id),t();else throw new Error(fe.error||"Failed to delete quiz")}catch(P){console.error("Error deleting quiz:",P)}finally{w(!1),h(!1)}}},[r,t,s]),X=m.useCallback(()=>{h(!1)},[]);return m.useEffect(()=>{const P=new window.BroadcastChannel("quizzard-quiz-events"),fe=be=>{var Fe;((Fe=be.data)==null?void 0:Fe.type)==="QUIZ_DELETED"&&be.data.id===(b==null?void 0:b.id)&&p(!0)};return P.addEventListener("message",fe),()=>{P.removeEventListener("message",fe),P.close()}},[b==null?void 0:b.id]),m.useEffect(()=>{c&&typeof t=="function"&&t()},[c,t]),e.jsx(ds,{fallback:e.jsx(U,{open:!0,fullScreen:!0,children:e.jsx(H,{sx:{display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.default"},children:e.jsxs(D,{variant:"h6",color:"error",textAlign:"center",children:["Something went wrong in the quiz wizard.",e.jsx("br",{}),"Please refresh the page and try again."]})})}),children:e.jsxs(U,{open:z,onClose:N,fullScreen:!0,PaperProps:{sx:{bgcolor:"background.default",backgroundImage:"none",display:"flex",flexDirection:"column",height:"100vh"}},TransitionComponent:Oe,transitionDuration:300,children:[e.jsx(S,{sx:{zIndex:1400,position:"relative"},children:e.jsx(Kt,{mode:n,onThemeChange:l})}),e.jsx(H,{"data-testid":"wizard-content",sx:{flex:1,p:0,display:"flex",flexDirection:"column",overflow:"auto"},children:e.jsxs(S,{sx:{maxWidth:1200,mx:"auto",width:"100%",px:{xs:2,sm:3,md:4},py:{xs:2,sm:3}},children:[u&&e.jsxs(S,{sx:{mb:4},children:[e.jsx(D,{variant:"h4",gutterBottom:!0,fontWeight:600,children:"Quiz Details"}),e.jsx(fs,{draftQuiz:b,updateDraft:C,validation:{isValid:!0,errors:[],warnings:[],validatedAt:new Date},onDeleteQuiz:r?q:void 0,isEditMode:!!r,onContinue:()=>a(!1)})]}),!u&&e.jsx(S,{children:e.jsx(Ps,{draftQuiz:b,updateDraft:C,showValidation:!1})})]})}),!u&&e.jsx(e.Fragment,{children:e.jsxs(S,{sx:{position:"fixed",bottom:{xs:16,sm:24},right:{xs:16,sm:24},display:"flex",flexDirection:"row",gap:2,zIndex:1300},children:[e.jsx(S,{sx:{display:{xs:"block",sm:"none"}},children:e.jsx(Re,{color:"secondary",onClick:$,sx:{boxShadow:3,"&:hover":{boxShadow:6}},children:e.jsx(Ae,{})})}),e.jsx(S,{sx:{display:{xs:"none",sm:"block"}},children:e.jsx(E,{variant:"contained",color:"secondary",onClick:$,startIcon:e.jsx(Ae,{}),sx:{boxShadow:3,"&:hover":{boxShadow:6},minWidth:120,height:56},children:"Edit Quiz"})}),e.jsx(S,{sx:{display:{xs:"block",sm:"none"}},children:e.jsx(Re,{color:"primary",onClick:g,disabled:!O,sx:{boxShadow:3,"&:hover":{boxShadow:6},"&.Mui-disabled":{bgcolor:"action.disabled"}},children:e.jsx(Ne,{})})}),e.jsx(S,{sx:{display:{xs:"none",sm:"block"}},children:e.jsx(E,{variant:"contained",color:"primary",onClick:g,disabled:!O,startIcon:e.jsx(Ne,{}),sx:{boxShadow:3,"&:hover":{boxShadow:6},"&.Mui-disabled":{bgcolor:"action.disabled"},minWidth:120,height:56},children:"Save Quiz"})})]})}),e.jsxs(U,{open:f,onClose:k,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2,boxShadow:24}},children:[e.jsxs(K,{sx:{display:"flex",alignItems:"center",gap:2,pb:2},children:[e.jsx(ht,{color:"success"}),e.jsx(D,{variant:"h6",fontWeight:600,children:"Save Quiz"})]}),e.jsxs(H,{sx:{pb:2},children:[e.jsx(de,{variant:"outlined",sx:{mb:3,bgcolor:"background.paper",border:"1px solid",borderColor:"divider"},children:e.jsxs(xe,{children:[e.jsx(D,{variant:"h6",gutterBottom:!0,fontWeight:600,children:b.title}),b.description&&e.jsx(D,{variant:"body2",color:"text.secondary",paragraph:!0,sx:{mb:2},children:b.description}),e.jsxs(S,{sx:{display:"flex",gap:1,flexWrap:"wrap",mb:2},children:[e.jsx(ne,{icon:e.jsx(Le,{}),label:b.category||"General",size:"small",variant:"outlined"}),e.jsx(ne,{icon:e.jsx(Xe,{}),label:`${M} Round${M!==1?"s":""}`,size:"small",variant:"filled",color:"secondary"}),e.jsx(ne,{icon:e.jsx(Ge,{}),label:`${I} Question${I!==1?"s":""}`,size:"small",variant:"filled",color:"primary"})]}),e.jsx(ft,{sx:{my:2}}),e.jsxs(D,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Difficulty:"})," ",b.difficulty||"Not set"]})]})}),e.jsx(D,{variant:"body2",color:"text.secondary",textAlign:"center",children:"Are you ready to save this quiz? You can always edit it later."})]}),e.jsxs(Z,{sx:{px:3,pb:3,gap:1},children:[e.jsx(E,{onClick:k,variant:"outlined",disabled:x,children:"Cancel"}),e.jsx(E,{onClick:d,variant:"contained",disabled:x,startIcon:x?null:e.jsx(Ne,{}),children:x?"Saving...":"Save Quiz"})]})]}),e.jsxs(U,{open:o,onClose:X,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2,boxShadow:24}},children:[e.jsxs(K,{sx:{display:"flex",alignItems:"center",gap:2,pb:2},children:[e.jsx(he,{color:"error"}),e.jsx(D,{variant:"h6",fontWeight:600,children:"Delete Quiz"})]}),e.jsxs(H,{sx:{pb:2},children:[e.jsx(D,{variant:"body1",paragraph:!0,children:"Are you sure you want to delete this quiz?"}),e.jsx(de,{variant:"outlined",sx:{mb:3,bgcolor:"background.paper",border:"1px solid",borderColor:"divider"},children:e.jsxs(xe,{children:[e.jsx(D,{variant:"h6",gutterBottom:!0,fontWeight:600,children:r==null?void 0:r.title}),(r==null?void 0:r.description)&&e.jsx(D,{variant:"body2",color:"text.secondary",paragraph:!0,sx:{mb:2},children:r.description}),e.jsxs(S,{sx:{display:"flex",gap:1,flexWrap:"wrap",mb:2},children:[e.jsx(ne,{icon:e.jsx(Le,{}),label:(r==null?void 0:r.category)||"General",size:"small",variant:"outlined"}),e.jsx(ne,{icon:e.jsx(Xe,{}),label:`${((De=r==null?void 0:r.rounds)==null?void 0:De.length)||0} Round${(((B=r==null?void 0:r.rounds)==null?void 0:B.length)||0)!==1?"s":""}`,size:"small",variant:"filled",color:"secondary"}),e.jsx(ne,{icon:e.jsx(Ge,{}),label:`${((ce=r==null?void 0:r.rounds)==null?void 0:ce.flatMap(P=>P.questions).length)||0} Question${(((ye=r==null?void 0:r.rounds)==null?void 0:ye.flatMap(P=>P.questions).length)||0)!==1?"s":""}`,size:"small",variant:"filled",color:"primary"})]})]})}),e.jsx(D,{variant:"body2",color:"error",textAlign:"center",fontWeight:500,children:"This action cannot be undone. The quiz will be permanently deleted."})]}),e.jsxs(Z,{sx:{px:3,pb:3,gap:1},children:[e.jsx(E,{onClick:X,variant:"outlined",disabled:y,children:"Cancel"}),e.jsx(E,{onClick:_,variant:"contained",color:"error",disabled:y,startIcon:y?null:e.jsx(he,{}),children:y?"Deleting...":"Delete Quiz"})]})]})]})})},Ns=({selectedQuiz:i,menuAnchorEl:t,editingQuiz:r,isWizardOpen:s,deleteConfirmOpen:n,pendingDeleteQuiz:l,onMenuClose:u,onEditQuiz:a,onExportQuiz:f,onRequestDeleteQuiz:v,onConfirmDeleteQuiz:o,onCancelDeleteQuiz:h,onCreateQuiz:x,onWizardCancel:j,onQuizCreated:y})=>{const w=T.useCallback(()=>{i&&(a(i),u())},[i,a,u]),z=T.useCallback(()=>{i&&(f(i,"slides"),u())},[i,f,u]),Q=T.useCallback(()=>{i&&(f(i,"json"),u())},[i,f,u]),c=T.useCallback(()=>{i&&(v(i),u())},[i,v,u]);return e.jsxs(e.Fragment,{children:[e.jsxs(Nt,{anchorEl:t,open:!!t,onClose:u,transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[e.jsxs(F,{onClick:w,children:[e.jsx(je,{children:e.jsx(Ae,{fontSize:"small"})}),e.jsx(Se,{children:"Edit Quiz"})]}),e.jsxs(F,{onClick:z,disabled:!0,children:[e.jsx(je,{children:e.jsx(lt,{fontSize:"small"})}),e.jsx(Se,{children:"Export to Google Slides"})]}),e.jsxs(F,{onClick:Q,disabled:!0,children:[e.jsx(je,{children:e.jsx(ct,{fontSize:"small"})}),e.jsx(Se,{children:"Export as JSON"})]}),e.jsxs(F,{onClick:c,sx:{color:"error.main"},children:[e.jsx(je,{children:e.jsx(he,{fontSize:"small",color:"error"})}),e.jsx(Se,{children:"Delete Quiz"})]})]}),e.jsx(Re,{color:"primary","aria-label":"Create new quiz",onClick:x,sx:{position:"fixed",bottom:80,right:24,zIndex:1e3},children:e.jsx(ue,{})}),s&&e.jsx(Ws,{onQuizCreated:y,onCancel:j,editQuiz:r||void 0,onQuizDeleted:()=>{window.location.reload()}}),e.jsxs(U,{open:n,onClose:h,"aria-labelledby":"delete-quiz-dialog-title","aria-describedby":"delete-quiz-dialog-description",children:[e.jsx(K,{id:"delete-quiz-dialog-title",children:"Confirm Delete"}),e.jsx(H,{children:e.jsx(Ue,{id:"delete-quiz-dialog-description",children:"Are you sure you want to delete this quiz? This action cannot be undone."})}),e.jsxs(Z,{children:[e.jsx(E,{onClick:h,color:"primary",autoFocus:!0,children:"Cancel"}),e.jsx(E,{onClick:o,color:"error",variant:"contained",children:"Delete"})]})]})]})},_s=({open:i,onClose:t,storageUsage:r,quizzes:s,draftsCount:n,onCleanupStorage:l,onRefreshStorage:u})=>{const a=_t(),f=$t(a.breakpoints.down("sm")),[v,o]=m.useState(!1),h=c=>{if(c===0)return"0 B";const p=1024,b=["B","KB","MB","GB"],C=Math.floor(Math.log(c)/Math.log(p));return`${parseFloat((c/Math.pow(p,C)).toFixed(1))} ${b[C]}`},x=m.useMemo(()=>s.map(c=>{var I,M,O;const b=(((I=c.rounds)==null?void 0:I.length)||0)*512,C=(((M=c.title)==null?void 0:M.length)||0)*2,L=(((O=c.description)==null?void 0:O.length)||0)*2,A=1024+b+C+L;return{...c,estimatedSize:A}}),[s]),j=()=>{o(!0)},y=()=>{l(),o(!1),t()},w=()=>{o(!1)},z=(r==null?void 0:r.percentageUsed)||0,Q=(r==null?void 0:r.isNearLimit)||!1;return e.jsxs(e.Fragment,{children:[e.jsxs(U,{open:i,onClose:t,maxWidth:"md",fullWidth:!0,fullScreen:f,TransitionComponent:ut,transitionDuration:300,PaperProps:{sx:{borderRadius:f?0:3,maxHeight:f?"100%":"90vh"}},children:[e.jsxs(K,{sx:{background:`linear-gradient(135deg, ${a.palette.primary.main}, ${a.palette.primary.dark})`,color:"white",textAlign:"center",position:"relative",py:3},children:[e.jsxs(S,{display:"flex",alignItems:"center",justifyContent:"center",gap:2,children:[e.jsx(gt,{sx:{fontSize:28}}),e.jsx(D,{variant:"h5",component:"div",fontWeight:"bold",children:"Storage"})]}),e.jsx(J,{onClick:t,sx:{position:"absolute",right:8,top:8,color:"white",bgcolor:"rgba(255,255,255,0.1)","&:hover":{bgcolor:"rgba(255,255,255,0.2)"}},children:e.jsx(Me,{})})]}),e.jsxs(H,{sx:{p:0},children:[e.jsxs(S,{sx:{p:3,bgcolor:"background.default"},children:[e.jsxs(S,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(Bt,{color:"primary"}),e.jsx(D,{variant:"h6",fontWeight:"600",children:"Current Usage"})]}),r&&e.jsx(Oe,{in:!0,timeout:500,children:e.jsxs(S,{children:[e.jsxs(S,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[e.jsxs(D,{variant:"body2",color:"text.secondary",children:[h(r.totalSize)," / 500 MB"]}),e.jsxs(D,{variant:"body2",fontWeight:"600",color:Q?"warning.main":"text.primary",children:[z.toFixed(1),"% used"]})]}),e.jsx(Gt,{variant:"determinate",value:Math.min(z,100),color:Q?"warning":"primary",sx:{height:12,borderRadius:6,bgcolor:"rgba(0,0,0,0.1)","& .MuiLinearProgress-bar":{borderRadius:6,background:Q?`linear-gradient(90deg, ${a.palette.warning.main}, ${a.palette.warning.dark})`:`linear-gradient(90deg, ${a.palette.primary.main}, ${a.palette.primary.dark})`}}}),Q&&e.jsx(pe,{severity:"warning",icon:e.jsx(Ve,{}),sx:{mt:2,borderRadius:2},children:"Storage is nearly full. Consider cleaning up old quizzes."})]})})]}),e.jsx(ft,{}),e.jsxs(S,{sx:{p:3},children:[e.jsxs(S,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(Be,{color:"primary"}),e.jsx(D,{variant:"h6",fontWeight:"600",children:"Quiz Storage"}),e.jsx(ne,{label:`${x.length} items`,size:"small",color:"primary",variant:"outlined"})]}),x.length===0?e.jsx(S,{textAlign:"center",py:4,children:e.jsx(D,{variant:"body2",color:"text.secondary",children:"No quizzes found"})}):e.jsx(ot,{sx:{maxHeight:300,overflow:"auto"},children:x.map((c,p)=>{var b;return e.jsx(Oe,{in:!0,timeout:300+p*100,children:e.jsxs(dt,{sx:{borderRadius:2,mb:1,bgcolor:"background.paper",border:1,borderColor:"divider","&:hover":{bgcolor:"action.hover"}},children:[e.jsx(je,{children:c.isDraft?e.jsx(Ae,{color:"secondary"}):e.jsx(Be,{color:"primary"})}),e.jsx(Se,{primary:e.jsxs(S,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(D,{variant:"body1",noWrap:!0,children:c.title}),c.isDraft&&e.jsx(ne,{label:"Draft",size:"small",color:"secondary",variant:"outlined"})]}),secondary:e.jsxs(D,{variant:"caption",color:"text.secondary",children:[((b=c.rounds)==null?void 0:b.length)||0," rounds â€¢ Created"," ",new Date(c.createdAt).toLocaleDateString()]})}),e.jsx(D,{variant:"body2",fontWeight:"600",color:"primary.main",children:h(c.estimatedSize)})]})},c.id)})})]})]}),e.jsxs(Z,{sx:{p:3,bgcolor:"background.default",borderTop:1,borderColor:"divider",gap:2},children:[e.jsx(E,{onClick:j,startIcon:e.jsx(Vt,{}),color:"error",variant:"outlined",disabled:x.length===0,sx:{borderRadius:2,textTransform:"none",fontWeight:600},children:"Clear All Storage"}),e.jsx(S,{sx:{flex:1}}),e.jsx(E,{onClick:t,variant:"contained",sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:4},children:"OK"})]})]}),e.jsxs(U,{open:v,onClose:w,maxWidth:"sm",fullWidth:!0,TransitionComponent:Oe,children:[e.jsxs(K,{sx:{textAlign:"center",pt:3},children:[e.jsx(Ve,{sx:{fontSize:48,color:"warning.main",mb:2}}),e.jsx(D,{variant:"h6",fontWeight:"600",children:"Clear All Storage"})]}),e.jsxs(H,{sx:{textAlign:"center",pb:2},children:[e.jsxs(D,{variant:"body1",color:"text.secondary",children:["Are you sure you want to clear all quiz storage? This will permanently delete ",e.jsx("strong",{children:"ALL quizzes and drafts"})," from your device."]}),e.jsx(D,{variant:"body2",color:"error.main",sx:{mt:2,fontWeight:600},children:"This action cannot be undone."})]}),e.jsxs(Z,{sx:{p:3,gap:2},children:[e.jsx(E,{onClick:w,variant:"outlined",sx:{borderRadius:2,textTransform:"none",fontWeight:600},autoFocus:!0,children:"Cancel"}),e.jsx(E,{onClick:y,color:"error",variant:"contained",sx:{borderRadius:2,textTransform:"none",fontWeight:600},children:"Clear All Storage"})]})]})]})},ve=(i,t)=>{},$s=()=>{const{quizzes:i,drafts:t,isLoading:r,deleteQuiz:s,saveQuiz:n,loadQuizzes:l,loadDrafts:u,refreshStorageUsage:a,deleteDraft:f}=Ke(),[v,o]=m.useState("idle"),h=m.useRef(0),x=m.useCallback(async()=>{try{o("syncing"),ve("Force refresh all data",{timestamp:Date.now()}),await Promise.all([l(),u(),a()]),h.current=Date.now(),o("synced"),setTimeout(()=>o("idle"),2e3),ve("Force refresh completed",{quizzesCount:i.length,draftsCount:t.length,timestamp:h.current})}catch(z){throw o("error"),setTimeout(()=>o("idle"),5e3),z}},[l,u,a,i.length,t.length]),j=m.useCallback(async z=>{try{o("syncing"),ve("Delete quiz with sync",{id:z,quizCount:i.length});const Q=await s(z);await f(z);try{const c=new window.BroadcastChannel("quizzard-quiz-events");c.postMessage({type:"QUIZ_DELETED",id:z}),c.close()}catch{}return await l(),await u(),await a(),o("idle"),Q}catch{return o("error"),!1}},[s,f,l,u,a,i.length]),y=m.useCallback(async z=>{try{return o("syncing"),ve("Save quiz with sync",{id:z.id,title:z.title}),await n(z)?(await x(),ve("Save and refresh completed",{id:z.id,title:z.title}),!0):(o("error"),!1)}catch{return ve("Save with sync failed",{id:z.id}),o("error"),!1}},[n,x]),w=m.useCallback(()=>({quizzesCount:i.length,draftsCount:t.length,isLoading:r,syncStatus:v,lastSync:h.current,lastSyncAge:Date.now()-h.current,quizIds:i.map(z=>z.id),draftIds:t.map(z=>z.id)}),[i,t,r,v]);return m.useEffect(()=>{x()},[]),{quizzes:i,drafts:t,isLoading:r,syncStatus:v,deleteQuizWithSync:j,saveQuizWithSync:y,forceRefreshAll:x,getDebugInfo:w}},Bs=(i,t)=>{const{quizzes:r,drafts:s,isLoading:n,storageUsage:l,autoSaveStatus:u,isInitialized:a,saveQuiz:f,enableAutoSave:v,disableAutoSave:o,refreshStorageUsage:h,loadQuizzes:x,loadDrafts:j}=Ke(),{showSnackbar:y}=pt(),{deleteQuizWithSync:w}=$s(),[z,Q]=T.useState(!1),[c,p]=T.useState(!1),[b,C]=T.useState(null),[L,A]=T.useState(null),[I,M]=T.useState(null),[O,N]=T.useState(!1),[$,g]=T.useState(null),[d,k]=T.useState(!1),[q,_]=T.useState(null);T.useEffect(()=>{q&&Q(!1)},[q]),T.useEffect(()=>{l!=null&&l.isNearLimit&&k(!1)},[l==null?void 0:l.isNearLimit]);const X=T.useCallback(()=>{Q(!0),_(null)},[]),re=T.useCallback(()=>{k(!0)},[]),ie=T.useCallback(()=>{C(null),p(!0)},[]),me=T.useCallback(W=>{C(W),p(!0),A(null)},[]),le=T.useCallback(async W=>{try{const G={...W,status:"completed",updatedAt:new Date};if(await f(G))y(b?"Quiz updated successfully!":"Quiz created successfully!","success"),p(!1),C(null),o(),await h();else throw new Error("Failed to save quiz to storage")}catch(G){const ge=G instanceof Error?G.message:"Failed to save quiz";_(ge),y(ge,"error")}},[b,f,y,o,h]),De=T.useCallback(()=>{p(!1),C(null),o()},[o]),B=T.useCallback(async(W,G)=>{try{y(`${{slides:"Google Slides",json:"JSON"}[G]} export coming soon!`,"info"),A(null)}catch(ge){const Ze=ge instanceof Error?ge.message:"Export failed";_(Ze),y(Ze,"error")}},[y]),ce=T.useCallback((W,G)=>{A(W.currentTarget),M(G)},[]),ye=T.useCallback(()=>{A(null),M(null)},[]),P=T.useCallback(W=>{g(W),N(!0),A(null)},[]),fe=T.useCallback(async()=>{if($)try{await w($.id)&&(y("Quiz deleted successfully!","success"),i&&i())}catch(W){console.error("Error deleting quiz:",W),_("Failed to delete quiz")}finally{N(!1),g(null)}},[$,w,y,i]),be=T.useCallback(()=>{N(!1),g(null)},[]),Fe=T.useCallback(async()=>{try{const W=await Y.clearAllStorage();if(W.success)y("All storage cleared successfully!","success"),await h(),await x(),await j();else throw new Error(W.error||"Failed to clear storage")}catch(W){const G=W instanceof Error?W.message:"Failed to clear storage";_(G),y(G,"error")}},[y,h,x,j]),jt=T.useCallback(async()=>{try{await h(),y("Storage information refreshed","info")}catch(W){const G=W instanceof Error?W.message:"Failed to refresh storage";_(G),y(G,"error")}},[h,y]);return T.useEffect(()=>{if(c&&b){const W={...b,status:"draft",lastSaved:new Date};v(W)}return()=>{c||o()}},[c,b,v,o]),T.useEffect(()=>{x(),j()},[t]),{quizzes:r,drafts:s,isLoading:n,error:q,storageUsage:l,isInitialized:a,state:{errorDismissed:z,isWizardOpen:c,editingQuiz:b,menuAnchorEl:L,selectedQuiz:I,deleteConfirmOpen:O,pendingDeleteQuiz:$,autoSaveStatus:u,storageWarningDismissed:d},actions:{dismissError:X,dismissStorageWarning:re,handleCreateQuiz:ie,handleEditQuiz:me,handleQuizCreated:le,handleWizardCancel:De,handleExportQuiz:B,handleMenuOpen:ce,handleMenuClose:ye,handleRequestDeleteQuiz:P,handleConfirmDeleteQuiz:fe,handleCancelDeleteQuiz:be,handleCleanupDrafts:Fe,handleRefreshStorage:jt,handleQuizDeleted:()=>{}}}},Ks=()=>{var c;const[i,t]=T.useState(0),r=T.useCallback(()=>{t(p=>p+1)},[]),{quizzes:s,drafts:n,isLoading:l,error:u,state:a,actions:f,storageUsage:v}=Bs(r,i),[o,h]=T.useState(!1),x=T.useCallback(p=>[...s,...n].find(C=>C&&String(C.id)===String(p)),[s,n]),j=T.useCallback(p=>{const b=x(p.id);b?f.handleExportQuiz(b):console.error(`Could not find full quiz object with id: ${p.id} for export.`)},[f,x]),y=T.useCallback(p=>{const b=x(p.id);b?f.handleEditQuiz(b):console.error(`Could not find full quiz object with id: ${p.id} for edit.`)},[f,x]),w=T.useCallback((p,b)=>{const C=x(b.id);C?f.handleMenuOpen(p,C):console.error(`Could not find full quiz object with id: ${b.id} for menu.`)},[f,x]),z=T.useMemo(()=>{const p=["general","sports","history","science","geography","entertainment","literature","art","music","technology","custom"],b=d=>typeof d=="string"&&p.includes(d)?d:"general",C=d=>typeof d=="string"&&["easy","medium","hard"].includes(d)?d:"medium",L=d=>{if(typeof d=="number"&&!isNaN(d))return Math.max(1,Math.min(1e3,d));if(d&&typeof d=="object"&&"valueOf"in d&&typeof d.valueOf=="function"){const k=d.valueOf();if(typeof k=="number"&&!isNaN(k))return Math.max(1,Math.min(1e3,k))}return 10},A=d=>{if(d instanceof Date)return d;if(typeof d=="string"||typeof d=="number"){const k=new Date(d);if(!isNaN(k.getTime()))return k}return new Date},I=d=>{const k={defaultTimeLimit:1,defaultPoints:1,defaultBreakingTime:5};if(d&&typeof d=="object"){const q=d;return{defaultTimeLimit:typeof q.defaultTimeLimit=="number"?q.defaultTimeLimit:k.defaultTimeLimit,defaultPoints:typeof q.defaultPoints=="number"?q.defaultPoints:k.defaultPoints,defaultBreakingTime:typeof q.defaultBreakingTime=="number"?q.defaultBreakingTime:k.defaultBreakingTime}}return k},M=d=>Array.isArray(d)?d.filter(k=>k&&typeof k=="object"):[],O=d=>Array.isArray(d)?d.filter(k=>typeof k=="string").slice(0,10):[],N=n.filter(d=>d&&d.id&&d.title).map(d=>({...d,id:String(d.id||""),title:String(d.title||"Untitled Draft"),description:String(d.description||"Draft quiz in progress..."),rounds:M(d.rounds),category:b(d.category),difficulty:C(d.difficulty),tags:O(d.tags),status:"draft",createdAt:A(d.createdAt),updatedAt:A(d.updatedAt),isDraft:!0,estimatedDuration:L(d.estimatedDuration),settings:I(d.settings)})),$=new Set(s.map(d=>String(d.id))),g=N.filter(d=>!$.has(d.id));return[...s,...g].map(d=>({...d,id:String(d.id||""),title:String(d.title||"Untitled Quiz"),description:String(d.description||""),rounds:M(d.rounds),estimatedDuration:L(d.estimatedDuration),createdAt:A(d.createdAt),updatedAt:A(d.updatedAt),category:b(d.category),difficulty:C(d.difficulty),tags:O(d.tags),settings:I(d.settings)})).sort((d,k)=>new Date(k.updatedAt).getTime()-new Date(d.updatedAt).getTime())},[s,n]),Q=z.length;return(c=a.selectedQuiz)==null||c.rounds.find(p=>p.type==="golden-pyramid"),e.jsx(et,{fallback:e.jsx(pe,{severity:"error",children:"Something went wrong in the quiz list. Please refresh the page."}),children:e.jsxs(Ut,{maxWidth:"xl",sx:{py:3},children:[e.jsx(S,{mb:4,children:e.jsxs(D,{variant:"h4",component:"h1",gutterBottom:!0,children:["My Quizzes (",Q,")"]})}),u&&!a.errorDismissed&&e.jsx(pe,{severity:"error",sx:{mb:3},action:e.jsx(J,{size:"small",onClick:f.dismissError,"aria-label":"Dismiss error",children:e.jsx(Me,{fontSize:"small"})}),children:u}),(v==null?void 0:v.isNearLimit)&&!a.storageWarningDismissed&&e.jsxs(pe,{severity:"warning",sx:{mb:3},action:e.jsx(J,{size:"small",onClick:f.dismissStorageWarning,"aria-label":"Dismiss storage warning",children:e.jsx(Me,{fontSize:"small"})}),children:["Storage is nearly full (",(()=>{const p=v==null?void 0:v.usagePercentage;return typeof p=="number"&&!isNaN(p)?Math.round(Math.max(0,Math.min(100,p))):0})(),"% used). Consider cleaning up old drafts or exporting quizzes to free up space."]}),Q>0&&e.jsxs(S,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(E,{variant:"contained",startIcon:e.jsx(ue,{}),onClick:f.handleCreateQuiz,sx:{borderRadius:2,textTransform:"none",fontWeight:600},children:[e.jsx(S,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:"Create New Quiz"}),e.jsx(S,{component:"span",sx:{display:{xs:"inline",sm:"none"}},children:"Create"})]}),e.jsx(E,{variant:"outlined",startIcon:e.jsx(gt,{}),onClick:()=>h(!0),sx:{borderRadius:2,textTransform:"none",fontWeight:600},children:"Storage"})]}),e.jsx(et,{children:e.jsx(ss,{quizzes:z,isLoading:l,onCreateQuiz:f.handleCreateQuiz,onMenuOpen:w,onExport:j,onEdit:y})}),e.jsx(Ns,{selectedQuiz:a.selectedQuiz,menuAnchorEl:a.menuAnchorEl,editingQuiz:a.editingQuiz,isWizardOpen:a.isWizardOpen,deleteConfirmOpen:a.deleteConfirmOpen,pendingDeleteQuiz:a.pendingDeleteQuiz,onMenuClose:f.handleMenuClose,onEditQuiz:f.handleEditQuiz,onExportQuiz:f.handleExportQuiz,onRequestDeleteQuiz:f.handleRequestDeleteQuiz,onConfirmDeleteQuiz:f.handleConfirmDeleteQuiz,onCancelDeleteQuiz:f.handleCancelDeleteQuiz,onCreateQuiz:f.handleCreateQuiz,onWizardCancel:f.handleWizardCancel,onQuizCreated:f.handleQuizCreated}),e.jsx(_s,{open:o,onClose:()=>h(!1),storageUsage:v,quizzes:z,draftsCount:n.length,onCleanupStorage:f.handleCleanupDrafts,onRefreshStorage:f.handleRefreshStorage})]})})};export{Ks as Quizzes,Ks as default};
//# sourceMappingURL=Quizzes-DOjyaQNv.js.map
