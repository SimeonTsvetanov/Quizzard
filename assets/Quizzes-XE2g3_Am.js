const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pptxgen.es-D1LdXykA.js","assets/index-Dv6ocQVj.js","assets/mui-CLLzQARg.js","assets/vendor-Csw2ODfV.js","assets/index-IoRVJUsv.css"])))=>i.map(i=>d[i]);
var vt=Object.defineProperty;var St=(i,t,r)=>t in i?vt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[t]=r;var Ie=(i,t,r)=>St(i,typeof t!="symbol"?t+"":t,r);import{j as e,o as B,p as Y,q as G,v as T,L as et,aq as tt,ar as st,as as rt,d as jt,e as ue,f as he,t as J,s as F,W as k,at as re,au as it,X as le,B as z,ae as me,I as ie,av as zt,aw as Ct,ax as Qe,a0 as qe,ay as At,S as Fe,a9 as Dt,az as Se,aA as Tt,aB as se,aC as kt,a5 as ce,r as g,a3 as $,aD as U,aE as H,aF as K,aG as P,aH as Be,ao as Z,ap as It,aI as Et,aJ as de,aK as ke,ac as Qt,ad as Ft,aL as We,aM as nt,aN as Ne,aO as at,aP as Mt,aQ as Rt,O as oe,V as Pt,Q as Me,aR as Ot,aS as Lt,aT as $e,F as Ee,aU as Pe,aV as Ge,a as ot,aW as qt,u as Wt,af as Nt,aX as lt,aY as $t,aZ as _t,b as Bt,a_ as Gt,a2 as Vt}from"./mui-CLLzQARg.js";import{a as Ut,_ as ct,H as Ht,E as Ve}from"./index-Dv6ocQVj.js";import{u as dt}from"./useSnackbar-DsNttXKD.js";import"./vendor-Csw2ODfV.js";const Kt=[{id:"powerpoint",label:"Export to PowerPoint",icon:tt,disabled:!1,description:"Export quiz as a PowerPoint presentation"},{id:"slides",label:"Export to Google Slides",icon:st,disabled:!0,description:"Export quiz as a Google Slides presentation (Coming Soon)"},{id:"json",label:"Export as JSON",icon:rt,disabled:!0,description:"Export quiz data in JSON format (Coming Soon)"}],Yt=({open:i,quiz:t,onClose:r,onExport:s})=>{const n=l=>{s(l),r()};return e.jsxs(B,{open:i,onClose:r,"aria-labelledby":"export-format-dialog-title",maxWidth:"sm",fullWidth:!0,children:[e.jsxs(Y,{id:"export-format-dialog-title",children:["Export Quiz: ",t.title]}),e.jsxs(G,{children:[e.jsx(T,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Choose an export format below. Currently, only PowerPoint export is available."}),e.jsx(et,{children:Kt.map(l=>e.jsxs(jt,{onClick:()=>n(l.id),disabled:l.disabled,children:[e.jsx(ue,{children:e.jsx(l.icon,{})}),e.jsx(he,{primary:l.label,secondary:l.disabled?"(Coming Soon)":l.description})]},l.id))})]}),e.jsx(J,{children:e.jsx(F,{onClick:r,children:"Cancel"})})]})},Jt=({quiz:i,onMenuOpen:t,onExport:r,onPreview:s,onEdit:n})=>{var b;const[l,c]=k.useState(!1),a=k.useCallback(()=>{s?s(i):console.log("Preview quiz:",i.id)},[i,s]),y=k.useCallback(()=>{c(!0)},[]),S=k.useCallback(m=>{r(i,m)},[i,r]),d=k.useCallback(()=>{n(i)},[i,n]),u=k.useCallback(m=>{t(m,i)},[i,t]),x=k.useMemo(()=>{var m;return((m=i.rounds)==null?void 0:m.flatMap(w=>(w==null?void 0:w.questions)||[]).length)||0},[i.rounds]);return e.jsxs(re,{size:{xs:12,sm:6,md:4},children:[e.jsx(it,{in:!0,timeout:300,children:e.jsxs(le,{elevation:2,sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",transition:"all 0.3s ease","&:hover":{elevation:4,transform:"translateY(-2px)"}},children:[e.jsx(z,{children:e.jsxs(me,{sx:{pb:1},children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[e.jsx(T,{variant:"h5",component:"h3",fontWeight:"bold",noWrap:!0,children:i.title||"Untitled Quiz"}),e.jsx(ie,{size:"small",onClick:u,"aria-label":"More options",children:e.jsx(zt,{})})]}),e.jsx(T,{variant:"body2",color:"text.secondary",sx:{mb:2,height:"40px",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:i.description||"No description provided."}),e.jsxs(z,{display:"flex",alignItems:"center",gap:2,color:"text.secondary",children:[e.jsxs(z,{display:"flex",alignItems:"center",gap:.5,children:[e.jsx(Ct,{fontSize:"small"}),e.jsxs(T,{variant:"caption",children:[i.estimatedDuration||"10"," min"]})]}),e.jsxs(z,{display:"flex",alignItems:"center",gap:.5,children:[e.jsx(Qe,{fontSize:"small"}),e.jsxs(T,{variant:"caption",children:[((b=i.rounds)==null?void 0:b.length)||0," Rounds"]})]}),e.jsxs(z,{display:"flex",alignItems:"center",gap:.5,children:[e.jsx(qe,{fontSize:"small"}),e.jsxs(T,{variant:"caption",children:[x," Questions"]})]})]})]})}),e.jsx(At,{sx:{p:2,pt:1},children:e.jsxs(Fe,{direction:"row",spacing:1,width:"100%",children:[e.jsx(F,{variant:"contained",size:"medium",startIcon:e.jsx(Dt,{}),onClick:a,sx:{flex:1},children:"Play"}),e.jsx(F,{variant:"outlined",size:"medium",startIcon:e.jsx(Se,{}),onClick:d,sx:{flex:1},children:"Edit"}),e.jsx(F,{variant:"outlined",size:"medium",startIcon:e.jsx(Tt,{}),onClick:y,sx:{flex:1},children:"Export"})]})})]})}),e.jsx(Yt,{open:l,quiz:i,onClose:()=>c(!1),onExport:S})]},i.id)},Zt=()=>e.jsx(e.Fragment,{children:[1,2,3].map(i=>e.jsx(re,{size:{xs:12,sm:6,md:4},children:e.jsx(le,{elevation:1,children:e.jsxs(me,{children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsx(se,{variant:"circular",width:48,height:48}),e.jsx(se,{variant:"circular",width:24,height:24})]}),e.jsx(se,{variant:"text",sx:{fontSize:"1.2rem",mb:1}}),e.jsx(se,{variant:"text",height:40,sx:{mb:2}}),e.jsxs(z,{display:"flex",gap:1,mb:2,children:[e.jsx(se,{variant:"rounded",width:60,height:24}),e.jsx(se,{variant:"rounded",width:80,height:24}),e.jsx(se,{variant:"rounded",width:40,height:24})]}),e.jsxs(z,{display:"flex",justifyContent:"space-between",children:[e.jsx(se,{variant:"text",width:100}),e.jsx(se,{variant:"text",width:60})]})]})})},i))}),Xt=({onCreateQuiz:i})=>e.jsx(re,{size:{xs:12},children:e.jsx(le,{elevation:0,sx:{textAlign:"center",py:8,bgcolor:"background.default",border:"2px dashed",borderColor:"divider"},children:e.jsxs(me,{children:[e.jsx(kt,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(T,{variant:"h5",gutterBottom:!0,children:"Create Your First Quiz"}),e.jsx(T,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Get started by creating an interactive quiz with questions, answers, and media. Export to PowerPoint when you're ready to present!"}),e.jsx(F,{variant:"contained",size:"large",startIcon:e.jsx(ce,{}),onClick:i,sx:{mt:2},children:"Create Quiz"})]})})}),es=({quizzes:i,isLoading:t,onCreateQuiz:r,onMenuOpen:s,onExport:n,onPreview:l,onEdit:c})=>{const a=k.useCallback(()=>i.map(y=>e.jsx(Jt,{quiz:y,onMenuOpen:s,onExport:n,onPreview:l,onEdit:c},y.id)),[i,s,n,l,c]);return e.jsx(re,{container:!0,spacing:3,children:t?e.jsx(Zt,{}):i.length===0?e.jsx(Xt,{onCreateQuiz:r}):a()})},Ae=[{id:"basic-info",title:"Quiz Information",description:"Set up basic quiz details like title, description, and category"},{id:"questions",title:"Add Questions",description:"Create and manage your quiz questions with answers"},{id:"review-create",title:"Review & Create",description:"Review your quiz and finalize creation."}],ts=i=>{const[t,r]=g.useState(0),s=g.useMemo(()=>Ae.map((u,x)=>{const b=x<t,m=x===t&&i().isValid;return{...u,completed:b||m,active:x===t,enabled:x<=t||b}}),[t,i]),n=g.useMemo(()=>i().isValid&&t<Ae.length-1,[i,t]),l=g.useCallback(()=>{i().isValid&&t<Ae.length-1&&r(t+1)},[t,i]),c=g.useCallback(()=>{t>0&&r(t-1)},[t]),a=g.useCallback(u=>{u>=0&&u<Ae.length&&s[u].enabled&&r(u)},[s]),y=g.useCallback(()=>{r(0)},[]);return{navigation:{currentStep:t,steps:s,canProceed:n},actions:{nextStep:l,previousStep:c,goToStep:a,resetNavigation:y}}};Ae.map(i=>i.id);const be={MAX_TITLE_LENGTH:100,MIN_OPTIONS:2,MAX_OPTIONS:20},Ue=i=>{const{currentStep:t,draftQuiz:r}=i,s=g.useCallback(()=>{var w,C;const b=[],m=[];return(w=r.title)!=null&&w.trim()?r.title.length>be.MAX_TITLE_LENGTH&&b.push(`Title must be ${be.MAX_TITLE_LENGTH} characters or less`):b.push("Quiz title is required"),r.category||b.push("Quiz category must be selected"),r.difficulty||b.push("Quiz difficulty must be selected"),(C=r.description)!=null&&C.trim()||m.push("Consider adding a description to help users understand the quiz content"),{isValid:b.length===0,errors:b,warnings:m,validatedAt:new Date}},[r]),n=g.useCallback(()=>{const b=[],m=[];return!r.rounds||r.rounds.length<1?(b.push("Quiz must have at least one round"),{isValid:!1,errors:b,warnings:m,validatedAt:new Date}):(r.rounds.forEach((w,C)=>{const E=C+1;if(!w.questions||w.questions.length<1){b.push(`Round ${E} must have at least one question`);return}w.questions.forEach((o,f)=>{var D,I,R;if(!o||typeof o!="object")return;const v=f+1,A=`Round ${E}, Question ${v}`;if((D=o.question)!=null&&D.trim()||b.push(`${A}: Question text is required`),o.type==="single-answer")(I=o.correctAnswerText)!=null&&I.trim()||m.push(`${A}: Consider adding an answer`);else if(["multiple-choice","picture","audio","video"].includes(o.type))if(w.type==="golden-pyramid")(!o.possibleAnswers||!Array.isArray(o.possibleAnswers)||o.possibleAnswers.length===0||o.possibleAnswers.every(h=>!(h!=null&&h.trim())))&&m.push(`${A}: Consider adding at least one answer option`);else{if((!o.possibleAnswers||!Array.isArray(o.possibleAnswers)||o.possibleAnswers.length<be.MIN_OPTIONS)&&m.push(`${A}: Consider adding at least ${be.MIN_OPTIONS} answer options`),!o.correctAnswers||!Array.isArray(o.correctAnswers)||o.correctAnswers.length===0)m.push(`${A}: Consider selecting at least one correct answer`);else if(o.possibleAnswers&&Array.isArray(o.possibleAnswers)){const h=((R=o.possibleAnswers)==null?void 0:R.length)||0;o.correctAnswers.filter(p=>typeof p!="number"||p<0||p>=h).length>0&&m.push(`${A}: Some correct answer selections may be invalid`)}o.possibleAnswers&&Array.isArray(o.possibleAnswers)&&o.possibleAnswers.filter(j=>!(j!=null&&j.trim())).length>0&&m.push(`${A}: Consider filling in all answer options`),o.possibleAnswers&&Array.isArray(o.possibleAnswers)&&o.possibleAnswers.length>be.MAX_OPTIONS&&m.push(`${A}: Consider limiting to ${be.MAX_OPTIONS} options for better usability`)}o.question&&o.question.length>200&&m.push(`${A}: Long questions may be harder to read`)}),w.questions.length>10&&m.push(`Round ${E}: Many questions in one round may overwhelm users`)}),{isValid:b.length===0,errors:b,warnings:m,validatedAt:new Date})},[r.rounds]),l=g.useCallback(()=>{var f,v;const b=[],m=[];!!((f=r.title)!=null&&f.trim())||b.push("Basic quiz information is incomplete"),r.rounds&&r.rounds.length>0&&r.rounds.every(A=>A.questions&&A.questions.length>0)||b.push("Quiz must have at least one round with questions"),!!r.settings||b.push("Quiz settings are required");const o=((v=r.rounds)==null?void 0:v.reduce((A,D)=>{var I;return A+(((I=D.questions)==null?void 0:I.length)||0)},0))||0;return o<5&&m.push("Quiz has fewer than 5 questions - consider adding more"),o>50&&m.push("Quiz has many questions - consider splitting into multiple quizzes"),{isValid:b.length===0,errors:b,warnings:m,validatedAt:new Date}},[r]),c=g.useCallback(()=>{switch(t){case 0:return s();case 1:return n();case 2:return l();default:return{isValid:!1,errors:["Invalid step"],warnings:[],validatedAt:new Date}}},[t,s,n,l]),a=g.useCallback(b=>{switch(b){case 0:return s();case 1:return n();case 2:return l();default:return{isValid:!1,errors:["Invalid step index"],warnings:[],validatedAt:new Date}}},[s,n,l]),y=g.useCallback(()=>{const b=[],m=[];return[0,1,2].forEach(w=>{const C=a(w);b.push(...C.errors),m.push(...C.warnings)}),{isValid:b.length===0,errors:b,warnings:m,validatedAt:new Date}},[a]),d=c().isValid,x=y().isValid;return{validateStep:c,validateSpecificStep:a,validateAllSteps:y,isCurrentStepValid:d,isWizardComplete:x}},ss=i=>{const{draftQuiz:t,clearDraft:r}=i,s=g.useCallback(d=>{const u=d.reduce((m,w)=>{var C;return m+(((C=w.questions)==null?void 0:C.length)||0)},0),x=Math.ceil(u*1.5),b=d.reduce((m,w)=>{const C=w.questions.reduce((E,o)=>{var f;return E+(((f=o.question)==null?void 0:f.length)||0)},0)/w.questions.length;return m+(C>100?.5:0)},0);return Math.max(5,x+Math.ceil(b))},[]),n=g.useCallback(()=>{if(t.id&&!t.id.startsWith("draft_"))return t.id;const d=Date.now(),u=Math.random().toString(36).substr(2,9);return`quiz_${d}_${u}`},[t.id]),l=g.useCallback(()=>{var C,E;if(!((C=t.title)!=null&&C.trim()))throw new Error("Quiz title is required");const d=new Date,u=t.id&&!t.id.startsWith("draft_"),x=t.rounds||[],b=t.settings||{allowHints:!1,showCorrectAnswers:!0,timeLimit:null,randomizeQuestions:!1,randomizeAnswers:!1},m=Math.max(x.length>0?s(x):5,t.estimatedDuration||5);return{id:n(),title:t.title.trim(),description:((E=t.description)==null?void 0:E.trim())||"",category:t.category||"general",difficulty:t.difficulty||"medium",estimatedDuration:m,createdAt:u&&t.createdAt||d,updatedAt:d,settings:b,rounds:x.map(o=>({...o,id:o.id||`round_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,createdAt:o.createdAt||d,updatedAt:o.updatedAt||d,questions:(o.questions||[]).map(f=>({...f,id:f.id||`q_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,createdAt:f.createdAt||d,updatedAt:f.updatedAt||d}))}))}},[t,s,n]),c=g.useCallback(()=>{var d;return!!((d=t.title)!=null&&d.trim())},[t.title]),a=g.useCallback(()=>{var x;const d=[],u=[];return(x=t.title)!=null&&x.trim()||d.push("Quiz title is required"),t.category||u.push("Consider adding a category"),t.difficulty||u.push("Consider setting a difficulty level"),(!t.rounds||t.rounds.length===0)&&u.push("Consider adding some questions"),{ready:d.length===0,errors:d,warnings:u}},[t]),y=g.useCallback(async()=>{var d;if(!((d=t.title)!=null&&d.trim()))throw new Error("Quiz title is required");try{const u=l();return r(),u}catch(u){throw console.error("[WizardCompletion] Failed to create quiz:",u),u instanceof Error?new Error(`Quiz creation failed: ${u.message}`):new Error("Quiz creation failed due to unknown error")}},[t.title,l,r]),S=c();return{completeWizard:y,canComplete:c,getCompletionStatus:a,isReady:S}},M={name:"QuizzardDB",version:1,stores:{quizzes:"quizzes",drafts:"drafts",mediaFiles:"mediaFiles",metadata:"metadata"}},De={TOTAL_QUIZ_SIZE:500*1024*1024,SINGLE_IMAGE:10*1024*1024,SINGLE_AUDIO:20*1024*1024,SINGLE_VIDEO:100*1024*1024,WARNING_THRESHOLD:400*1024*1024},Te={DEBOUNCE_DELAY:3e4,MAX_RETRIES:3,RETRY_DELAY:5e3,DRAFT_CLEANUP_DAYS:30};class rs{constructor(){Ie(this,"db",null);Ie(this,"isInitialized",!1);Ie(this,"initPromise",null)}async initialize(){return this.initPromise?this.initPromise:(this.initPromise=this._initializeDB(),this.initPromise)}async _initializeDB(){try{return window.indexedDB?new Promise((t,r)=>{const s=indexedDB.open(M.name,M.version);s.onerror=()=>{console.error("Failed to open IndexedDB:",s.error),r(!1)},s.onsuccess=()=>{this.db=s.result,this.isInitialized=!0,console.log("IndexedDB initialized successfully"),t(!0)},s.onupgradeneeded=n=>{const l=n.target.result;if(!l.objectStoreNames.contains(M.stores.quizzes)){const c=l.createObjectStore(M.stores.quizzes,{keyPath:"id"});c.createIndex("status","status",{unique:!1}),c.createIndex("createdAt","createdAt",{unique:!1}),c.createIndex("category","category",{unique:!1})}if(l.objectStoreNames.contains(M.stores.drafts)||l.createObjectStore(M.stores.drafts,{keyPath:"id"}).createIndex("lastSaved","lastSaved",{unique:!1}),!l.objectStoreNames.contains(M.stores.mediaFiles)){const c=l.createObjectStore(M.stores.mediaFiles,{keyPath:"id"});c.createIndex("type","type",{unique:!1}),c.createIndex("size","size",{unique:!1})}l.objectStoreNames.contains(M.stores.metadata)||l.createObjectStore(M.stores.metadata,{keyPath:"key"})}}):(console.warn("IndexedDB not available, will use localStorage fallback"),!1)}catch(t){return console.error("IndexedDB initialization failed:",t),!1}}async executeTransaction(t,r,s){try{if(!this.db)throw new Error("Database not initialized");const n=this.db.transaction(t,r);return new Promise(l=>{n.oncomplete=()=>{},n.onerror=()=>{var c;l({success:!1,error:`Transaction failed: ${(c=n.error)==null?void 0:c.message}`})},s(n).then(c=>{l({success:!0,data:c})}).catch(c=>{l({success:!1,error:c.message||"Operation failed"})})})}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error"}}}async saveQuiz(t){if(await this.initialize(),!this.isInitialized)return this.saveQuizFallback(t);const r=await this.getStorageUsage(),s=this.calculateQuizSize(t);return r.totalSize+s>De.TOTAL_QUIZ_SIZE?{success:!1,error:"Storage limit exceeded. Please delete some quizzes or media files."}:this.executeTransaction([M.stores.quizzes,M.stores.mediaFiles],"readwrite",async n=>{const l=n.objectStore(M.stores.quizzes),c=n.objectStore(M.stores.mediaFiles);for(const a of t.rounds)for(const y of a.questions)y.mediaFile&&await this.putInStore(c,y.mediaFile);return await this.putInStore(l,t),await this.updateMetadata(),t})}async saveDraft(t){if(await this.initialize(),!this.isInitialized)return this.saveDraftFallback(t);const r={...t,lastSaved:new Date,isDraft:!0};return this.executeTransaction(M.stores.drafts,"readwrite",async s=>{const n=s.objectStore(M.stores.drafts);return await this.putInStore(n,r),r})}async loadQuizzes(){return await this.initialize(),this.isInitialized?this.executeTransaction(M.stores.quizzes,"readonly",async t=>{const s=t.objectStore(M.stores.quizzes).getAll();return new Promise((n,l)=>{s.onsuccess=()=>n(s.result||[]),s.onerror=()=>l(s.error)})}):this.loadQuizzesFallback()}async loadQuiz(t){return await this.initialize(),this.isInitialized?this.executeTransaction(M.stores.quizzes,"readonly",async r=>{const n=r.objectStore(M.stores.quizzes).get(t);return new Promise((l,c)=>{n.onsuccess=()=>l(n.result||null),n.onerror=()=>c(n.error)})}):this.loadQuizFallback(t)}async loadDrafts(){return await this.initialize(),this.isInitialized?this.executeTransaction(M.stores.drafts,"readonly",async t=>{const s=t.objectStore(M.stores.drafts).getAll();return new Promise((n,l)=>{s.onsuccess=()=>n(s.result||[]),s.onerror=()=>l(s.error)})}):this.loadDraftsFallback()}async deleteQuiz(t){return await this.initialize(),this.isInitialized?this.executeTransaction([M.stores.quizzes,M.stores.mediaFiles],"readwrite",async r=>{const s=r.objectStore(M.stores.quizzes),n=r.objectStore(M.stores.mediaFiles),l=await this.getFromStore(s,t);if(l)for(const c of l.rounds)for(const a of c.questions)a.mediaFile&&await this.deleteFromStore(n,a.mediaFile.id);return await this.deleteFromStore(s,t),await this.updateMetadata(),!0}):this.deleteQuizFallback(t)}async deleteDraft(t){return await this.initialize(),this.isInitialized?this.executeTransaction(M.stores.drafts,"readwrite",async r=>{const s=r.objectStore(M.stores.drafts);return await this.deleteFromStore(s,t),!0}):this.deleteDraftFallback(t)}async getStorageUsage(){if(await this.initialize(),!this.isInitialized)return this.getStorageUsageFallback();try{const[t,r,s]=await Promise.all([this.calculateStoreSize(M.stores.quizzes),this.calculateStoreSize(M.stores.drafts),this.calculateStoreSize(M.stores.mediaFiles)]),n=t+r+s,l=De.TOTAL_QUIZ_SIZE-n,c=n/De.TOTAL_QUIZ_SIZE*100;return{totalSize:n,quizzesSize:t,draftsSize:r,mediaFilesSize:s,remainingSpace:Math.max(0,l),percentageUsed:Math.min(100,c),isNearLimit:c>80}}catch(t){return console.error("Error calculating storage usage:",t),{totalSize:0,quizzesSize:0,draftsSize:0,mediaFilesSize:0,remainingSpace:De.TOTAL_QUIZ_SIZE,percentageUsed:0,isNearLimit:!1}}}async cleanupOldDrafts(){if(await this.initialize(),!this.isInitialized)return{success:!0,data:0};const t=new Date;return t.setDate(t.getDate()-Te.DRAFT_CLEANUP_DAYS),this.executeTransaction(M.stores.drafts,"readwrite",async r=>{const n=r.objectStore(M.stores.drafts).index("lastSaved"),l=IDBKeyRange.upperBound(t),c=n.openCursor(l);let a=0;return new Promise((y,S)=>{c.onsuccess=d=>{const u=d.target.result;u?(u.delete(),a++,u.continue()):y(a)},c.onerror=()=>S(c.error)})})}async clearAllStorage(){try{if(await this.initialize(),this.isInitialized&&this.db){const t=[M.stores.quizzes,M.stores.drafts,M.stores.mediaFiles,M.stores.metadata];for(const r of t)await this.executeTransaction(r,"readwrite",async s=>{const n=s.objectStore(r);return new Promise((l,c)=>{const a=n.clear();a.onsuccess=()=>l(),a.onerror=()=>c(a.error)})})}try{localStorage.removeItem("quizzard_quizzes"),localStorage.removeItem("quizzard_drafts"),Object.keys(localStorage).forEach(t=>{(t.startsWith("quizzard")||t.startsWith("Quizzard"))&&localStorage.removeItem(t)})}catch(t){console.warn("Failed to clear localStorage:",t)}return{success:!0,data:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to clear storage"}}}async putInStore(t,r){return new Promise((s,n)=>{const l=t.put(r);l.onsuccess=()=>s(),l.onerror=()=>n(l.error)})}async getFromStore(t,r){return new Promise((s,n)=>{const l=t.get(r);l.onsuccess=()=>s(l.result||null),l.onerror=()=>n(l.error)})}async deleteFromStore(t,r){return new Promise((s,n)=>{const l=t.delete(r);l.onsuccess=()=>s(),l.onerror=()=>n(l.error)})}async calculateStoreSize(t){return this.db?new Promise((r,s)=>{const c=this.db.transaction(t,"readonly").objectStore(t).getAll();c.onsuccess=()=>{const y=(c.result||[]).reduce((S,d)=>S+JSON.stringify(d).length*2,0);r(y)},c.onerror=()=>s(c.error)}):0}calculateQuizSize(t){return JSON.stringify(t).length*2}async updateMetadata(){if(!this.db)return;const r={version:"1.0.0",totalSize:(await this.getStorageUsage()).totalSize,createdAt:new Date,lastCleanup:new Date};this.db.transaction(M.stores.metadata,"readwrite").objectStore(M.stores.metadata).put({key:"app_metadata",...r})}saveQuizFallback(t){try{const r=this.getQuizzesFromLocalStorage(),s=r.findIndex(n=>n.id===t.id);return s>=0?r[s]=t:r.push(t),localStorage.setItem("quizzard_quizzes",JSON.stringify(r)),{success:!0,data:t,usedFallback:!0}}catch(r){return{success:!1,error:"localStorage save failed: "+(r instanceof Error?r.message:"Unknown error"),usedFallback:!0}}}saveDraftFallback(t){try{const r=this.getDraftsFromLocalStorage(),s=r.findIndex(l=>l.id===t.id),n={...t,lastSaved:new Date,isDraft:!0};return s>=0?r[s]=n:r.push(n),localStorage.setItem("quizzard_drafts",JSON.stringify(r)),{success:!0,data:n,usedFallback:!0}}catch(r){return{success:!1,error:"localStorage draft save failed: "+(r instanceof Error?r.message:"Unknown error"),usedFallback:!0}}}loadQuizzesFallback(){try{return{success:!0,data:this.getQuizzesFromLocalStorage(),usedFallback:!0}}catch(t){return{success:!1,error:"localStorage load failed: "+(t instanceof Error?t.message:"Unknown error"),usedFallback:!0}}}loadQuizFallback(t){try{return{success:!0,data:this.getQuizzesFromLocalStorage().find(n=>n.id===t)||null,usedFallback:!0}}catch(r){return{success:!1,error:"localStorage load failed: "+(r instanceof Error?r.message:"Unknown error"),usedFallback:!0}}}loadDraftsFallback(){try{return{success:!0,data:this.getDraftsFromLocalStorage(),usedFallback:!0}}catch(t){return{success:!1,error:"localStorage drafts load failed: "+(t instanceof Error?t.message:"Unknown error"),usedFallback:!0}}}deleteQuizFallback(t){try{const s=this.getQuizzesFromLocalStorage().filter(n=>n.id!==t);return localStorage.setItem("quizzard_quizzes",JSON.stringify(s)),{success:!0,data:!0,usedFallback:!0}}catch(r){return{success:!1,error:"localStorage delete failed: "+(r instanceof Error?r.message:"Unknown error"),usedFallback:!0}}}deleteDraftFallback(t){try{const s=this.getDraftsFromLocalStorage().filter(n=>n.id!==t);return localStorage.setItem("quizzard_drafts",JSON.stringify(s)),{success:!0,data:!0,usedFallback:!0}}catch(r){return{success:!1,error:"localStorage draft delete failed: "+(r instanceof Error?r.message:"Unknown error"),usedFallback:!0}}}getStorageUsageFallback(){try{const t=localStorage.getItem("quizzard_quizzes")||"[]",r=localStorage.getItem("quizzard_drafts")||"[]",s=t.length*2,n=r.length*2,l=s+n,c=5*1024*1024,a=Math.max(0,c-l),y=l/c*100;return{totalSize:l,quizzesSize:s,draftsSize:n,mediaFilesSize:0,remainingSpace:a,percentageUsed:Math.min(100,y),isNearLimit:y>80}}catch{return{totalSize:0,quizzesSize:0,draftsSize:0,mediaFilesSize:0,remainingSpace:5*1024*1024,percentageUsed:0,isNearLimit:!1}}}getQuizzesFromLocalStorage(){try{const t=localStorage.getItem("quizzard_quizzes");return t?JSON.parse(t):[]}catch{return[]}}getDraftsFromLocalStorage(){try{const t=localStorage.getItem("quizzard_drafts");return t?JSON.parse(t):[]}catch{return[]}}}const _=new rs,is=Object.freeze(Object.defineProperty({__proto__:null,AUTO_SAVE_CONFIG:Te,STORAGE_LIMITS:De,indexedDBService:_},Symbol.toStringTag,{value:"Module"})),ut=()=>{const{showSnackbar:i}=dt(),[t,r]=g.useState({quizzes:[],drafts:[],isLoading:!1,storageUsage:null,autoSaveStatus:"idle",isInitialized:!1}),s=g.useRef(null),n=g.useRef(null),l=g.useRef(0),c=g.useCallback(async()=>{try{r(f=>({...f,isLoading:!0}));const o=await _.initialize();return r(f=>({...f,isInitialized:o,isLoading:!1})),o?console.log("✅ IndexedDB initialized successfully"):(console.warn("⚠️ Using localStorage fallback"),i("Using local storage - some features may be limited","warning")),o}catch(o){return console.error("Storage initialization failed:",o),r(f=>({...f,isInitialized:!1,isLoading:!1})),i("Storage initialization failed","error"),!1}},[i]),a=g.useCallback(async o=>{try{r(v=>({...v,isLoading:!0}));const f=await _.saveQuiz(o);return f.success?(r(v=>({...v,quizzes:v.quizzes.some(A=>A.id===o.id)?v.quizzes.map(A=>A.id===o.id?o:A):[...v.quizzes,o],isLoading:!1})),i(f.usedFallback?"Quiz saved to local storage":"Quiz saved successfully","success"),await Promise.all([y(),u(),C()]),!0):(r(v=>({...v,isLoading:!1})),i(f.error||"Failed to save quiz","error"),!1)}catch(f){return r(v=>({...v,isLoading:!1})),console.error("Error saving quiz:",f),i("Failed to save quiz","error"),!1}},[i]),y=g.useCallback(async()=>{try{r(f=>({...f,isLoading:!0}));const o=await _.loadQuizzes();o.success?(r(f=>({...f,quizzes:o.data||[],isLoading:!1})),o.usedFallback&&console.log("📦 Loaded quizzes from localStorage")):(r(f=>({...f,isLoading:!1})),console.error("Failed to load quizzes:",o.error),i("Failed to load quizzes","error"))}catch(o){r(f=>({...f,isLoading:!1})),console.error("Error loading quizzes:",o),i("Failed to load quizzes","error")}},[i]),S=g.useCallback(async o=>{try{r(v=>({...v,isLoading:!0}));const f=await _.deleteQuiz(o);return f.success?(r(v=>({...v,quizzes:v.quizzes.filter(A=>A.id!==o),isLoading:!1})),await Promise.all([y(),(async()=>{try{const v=await _.loadDrafts();v.success&&r(A=>({...A,drafts:v.data||[]}))}catch(v){console.error("Error reloading drafts:",v)}})(),(async()=>{try{const v=await _.getStorageUsage();r(A=>({...A,storageUsage:v}))}catch(v){console.error("Error refreshing storage usage:",v)}})()]),i("Quiz deleted successfully","success"),!0):(r(v=>({...v,isLoading:!1})),i(f.error||"Failed to delete quiz","error"),!1)}catch(f){return r(v=>({...v,isLoading:!1})),console.error("Error deleting quiz:",f),i("Failed to delete quiz","error"),!1}},[i,y]),d=g.useCallback(async o=>{try{const f=await _.saveDraft(o);return f.success?(r(v=>({...v,drafts:v.drafts.some(A=>A.id===o.id)?v.drafts.map(A=>A.id===o.id?f.data:A):[...v.drafts,f.data]})),!0):(console.error("Failed to save draft:",f.error),!1)}catch(f){return console.error("Error saving draft:",f),!1}},[]),u=g.useCallback(async()=>{try{const o=await _.loadDrafts();o.success?r(f=>({...f,drafts:o.data||[]})):console.error("Failed to load drafts:",o.error)}catch(o){console.error("Error loading drafts:",o)}},[]),x=g.useCallback(async o=>{try{const f=await _.deleteDraft(o);return f.success?(r(v=>({...v,drafts:v.drafts.filter(A=>A.id!==o)})),!0):(console.error("Failed to delete draft:",f.error),!1)}catch(f){return console.error("Error deleting draft:",f),!1}},[]),b=g.useCallback(async()=>{if(n.current)try{if(r(f=>({...f,autoSaveStatus:"saving"})),await d(n.current))r(f=>({...f,autoSaveStatus:"saved"})),l.current=0,setTimeout(()=>{r(f=>({...f,autoSaveStatus:"idle"}))},2e3);else throw new Error("Auto-save failed")}catch(o){console.error("Auto-save error:",o),r(f=>({...f,autoSaveStatus:"error"})),l.current<Te.MAX_RETRIES?(l.current++,setTimeout(()=>{b()},Te.RETRY_DELAY)):(i("Auto-save failed. Please save manually.","error"),setTimeout(()=>{r(f=>({...f,autoSaveStatus:"idle"}))},5e3))}},[d,i]),m=g.useCallback(o=>{s.current&&clearTimeout(s.current),n.current=o,s.current=setTimeout(()=>{b()},Te.DEBOUNCE_DELAY)},[b]),w=g.useCallback(()=>{s.current&&(clearTimeout(s.current),s.current=null),n.current=null,r(o=>({...o,autoSaveStatus:"idle"}))},[]),C=g.useCallback(async()=>{try{const o=await _.getStorageUsage();r(f=>({...f,storageUsage:o})),o.isNearLimit&&i(`Storage is ${o.percentageUsed.toFixed(1)}% full. Consider deleting old quizzes.`,"warning")}catch(o){console.error("Error getting storage usage:",o)}},[i]),E=g.useCallback(async()=>{try{const o=await _.cleanupOldDrafts();return o.success&&o.data>0&&(i(`Cleaned up ${o.data} old drafts`,"info"),await u(),await C()),o.data||0}catch(o){return console.error("Error cleaning up drafts:",o),0}},[u,C,i]);return g.useEffect(()=>{c()},[c]),g.useEffect(()=>{t.isInitialized&&(y(),u(),C())},[t.isInitialized,y,u,C]),g.useEffect(()=>()=>{s.current&&clearTimeout(s.current)},[]),{...t,saveQuiz:a,loadQuizzes:y,deleteQuiz:S,saveDraft:d,loadDrafts:u,deleteDraft:x,enableAutoSave:m,disableAutoSave:w,refreshStorageUsage:C,cleanupOldDrafts:E,initializeStorage:c}},ht={defaultTimeLimit:30},Ce={title:"",description:"",category:"general",difficulty:"medium",rounds:[],estimatedDuration:10,settings:ht,status:"draft"},ns=i=>{const{saveDraft:t,loadDrafts:r,deleteDraft:s,autoSaveStatus:n,storageError:l,clearError:c}=ut(),[a,y]=g.useState(Ce),[S,d]=g.useState(!1),[u,x]=g.useState(null),b=g.useRef(null),m=g.useRef(null);g.useEffect(()=>{S||(async()=>{try{if(i!=null&&i.id){const I={...i,status:"draft",id:i.id};y(I),m.current=I.id}else{const R=(await r()).find(h=>h.title===""||!h.title);if(R)y(R),m.current=R.id;else{const h={...Ce,id:`draft_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date};y(h),m.current=h.id}}}catch(I){console.warn("[WizardPersistence] Failed to initialize draft:",I);const R={...Ce,id:`draft_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date};y(R),m.current=R.id}finally{d(!0)}})()},[S,i,r]);const w=g.useCallback(()=>{b.current&&clearTimeout(b.current),b.current=setTimeout(async()=>{var D;if(a.id&&(a.title||(D=a.rounds)!=null&&D.length))try{await t(a),x(new Date)}catch(I){console.error("[WizardPersistence] Auto-save failed:",I)}},3e4)},[a,t]),C=g.useCallback(D=>{y(I=>({...I,...D,settings:{...I.settings||ht,...D.settings||{}},rounds:D.rounds!==void 0?D.rounds:I.rounds,updatedAt:new Date})),w()},[w]),E=g.useCallback(async()=>{if(a.id)try{await t(a),x(new Date)}catch(D){throw console.error("[WizardPersistence] Manual save failed:",D),D}},[a,t]),o=g.useCallback(async()=>{if(b.current&&(clearTimeout(b.current),b.current=null),m.current)try{await s(m.current)}catch(D){console.warn("[WizardPersistence] Failed to delete draft:",D)}y(Ce),x(null),m.current=null,c()},[s,c]),f=g.useCallback(()=>{const D={...Ce,id:`draft_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date};y(D),m.current=D.id,x(null)},[]),v=g.useCallback(D=>{const I={...D,status:"draft",id:`draft_${D.id||Date.now()}_${Date.now()}`,updatedAt:new Date};y(I),m.current=I.id,x(null)},[]),A=g.useCallback(async()=>{try{const I=(await r()).filter(R=>R.status==="draft").sort((R,h)=>new Date(h.updatedAt||0).getTime()-new Date(R.updatedAt||0).getTime())[0];return I?(y(I),m.current=I.id,x(I.updatedAt?new Date(I.updatedAt):null),!0):!1}catch(D){return console.error("[WizardPersistence] Draft recovery failed:",D),!1}},[r]);return g.useEffect(()=>()=>{b.current&&clearTimeout(b.current)},[]),{persistence:{draftQuiz:a,isInitialized:S,autoSaveStatus:n,storageError:l,lastSaved:u},actions:{updateDraft:C,saveDraft:E,clearDraft:o,resetDraft:f,initializeFromQuiz:v,recoverDraft:A}}},as=i=>{const{persistence:{draftQuiz:t,autoSaveStatus:r,storageError:s,lastSaved:n},actions:l}=ns(i),c=Ue({currentStep:0,draftQuiz:t}),{navigation:{currentStep:a,steps:y,canProceed:S},actions:d}=ts(c.validateStep),u=Ue({currentStep:a,draftQuiz:t}),x=ss({draftQuiz:t,clearDraft:l.clearDraft,resetDraft:l.resetDraft}),b=()=>{d.resetNavigation(),l.clearDraft()};return{currentStep:a,steps:y,canProceed:S,nextStep:d.nextStep,previousStep:d.previousStep,goToStep:d.goToStep,draftQuiz:t,updateDraft:l.updateDraft,saveDraft:l.saveDraft,autoSaveStatus:r,storageError:s,lastSaved:n,validateStep:u.validateStep,completeWizard:x.completeWizard,resetWizard:b,recoverDraft:l.recoverDraft}},os=g.createContext(null),Oe={didCatch:!1,error:null};class ls extends g.Component{constructor(t){super(t),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=Oe}static getDerivedStateFromError(t){return{didCatch:!0,error:t}}resetErrorBoundary(){const{error:t}=this.state;if(t!==null){for(var r,s,n=arguments.length,l=new Array(n),c=0;c<n;c++)l[c]=arguments[c];(r=(s=this.props).onReset)===null||r===void 0||r.call(s,{args:l,reason:"imperative-api"}),this.setState(Oe)}}componentDidCatch(t,r){var s,n;(s=(n=this.props).onError)===null||s===void 0||s.call(n,t,r)}componentDidUpdate(t,r){const{didCatch:s}=this.state,{resetKeys:n}=this.props;if(s&&r.error!==null&&cs(t.resetKeys,n)){var l,c;(l=(c=this.props).onReset)===null||l===void 0||l.call(c,{next:n,prev:t.resetKeys,reason:"keys"}),this.setState(Oe)}}render(){const{children:t,fallbackRender:r,FallbackComponent:s,fallback:n}=this.props,{didCatch:l,error:c}=this.state;let a=t;if(l){const y={error:c,resetErrorBoundary:this.resetErrorBoundary};if(typeof r=="function")a=r(y);else if(s)a=g.createElement(s,y);else if(n!==void 0)a=n;else throw c}return g.createElement(os.Provider,{value:{didCatch:l,error:c,resetErrorBoundary:this.resetErrorBoundary}},a)}}function cs(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return i.length!==t.length||i.some((r,s)=>!Object.is(r,t[s]))}const He={MAX_TITLE_LENGTH:100},ae={mixed:{label:"Any Type of Question",description:"Questions of any type",allowedQuestionTypes:["single-answer","multiple-choice","picture","audio","video"],canSelectQuestionType:!0},"single-answer-only":{label:"Question-Answer",description:"Only single answer questions",allowedQuestionTypes:["single-answer"],canSelectQuestionType:!1},"multiple-choice":{label:"Multiple Choice Question",description:"Only multiple choice questions",allowedQuestionTypes:["multiple-choice"],canSelectQuestionType:!1},picture:{label:"Picture Question",description:"Questions with picture uploads",allowedQuestionTypes:["picture"],canSelectQuestionType:!1},audio:{label:"Audio Question",description:"Questions with audio uploads",allowedQuestionTypes:["audio"],canSelectQuestionType:!1},video:{label:"Video Question",description:"Questions with video uploads",allowedQuestionTypes:["video"],canSelectQuestionType:!1},"golden-pyramid":{label:"Golden Pyramid Question",description:"Special 4-question format",allowedQuestionTypes:["multiple-choice"],canSelectQuestionType:!1,specialFormat:!0,prePopulatedQuestions:4}},ds=[{value:"general",label:"General Knowledge",description:"Mixed topics and trivia"},{value:"sports",label:"Sports",description:"Sports, teams, and athletics"},{value:"history",label:"History",description:"Historical events and figures"},{value:"science",label:"Science",description:"Science, technology, and nature"},{value:"geography",label:"Geography",description:"Countries, capitals, and locations"},{value:"entertainment",label:"Entertainment",description:"Movies, TV, and celebrities"},{value:"literature",label:"Literature",description:"Books, authors, and poetry"},{value:"art",label:"Art",description:"Visual arts, paintings, and artists"},{value:"music",label:"Music",description:"Songs, artists, and musical theory"},{value:"technology",label:"Technology",description:"Computers, software, and gadgets"},{value:"custom",label:"Custom",description:"Your own custom category"}],us=[{value:"easy",label:"Easy",description:"Simple questions for beginners",color:"success"},{value:"medium",label:"Medium",description:"Moderate difficulty questions",color:"warning"},{value:"hard",label:"Hard",description:"Challenging questions for experts",color:"error"}],hs=({draftQuiz:i,updateDraft:t,validation:r,onDeleteQuiz:s,isEditMode:n,onContinue:l})=>{var b,m;const c=k.useCallback(w=>r.errors.find(C=>C.toLowerCase().includes(w.toLowerCase())),[r.errors]),a=i.defaultTimeLimit,y=a===void 0?"":Math.round(a/60),S=a??60,d=S>0&&S<=3600,x=(()=>{if(a!==void 0&&!d){if(a<=0)return"Time must be > 0 minutes.";if(a>3600)return"Time must be <= 60 minutes."}})();return e.jsxs(z,{sx:{maxWidth:1e3,mx:"auto"},children:[e.jsxs(re,{container:!0,spacing:4,children:[e.jsx(re,{size:{xs:12},children:e.jsx($,{fullWidth:!0,id:"quiz-title",name:"title",label:"Quiz Title",placeholder:"e.g., General Knowledge Quiz, Science Facts Challenge",value:i.title||"",onChange:w=>t({title:w.target.value}),error:!!c("title"),helperText:c("title")||`${(i.title||"").length}/${He.MAX_TITLE_LENGTH} characters`,inputProps:{maxLength:He.MAX_TITLE_LENGTH,"aria-label":"Quiz title"},size:"medium",sx:{mb:3}})}),e.jsx(re,{size:{xs:12},children:e.jsx($,{fullWidth:!0,id:"quiz-description",name:"description",multiline:!0,rows:4,label:"Description (Optional)",placeholder:"Brief description of what this quiz covers...",value:i.description||"",onChange:w=>t({description:w.target.value}),helperText:`${((b=i.description)==null?void 0:b.length)||0}/500 characters`,inputProps:{maxLength:500},size:"medium",sx:{mb:3}})}),e.jsx(re,{size:{xs:12,md:6},children:e.jsxs(U,{fullWidth:!0,error:!!c("category"),size:"medium",children:[e.jsx(H,{children:"Quiz Category"}),e.jsx(K,{id:"quiz-category",name:"category",value:i.category||"general",onChange:w=>t({category:w.target.value}),label:"Quiz Category","aria-label":"Quiz category selection",startAdornment:e.jsx(Qe,{sx:{mr:1,color:"text.secondary"}}),children:ds.map(w=>e.jsx(P,{value:w.value,children:e.jsxs(z,{children:[e.jsx(T,{variant:"body1",children:w.label}),e.jsx(T,{variant:"caption",color:"text.secondary",children:w.description})]})},w.value))}),e.jsx(Be,{children:c("category")||"Choose the main topic of your quiz"})]})}),e.jsx(re,{size:{xs:12,md:6},children:e.jsxs(U,{fullWidth:!0,error:!!c("difficulty"),size:"medium",children:[e.jsx(H,{children:"Difficulty Level"}),e.jsx(K,{id:"quiz-difficulty",name:"difficulty",value:i.difficulty||"medium",onChange:w=>t({difficulty:w.target.value}),label:"Difficulty Level","aria-label":"Difficulty level selection",startAdornment:e.jsx(It,{sx:{mr:1,color:"text.secondary"}}),children:us.map(w=>e.jsx(P,{value:w.value,children:e.jsxs(z,{display:"flex",alignItems:"center",gap:2,width:"100%",children:[e.jsx(Z,{label:w.label,size:"small",color:w.color,variant:"outlined"}),e.jsx(T,{variant:"body2",color:"text.secondary",children:w.description})]})},w.value))}),e.jsx(Be,{children:c("difficulty")||"Set the challenge level for your quiz"})]})}),e.jsxs(z,{sx:{mt:3,width:"100%"},children:[e.jsx(T,{gutterBottom:!0,children:"Default Time Per Question"}),e.jsx($,{fullWidth:!0,type:"number",label:"1 Minute by Default",placeholder:"1 Minute by Default",value:y,onChange:w=>{const C=w.target.value;t({defaultTimeLimit:C===""?void 0:Number(C)*60})},error:!!x,helperText:x||"This will be the default time limit for each new question. You can override it per question.",inputProps:{step:.5,min:.1,"aria-label":"Default time per question in minutes"},InputProps:{endAdornment:e.jsx(Et,{position:"end",children:"minutes"})},size:"medium",sx:{mb:1,"& .MuiOutlinedInput-root":{"&.Mui-error fieldset":{borderColor:"error.main"}}}})]})]}),e.jsxs(z,{sx:{mt:4,display:"flex",justifyContent:"space-between",alignItems:"center",gap:2},children:[n&&s&&e.jsx(F,{variant:"outlined",color:"error",onClick:s,startIcon:e.jsx(de,{}),size:"large",sx:{minWidth:{xs:"auto",sm:150},height:48,borderColor:"error.main",color:"error.main","&:hover":{borderColor:"error.dark",backgroundColor:"error.light",color:"error.dark"},"& .MuiButton-startIcon":{margin:{xs:0,sm:"0 8px 0 -4px"}},"& .MuiButton-startIcon + *":{display:{xs:"none",sm:"inline"}}},children:e.jsx(z,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:"Delete Quiz"})}),!n&&e.jsx(z,{}),e.jsxs(F,{variant:"contained",onClick:l,disabled:!((m=i.title)!=null&&m.trim())||!d,size:"large",sx:{minWidth:{xs:120,sm:200},height:48,boxShadow:2,"&:hover":{boxShadow:4}},children:[e.jsx(z,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:"Continue to Questions"}),e.jsx(z,{component:"span",sx:{display:{xs:"inline",sm:"none"}},children:"Continue"})]})]})]})},ms=i=>{const[t,r]=g.useState(0),[s,n]=g.useState(!1),[l,c]=g.useState("add"),[a,y]=g.useState(null),[S,d]=g.useState({description:"",type:"mixed",answerRevealMode:"after-all",defaultTimePerQuestion:(i.defaultTimeLimit||60)/60,breakingTime:5}),[u,x]=g.useState(!1),[b,m]=g.useState(null),[w,C]=g.useState(null),[E,o]=g.useState(!1),[f,v]=g.useState(!1),[A,D]=g.useState(""),[I,R]=g.useState(""),[h,j]=g.useState(!1),[p,Q]=g.useState({questionType:"text-answer",language:"English",topicHint:"",category:"general",difficulty:"medium",optionsCount:4}),[q,V]=g.useState(!1),[fe,W]=g.useState(!1),[X,ee]=g.useState(null),te=i.rounds||[],pe=te[t]||null,ge=S.type&&S.answerRevealMode&&S.defaultTimePerQuestion>=.1&&S.breakingTime>=.1;g.useEffect(()=>{s&&l==="edit"&&a?d({description:a.description||"",type:a.type,answerRevealMode:a.answerRevealMode,defaultTimePerQuestion:a.defaultTimePerQuestion,breakingTime:a.breakingTime||1}):s&&l==="add"&&d({description:"",type:"mixed",answerRevealMode:"after-all",defaultTimePerQuestion:(i.defaultTimeLimit||60)/60,breakingTime:5})},[s,l,a,i]);const xe={setCurrentRoundIdx:r,goToPrevRound:g.useCallback(()=>{r(O=>Math.max(0,O-1))},[]),goToNextRound:g.useCallback(()=>{r(O=>Math.min(te.length-1,O+1))},[te.length]),openRoundModal:g.useCallback((O,ne)=>{c(O),y(ne||null),n(!0)},[]),closeRoundModal:g.useCallback(()=>{n(!1),y(null)},[]),updateRoundForm:g.useCallback((O,ne)=>{d(ze=>({...ze,[O]:ne}))},[]),openManualDialog:g.useCallback(()=>{x(!0)},[]),closeManualDialog:g.useCallback(()=>{x(!1),m(null)},[]),setManualQuestion:m,setEditingQuestionId:C,openAIDialog:g.useCallback(()=>{o(!0),R(""),j(!1)},[]),closeAIDialog:g.useCallback(()=>{o(!1)},[]),setAiGenerating:v,setAiStatus:D,setAiError:R,setAiErrorDismissed:j,setAiSettings:Q,openDeleteRoundConfirm:g.useCallback(()=>{V(!0)},[]),closeDeleteRoundConfirm:g.useCallback(()=>{V(!1)},[]),openDeleteQuestionConfirm:g.useCallback(O=>{ee(O),W(!0)},[]),closeDeleteQuestionConfirm:g.useCallback(()=>{W(!1),ee(null)},[])};return{state:{currentRoundIdx:t,roundModalOpen:s,roundModalMode:l,editingRound:a,roundForm:S,manualDialogOpen:u,manualQuestion:b,editingQuestionId:w,aiDialogOpen:E,aiGenerating:f,aiStatus:A,aiError:I,aiErrorDismissed:h,aiSettings:p,deleteRoundConfirmOpen:q,deleteQuestionConfirmOpen:fe,pendingDeleteQuestionId:X},actions:xe,derived:{rounds:te,currentRound:pe,isRoundFormValid:ge}}},fs=({rounds:i,currentRoundIdx:t,currentRound:r,onPreviousRound:s,onNextRound:n,onAddRound:l,onEditRound:c,onDeleteRound:a})=>{const y=i.length>0,S=y&&t>0,d=y&&t<i.length-1;return e.jsx(z,{sx:{mb:3},children:e.jsxs(z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:{xs:.5,sm:1.5},p:{xs:1.5,sm:2},borderRadius:3,bgcolor:"background.paper",border:1,borderColor:"divider",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",transition:"all 0.2s ease-in-out","&:hover":{boxShadow:"0 4px 16px rgba(0,0,0,0.12)"}},children:[e.jsx(ke,{onClick:s,disabled:!S,size:"medium",sx:{width:{xs:36,sm:44},height:{xs:36,sm:44},minWidth:{xs:36,sm:44},bgcolor:S?"primary.main":"grey.200",color:S?"white":"grey.400",boxShadow:S?2:1,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",transform:S?"scale(1)":"scale(0.9)","&:hover":{bgcolor:S?"primary.dark":"grey.200",transform:S?"scale(1.05)":"scale(0.9)",boxShadow:S?3:1},"&:active":{transform:S?"scale(0.95)":"scale(0.9)"},"&:disabled":{bgcolor:"grey.200",color:"grey.400",cursor:"not-allowed"}},"aria-label":"Previous round",children:e.jsx(Qt,{sx:{fontSize:{xs:"1.1rem",sm:"1.3rem"}}})}),e.jsx(z,{sx:{flex:1}}),y?e.jsx(F,{onClick:c,endIcon:e.jsx(Se,{sx:{fontSize:{xs:"0.9rem",sm:"1rem"}}}),sx:{borderRadius:3,textTransform:"none",fontWeight:600,fontSize:{xs:"0.8rem",sm:"0.9rem"},px:{xs:2,sm:3},py:{xs:1,sm:1.2},background:"linear-gradient(45deg, #1976d2, #42a5f5)",color:"white",boxShadow:"0 2px 8px rgba(25, 118, 210, 0.3)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",minWidth:{xs:90,sm:120},"&:hover":{background:"linear-gradient(45deg, #1565c0, #1976d2)",boxShadow:"0 4px 12px rgba(25, 118, 210, 0.4)",transform:"translateY(-1px)"},"&:active":{transform:"translateY(0px)"}},children:e.jsxs(T,{variant:"inherit",sx:{fontWeight:600,fontSize:"inherit",whiteSpace:"nowrap"},children:["Round ",t+1,"/",i.length]})}):e.jsx(T,{variant:"body2",sx:{color:"text.secondary",fontWeight:500,px:{xs:2,sm:3},fontSize:{xs:"0.8rem",sm:"0.9rem"}},children:"No rounds yet"}),e.jsxs(F,{onClick:l,sx:{borderRadius:{xs:"50%",sm:3},textTransform:"none",fontWeight:{xs:600,sm:500},fontSize:{xs:"1.4rem",sm:"0.8rem"},px:{xs:0,sm:3},py:{xs:0,sm:1.2},minWidth:{xs:40,sm:120},minHeight:{xs:40,sm:44},width:{xs:40,sm:120},height:{xs:40,sm:44},ml:{xs:.5,sm:1},background:"linear-gradient(45deg, #4caf50, #66bb6a)",color:"white",boxShadow:"0 2px 8px rgba(76, 175, 80, 0.3)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",display:"flex",alignItems:"center",justifyContent:"center","&:hover":{background:"linear-gradient(45deg, #388e3c, #4caf50)",boxShadow:"0 4px 12px rgba(76, 175, 80, 0.4)",transform:"translateY(-1px)"},"&:active":{transform:"translateY(0px)"}},"aria-label":"Add round",children:[e.jsx(z,{sx:{display:{xs:"flex",sm:"none"},alignItems:"center",justifyContent:"center",width:"100%",height:"100%"},children:e.jsx(ce,{sx:{fontSize:"1.6rem"}})}),e.jsx(T,{variant:"inherit",sx:{fontWeight:600,fontSize:"inherit",display:{xs:"none",sm:"block"},whiteSpace:"nowrap"},children:"Add Round"})]}),e.jsx(z,{sx:{flex:1}}),e.jsx(ke,{onClick:n,disabled:!d,size:"medium",sx:{width:{xs:36,sm:44},height:{xs:36,sm:44},minWidth:{xs:36,sm:44},bgcolor:d?"primary.main":"grey.200",color:d?"white":"grey.400",boxShadow:d?2:1,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",transform:d?"scale(1)":"scale(0.9)","&:hover":{bgcolor:d?"primary.dark":"grey.200",transform:d?"scale(1.05)":"scale(0.9)",boxShadow:d?3:1},"&:active":{transform:d?"scale(0.95)":"scale(0.9)"},"&:disabled":{bgcolor:"grey.200",color:"grey.400",cursor:"not-allowed"}},"aria-label":"Next round",children:e.jsx(Ft,{sx:{fontSize:{xs:"1.1rem",sm:"1.3rem"}}})})]})})},ps=(i,t)=>!i.question||!i.question.trim()?!1:i.type==="single-answer"||["picture","audio","video"].includes(i.type)?!!(i.correctAnswerText&&i.correctAnswerText.trim()):t==="golden-pyramid"?i.possibleAnswers.length>0&&i.possibleAnswers.every(r=>r.trim()):i.possibleAnswers.length>=2&&i.possibleAnswers.every(r=>r.trim())&&i.correctAnswers.length>0,gs=({currentRound:i,onEditQuestion:t,onDeleteQuestion:r,onAddRound:s,onAddQuestion:n})=>i?e.jsxs(e.Fragment,{children:[e.jsx(z,{sx:{mb:2},children:e.jsxs(T,{variant:"subtitle1",color:"text.secondary",children:[i.level?`Level: ${i.level}`:""," | Reveal:"," ",i.answerRevealMode," | Default Time:"," ",i.defaultTimePerQuestion,"min"]})}),e.jsx(z,{sx:{display:"flex",flexDirection:"column",gap:2},children:i.questions.length===0?e.jsx(le,{elevation:0,sx:{textAlign:"center",py:4,border:1,borderStyle:"dashed",borderColor:"divider"},children:e.jsxs(me,{children:[e.jsx(T,{variant:"body2",color:"text.secondary",paragraph:!0,children:"No questions in this round yet. Add or generate questions to get started."}),n&&e.jsx(F,{variant:"contained",size:"medium",startIcon:e.jsx(ce,{}),onClick:n,sx:{mt:1},children:"Add Question"})]})}):i.questions.map((l,c)=>{const a=ps(l,i.type);return e.jsxs(le,{elevation:0,sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,py:1.5,cursor:"pointer",bgcolor:"background.paper",transition:"box-shadow 0.2s","&:hover":{boxShadow:4}},onClick:()=>t(l),"aria-label":`Edit question ${c+1}`,children:[e.jsx(z,{sx:{mr:1,display:"flex",alignItems:"center"},children:a?e.jsx(nt,{sx:{color:"success.main",fontSize:{xs:16,sm:18}},titleAccess:"Question complete"}):e.jsx(Ne,{sx:{color:"error.main",fontSize:{xs:16,sm:18}},titleAccess:"Question incomplete"})}),e.jsxs(T,{variant:"subtitle1",sx:{flex:1},children:[c+1,". ",l.question||"Untitled Question"]}),e.jsx(Z,{label:l.difficulty,size:"small",color:l.difficulty==="easy"?"success":l.difficulty==="medium"?"warning":"error",sx:{mr:1}}),e.jsx(ie,{size:"small",color:"error",onClick:y=>{y.stopPropagation(),r(l.id)},"aria-label":`Delete question ${c+1}`,children:e.jsx(de,{fontSize:"small"})})]},l.id)})})]}):e.jsx(le,{elevation:0,sx:{textAlign:"center",py:6,border:2,borderStyle:"dashed",borderColor:"divider",bgcolor:"background.default"},children:e.jsxs(me,{children:[e.jsx(We,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(T,{variant:"h6",gutterBottom:!0,children:"No Rounds Yet"}),e.jsx(T,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Add your first round to begin creating your quiz structure."}),s&&e.jsx(F,{variant:"contained",size:"large",startIcon:e.jsx(ce,{}),onClick:s,sx:{mt:2},children:"Add Round"})]})}),xs=({showActions:i,roundType:t,onOpenAIDialog:r,onOpenManualDialog:s})=>{if(!i||!t||t==="golden-pyramid")return null;const n=["mixed","single-answer-only","multiple-choice"].includes(t);return e.jsxs(z,{sx:{display:"flex",gap:1,mb:3},children:[n&&e.jsx(F,{variant:"outlined",startIcon:e.jsx(at,{}),onClick:r,"aria-label":"Generate question with AI",children:"AI Generate"}),e.jsx(F,{variant:"contained",startIcon:e.jsx(ce,{}),onClick:s,"aria-label":"Add question manually",children:"Add Question"})]})},ys=({question:i,onUpdate:t,roundType:r="mixed"})=>{const s=ae[r],n=async d=>{var v,A,D,I,R;const u=(v=d.target.files)==null?void 0:v[0];if(!u)return;const x={picture:["image/jpeg","image/jpg","image/png","image/webp","image/gif","image/bmp","image/tiff","image/svg+xml"],audio:["audio/mpeg","audio/mp3","audio/wav","audio/wave","audio/x-wav","audio/wma","audio/mp4","audio/m4a"],video:["video/mp4","video/webm","video/mov","video/quicktime","video/x-msvideo","video/avi","video/wmv"]},b=((A=u.name.split(".").pop())==null?void 0:A.toLowerCase())||"",m={picture:["jpg","jpeg","png","webp","gif","bmp","tiff","svg"],audio:["mp3","wav","wma","m4a"],video:["mp4","mov","wmv","avi","webm"]},w=i.type,C=(D=x[w])==null?void 0:D.includes(u.type),E=(I=m[w])==null?void 0:I.includes(b);if(!C&&!E){alert(`Unsupported file format. Supported formats: ${(R=m[w])==null?void 0:R.join(", ")}`);return}const o={picture:10*1024*1024,audio:20*1024*1024,video:100*1024*1024};if(u.size>o[w]){const h=o[w]/1048576;alert(`File too large. Maximum size for ${w} files is ${h}MB`);return}const f=new FileReader;f.onload=h=>{var p;const j={id:`media_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,filename:u.name,type:i.type==="picture"?"image":i.type==="audio"?"audio":"video",size:u.size,data:(p=h.target)==null?void 0:p.result,mimeType:u.type,createdAt:new Date};t({mediaFile:j})},f.readAsDataURL(u)},l=(d,u)=>{const x=[...i.possibleAnswers];x[d]=u,t({possibleAnswers:x})},c=()=>{i.possibleAnswers.length<20&&t({possibleAnswers:[...i.possibleAnswers,""]})},a=d=>{const u=i.type==="multiple-choice"?2:0;if(i.possibleAnswers.length>u){const x=i.possibleAnswers.filter((m,w)=>w!==d),b=i.correctAnswers.filter(m=>m!==d).map(m=>m>d?m-1:m);t({possibleAnswers:x,correctAnswers:b})}},y=d=>{const u=i.correctAnswers||[],x=u.includes(d);let b;x?b=u.filter(m=>m!==d):b=[...u,d].sort(),t({correctAnswers:b})},S=()=>{const d=["picture","audio","video"].includes(i.type),u=["picture","audio","video"].includes(r||"");if(!d&&!u)return null;const x=d?i.type:r;return e.jsxs(z,{sx:{mb:3},children:[e.jsx(T,{variant:"subtitle2",gutterBottom:!0,children:"Media File"}),e.jsxs(F,{variant:"outlined",component:"label",sx:{mb:2},"aria-label":`Upload ${x} file`,children:["Upload"," ",x&&x.charAt(0).toUpperCase()+x.slice(1),e.jsx("input",{type:"file",accept:x==="picture"?".jpg,.jpeg,.png,.webp,.gif,.bmp,.tiff,.svg":x==="audio"?".mp3,.wav,.wma,.m4a":".mp4,.mov,.wmv,.avi,.webm",hidden:!0,onChange:n})]}),i.mediaFile&&e.jsxs(z,{sx:{mb:2},children:[x==="picture"&&e.jsx(z,{component:"img",src:i.mediaFile.data,alt:"Question media",sx:{maxWidth:"100%",width:"100%",maxHeight:{xs:200,sm:300,md:400},height:"auto",borderRadius:2,objectFit:"contain",border:"1px solid",borderColor:"divider"}}),x==="audio"&&e.jsx(z,{component:"audio",controls:!0,src:i.mediaFile.data,sx:{width:"100%",maxWidth:400,height:40}}),x==="video"&&e.jsx(z,{component:"video",controls:!0,src:i.mediaFile.data,sx:{maxWidth:"100%",width:"100%",maxHeight:{xs:200,sm:300,md:400},height:"auto",borderRadius:2,objectFit:"contain",border:"1px solid",borderColor:"divider"}}),e.jsxs(T,{variant:"caption",display:"block",sx:{mt:1},children:[i.mediaFile.filename," (",(i.mediaFile.size/1024/1024).toFixed(2)," MB)"]}),e.jsx(F,{size:"small",color:"error",onClick:()=>t({mediaFile:void 0}),sx:{mt:1},children:"Remove File"})]})]})};return e.jsxs(Fe,{spacing:3,sx:{mt:1},children:[(r==="picture"||r==="audio"||r==="video")&&e.jsxs(U,{fullWidth:!0,children:[e.jsx(H,{children:"Question Type"}),e.jsxs(K,{value:i.type,label:"Question Type",onChange:d=>{const u=d.target.value,x={type:u};u==="single-answer"?(x.possibleAnswers=[],x.correctAnswers=[],x.correctAnswerText=""):u==="multiple-choice"&&(x.possibleAnswers=["","","",""],x.correctAnswers=[0],x.correctAnswerText=void 0),t(x)},children:[e.jsx(P,{value:"single-answer",children:"Single Answer"}),e.jsx(P,{value:"multiple-choice",children:"Multiple Choice"})]})]}),r==="mixed"&&e.jsxs(U,{fullWidth:!0,children:[e.jsx(H,{children:"Question Type"}),e.jsx(K,{value:i.type,label:"Question Type",onChange:d=>{const u=d.target.value,x={type:u};u==="single-answer"?(x.possibleAnswers=[],x.correctAnswers=[],x.correctAnswerText="",x.mediaFile=void 0):u==="multiple-choice"?(x.possibleAnswers=["","","",""],x.correctAnswers=[0],x.correctAnswerText=void 0,x.mediaFile=void 0):(x.possibleAnswers=[],x.correctAnswers=[],x.correctAnswerText=""),t(x)},children:s.allowedQuestionTypes.map(d=>e.jsxs(P,{value:d,children:[d==="single-answer"&&"Single Answer",d==="multiple-choice"&&"Multiple Choice",d==="picture"&&"Picture Question",d==="audio"&&"Audio Question",d==="video"&&"Video Question"]},d))})]}),e.jsx($,{fullWidth:!0,label:"Question",multiline:!0,minRows:2,maxRows:4,value:i.question,onChange:d=>t({question:d.target.value}),placeholder:"Enter your question here..."}),S(),i.type==="single-answer"||["picture","audio","video"].includes(i.type)&&i.possibleAnswers.length===0?e.jsxs(z,{children:[e.jsxs(z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(T,{variant:"subtitle2",children:"Correct Answer"}),["picture","audio","video"].includes(i.type)&&e.jsx(F,{size:"small",variant:"outlined",onClick:()=>{t({possibleAnswers:["","","",""],correctAnswers:[0],correctAnswerText:void 0})},children:"Switch to Multiple Choice"})]}),e.jsx($,{fullWidth:!0,label:"Type the correct answer",value:i.correctAnswerText||"",onChange:d=>t({correctAnswerText:d.target.value}),placeholder:"e.g., Sofia, Paris, 1969...",helperText:"This is the exact answer participants need to type"})]}):e.jsxs(z,{children:[e.jsxs(z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(T,{variant:"subtitle2",children:r==="golden-pyramid"?"Correct Answers":"Answer Options (1-20 options)"}),["picture","audio","video"].includes(i.type)&&r!=="golden-pyramid"&&e.jsx(F,{size:"small",variant:"outlined",onClick:()=>{t({possibleAnswers:[],correctAnswers:[],correctAnswerText:""})},children:"Switch to Single Answer"})]}),e.jsxs(Fe,{spacing:2,children:[i.possibleAnswers.map((d,u)=>e.jsxs(z,{sx:{display:"flex",alignItems:"center",gap:1},children:[r!=="golden-pyramid"&&e.jsx(Mt,{control:e.jsx(Rt,{checked:i.correctAnswers.includes(u),onChange:()=>y(u)}),label:""}),e.jsx($,{fullWidth:!0,value:d,onChange:x=>l(u,x.target.value),placeholder:r==="golden-pyramid"?`Correct Answer (${u+1})`:`Enter option ${u+1}...`}),r!=="golden-pyramid"&&i.possibleAnswers.length>1&&e.jsx(ie,{onClick:()=>a(u),color:"error",size:"small",children:e.jsx(de,{})})]},u)),r!=="golden-pyramid"&&i.possibleAnswers.length<20&&e.jsx(F,{startIcon:e.jsx(ce,{}),onClick:c,variant:"outlined",size:"small",children:"Add Option"})]}),r!=="golden-pyramid"&&i.correctAnswers.length===0&&e.jsx(T,{variant:"caption",color:"error",children:"Please select at least one correct answer"})]}),e.jsxs(z,{sx:{display:"flex",gap:2,width:"100%",flexWrap:"nowrap",alignItems:"flex-start"},children:[e.jsx($,{fullWidth:!0,type:"number",label:"Points",placeholder:"1",inputProps:{min:.1,step:.1},value:i.points||"",onChange:d=>t({points:Number(d.target.value)||1}),sx:{flex:1,minWidth:0}}),e.jsx($,{fullWidth:!0,type:"number",label:"Time Limit (min)",placeholder:"1",inputProps:{min:.1,step:.1},value:i.timeLimit||"",onChange:d=>t({timeLimit:Number(d.target.value)||1}),sx:{flex:1,minWidth:0}}),e.jsxs($,{fullWidth:!0,select:!0,label:"Difficulty",value:i.difficulty,onChange:d=>t({difficulty:d.target.value}),sx:{flex:1,minWidth:0},children:[e.jsx(P,{value:"easy",children:"Easy"}),e.jsx(P,{value:"medium",children:"Medium"}),e.jsx(P,{value:"hard",children:"Hard"})]})]}),e.jsx($,{fullWidth:!0,label:"Explanation (optional)",multiline:!0,minRows:2,maxRows:3,value:i.explanation||"",onChange:d=>t({explanation:d.target.value}),placeholder:"Optional explanation shown after the question..."})]})};let we=0,ve=0;const Re=6e4,_e=15,Ke=4e3;function bs(){const i=Date.now();if(i-we>Re&&(ve=0),ve>=_e){const r=Re-(i-we);return{isRateLimited:!0,retryAfter:Math.ceil(r/1e3),message:`Rate limit reached (${_e}/minute). Please wait ${Math.ceil(r/1e3)} seconds.`}}const t=i-we;if(t<Ke&&ve>0){const r=Ke-t;return{isRateLimited:!0,retryAfter:Math.ceil(r/1e3),message:`Please wait ${Math.ceil(r/1e3)} seconds between requests to avoid rate limits.`}}return{isRateLimited:!1}}function Ye(i){return new Promise(t=>setTimeout(t,i*1e3))}const mt=async(i={},t)=>{var r;try{const s=bs();if(s.isRateLimited){const u=s.retryAfter||4;t||await Ye(u)}const n="AIzaSyAzhUzT7hqprvBPcz96iN8j0zdAw84pBb4";if(!navigator.onLine)throw new Error("Internet connection required");ve++,we=Date.now();const c={contents:[{parts:[{text:ws(i.difficulty||"medium",i.language||"English",i.category||"random",i.previousQuestions||[])}]}],generationConfig:{temperature:.9,topK:40,topP:.95,maxOutputTokens:1024}},a=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!a.ok){const u=await a.json().catch(()=>({}));if(a.status===429)return await Ye(4),mt(i,t);throw new Error(`Gemini API error: ${a.status} - ${((r=u.error)==null?void 0:r.message)||"Unknown error"}`)}const y=await a.json();if(!y.candidates||y.candidates.length===0)throw new Error("No response generated from Gemini API");const S=y.candidates[0].content.parts[0].text,d=js(S);return{id:Math.random().toString(36).substring(7),question:d.question,answer:d.answer,category:d.category,difficulty:d.difficulty}}catch(s){throw console.error("Gemini API error:",s),s instanceof Error?s:new Error("Failed to generate question. Please try again.")}};function ws(i,t,r,s){const n=t.toLowerCase()==="bulgarian"?"Generate the question and answer in Bulgarian language.":"Generate the question and answer in English language.",l=r.toLowerCase()==="random"?"Choose a random general knowledge topic.":`Generate a question about the category: ${r}`,c=vs(i);let a="";s.length>0&&(a=`

IMPORTANT: Do NOT repeat any of these recently asked questions. Generate something completely different:
${s.slice(-10).map((d,u)=>`${u+1}. ${d.question}`).join(`
`)}`);const y=Ss(r);return`You are an expert quiz master with access to accurate, up-to-date information. Generate a single quiz question and its answer.

${n}
${l}
${c}
${y}
${a}

CRITICAL REQUIREMENTS:
- The answer must be 100% factually correct and verifiable
- For geographic questions, double-check all facts (heights, locations, names)
- Avoid controversial or ambiguous topics
- Make the question engaging and educational
- Ensure the question is unique and not repetitive

IMPORTANT: Respond ONLY with a valid JSON object in this exact format:
{
  "question": "Your generated question here",
  "answer": "The correct answer here", 
  "category": "The category of the question",
  "difficulty": "${i}"
}

Do not include any other text, explanations, or formatting outside the JSON object.`}function vs(i){switch(i.toLowerCase()){case"easy":return"Make this an EASY question that most people would know. Use basic, well-known facts that are commonly taught in school or widely known in popular culture.";case"hard":return"Make this a HARD question that requires specialized knowledge, advanced education, or deep expertise in a specific field. Use complex concepts, technical details, or obscure historical facts.";case"medium":default:return"Make this a MEDIUM difficulty question that requires some general knowledge and thinking. It should be challenging but not impossible for an educated person to answer."}}function Ss(i){const t=i.toLowerCase();return t.includes("geography")||t.includes("смолян")||t.includes("bulgaria")||t.includes("mountain")||t.includes("peak")?`
FACT-CHECKING FOR GEOGRAPHY: 
- For Bulgarian geography: Verify all mountain peaks, heights, and locations
- For Smolyan region: The highest peak near Smolyan is Perelik (2,191m), NOT Snezhanka
- Snezhanka is near Pamporovo but is NOT the highest peak in the Smolyan area
- Always verify geographical facts against reliable sources
- Double-check all numerical data (heights, distances, populations)`:t.includes("history")?`
FACT-CHECKING FOR HISTORY: 
- Verify all dates, names, and historical events
- Ensure chronological accuracy
- Cross-reference multiple historical sources`:t.includes("science")?`
FACT-CHECKING FOR SCIENCE: 
- Verify all scientific facts and figures
- Ensure formulas and laws are correct
- Use current scientific understanding`:`
FACT-CHECKING: 
- Verify all facts before including them
- Use reliable, authoritative sources
- Avoid outdated or disputed information`}function js(i){try{const r=i.trim().match(/\{[\s\S]*\}/);if(!r)throw new Error("No JSON found in response");const s=JSON.parse(r[0]);if(!s.question||!s.answer)throw new Error("Missing required fields in response");return{question:s.question,answer:s.answer,category:s.category||"General Knowledge",difficulty:s.difficulty||"medium"}}catch{return console.error("Failed to parse Gemini response:",i),{question:"What is the capital of France?",answer:"Paris",category:"Geography",difficulty:"easy"}}}const ft=()=>!!navigator.onLine,zs=()=>{const i=Date.now();i-we>Re&&(ve=0);const t=Math.max(0,_e-ve),r=Math.max(0,Re-(i-we)),s=t<=3;return{requestsRemaining:t,timeUntilReset:Math.ceil(r/1e3),isNearLimit:s}},Cs=async(i={},t)=>{try{if(!ft())return{question:Je(),success:!1,error:"AI service is not available. Please check your connection and try again."};const r={difficulty:i.difficulty||"medium",language:i.language||"English",category:i.topicHint||Is(i.category||"general"),previousQuestions:Es(i.previousQuestions||[])},s=await mt(r,t),n=i.questionType||"text-answer";return{question:await As(s,n,i.optionsCount||4,i.difficulty||"medium"),success:!0}}catch(r){const s=r instanceof Error?r.message:"Failed to generate question";return{question:Je(),success:!1,error:s}}};async function As(i,t,r,s){const n=new Date,l={id:pt(),question:i.question,difficulty:s,points:Fs(),timeLimit:60,createdAt:n,updatedAt:n};if(t==="text-answer")return{...l,type:"text-answer",options:[],correctAnswer:-1,textAnswer:i.answer,explanation:`The correct answer is: ${i.answer}`};{const c=await Ds(i.question,i.answer,r-1,s),a=[i.answer,...c],y=Qs([...a]),S=y.indexOf(i.answer);return{...l,type:"text",options:y,correctAnswer:S,textAnswer:"",explanation:`The correct answer is: ${i.answer}`}}}async function Ds(i,t,r,s){var n,l,c,a,y;try{const S=Ts(i,t,r,s),d="AIzaSyAzhUzT7hqprvBPcz96iN8j0zdAw84pBb4",u=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${d}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:S}]}],generationConfig:{temperature:.8,topK:40,topP:.9}})});if(!u.ok)return Le(t,r);const b=((y=(a=(c=(l=(n=(await u.json()).candidates)==null?void 0:n[0])==null?void 0:l.content)==null?void 0:c.parts)==null?void 0:a[0])==null?void 0:y.text)||"",m=ks(b,r);if(m.length<r){const w=Le(t,r-m.length);return[...m,...w]}return m.slice(0,r)}catch(S){return console.warn("Failed to generate AI distractors, using fallback:",S),Le(t,r)}}function Ts(i,t,r,s){const n={easy:"Make the wrong answers obviously incorrect but still plausible.",medium:"Make the wrong answers plausible but clearly distinguishable from the correct answer.",hard:"Make the wrong answers very plausible and similar to the correct answer."}[s];return`Generate ${r} incorrect but plausible answers for this multiple choice question.

Question: ${i}
Correct Answer: ${t}

Requirements:
- ${n}
- Each wrong answer should be on a separate line
- Make them the same format/length as the correct answer
- Don't number them or add extra text
- Make them factually wrong but believable
- Avoid obviously ridiculous answers

Wrong answers:`}function ks(i,t){return i.split(`
`).map(s=>s.trim()).filter(s=>s.length>0).filter(s=>!s.match(/^[0-9]+\.?\s/)).slice(0,t)}function Le(i,t){const r=[];for(let s=0;s<t;s++)if(i.match(/^\d+$/)){const n=parseInt(i);r.push(String(n+(s+1)*10))}else i.match(/^[A-Z]/)?r.push(`Alternative ${String.fromCharCode(65+s)}`):r.push(`Option ${String.fromCharCode(65+s)}`);return r}function Je(){const i=new Date;return{id:pt(),type:"text",question:"",options:["","","",""],correctAnswer:0,difficulty:"medium",points:1,timeLimit:60,createdAt:i,updatedAt:i}}function pt(){return`q_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function Is(i){return{general:"General Knowledge",sports:"Sports",history:"History",science:"Science",geography:"Geography",entertainment:"Entertainment",literature:"Literature",art:"Art",music:"Music",technology:"Technology",custom:"General Knowledge"}[i]||"General Knowledge"}function Es(i){return i.map(t=>({question:t.question,answer:t.options[t.correctAnswer]||""}))}function Qs(i){const t=[...i];for(let r=t.length-1;r>0;r--){const s=Math.floor(Math.random()*(r+1));[t[r],t[s]]=[t[s],t[r]]}return t}function Fs(i){return 1}const Ze=()=>ft(),Ms=()=>zs(),Rs=({draftQuiz:i,updateDraft:t,showValidation:r})=>{const{state:s,actions:n,derived:l}=ms(i),{rounds:c,currentRound:a,isRoundFormValid:y}=l,S=[{value:"mixed",label:"Mixed Types"},{value:"single-answer-only",label:"Single Answer Only"},{value:"multiple-choice",label:"Multiple Choice"},{value:"picture",label:"Picture Round"},{value:"audio",label:"Audio Round"},{value:"video",label:"Video Round"},{value:"golden-pyramid",label:"Golden Pyramid"}],d=[{value:"after-each",label:"After Each Question"},{value:"after-all",label:"After All Questions"}],u=()=>{var p,Q,q;if(!y)return;const h=s.roundModalMode==="add"?c.length:s.currentRoundIdx,j={id:((p=s.editingRound)==null?void 0:p.id)||`round_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:`Round ${h+1}`,description:s.roundForm.description,type:s.roundForm.type,answerRevealMode:s.roundForm.answerRevealMode,defaultTimePerQuestion:Number(s.roundForm.defaultTimePerQuestion),breakingTime:Number(s.roundForm.breakingTime),level:i.difficulty||"medium",questions:((Q=s.editingRound)==null?void 0:Q.questions)||[],createdAt:((q=s.editingRound)==null?void 0:q.createdAt)||new Date,updatedAt:new Date};if(s.roundForm.type==="golden-pyramid"&&j.questions.length===0){const V=Array.from({length:4},(fe,W)=>({id:`question_${Date.now()}_${W}_${Math.random().toString(36).substr(2,9)}`,type:"multiple-choice",question:`Golden Pyramid Question ${W+1}`,possibleAnswers:Array.from({length:W+1},()=>""),correctAnswers:Array.from({length:W+1},(X,ee)=>ee),correctAnswerText:"",explanation:"",mediaFile:void 0,difficulty:i.difficulty||"medium",points:1,timeLimit:Number(s.roundForm.defaultTimePerQuestion),createdAt:new Date,updatedAt:new Date}));j.questions=V}E(j)},x=k.useCallback(()=>e.jsxs(B,{open:s.aiDialogOpen,onClose:n.closeAIDialog,maxWidth:"sm",fullWidth:!0,children:[e.jsx(Y,{children:e.jsxs(z,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(at,{color:"primary"}),"Generate AI Question"]})}),e.jsx(G,{children:e.jsxs(Fe,{spacing:3,sx:{mt:1},children:[(s.aiGenerating||s.aiStatus)&&e.jsx(oe,{severity:"info",icon:s.aiGenerating?e.jsx(Pt,{size:20}):void 0,children:s.aiStatus||"Generating question..."}),s.aiError&&!s.aiErrorDismissed&&e.jsx(oe,{severity:"error",action:e.jsx(ie,{size:"small",onClick:()=>n.setAiErrorDismissed(!0),"aria-label":"Dismiss error",children:e.jsx(Me,{fontSize:"small"})}),children:s.aiError}),(a==null?void 0:a.type)==="mixed"&&e.jsxs(U,{fullWidth:!0,children:[e.jsx(H,{children:"Question Type"}),e.jsxs(K,{value:s.aiSettings.questionType||"text-answer",onChange:h=>n.setAiSettings({...s.aiSettings,questionType:h.target.value}),label:"Question Type",children:[e.jsx(P,{value:"text-answer",children:e.jsxs(z,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ot,{fontSize:"small"}),"Single Answer"]})}),e.jsx(P,{value:"text",children:e.jsxs(z,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Lt,{fontSize:"small"}),"Multiple Choice"]})})]})]}),e.jsxs(U,{fullWidth:!0,children:[e.jsx(H,{children:"Language"}),e.jsxs(K,{value:s.aiSettings.language||"English",onChange:h=>n.setAiSettings({...s.aiSettings,language:h.target.value}),label:"Language",children:[e.jsx(P,{value:"English",children:"English"}),e.jsx(P,{value:"Bulgarian",children:"Bulgarian"})]})]}),e.jsx($,{fullWidth:!0,label:"Topic (optional)",placeholder:"e.g., Ancient Rome, Quantum Physics, Football...",value:s.aiSettings.topicHint||"",onChange:h=>n.setAiSettings({...s.aiSettings,topicHint:h.target.value}),helperText:"Leave empty for random topic"}),e.jsxs(U,{fullWidth:!0,children:[e.jsx(H,{children:"Category"}),e.jsxs(K,{value:s.aiSettings.category||"general",onChange:h=>n.setAiSettings({...s.aiSettings,category:h.target.value}),label:"Category",children:[e.jsx(P,{value:"general",children:"General Knowledge"}),e.jsx(P,{value:"science",children:"Science"}),e.jsx(P,{value:"history",children:"History"}),e.jsx(P,{value:"geography",children:"Geography"}),e.jsx(P,{value:"sports",children:"Sports"}),e.jsx(P,{value:"entertainment",children:"Entertainment"}),e.jsx(P,{value:"literature",children:"Literature"}),e.jsx(P,{value:"art",children:"Art"}),e.jsx(P,{value:"music",children:"Music"}),e.jsx(P,{value:"technology",children:"Technology"})]})]}),e.jsxs(U,{fullWidth:!0,children:[e.jsx(H,{children:"Difficulty"}),e.jsxs(K,{value:s.aiSettings.difficulty||"medium",onChange:h=>n.setAiSettings({...s.aiSettings,difficulty:h.target.value}),label:"Difficulty",children:[e.jsx(P,{value:"easy",children:"Easy"}),e.jsx(P,{value:"medium",children:"Medium"}),e.jsx(P,{value:"hard",children:"Hard"})]})]}),(s.aiSettings.questionType==="text"||(a==null?void 0:a.type)==="multiple-choice"&&a.type!=="mixed")&&e.jsxs(U,{fullWidth:!0,children:[e.jsx(H,{children:"Number of Options"}),e.jsxs(K,{value:s.aiSettings.optionsCount||4,onChange:h=>n.setAiSettings({...s.aiSettings,optionsCount:Number(h.target.value)}),label:"Number of Options",children:[e.jsx(P,{value:2,children:"2 Options"}),e.jsx(P,{value:3,children:"3 Options"}),e.jsx(P,{value:4,children:"4 Options"}),e.jsx(P,{value:5,children:"5 Options"}),e.jsx(P,{value:6,children:"6 Options"})]})]}),Ze()&&e.jsx(z,{sx:{p:2,bgcolor:"background.paper",borderRadius:1},children:e.jsxs(T,{variant:"body2",color:"text.secondary",children:["AI questions remaining:"," ",Ms().requestsRemaining,"/15 per minute"]})})]})}),e.jsxs(J,{children:[e.jsx(F,{onClick:n.closeAIDialog,children:"Cancel"}),e.jsx(F,{onClick:async()=>{n.setAiGenerating(!0),n.setAiError(null),n.setAiErrorDismissed(!1);try{let h=s.aiSettings.questionType;(a==null?void 0:a.type)==="single-answer-only"?h="text-answer":(a==null?void 0:a.type)==="multiple-choice"&&(h="text");const j=await Cs({questionType:h||"text-answer",language:s.aiSettings.language||"English",topicHint:s.aiSettings.topicHint,category:s.aiSettings.category||"general",difficulty:s.aiSettings.difficulty||"medium",optionsCount:s.aiSettings.optionsCount||4});if(j.success&&j.question){const p={...j.question,id:`q_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,difficulty:s.aiSettings.difficulty||"medium",points:1,timeLimit:(a==null?void 0:a.defaultTimePerQuestion)||1,createdAt:new Date,updatedAt:new Date},Q={...a,questions:[...(a==null?void 0:a.questions)||[],p],updatedAt:new Date};t({rounds:c.map((q,V)=>V===s.currentRoundIdx?Q:q)}),n.setAiStatus("Question generated successfully!"),setTimeout(()=>{n.closeAIDialog(),n.setAiStatus(null)},1500)}else n.setAiError(j.error||"Failed to generate question")}catch(h){n.setAiError(h instanceof Error?h.message:"Unknown error occurred")}finally{n.setAiGenerating(!1)}},variant:"contained",disabled:s.aiGenerating||!Ze(),children:s.aiGenerating?"Generating...":"Generate"})]})]}),[s.aiDialogOpen,s.aiGenerating,s.aiStatus,s.aiError,s.aiErrorDismissed,s.aiSettings,a,c,s.currentRoundIdx,n,t]),b=()=>{if(!a)return;const h=ae[a.type];let j;a.type==="picture"?j="picture":a.type==="audio"?j="audio":a.type==="video"?j="video":h.canSelectQuestionType?j="single-answer":j=h.allowedQuestionTypes[0];let p;j==="single-answer"?p={possibleAnswers:[],correctAnswers:[],correctAnswerText:""}:j==="multiple-choice"?p={possibleAnswers:["","","",""],correctAnswers:[0],correctAnswerText:void 0}:["picture","audio","video"].includes(j)?p={possibleAnswers:[],correctAnswers:[],correctAnswerText:""}:p={possibleAnswers:[""],correctAnswers:[0],correctAnswerText:void 0},n.setManualQuestion({id:`q_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:j,question:"",...p,explanation:"",mediaFile:void 0,difficulty:i.difficulty||"medium",points:1,timeLimit:a.defaultTimePerQuestion||1,createdAt:new Date,updatedAt:new Date}),n.openManualDialog()},m=s.manualQuestion&&s.manualQuestion.question.trim()&&(s.manualQuestion.type==="single-answer"||["picture","audio","video"].includes(s.manualQuestion.type)?s.manualQuestion.correctAnswerText&&s.manualQuestion.correctAnswerText.trim():(a==null?void 0:a.type)==="golden-pyramid"?s.manualQuestion.possibleAnswers.length>0&&s.manualQuestion.possibleAnswers.some(h=>h.trim()):s.manualQuestion.possibleAnswers.length>=2&&s.manualQuestion.possibleAnswers.every(h=>h.trim())&&s.manualQuestion.correctAnswers.length>0),w=()=>{n.openRoundModal("add")},C=()=>{n.openRoundModal("edit",a||void 0)},E=h=>{s.roundModalMode==="add"?(t({rounds:[...c,h]}),n.setCurrentRoundIdx(c.length)):s.roundModalMode==="edit"&&a&&t({rounds:c.map((j,p)=>p===s.currentRoundIdx?h:j)}),n.closeRoundModal()},o=()=>{if(s.roundModalMode==="edit"&&s.editingRound){if(s.editingRound.type==="golden-pyramid")return[{value:"golden-pyramid",label:"Golden Pyramid"}];if(s.editingRound.questions.length>0)return[{value:s.editingRound.type,label:ae[s.editingRound.type].label},{value:"mixed",label:"Mixed Types"}].filter((h,j,p)=>j===p.findIndex(Q=>Q.value===h.value))}return S.filter(h=>s.roundModalMode==="add"||h.value!=="golden-pyramid")},f=()=>{n.openDeleteRoundConfirm()},v=()=>{if(!a)return;const h=c.filter((j,p)=>p!==s.currentRoundIdx);t({rounds:h}),n.setCurrentRoundIdx(Math.max(0,s.currentRoundIdx-1)),n.closeDeleteRoundConfirm()},A=()=>n.closeDeleteRoundConfirm(),D=h=>{n.openDeleteQuestionConfirm(h)},I=()=>{var p;if(!a||!s.pendingDeleteQuestionId)return;const h=a.questions.filter(Q=>Q.id!==s.pendingDeleteQuestionId),j={...a,questions:h,updatedAt:new Date};t({rounds:c.map((Q,q)=>q===s.currentRoundIdx?j:Q)}),s.editingQuestionId===s.pendingDeleteQuestionId&&n.setEditingQuestionId(null),((p=s.manualQuestion)==null?void 0:p.id)===s.pendingDeleteQuestionId&&n.closeManualDialog(),n.closeDeleteQuestionConfirm()},R=()=>{n.closeDeleteQuestionConfirm()};return e.jsxs(z,{sx:{maxWidth:1e3,mx:"auto"},children:[e.jsx(fs,{rounds:c,currentRoundIdx:s.currentRoundIdx,currentRound:a,onPreviousRound:n.goToPrevRound,onNextRound:n.goToNextRound,onAddRound:w,onEditRound:C,onDeleteRound:f}),a&&!ae[a.type].canSelectQuestionType&&e.jsx(oe,{severity:"info",sx:{mb:2},children:e.jsxs(T,{variant:"body2",children:[e.jsxs("strong",{children:[ae[a.type].label,":"]})," ",ae[a.type].description,a.type==="golden-pyramid"&&e.jsxs("span",{children:[" ","- This round auto-generates 4 pre-configured questions with 1, 2, 3, and 4 correct answers respectively."]})]})}),e.jsx(xs,{showActions:!!a,roundType:a==null?void 0:a.type,onOpenAIDialog:n.openAIDialog,onOpenManualDialog:b}),e.jsx(gs,{currentRound:a,onEditQuestion:h=>{n.setManualQuestion(h),n.openManualDialog()},onDeleteQuestion:D,onAddRound:w,onAddQuestion:b}),x(),e.jsxs(B,{open:s.manualDialogOpen,onClose:n.closeManualDialog,maxWidth:"sm",fullWidth:!0,children:[e.jsx(Y,{children:s.manualQuestion&&(a!=null&&a.questions.some(h=>{var j;return h.id===((j=s.manualQuestion)==null?void 0:j.id)}))?`Edit ${a?(()=>{const h=ae[a.type].label;return h.includes("Question")?h:`${h} Question`})():"Question"}`:`Add ${a?(()=>{const h=ae[a.type].label;return h.includes("Question")?h:`${h} Question`})():"Question"}`}),e.jsx(G,{children:s.manualQuestion&&e.jsx(ys,{question:s.manualQuestion,roundType:a==null?void 0:a.type,onUpdate:h=>n.setManualQuestion(s.manualQuestion?{...s.manualQuestion,...h,updatedAt:new Date}:null)})}),e.jsxs(J,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:3,py:2},children:[s.manualQuestion&&(a==null?void 0:a.questions.some(h=>{var j;return h.id===((j=s.manualQuestion)==null?void 0:j.id)}))&&e.jsx(ie,{onClick:()=>{var h;(h=s.manualQuestion)!=null&&h.id&&D(s.manualQuestion.id)},color:"error",sx:{bgcolor:"error.50","&:hover":{bgcolor:"error.100"}},"aria-label":"Delete question",children:e.jsx(de,{})}),!(s.manualQuestion&&(a!=null&&a.questions.some(h=>{var j;return h.id===((j=s.manualQuestion)==null?void 0:j.id)})))&&e.jsx(z,{}),e.jsxs(z,{sx:{display:"flex",gap:1},children:[e.jsx(F,{onClick:n.closeManualDialog,children:"Cancel"}),e.jsx(F,{onClick:()=>{if(s.manualQuestion){if(a!=null&&a.questions.some(h=>{var j;return h.id===((j=s.manualQuestion)==null?void 0:j.id)})){const h=a.questions.map(p=>{var Q;return p.id===((Q=s.manualQuestion)==null?void 0:Q.id)?s.manualQuestion:p}),j={...a,questions:h,updatedAt:new Date};t({rounds:c.map((p,Q)=>Q===s.currentRoundIdx?j:p)})}else{const h={...a,questions:[...(a==null?void 0:a.questions)||[],s.manualQuestion],updatedAt:new Date};t({rounds:c.map((j,p)=>p===s.currentRoundIdx?h:j)})}n.closeManualDialog()}},variant:"contained",disabled:!m,children:"Save"})]})]})]}),e.jsxs(B,{open:s.roundModalOpen,onClose:n.closeRoundModal,maxWidth:"sm",fullWidth:!0,children:[e.jsx(Y,{children:s.roundModalMode==="add"?"Add Round":"Edit Round"}),e.jsx(G,{children:e.jsxs(z,{component:"form",sx:{display:"flex",flexDirection:"column",gap:3,mt:1},children:[e.jsxs(U,{fullWidth:!0,required:!0,children:[e.jsx(H,{children:"Round Type"}),e.jsx(K,{value:s.roundForm.type,label:"Round Type",onChange:h=>n.updateRoundForm("type",h.target.value),"aria-label":"Round type",children:o().map(h=>e.jsx(P,{value:h.value,children:h.label},h.value))})]}),e.jsxs(U,{fullWidth:!0,required:!0,children:[e.jsx(H,{children:"Answer Reveal Mode"}),e.jsx(K,{value:s.roundForm.answerRevealMode,label:"Answer Reveal Mode",onChange:h=>n.updateRoundForm("answerRevealMode",h.target.value),"aria-label":"Answer reveal mode",children:d.map(h=>e.jsx(P,{value:h.value,children:h.label},h.value))})]}),e.jsxs(z,{children:[e.jsx(T,{gutterBottom:!0,children:"Default Time Per Question (minutes)"}),e.jsx($,{type:"number",fullWidth:!0,label:"Minutes",inputProps:{min:.1,max:10,step:.1},value:s.roundForm.defaultTimePerQuestion,onChange:h=>{let j=Number(h.target.value);j<.1&&(j=.1),j>10&&(j=10),n.updateRoundForm("defaultTimePerQuestion",j)},helperText:"Time limit per question (0.5 = 30 seconds, 1 = 60 seconds)","aria-label":"Default time per question in minutes"})]}),e.jsxs(z,{children:[e.jsx(T,{gutterBottom:!0,children:"Breaking Time (minutes)"}),e.jsx($,{type:"number",fullWidth:!0,label:"Minutes",placeholder:"5",inputProps:{min:.1,max:10,step:.1},value:s.roundForm.breakingTime||"",onChange:h=>{let j=Number(h.target.value)||5;j<.1&&(j=.1),j>10&&(j=10),n.updateRoundForm("breakingTime",j)},helperText:"Break time between rounds (default 5 minutes)","aria-label":"Breaking time between rounds in minutes"})]}),e.jsx($,{label:"Round Description (Optional)",value:s.roundForm.description,onChange:h=>n.updateRoundForm("description",h.target.value),fullWidth:!0,multiline:!0,minRows:2,maxRows:4,inputProps:{maxLength:120},"aria-label":"Round description",helperText:"Optional description for this round"})]})}),e.jsxs(J,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:3,py:2},children:[s.roundModalMode==="edit"&&c.length>0&&e.jsx(ie,{onClick:f,color:"error",sx:{bgcolor:"error.50","&:hover":{bgcolor:"error.100"}},"aria-label":"Delete round",children:e.jsx(de,{})}),s.roundModalMode==="add"&&e.jsx(z,{}),e.jsxs(z,{sx:{display:"flex",gap:1},children:[e.jsx(F,{onClick:n.closeRoundModal,children:"Cancel"}),e.jsx(F,{onClick:u,variant:"contained",disabled:!y,children:"Save"})]})]})]}),r&&c.some(h=>h.questions.length===0)&&e.jsx(oe,{severity:"error",sx:{mt:2},children:"Each round must have at least one question to proceed."}),e.jsxs(B,{open:s.deleteRoundConfirmOpen,onClose:A,"aria-labelledby":"delete-round-dialog-title","aria-describedby":"delete-round-dialog-description",children:[e.jsx(Y,{id:"delete-round-dialog-title",children:"Confirm Delete Round"}),e.jsx(G,{children:e.jsx($e,{id:"delete-round-dialog-description",children:"Are you sure you want to delete this round? All questions in this round will be lost. This action cannot be undone."})}),e.jsxs(J,{children:[e.jsx(F,{onClick:A,color:"primary",autoFocus:!0,children:"Cancel"}),e.jsx(F,{onClick:v,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsxs(B,{open:s.deleteQuestionConfirmOpen,onClose:R,"aria-labelledby":"delete-question-dialog-title","aria-describedby":"delete-question-dialog-description",children:[e.jsx(Y,{id:"delete-question-dialog-title",children:"Confirm Delete Question"}),e.jsx(G,{children:e.jsx($e,{id:"delete-question-dialog-description",children:"Are you sure you want to delete this question? This action cannot be undone."})}),e.jsxs(J,{children:[e.jsx(F,{onClick:R,color:"primary",autoFocus:!0,children:"Cancel"}),e.jsx(F,{onClick:I,color:"error",variant:"contained",children:"Delete"})]})]})]})},Ps=({onQuizCreated:i,onCancel:t,editQuiz:r,onQuizDeleted:s})=>{var X,ee,te,pe,ge,xe,je;const{mode:n,handleThemeChange:l}=Ut(),[c,a]=g.useState(!0),[y,S]=g.useState(!1),[d,u]=g.useState(!1),[x,b]=g.useState(!1),[m,w]=g.useState(!1),[C,E]=g.useState(!0),{draftQuiz:o,updateDraft:f,resetWizard:v,completeWizard:A}=as(r),D=((X=o.rounds)==null?void 0:X.flatMap(O=>O.questions).length)||0,I=((ee=o.rounds)==null?void 0:ee.length)||0,R=!!((te=o.title)!=null&&te.trim()),h=g.useCallback(()=>{o.title||D>0?setTimeout(()=>{E(!1),t()},100):(E(!1),t())},[o.title,D,t]),j=g.useCallback(()=>{a(!0);const O=document.querySelector('[data-testid="wizard-content"]');O&&O.scrollTo({top:0,behavior:"smooth"})},[]),p=g.useCallback(()=>{R&&S(!0)},[R]),Q=g.useCallback(async()=>{b(!0);try{const O=await A();i(O),v(),S(!1),t()}catch(O){console.error("Error saving quiz:",O)}finally{b(!1)}},[A,i,v,t]),q=g.useCallback(()=>{S(!1)},[]),V=g.useCallback(()=>{r&&u(!0)},[r]),fe=g.useCallback(async()=>{if(r){w(!0);try{const{indexedDBService:O}=await ct(async()=>{const{indexedDBService:ze}=await Promise.resolve().then(()=>is);return{indexedDBService:ze}},void 0),ne=await O.deleteQuiz(r.id);if(ne.success)s&&s(r.id),t();else throw new Error(ne.error||"Failed to delete quiz")}catch(O){console.error("Error deleting quiz:",O)}finally{w(!1),u(!1)}}},[r,t,s]),W=g.useCallback(()=>{u(!1)},[]);return e.jsx(ls,{fallback:e.jsx(B,{open:!0,fullScreen:!0,children:e.jsx(G,{sx:{display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.default"},children:e.jsxs(T,{variant:"h6",color:"error",textAlign:"center",children:["Something went wrong in the quiz wizard.",e.jsx("br",{}),"Please refresh the page and try again."]})})}),children:e.jsxs(B,{open:C,onClose:h,fullScreen:!0,PaperProps:{sx:{bgcolor:"background.default",backgroundImage:"none",display:"flex",flexDirection:"column",height:"100vh"}},TransitionComponent:Ee,transitionDuration:300,children:[e.jsx(z,{sx:{zIndex:1400,position:"relative"},children:e.jsx(Ht,{mode:n,onThemeChange:l})}),e.jsx(G,{"data-testid":"wizard-content",sx:{flex:1,p:0,display:"flex",flexDirection:"column",overflow:"auto"},children:e.jsxs(z,{sx:{maxWidth:1200,mx:"auto",width:"100%",px:{xs:2,sm:3,md:4},py:{xs:2,sm:3}},children:[c&&e.jsxs(z,{sx:{mb:4},children:[e.jsx(T,{variant:"h4",gutterBottom:!0,fontWeight:600,children:"Quiz Details"}),e.jsx(hs,{draftQuiz:o,updateDraft:f,validation:{isValid:!0,errors:[],warnings:[],validatedAt:new Date},onDeleteQuiz:r?V:void 0,isEditMode:!!r,onContinue:()=>a(!1)})]}),!c&&e.jsx(z,{children:e.jsx(Rs,{draftQuiz:o,updateDraft:f,showValidation:!1})})]})}),!c&&e.jsx(e.Fragment,{children:e.jsxs(z,{sx:{position:"fixed",bottom:{xs:16,sm:24},right:{xs:16,sm:24},display:"flex",flexDirection:"row",gap:2,zIndex:1300},children:[e.jsx(z,{sx:{display:{xs:"block",sm:"none"}},children:e.jsx(ke,{color:"secondary",onClick:j,sx:{boxShadow:3,"&:hover":{boxShadow:6}},children:e.jsx(Se,{})})}),e.jsx(z,{sx:{display:{xs:"none",sm:"block"}},children:e.jsx(F,{variant:"contained",color:"secondary",onClick:j,startIcon:e.jsx(Se,{}),sx:{boxShadow:3,"&:hover":{boxShadow:6},minWidth:120,height:56},children:"Edit Quiz"})}),e.jsx(z,{sx:{display:{xs:"block",sm:"none"}},children:e.jsx(ke,{color:"primary",onClick:p,disabled:!R,sx:{boxShadow:3,"&:hover":{boxShadow:6},"&.Mui-disabled":{bgcolor:"action.disabled"}},children:e.jsx(Pe,{})})}),e.jsx(z,{sx:{display:{xs:"none",sm:"block"}},children:e.jsx(F,{variant:"contained",color:"primary",onClick:p,disabled:!R,startIcon:e.jsx(Pe,{}),sx:{boxShadow:3,"&:hover":{boxShadow:6},"&.Mui-disabled":{bgcolor:"action.disabled"},minWidth:120,height:56},children:"Save Quiz"})})]})}),e.jsxs(B,{open:y,onClose:q,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2,boxShadow:24}},children:[e.jsxs(Y,{sx:{display:"flex",alignItems:"center",gap:2,pb:2},children:[e.jsx(nt,{color:"success"}),e.jsx(T,{variant:"h6",fontWeight:600,children:"Save Quiz"})]}),e.jsxs(G,{sx:{pb:2},children:[e.jsx(le,{variant:"outlined",sx:{mb:3,bgcolor:"background.paper",border:"1px solid",borderColor:"divider"},children:e.jsxs(me,{children:[e.jsx(T,{variant:"h6",gutterBottom:!0,fontWeight:600,children:o.title}),o.description&&e.jsx(T,{variant:"body2",color:"text.secondary",paragraph:!0,sx:{mb:2},children:o.description}),e.jsxs(z,{sx:{display:"flex",gap:1,flexWrap:"wrap",mb:2},children:[e.jsx(Z,{icon:e.jsx(Qe,{}),label:o.category||"General",size:"small",variant:"outlined"}),e.jsx(Z,{icon:e.jsx(Ge,{}),label:`${I} Round${I!==1?"s":""}`,size:"small",variant:"filled",color:"secondary"}),e.jsx(Z,{icon:e.jsx(We,{}),label:`${D} Question${D!==1?"s":""}`,size:"small",variant:"filled",color:"primary"})]}),e.jsx(ot,{sx:{my:2}}),e.jsxs(T,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Difficulty:"})," ",o.difficulty||"Not set"]})]})}),e.jsx(T,{variant:"body2",color:"text.secondary",textAlign:"center",children:"Are you ready to save this quiz? You can always edit it later."})]}),e.jsxs(J,{sx:{px:3,pb:3,gap:1},children:[e.jsx(F,{onClick:q,variant:"outlined",disabled:x,children:"Cancel"}),e.jsx(F,{onClick:Q,variant:"contained",disabled:x,startIcon:x?null:e.jsx(Pe,{}),children:x?"Saving...":"Save Quiz"})]})]}),e.jsxs(B,{open:d,onClose:W,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2,boxShadow:24}},children:[e.jsxs(Y,{sx:{display:"flex",alignItems:"center",gap:2,pb:2},children:[e.jsx(de,{color:"error"}),e.jsx(T,{variant:"h6",fontWeight:600,children:"Delete Quiz"})]}),e.jsxs(G,{sx:{pb:2},children:[e.jsx(T,{variant:"body1",paragraph:!0,children:"Are you sure you want to delete this quiz?"}),e.jsx(le,{variant:"outlined",sx:{mb:3,bgcolor:"background.paper",border:"1px solid",borderColor:"divider"},children:e.jsxs(me,{children:[e.jsx(T,{variant:"h6",gutterBottom:!0,fontWeight:600,children:r==null?void 0:r.title}),(r==null?void 0:r.description)&&e.jsx(T,{variant:"body2",color:"text.secondary",paragraph:!0,sx:{mb:2},children:r.description}),e.jsxs(z,{sx:{display:"flex",gap:1,flexWrap:"wrap",mb:2},children:[e.jsx(Z,{icon:e.jsx(Qe,{}),label:(r==null?void 0:r.category)||"General",size:"small",variant:"outlined"}),e.jsx(Z,{icon:e.jsx(Ge,{}),label:`${((pe=r==null?void 0:r.rounds)==null?void 0:pe.length)||0} Round${(((ge=r==null?void 0:r.rounds)==null?void 0:ge.length)||0)!==1?"s":""}`,size:"small",variant:"filled",color:"secondary"}),e.jsx(Z,{icon:e.jsx(We,{}),label:`${((xe=r==null?void 0:r.rounds)==null?void 0:xe.flatMap(O=>O.questions).length)||0} Question${(((je=r==null?void 0:r.rounds)==null?void 0:je.flatMap(O=>O.questions).length)||0)!==1?"s":""}`,size:"small",variant:"filled",color:"primary"})]})]})}),e.jsx(T,{variant:"body2",color:"error",textAlign:"center",fontWeight:500,children:"This action cannot be undone. The quiz will be permanently deleted."})]}),e.jsxs(J,{sx:{px:3,pb:3,gap:1},children:[e.jsx(F,{onClick:W,variant:"outlined",disabled:m,children:"Cancel"}),e.jsx(F,{onClick:fe,variant:"contained",color:"error",disabled:m,startIcon:m?null:e.jsx(de,{}),children:m?"Deleting...":"Delete Quiz"})]})]})]})})},Os=({selectedQuiz:i,menuAnchorEl:t,editingQuiz:r,isWizardOpen:s,deleteConfirmOpen:n,pendingDeleteQuiz:l,onMenuClose:c,onEditQuiz:a,onExportQuiz:y,onRequestDeleteQuiz:S,onConfirmDeleteQuiz:d,onCancelDeleteQuiz:u,onCreateQuiz:x,onWizardCancel:b,onQuizCreated:m})=>{const w=k.useCallback(()=>{i&&(a(i),c())},[i,a,c]),C=k.useCallback(()=>{i&&(y(i,"powerpoint"),c())},[i,y,c]),E=k.useCallback(()=>{i&&(y(i,"slides"),c())},[i,y,c]),o=k.useCallback(()=>{i&&(y(i,"json"),c())},[i,y,c]),f=k.useCallback(()=>{i&&(S(i),c())},[i,S,c]);return e.jsxs(e.Fragment,{children:[e.jsxs(qt,{anchorEl:t,open:!!t,onClose:c,transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[e.jsxs(P,{onClick:w,children:[e.jsx(ue,{children:e.jsx(Se,{fontSize:"small"})}),e.jsx(he,{children:"Edit Quiz"})]}),e.jsxs(P,{onClick:C,children:[e.jsx(ue,{children:e.jsx(tt,{fontSize:"small"})}),e.jsx(he,{children:"Export to PowerPoint"})]}),e.jsxs(P,{onClick:E,disabled:!0,children:[e.jsx(ue,{children:e.jsx(st,{fontSize:"small"})}),e.jsx(he,{children:"Export to Google Slides"})]}),e.jsxs(P,{onClick:o,disabled:!0,children:[e.jsx(ue,{children:e.jsx(rt,{fontSize:"small"})}),e.jsx(he,{children:"Export as JSON"})]}),e.jsxs(P,{onClick:f,sx:{color:"error.main"},children:[e.jsx(ue,{children:e.jsx(de,{fontSize:"small",color:"error"})}),e.jsx(he,{children:"Delete Quiz"})]})]}),e.jsx(ke,{color:"primary","aria-label":"Create new quiz",onClick:x,sx:{position:"fixed",bottom:80,right:24,zIndex:1e3},children:e.jsx(ce,{})}),s&&e.jsx(Ps,{onQuizCreated:m,onCancel:b,editQuiz:r||void 0,onQuizDeleted:()=>{window.location.reload()}}),e.jsxs(B,{open:n,onClose:u,"aria-labelledby":"delete-quiz-dialog-title","aria-describedby":"delete-quiz-dialog-description",children:[e.jsx(Y,{id:"delete-quiz-dialog-title",children:"Confirm Delete"}),e.jsx(G,{children:e.jsx($e,{id:"delete-quiz-dialog-description",children:"Are you sure you want to delete this quiz? This action cannot be undone."})}),e.jsxs(J,{children:[e.jsx(F,{onClick:u,color:"primary",autoFocus:!0,children:"Cancel"}),e.jsx(F,{onClick:d,color:"error",variant:"contained",children:"Delete"})]})]})]})},Ls=({open:i,onClose:t,storageUsage:r,quizzes:s,draftsCount:n,onCleanupStorage:l,onRefreshStorage:c})=>{const a=Wt(),y=Nt(a.breakpoints.down("sm")),[S,d]=g.useState(!1),u=o=>{if(o===0)return"0 B";const f=1024,v=["B","KB","MB","GB"],A=Math.floor(Math.log(o)/Math.log(f));return`${parseFloat((o/Math.pow(f,A)).toFixed(1))} ${v[A]}`},x=g.useMemo(()=>s.map(o=>{var R,h,j;const v=(((R=o.rounds)==null?void 0:R.length)||0)*512,A=(((h=o.title)==null?void 0:h.length)||0)*2,D=(((j=o.description)==null?void 0:j.length)||0)*2,I=1024+v+A+D;return{...o,estimatedSize:I}}),[s]),b=()=>{d(!0)},m=()=>{l(),d(!1),t()},w=()=>{d(!1)},C=(r==null?void 0:r.percentageUsed)||0,E=(r==null?void 0:r.isNearLimit)||!1;return e.jsxs(e.Fragment,{children:[e.jsxs(B,{open:i,onClose:t,maxWidth:"md",fullWidth:!0,fullScreen:y,TransitionComponent:it,transitionDuration:300,PaperProps:{sx:{borderRadius:y?0:3,maxHeight:y?"100%":"90vh"}},children:[e.jsxs(Y,{sx:{background:`linear-gradient(135deg, ${a.palette.primary.main}, ${a.palette.primary.dark})`,color:"white",textAlign:"center",position:"relative",py:3},children:[e.jsxs(z,{display:"flex",alignItems:"center",justifyContent:"center",gap:2,children:[e.jsx(lt,{sx:{fontSize:28}}),e.jsx(T,{variant:"h5",component:"div",fontWeight:"bold",children:"Storage"})]}),e.jsx(ie,{onClick:t,sx:{position:"absolute",right:8,top:8,color:"white",bgcolor:"rgba(255,255,255,0.1)","&:hover":{bgcolor:"rgba(255,255,255,0.2)"}},children:e.jsx(Me,{})})]}),e.jsxs(G,{sx:{p:0},children:[e.jsxs(z,{sx:{p:3,bgcolor:"background.default"},children:[e.jsxs(z,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx($t,{color:"primary"}),e.jsx(T,{variant:"h6",fontWeight:"600",children:"Current Usage"})]}),r&&e.jsx(Ee,{in:!0,timeout:500,children:e.jsxs(z,{children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[e.jsxs(T,{variant:"body2",color:"text.secondary",children:[u(r.totalSize)," / 500 MB"]}),e.jsxs(T,{variant:"body2",fontWeight:"600",color:E?"warning.main":"text.primary",children:[C.toFixed(1),"% used"]})]}),e.jsx(_t,{variant:"determinate",value:Math.min(C,100),color:E?"warning":"primary",sx:{height:12,borderRadius:6,bgcolor:"rgba(0,0,0,0.1)","& .MuiLinearProgress-bar":{borderRadius:6,background:E?`linear-gradient(90deg, ${a.palette.warning.main}, ${a.palette.warning.dark})`:`linear-gradient(90deg, ${a.palette.primary.main}, ${a.palette.primary.dark})`}}}),E&&e.jsx(oe,{severity:"warning",icon:e.jsx(Ne,{}),sx:{mt:2,borderRadius:2},children:"Storage is nearly full. Consider cleaning up old quizzes."})]})})]}),e.jsx(ot,{}),e.jsxs(z,{sx:{p:3},children:[e.jsxs(z,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(qe,{color:"primary"}),e.jsx(T,{variant:"h6",fontWeight:"600",children:"Quiz Storage"}),e.jsx(Z,{label:`${x.length} items`,size:"small",color:"primary",variant:"outlined"})]}),x.length===0?e.jsx(z,{textAlign:"center",py:4,children:e.jsx(T,{variant:"body2",color:"text.secondary",children:"No quizzes found"})}):e.jsx(et,{sx:{maxHeight:300,overflow:"auto"},children:x.map((o,f)=>{var v;return e.jsx(Ee,{in:!0,timeout:300+f*100,children:e.jsxs(Bt,{sx:{borderRadius:2,mb:1,bgcolor:"background.paper",border:1,borderColor:"divider","&:hover":{bgcolor:"action.hover"}},children:[e.jsx(ue,{children:o.isDraft?e.jsx(Se,{color:"secondary"}):e.jsx(qe,{color:"primary"})}),e.jsx(he,{primary:e.jsxs(z,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(T,{variant:"body1",noWrap:!0,children:o.title}),o.isDraft&&e.jsx(Z,{label:"Draft",size:"small",color:"secondary",variant:"outlined"})]}),secondary:e.jsxs(T,{variant:"caption",color:"text.secondary",children:[((v=o.rounds)==null?void 0:v.length)||0," rounds • Created"," ",new Date(o.createdAt).toLocaleDateString()]})}),e.jsx(T,{variant:"body2",fontWeight:"600",color:"primary.main",children:u(o.estimatedSize)})]})},o.id)})})]})]}),e.jsxs(J,{sx:{p:3,bgcolor:"background.default",borderTop:1,borderColor:"divider",gap:2},children:[e.jsx(F,{onClick:b,startIcon:e.jsx(Gt,{}),color:"error",variant:"outlined",disabled:x.length===0,sx:{borderRadius:2,textTransform:"none",fontWeight:600},children:"Clear All Storage"}),e.jsx(z,{sx:{flex:1}}),e.jsx(F,{onClick:t,variant:"contained",sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:4},children:"OK"})]})]}),e.jsxs(B,{open:S,onClose:w,maxWidth:"sm",fullWidth:!0,TransitionComponent:Ee,children:[e.jsxs(Y,{sx:{textAlign:"center",pt:3},children:[e.jsx(Ne,{sx:{fontSize:48,color:"warning.main",mb:2}}),e.jsx(T,{variant:"h6",fontWeight:"600",children:"Clear All Storage"})]}),e.jsxs(G,{sx:{textAlign:"center",pb:2},children:[e.jsxs(T,{variant:"body1",color:"text.secondary",children:["Are you sure you want to clear all quiz storage? This will permanently delete ",e.jsx("strong",{children:"ALL quizzes and drafts"})," from your device."]}),e.jsx(T,{variant:"body2",color:"error.main",sx:{mt:2,fontWeight:600},children:"This action cannot be undone."})]}),e.jsxs(J,{sx:{p:3,gap:2},children:[e.jsx(F,{onClick:w,variant:"outlined",sx:{borderRadius:2,textTransform:"none",fontWeight:600},autoFocus:!0,children:"Cancel"}),e.jsx(F,{onClick:m,color:"error",variant:"contained",sx:{borderRadius:2,textTransform:"none",fontWeight:600},children:"Clear All Storage"})]})]})]})},Xe={includePresenterNotes:!0,slideTemplate:"standard",questionFontSize:24,optionFontSize:18,includeMetadata:!0,includeAnswerKey:!0,compressImages:!0,imageQuality:85},qs=i=>i?!i.rounds||!Array.isArray(i.rounds)?"Quiz rounds are missing or invalid":i.rounds.length===0?"Quiz has no rounds":i.rounds.every(t=>t&&Array.isArray(t.questions))?null:"One or more quiz rounds have invalid questions":"Quiz data is missing",Ws=()=>{const[i,t]=g.useState(!1),[r,s]=g.useState(null),n=g.useCallback(async(a,y=Xe)=>{t(!0),s(null);try{const S=qs(a);if(S)throw new Error(S);const d=(await ct(async()=>{const{default:b}=await import("./pptxgen.es-D1LdXykA.js");return{default:b}},__vite__mapDeps([0,1,2,3,4]))).default,u=new d;if(u.defineLayout({name:"QUIZZARD",width:10,height:7.5}),u.layout="QUIZZARD",y.includeMetadata){const b=u.addSlide();b.addText(a.title,{x:1,y:2,w:8,h:1.5,fontSize:36,bold:!0,align:"center"}),b.addText([{text:`Category: ${a.category}`,options:{breakLine:!0}},{text:`Difficulty: ${a.difficulty}`,options:{breakLine:!0}},{text:`Questions: ${a.rounds.flatMap(m=>m.questions).length}`,options:{breakLine:!0}}],{x:1,y:4,w:8,h:2,fontSize:18,align:"center"}),y.includePresenterNotes&&b.addNotes(`Quiz: ${a.title}
Total Questions: ${a.rounds.flatMap(m=>m.questions).length}
Estimated Duration: ${a.estimatedDuration} minutes`)}if(a.rounds.forEach((b,m)=>{const w=u.addSlide();w.addText(`Round ${m+1}${b.name?`: ${b.name}`:""}`,{x:1,y:2,w:8,h:1.5,fontSize:32,bold:!0,align:"center"}),b.description&&w.addText(b.description,{x:1,y:4,w:8,h:2,fontSize:18,align:"center"}),b.questions.forEach((C,E)=>{const o=u.addSlide(),f=`Round ${m+1}, Question ${E+1}`;if(o.addText(f,{x:.5,y:.5,w:9,h:.8,fontSize:28,bold:!0,color:"1976D2"}),o.addText(C.question,{x:.5,y:1.5,w:9,h:1.5,fontSize:y.questionFontSize,bold:!0}),C.type==="single-answer")o.addText("Answer:",{x:1,y:3.5,w:8,h:.7,fontSize:y.optionFontSize,italic:!0,color:"666666"}),y.includePresenterNotes&&C.correctAnswerText&&o.addNotes(`${f}
Correct Answer: ${C.correctAnswerText}${C.explanation?`
Explanation: ${C.explanation}`:""}`);else if(C.type==="multiple-choice"&&C.possibleAnswers&&(C.possibleAnswers.forEach((v,A)=>{const D=String.fromCharCode(65+A),I=C.correctAnswers.includes(A);o.addText(`${D}. ${v}`,{x:1,y:3.5+A*.8,w:8,h:.7,fontSize:y.optionFontSize,bold:I,color:I?"4CAF50":"000000"})}),y.includePresenterNotes)){const v=C.correctAnswers.map(D=>`${String.fromCharCode(65+D)}. ${C.possibleAnswers[D]}`).join(", ");let A=`${f}
Correct Answer(s): ${v}`;C.explanation&&(A+=`
Explanation: ${C.explanation}`),o.addNotes(A)}if(C.mediaFile)try{C.mediaFile.type==="image"&&o.addImage({data:C.mediaFile.data,x:6,y:3,w:3,h:2.5,sizing:{type:"contain",w:3,h:2.5}})}catch(v){console.warn(`Failed to add media for ${f}:`,v)}})}),y.includeAnswerKey){const b=u.addSlide();b.addText("Answer Key",{x:1,y:1,w:8,h:1,fontSize:32,bold:!0,align:"center"});let m="";a.rounds.forEach((w,C)=>{m+=`Round ${C+1}:
`,w.questions.forEach((E,o)=>{const f=`Q${o+1}`;if(E.type==="single-answer")m+=`${f}: ${E.correctAnswerText}
`;else if(E.type==="multiple-choice"){const v=E.correctAnswers.map(A=>String.fromCharCode(65+A)).join(", ");m+=`${f}: ${v}
`}}),m+=`
`}),b.addText(m.trim(),{x:1,y:2,w:8,h:4,fontSize:16,align:"left"})}const x=`${a.title.replace(/[^a-z0-9]/gi,"_")}_Quiz.pptx`;await u.writeFile({fileName:x})}catch(S){const d=S instanceof Error?S.message:"Failed to export quiz to PowerPoint";throw s(d),new Error(d)}finally{t(!1)}},[]),l=g.useCallback(async a=>{t(!0),s(null);try{const y=JSON.stringify(a,null,2),S=new Blob([y],{type:"application/json"}),d=URL.createObjectURL(S),u=document.createElement("a");u.href=d,u.download=`${a.title.replace(/[^a-z0-9]/gi,"_")}_Quiz.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(d)}catch(y){const S=y instanceof Error?y.message:"Failed to export quiz to JSON";throw s(S),new Error(S)}finally{t(!1)}},[]),c=g.useCallback(()=>{s(null)},[]);return{isExporting:i,exportError:r,exportToPowerPoint:n,exportToJSON:l,clearExportError:c,DEFAULT_EXPORT_SETTINGS:Xe}},Ns=()=>{const{quizzes:i,drafts:t,isLoading:r,storageUsage:s,autoSaveStatus:n,isInitialized:l,saveQuiz:c,deleteQuiz:a,enableAutoSave:y,disableAutoSave:S,refreshStorageUsage:d,loadQuizzes:u,loadDrafts:x}=ut(),{exportToPowerPoint:b}=Ws(),{showSnackbar:m}=dt(),[w,C]=k.useState(!1),[E,o]=k.useState(!1),[f,v]=k.useState(null),[A,D]=k.useState(null),[I,R]=k.useState(null),[h,j]=k.useState(!1),[p,Q]=k.useState(null),[q,V]=k.useState(!1),[fe,W]=k.useState(null),X=fe;k.useEffect(()=>{X&&C(!1)},[X]),k.useEffect(()=>{s!=null&&s.isNearLimit&&V(!1)},[s==null?void 0:s.isNearLimit]);const ee=k.useCallback(()=>{C(!0),W(null)},[]),te=k.useCallback(()=>{V(!0)},[]),pe=k.useCallback(()=>{v(null),o(!0)},[]),ge=k.useCallback(L=>{v(L),o(!0),D(null)},[]),xe=k.useCallback(async L=>{try{const N={...L,status:"completed",updatedAt:new Date};if(await c(N))m(f?"Quiz updated successfully!":"Quiz created successfully!","success"),o(!1),v(null),S(),await d();else throw new Error("Failed to save quiz to storage")}catch(N){const ye=N instanceof Error?N.message:"Failed to save quiz";W(ye),m(ye,"error")}},[f,c,m,S,d]),je=k.useCallback(()=>{o(!1),v(null),S()},[S]),O=k.useCallback(async L=>{try{await b(L,{includePresenterNotes:!0,slideTemplate:"standard",questionFontSize:20,answerFontSize:16,includeAnswerSlides:!0,includeQuizSummary:!0}),m("PowerPoint exported successfully!","success"),D(null)}catch(N){const ye=N instanceof Error?N.message:"Export failed";W(ye),m(ye,"error")}},[b,m]),ne=k.useCallback((L,N)=>{D(L.currentTarget),R(N)},[]),ze=k.useCallback(()=>{D(null),R(null)},[]),gt=k.useCallback(L=>{Q(L),j(!0),D(null)},[]),xt=k.useCallback(async()=>{if(p)try{await a(p.id)&&(await Promise.all([u(),x(),d()]),m("Quiz deleted successfully!","success"))}catch(L){console.error("Error deleting quiz:",L),W("Failed to delete quiz")}finally{j(!1),Q(null)}},[p,a,u,x,d,m]),yt=k.useCallback(()=>{j(!1),Q(null)},[]),bt=k.useCallback(async()=>{try{const L=await _.clearAllStorage();if(L.success)m("All storage cleared successfully!","success"),await d(),await u(),await x();else throw new Error(L.error||"Failed to clear storage")}catch(L){const N=L instanceof Error?L.message:"Failed to clear storage";W(N),m(N,"error")}},[m,d,u,x]),wt=k.useCallback(async()=>{try{await d(),m("Storage information refreshed","info")}catch(L){const N=L instanceof Error?L.message:"Failed to refresh storage";W(N),m(N,"error")}},[d,m]);return k.useEffect(()=>{if(E&&f){const L={...f,status:"draft",lastSaved:new Date};y(L)}return()=>{E||S()}},[E,f,y,S]),{quizzes:i,drafts:t,isLoading:r,error:X,storageUsage:s,isInitialized:l,state:{errorDismissed:w,isWizardOpen:E,editingQuiz:f,menuAnchorEl:A,selectedQuiz:I,deleteConfirmOpen:h,pendingDeleteQuiz:p,autoSaveStatus:n,storageWarningDismissed:q},actions:{dismissError:ee,dismissStorageWarning:te,handleCreateQuiz:pe,handleEditQuiz:ge,handleQuizCreated:xe,handleWizardCancel:je,handleExportQuiz:O,handleMenuOpen:ne,handleMenuClose:ze,handleRequestDeleteQuiz:gt,handleConfirmDeleteQuiz:xt,handleCancelDeleteQuiz:yt,handleCleanupDrafts:bt,handleRefreshStorage:wt}}},Us=()=>{const{quizzes:i,drafts:t,isLoading:r,error:s,state:n,actions:l,storageUsage:c}=Ns(),[a,y]=k.useState(!1),[S,d]=k.useState(0),u=k.useCallback(()=>{d(o=>o+1)},[]);k.useEffect(()=>{u()},[i.length,t.length,u]);const x=k.useCallback(o=>[...i,...t].find(v=>v&&String(v.id)===String(o)),[i,t]),b=k.useCallback(o=>{const f=x(o.id);f?l.handleExportQuiz(f):console.error(`Could not find full quiz object with id: ${o.id} for export.`)},[l,x]),m=k.useCallback(o=>{const f=x(o.id);f?l.handleEditQuiz(f):console.error(`Could not find full quiz object with id: ${o.id} for edit.`)},[l,x]),w=k.useCallback((o,f)=>{const v=x(f.id);v?l.handleMenuOpen(o,v):console.error(`Could not find full quiz object with id: ${f.id} for menu.`)},[l,x]),C=k.useMemo(()=>{const o=["general","sports","history","science","geography","entertainment","literature","art","music","technology","custom"],f=p=>typeof p=="string"&&o.includes(p)?p:"general",v=p=>typeof p=="string"&&["easy","medium","hard"].includes(p)?p:"medium",A=p=>{if(typeof p=="number"&&!isNaN(p))return Math.max(1,Math.min(1e3,p));if(p&&typeof p=="object"&&"valueOf"in p&&typeof p.valueOf=="function"){const Q=p.valueOf();if(typeof Q=="number"&&!isNaN(Q))return Math.max(1,Math.min(1e3,Q))}return 10},D=p=>{if(p instanceof Date)return p;if(typeof p=="string"||typeof p=="number"){const Q=new Date(p);if(!isNaN(Q.getTime()))return Q}return new Date},I=p=>{const Q={defaultTimeLimit:1,defaultPoints:1,defaultBreakingTime:5};if(p&&typeof p=="object"){const q=p;return{defaultTimeLimit:typeof q.defaultTimeLimit=="number"?q.defaultTimeLimit:Q.defaultTimeLimit,defaultPoints:typeof q.defaultPoints=="number"?q.defaultPoints:Q.defaultPoints,defaultBreakingTime:typeof q.defaultBreakingTime=="number"?q.defaultBreakingTime:Q.defaultBreakingTime}}return Q},R=p=>Array.isArray(p)?p.filter(Q=>Q&&typeof Q=="object"):[],h=p=>Array.isArray(p)?p.filter(Q=>typeof Q=="string").slice(0,10):[],j=t.filter(p=>p&&p.id&&p.title).map(p=>({...p,id:String(p.id||""),title:String(p.title||"Untitled Draft"),description:String(p.description||"Draft quiz in progress..."),rounds:R(p.rounds),category:f(p.category),difficulty:v(p.difficulty),tags:h(p.tags),status:"draft",createdAt:D(p.createdAt),updatedAt:D(p.updatedAt),isDraft:!0,estimatedDuration:A(p.estimatedDuration),settings:I(p.settings)}));return[...i,...j].map(p=>({...p,id:String(p.id||""),title:String(p.title||"Untitled Quiz"),description:String(p.description||""),rounds:R(p.rounds),estimatedDuration:A(p.estimatedDuration),createdAt:D(p.createdAt),updatedAt:D(p.updatedAt),category:f(p.category),difficulty:v(p.difficulty),tags:h(p.tags),settings:I(p.settings)})).sort((p,Q)=>new Date(Q.updatedAt).getTime()-new Date(p.updatedAt).getTime())},[i,t,S]),E=C.length;return e.jsx(Ve,{fallback:e.jsx(oe,{severity:"error",children:"Something went wrong in the quiz list. Please refresh the page."}),children:e.jsxs(Vt,{maxWidth:"xl",sx:{py:3},children:[e.jsx(z,{mb:4,children:e.jsxs(T,{variant:"h4",component:"h1",gutterBottom:!0,children:["My Quizzes (",E,")"]})}),s&&!n.errorDismissed&&e.jsx(oe,{severity:"error",sx:{mb:3},action:e.jsx(ie,{size:"small",onClick:l.dismissError,"aria-label":"Dismiss error",children:e.jsx(Me,{fontSize:"small"})}),children:s}),(c==null?void 0:c.isNearLimit)&&!n.storageWarningDismissed&&e.jsxs(oe,{severity:"warning",sx:{mb:3},action:e.jsx(ie,{size:"small",onClick:l.dismissStorageWarning,"aria-label":"Dismiss storage warning",children:e.jsx(Me,{fontSize:"small"})}),children:["Storage is nearly full (",(()=>{const o=c==null?void 0:c.usagePercentage;return typeof o=="number"&&!isNaN(o)?Math.round(Math.max(0,Math.min(100,o))):0})(),"% used). Consider cleaning up old drafts or exporting quizzes to free up space."]}),E>0&&e.jsxs(z,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(F,{variant:"contained",startIcon:e.jsx(ce,{}),onClick:l.handleCreateQuiz,sx:{borderRadius:2,textTransform:"none",fontWeight:600},children:[e.jsx(z,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:"Create New Quiz"}),e.jsx(z,{component:"span",sx:{display:{xs:"inline",sm:"none"}},children:"Create"})]}),e.jsx(F,{variant:"outlined",startIcon:e.jsx(lt,{}),onClick:()=>y(!0),sx:{borderRadius:2,textTransform:"none",fontWeight:600},children:"Storage"})]}),e.jsx(Ve,{children:e.jsx(es,{quizzes:C,isLoading:r,onCreateQuiz:l.handleCreateQuiz,onMenuOpen:w,onExport:b,onEdit:m})}),e.jsx(Os,{selectedQuiz:n.selectedQuiz,menuAnchorEl:n.menuAnchorEl,editingQuiz:n.editingQuiz,isWizardOpen:n.isWizardOpen,deleteConfirmOpen:n.deleteConfirmOpen,pendingDeleteQuiz:n.pendingDeleteQuiz,onMenuClose:l.handleMenuClose,onEditQuiz:l.handleEditQuiz,onExportQuiz:l.handleExportQuiz,onRequestDeleteQuiz:l.handleRequestDeleteQuiz,onConfirmDeleteQuiz:l.handleConfirmDeleteQuiz,onCancelDeleteQuiz:l.handleCancelDeleteQuiz,onCreateQuiz:l.handleCreateQuiz,onWizardCancel:l.handleWizardCancel,onQuizCreated:l.handleQuizCreated}),e.jsx(Ls,{open:a,onClose:()=>y(!1),storageUsage:c,quizzes:C,draftsCount:t.length,onCleanupStorage:l.handleCleanupDrafts,onRefreshStorage:l.handleRefreshStorage})]})})};export{Us as Quizzes,Us as default};
//# sourceMappingURL=Quizzes-XE2g3_Am.js.map
