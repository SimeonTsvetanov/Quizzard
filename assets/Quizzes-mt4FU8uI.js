const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pptxgen.es-BuAvOu_s.js","assets/index-B26QbDBX.js","assets/mui-YUMVbANw.js","assets/vendor-Csw2ODfV.js","assets/index-IoRVJUsv.css"])))=>i.map(i=>d[i]);
var gt=Object.defineProperty;var xt=(i,t,r)=>t in i?gt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[t]=r;var ve=(i,t,r)=>xt(i,typeof t!="symbol"?t+"":t,r);import{W as E,j as e,aq as J,ar as Ze,X as ne,ae as me,B as S,am as yt,a0 as De,I as te,as as bt,v as Q,ao as Y,ap as Je,at as _e,au as wt,av as vt,s as M,a9 as St,aw as Xe,ax as Z,ay as jt,a5 as ie,r as p,a3 as N,az as _,aA as $,aB as B,aC as F,aD as Fe,aE as zt,aF as Ct,aG as xe,ac as At,aH as ye,ad as Dt,aI as et,aJ as tt,aK as Pe,aL as be,aM as st,S as Oe,aN as Tt,aO as Qt,o as G,p as X,q as V,O as re,V as kt,Q as Te,aP as It,aQ as Et,t as ee,aR as Ne,F as je,aS as Re,aT as Mt,a as rt,aU as Ft,e as ze,f as Ce,u as Rt,af as Lt,aV as it,aW as qt,aX as Pt,L as Ot,b as Nt,aY as Wt,a2 as _t}from"./mui-YUMVbANw.js";import{u as nt}from"./useSnackbar-Djh2LGw4.js";import{a as $t,H as Bt,_ as Gt,E as Vt}from"./index-B26QbDBX.js";import"./vendor-Csw2ODfV.js";const Ut=i=>{switch(i){case"easy":return"success";case"hard":return"error";default:return"warning"}},Ht=({quiz:i,onMenuOpen:t,onExport:r,onPreview:s})=>{const a=E.useCallback(()=>{s?s(i):console.log("Preview quiz:",i.id)},[i,s]),o=E.useCallback(()=>{r(i)},[i,r]),l=E.useCallback(n=>{t(n,i)},[i,t]);return e.jsx(J,{size:{xs:12,sm:6,md:4},children:e.jsx(Ze,{in:!0,timeout:300,children:e.jsxs(ne,{elevation:2,sx:{height:"100%",display:"flex",flexDirection:"column",transition:"all 0.3s ease","&:hover":{elevation:4,transform:"translateY(-2px)"}},children:[e.jsxs(me,{sx:{flex:1},children:[e.jsxs(S,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsx(yt,{sx:{bgcolor:"primary.main",width:48,height:48},children:e.jsx(De,{})}),e.jsx(te,{size:"small",onClick:l,"aria-label":"Quiz options",children:e.jsx(bt,{})})]}),e.jsx(Q,{variant:"h6",component:"h3",gutterBottom:!0,noWrap:!0,children:(()=>{const n=i.title;return typeof n=="string"?n:"Untitled Quiz"})()}),e.jsx(Q,{variant:"body2",color:"text.secondary",sx:{mb:2,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:(()=>{const n=i.description;return typeof n=="string"&&n||"No description provided"})()}),e.jsxs(S,{display:"flex",flexWrap:"wrap",gap:1,mb:2,children:[e.jsx(Y,{size:"small",label:(()=>{const n=i.difficulty;return typeof n=="string"&&["easy","medium","hard"].includes(n)?n:"medium"})(),color:Ut((()=>{const n=i.difficulty;return typeof n=="string"&&["easy","medium","hard"].includes(n)?n:"medium"})()),variant:"outlined",icon:e.jsx(Je,{fontSize:"small"})}),e.jsx(Y,{size:"small",label:(()=>{const n=i.category;return typeof n=="string"?n:"general"})(),variant:"outlined",icon:e.jsx(_e,{fontSize:"small"})}),e.jsx(Y,{size:"small",label:`${(()=>{const n=i.rounds;return Array.isArray(n)&&n.flatMap(x=>(x==null?void 0:x.questions)||[]).length||0})()} Q`,variant:"outlined",icon:e.jsx(De,{fontSize:"small"})})]}),e.jsx(S,{display:"flex",justifyContent:"space-between",alignItems:"center",children:e.jsxs(S,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(wt,{fontSize:"small",color:"action"}),e.jsxs(Q,{variant:"caption",color:"text.secondary",children:["~",(()=>{const n=i.estimatedDuration;if(typeof n=="number"&&!isNaN(n))return Math.max(1,Math.min(1e3,n));if(n&&typeof n.valueOf=="function"){const x=n.valueOf();if(typeof x=="number"&&!isNaN(x))return Math.max(1,Math.min(1e3,x))}return 10})(),"m"]})]})})]}),e.jsxs(vt,{sx:{justifyContent:"space-between",px:2,pb:2},children:[e.jsx(M,{size:"small",startIcon:e.jsx(St,{}),onClick:a,children:"Preview"}),e.jsx(M,{size:"small",startIcon:e.jsx(Xe,{}),onClick:o,children:"Export"})]})]})})},i.id)},Yt=()=>e.jsx(e.Fragment,{children:[1,2,3].map(i=>e.jsx(J,{size:{xs:12,sm:6,md:4},children:e.jsx(ne,{elevation:1,children:e.jsxs(me,{children:[e.jsxs(S,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsx(Z,{variant:"circular",width:48,height:48}),e.jsx(Z,{variant:"circular",width:24,height:24})]}),e.jsx(Z,{variant:"text",sx:{fontSize:"1.2rem",mb:1}}),e.jsx(Z,{variant:"text",height:40,sx:{mb:2}}),e.jsxs(S,{display:"flex",gap:1,mb:2,children:[e.jsx(Z,{variant:"rounded",width:60,height:24}),e.jsx(Z,{variant:"rounded",width:80,height:24}),e.jsx(Z,{variant:"rounded",width:40,height:24})]}),e.jsxs(S,{display:"flex",justifyContent:"space-between",children:[e.jsx(Z,{variant:"text",width:100}),e.jsx(Z,{variant:"text",width:60})]})]})})},i))}),Kt=({onCreateQuiz:i})=>e.jsx(J,{size:{xs:12},children:e.jsx(ne,{elevation:0,sx:{textAlign:"center",py:8,bgcolor:"background.default",border:"2px dashed",borderColor:"divider"},children:e.jsxs(me,{children:[e.jsx(jt,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(Q,{variant:"h5",gutterBottom:!0,children:"Create Your First Quiz"}),e.jsx(Q,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Get started by creating an interactive quiz with questions, answers, and media. Export to PowerPoint when you're ready to present!"}),e.jsx(M,{variant:"contained",size:"large",startIcon:e.jsx(ie,{}),onClick:i,sx:{mt:2},children:"Create Quiz"})]})})}),Zt=({quizzes:i,isLoading:t,onCreateQuiz:r,onMenuOpen:s,onExport:a,onPreview:o})=>{const l=E.useCallback(()=>i.map(n=>e.jsx(Ht,{quiz:n,onMenuOpen:s,onExport:a,onPreview:o},n.id)),[i,s,a,o]);return e.jsx(J,{container:!0,spacing:3,children:t?e.jsx(Yt,{}):i.length===0?e.jsx(Kt,{onCreateQuiz:r}):l()})},ge=[{id:"basic-info",title:"Quiz Information",description:"Set up basic quiz details like title, description, and category"},{id:"questions",title:"Add Questions",description:"Create and manage your quiz questions with answers"},{id:"review-create",title:"Review & Create",description:"Review your quiz and finalize creation."}],Jt=i=>{const[t,r]=p.useState(0),s=p.useMemo(()=>ge.map((h,u)=>{const b=u<t,g=u===t&&i().isValid;return{...h,completed:b||g,active:u===t,enabled:u<=t||b}}),[t,i]),a=p.useMemo(()=>i().isValid&&t<ge.length-1,[i,t]),o=p.useCallback(()=>{i().isValid&&t<ge.length-1&&r(t+1)},[t,i]),l=p.useCallback(()=>{t>0&&r(t-1)},[t]),n=p.useCallback(h=>{h>=0&&h<ge.length&&s[h].enabled&&r(h)},[s]),x=p.useCallback(()=>{r(0)},[]);return{navigation:{currentStep:t,steps:s,canProceed:a},actions:{nextStep:o,previousStep:l,goToStep:n,resetNavigation:x}}};ge.map(i=>i.id);const de={MAX_TITLE_LENGTH:100,MIN_OPTIONS:2,MAX_OPTIONS:20},Be=i=>{const{currentStep:t,draftQuiz:r}=i,s=p.useCallback(()=>{var z,A;const b=[],g=[];return(z=r.title)!=null&&z.trim()?r.title.length>de.MAX_TITLE_LENGTH&&b.push(`Title must be ${de.MAX_TITLE_LENGTH} characters or less`):b.push("Quiz title is required"),r.category||b.push("Quiz category must be selected"),r.difficulty||b.push("Quiz difficulty must be selected"),(A=r.description)!=null&&A.trim()||g.push("Consider adding a description to help users understand the quiz content"),{isValid:b.length===0,errors:b,warnings:g,validatedAt:new Date}},[r]),a=p.useCallback(()=>{const b=[],g=[];return!r.rounds||r.rounds.length<1?(b.push("Quiz must have at least one round"),{isValid:!1,errors:b,warnings:g,validatedAt:new Date}):(r.rounds.forEach((z,A)=>{const T=A+1;if(!z.questions||z.questions.length<1){b.push(`Round ${T} must have at least one question`);return}z.questions.forEach((d,y)=>{var j,k,R;if(!d||typeof d!="object")return;const C=y+1,f=`Round ${T}, Question ${C}`;if((j=d.question)!=null&&j.trim()||b.push(`${f}: Question text is required`),d.type==="single-answer")(k=d.correctAnswerText)!=null&&k.trim()||g.push(`${f}: Consider adding an answer`);else if(["multiple-choice","picture","audio","video"].includes(d.type))if(z.type==="golden-pyramid")(!d.possibleAnswers||!Array.isArray(d.possibleAnswers)||d.possibleAnswers.length===0||d.possibleAnswers.every(m=>!(m!=null&&m.trim())))&&g.push(`${f}: Consider adding at least one answer option`);else{if((!d.possibleAnswers||!Array.isArray(d.possibleAnswers)||d.possibleAnswers.length<de.MIN_OPTIONS)&&g.push(`${f}: Consider adding at least ${de.MIN_OPTIONS} answer options`),!d.correctAnswers||!Array.isArray(d.correctAnswers)||d.correctAnswers.length===0)g.push(`${f}: Consider selecting at least one correct answer`);else if(d.possibleAnswers&&Array.isArray(d.possibleAnswers)){const m=((R=d.possibleAnswers)==null?void 0:R.length)||0;d.correctAnswers.filter(D=>typeof D!="number"||D<0||D>=m).length>0&&g.push(`${f}: Some correct answer selections may be invalid`)}d.possibleAnswers&&Array.isArray(d.possibleAnswers)&&d.possibleAnswers.filter(v=>!(v!=null&&v.trim())).length>0&&g.push(`${f}: Consider filling in all answer options`),d.possibleAnswers&&Array.isArray(d.possibleAnswers)&&d.possibleAnswers.length>de.MAX_OPTIONS&&g.push(`${f}: Consider limiting to ${de.MAX_OPTIONS} options for better usability`)}d.question&&d.question.length>200&&g.push(`${f}: Long questions may be harder to read`)}),z.questions.length>10&&g.push(`Round ${T}: Many questions in one round may overwhelm users`)}),{isValid:b.length===0,errors:b,warnings:g,validatedAt:new Date})},[r.rounds]),o=p.useCallback(()=>{var y,C;const b=[],g=[];!!((y=r.title)!=null&&y.trim())||b.push("Basic quiz information is incomplete"),r.rounds&&r.rounds.length>0&&r.rounds.every(f=>f.questions&&f.questions.length>0)||b.push("Quiz must have at least one round with questions"),!!r.settings||b.push("Quiz settings are required");const d=((C=r.rounds)==null?void 0:C.reduce((f,j)=>{var k;return f+(((k=j.questions)==null?void 0:k.length)||0)},0))||0;return d<5&&g.push("Quiz has fewer than 5 questions - consider adding more"),d>50&&g.push("Quiz has many questions - consider splitting into multiple quizzes"),{isValid:b.length===0,errors:b,warnings:g,validatedAt:new Date}},[r]),l=p.useCallback(()=>{switch(t){case 0:return s();case 1:return a();case 2:return o();default:return{isValid:!1,errors:["Invalid step"],warnings:[],validatedAt:new Date}}},[t,s,a,o]),n=p.useCallback(b=>{switch(b){case 0:return s();case 1:return a();case 2:return o();default:return{isValid:!1,errors:["Invalid step index"],warnings:[],validatedAt:new Date}}},[s,a,o]),x=p.useCallback(()=>{const b=[],g=[];return[0,1,2].forEach(z=>{const A=n(z);b.push(...A.errors),g.push(...A.warnings)}),{isValid:b.length===0,errors:b,warnings:g,validatedAt:new Date}},[n]),c=l().isValid,u=x().isValid;return{validateStep:l,validateSpecificStep:n,validateAllSteps:x,isCurrentStepValid:c,isWizardComplete:u}},Xt=i=>{const{draftQuiz:t,clearDraft:r}=i,s=p.useCallback(c=>{const h=c.reduce((g,z)=>{var A;return g+(((A=z.questions)==null?void 0:A.length)||0)},0),u=Math.ceil(h*1.5),b=c.reduce((g,z)=>{const A=z.questions.reduce((T,d)=>{var y;return T+(((y=d.question)==null?void 0:y.length)||0)},0)/z.questions.length;return g+(A>100?.5:0)},0);return Math.max(5,u+Math.ceil(b))},[]),a=p.useCallback(()=>{if(t.id&&!t.id.startsWith("draft_"))return t.id;const c=Date.now(),h=Math.random().toString(36).substr(2,9);return`quiz_${c}_${h}`},[t.id]),o=p.useCallback(()=>{var A,T;if(!((A=t.title)!=null&&A.trim()))throw new Error("Quiz title is required");const c=new Date,h=t.id&&!t.id.startsWith("draft_"),u=t.rounds||[],b=t.settings||{allowHints:!1,showCorrectAnswers:!0,timeLimit:null,randomizeQuestions:!1,randomizeAnswers:!1},g=Math.max(u.length>0?s(u):5,t.estimatedDuration||5);return{id:a(),title:t.title.trim(),description:((T=t.description)==null?void 0:T.trim())||"",category:t.category||"general",difficulty:t.difficulty||"medium",estimatedDuration:g,createdAt:h&&t.createdAt||c,updatedAt:c,settings:b,rounds:u.map(d=>({...d,id:d.id||`round_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,createdAt:d.createdAt||c,updatedAt:d.updatedAt||c,questions:(d.questions||[]).map(y=>({...y,id:y.id||`q_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,createdAt:y.createdAt||c,updatedAt:y.updatedAt||c}))}))}},[t,s,a]),l=p.useCallback(()=>{var c;return!!((c=t.title)!=null&&c.trim())},[t.title]),n=p.useCallback(()=>{var u;const c=[],h=[];return(u=t.title)!=null&&u.trim()||c.push("Quiz title is required"),t.category||h.push("Consider adding a category"),t.difficulty||h.push("Consider setting a difficulty level"),(!t.rounds||t.rounds.length===0)&&h.push("Consider adding some questions"),{ready:c.length===0,errors:c,warnings:h}},[t]),x=p.useCallback(async()=>{var c;if(!((c=t.title)!=null&&c.trim()))throw new Error("Quiz title is required");try{const h=o();return r(),h}catch(h){throw console.error("[WizardCompletion] Failed to create quiz:",h),h instanceof Error?new Error(`Quiz creation failed: ${h.message}`):new Error("Quiz creation failed due to unknown error")}},[t.title,o,r]),w=l();return{completeWizard:x,canComplete:l,getCompletionStatus:n,isReady:w}},I={name:"QuizzardDB",version:1,stores:{quizzes:"quizzes",drafts:"drafts",mediaFiles:"mediaFiles",metadata:"metadata"}},Se={TOTAL_QUIZ_SIZE:500*1024*1024,SINGLE_IMAGE:10*1024*1024,SINGLE_AUDIO:20*1024*1024,SINGLE_VIDEO:100*1024*1024,WARNING_THRESHOLD:400*1024*1024},Ae={DEBOUNCE_DELAY:3e4,MAX_RETRIES:3,RETRY_DELAY:5e3,DRAFT_CLEANUP_DAYS:30};class es{constructor(){ve(this,"db",null);ve(this,"isInitialized",!1);ve(this,"initPromise",null)}async initialize(){return this.initPromise?this.initPromise:(this.initPromise=this._initializeDB(),this.initPromise)}async _initializeDB(){try{return window.indexedDB?new Promise((t,r)=>{const s=indexedDB.open(I.name,I.version);s.onerror=()=>{console.error("Failed to open IndexedDB:",s.error),r(!1)},s.onsuccess=()=>{this.db=s.result,this.isInitialized=!0,console.log("IndexedDB initialized successfully"),t(!0)},s.onupgradeneeded=a=>{const o=a.target.result;if(!o.objectStoreNames.contains(I.stores.quizzes)){const l=o.createObjectStore(I.stores.quizzes,{keyPath:"id"});l.createIndex("status","status",{unique:!1}),l.createIndex("createdAt","createdAt",{unique:!1}),l.createIndex("category","category",{unique:!1})}if(o.objectStoreNames.contains(I.stores.drafts)||o.createObjectStore(I.stores.drafts,{keyPath:"id"}).createIndex("lastSaved","lastSaved",{unique:!1}),!o.objectStoreNames.contains(I.stores.mediaFiles)){const l=o.createObjectStore(I.stores.mediaFiles,{keyPath:"id"});l.createIndex("type","type",{unique:!1}),l.createIndex("size","size",{unique:!1})}o.objectStoreNames.contains(I.stores.metadata)||o.createObjectStore(I.stores.metadata,{keyPath:"key"})}}):(console.warn("IndexedDB not available, will use localStorage fallback"),!1)}catch(t){return console.error("IndexedDB initialization failed:",t),!1}}async executeTransaction(t,r,s){try{if(!this.db)throw new Error("Database not initialized");const a=this.db.transaction(t,r);return new Promise(o=>{a.oncomplete=()=>{},a.onerror=()=>{var l;o({success:!1,error:`Transaction failed: ${(l=a.error)==null?void 0:l.message}`})},s(a).then(l=>{o({success:!0,data:l})}).catch(l=>{o({success:!1,error:l.message||"Operation failed"})})})}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error"}}}async saveQuiz(t){if(await this.initialize(),!this.isInitialized)return this.saveQuizFallback(t);const r=await this.getStorageUsage(),s=this.calculateQuizSize(t);return r.totalSize+s>Se.TOTAL_QUIZ_SIZE?{success:!1,error:"Storage limit exceeded. Please delete some quizzes or media files."}:this.executeTransaction([I.stores.quizzes,I.stores.mediaFiles],"readwrite",async a=>{const o=a.objectStore(I.stores.quizzes),l=a.objectStore(I.stores.mediaFiles);for(const n of t.rounds)for(const x of n.questions)x.mediaFile&&await this.putInStore(l,x.mediaFile);return await this.putInStore(o,t),await this.updateMetadata(),t})}async saveDraft(t){if(await this.initialize(),!this.isInitialized)return this.saveDraftFallback(t);const r={...t,lastSaved:new Date,isDraft:!0};return this.executeTransaction(I.stores.drafts,"readwrite",async s=>{const a=s.objectStore(I.stores.drafts);return await this.putInStore(a,r),r})}async loadQuizzes(){return await this.initialize(),this.isInitialized?this.executeTransaction(I.stores.quizzes,"readonly",async t=>{const s=t.objectStore(I.stores.quizzes).getAll();return new Promise((a,o)=>{s.onsuccess=()=>a(s.result||[]),s.onerror=()=>o(s.error)})}):this.loadQuizzesFallback()}async loadQuiz(t){return await this.initialize(),this.isInitialized?this.executeTransaction(I.stores.quizzes,"readonly",async r=>{const a=r.objectStore(I.stores.quizzes).get(t);return new Promise((o,l)=>{a.onsuccess=()=>o(a.result||null),a.onerror=()=>l(a.error)})}):this.loadQuizFallback(t)}async loadDrafts(){return await this.initialize(),this.isInitialized?this.executeTransaction(I.stores.drafts,"readonly",async t=>{const s=t.objectStore(I.stores.drafts).getAll();return new Promise((a,o)=>{s.onsuccess=()=>a(s.result||[]),s.onerror=()=>o(s.error)})}):this.loadDraftsFallback()}async deleteQuiz(t){return await this.initialize(),this.isInitialized?this.executeTransaction([I.stores.quizzes,I.stores.mediaFiles],"readwrite",async r=>{const s=r.objectStore(I.stores.quizzes),a=r.objectStore(I.stores.mediaFiles),o=await this.getFromStore(s,t);if(o)for(const l of o.rounds)for(const n of l.questions)n.mediaFile&&await this.deleteFromStore(a,n.mediaFile.id);return await this.deleteFromStore(s,t),await this.updateMetadata(),!0}):this.deleteQuizFallback(t)}async deleteDraft(t){return await this.initialize(),this.isInitialized?this.executeTransaction(I.stores.drafts,"readwrite",async r=>{const s=r.objectStore(I.stores.drafts);return await this.deleteFromStore(s,t),!0}):this.deleteDraftFallback(t)}async getStorageUsage(){if(await this.initialize(),!this.isInitialized)return this.getStorageUsageFallback();try{const[t,r,s]=await Promise.all([this.calculateStoreSize(I.stores.quizzes),this.calculateStoreSize(I.stores.drafts),this.calculateStoreSize(I.stores.mediaFiles)]),a=t+r+s,o=Se.TOTAL_QUIZ_SIZE-a,l=a/Se.TOTAL_QUIZ_SIZE*100;return{totalSize:a,quizzesSize:t,draftsSize:r,mediaFilesSize:s,remainingSpace:Math.max(0,o),percentageUsed:Math.min(100,l),isNearLimit:l>80}}catch(t){return console.error("Error calculating storage usage:",t),{totalSize:0,quizzesSize:0,draftsSize:0,mediaFilesSize:0,remainingSpace:Se.TOTAL_QUIZ_SIZE,percentageUsed:0,isNearLimit:!1}}}async cleanupOldDrafts(){if(await this.initialize(),!this.isInitialized)return{success:!0,data:0};const t=new Date;return t.setDate(t.getDate()-Ae.DRAFT_CLEANUP_DAYS),this.executeTransaction(I.stores.drafts,"readwrite",async r=>{const a=r.objectStore(I.stores.drafts).index("lastSaved"),o=IDBKeyRange.upperBound(t),l=a.openCursor(o);let n=0;return new Promise((x,w)=>{l.onsuccess=c=>{const h=c.target.result;h?(h.delete(),n++,h.continue()):x(n)},l.onerror=()=>w(l.error)})})}async clearAllStorage(){try{if(await this.initialize(),this.isInitialized&&this.db){const t=[I.stores.quizzes,I.stores.drafts,I.stores.mediaFiles,I.stores.metadata];for(const r of t)await this.executeTransaction(r,"readwrite",async s=>{const a=s.objectStore(r);return new Promise((o,l)=>{const n=a.clear();n.onsuccess=()=>o(),n.onerror=()=>l(n.error)})})}try{localStorage.removeItem("quizzard_quizzes"),localStorage.removeItem("quizzard_drafts"),Object.keys(localStorage).forEach(t=>{(t.startsWith("quizzard")||t.startsWith("Quizzard"))&&localStorage.removeItem(t)})}catch(t){console.warn("Failed to clear localStorage:",t)}return{success:!0,data:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to clear storage"}}}async putInStore(t,r){return new Promise((s,a)=>{const o=t.put(r);o.onsuccess=()=>s(),o.onerror=()=>a(o.error)})}async getFromStore(t,r){return new Promise((s,a)=>{const o=t.get(r);o.onsuccess=()=>s(o.result||null),o.onerror=()=>a(o.error)})}async deleteFromStore(t,r){return new Promise((s,a)=>{const o=t.delete(r);o.onsuccess=()=>s(),o.onerror=()=>a(o.error)})}async calculateStoreSize(t){return this.db?new Promise((r,s)=>{const l=this.db.transaction(t,"readonly").objectStore(t).getAll();l.onsuccess=()=>{const x=(l.result||[]).reduce((w,c)=>w+JSON.stringify(c).length*2,0);r(x)},l.onerror=()=>s(l.error)}):0}calculateQuizSize(t){return JSON.stringify(t).length*2}async updateMetadata(){if(!this.db)return;const r={version:"1.0.0",totalSize:(await this.getStorageUsage()).totalSize,createdAt:new Date,lastCleanup:new Date};this.db.transaction(I.stores.metadata,"readwrite").objectStore(I.stores.metadata).put({key:"app_metadata",...r})}saveQuizFallback(t){try{const r=this.getQuizzesFromLocalStorage(),s=r.findIndex(a=>a.id===t.id);return s>=0?r[s]=t:r.push(t),localStorage.setItem("quizzard_quizzes",JSON.stringify(r)),{success:!0,data:t,usedFallback:!0}}catch(r){return{success:!1,error:"localStorage save failed: "+(r instanceof Error?r.message:"Unknown error"),usedFallback:!0}}}saveDraftFallback(t){try{const r=this.getDraftsFromLocalStorage(),s=r.findIndex(o=>o.id===t.id),a={...t,lastSaved:new Date,isDraft:!0};return s>=0?r[s]=a:r.push(a),localStorage.setItem("quizzard_drafts",JSON.stringify(r)),{success:!0,data:a,usedFallback:!0}}catch(r){return{success:!1,error:"localStorage draft save failed: "+(r instanceof Error?r.message:"Unknown error"),usedFallback:!0}}}loadQuizzesFallback(){try{return{success:!0,data:this.getQuizzesFromLocalStorage(),usedFallback:!0}}catch(t){return{success:!1,error:"localStorage load failed: "+(t instanceof Error?t.message:"Unknown error"),usedFallback:!0}}}loadQuizFallback(t){try{return{success:!0,data:this.getQuizzesFromLocalStorage().find(a=>a.id===t)||null,usedFallback:!0}}catch(r){return{success:!1,error:"localStorage load failed: "+(r instanceof Error?r.message:"Unknown error"),usedFallback:!0}}}loadDraftsFallback(){try{return{success:!0,data:this.getDraftsFromLocalStorage(),usedFallback:!0}}catch(t){return{success:!1,error:"localStorage drafts load failed: "+(t instanceof Error?t.message:"Unknown error"),usedFallback:!0}}}deleteQuizFallback(t){try{const s=this.getQuizzesFromLocalStorage().filter(a=>a.id!==t);return localStorage.setItem("quizzard_quizzes",JSON.stringify(s)),{success:!0,data:!0,usedFallback:!0}}catch(r){return{success:!1,error:"localStorage delete failed: "+(r instanceof Error?r.message:"Unknown error"),usedFallback:!0}}}deleteDraftFallback(t){try{const s=this.getDraftsFromLocalStorage().filter(a=>a.id!==t);return localStorage.setItem("quizzard_drafts",JSON.stringify(s)),{success:!0,data:!0,usedFallback:!0}}catch(r){return{success:!1,error:"localStorage draft delete failed: "+(r instanceof Error?r.message:"Unknown error"),usedFallback:!0}}}getStorageUsageFallback(){try{const t=localStorage.getItem("quizzard_quizzes")||"[]",r=localStorage.getItem("quizzard_drafts")||"[]",s=t.length*2,a=r.length*2,o=s+a,l=5*1024*1024,n=Math.max(0,l-o),x=o/l*100;return{totalSize:o,quizzesSize:s,draftsSize:a,mediaFilesSize:0,remainingSpace:n,percentageUsed:Math.min(100,x),isNearLimit:x>80}}catch{return{totalSize:0,quizzesSize:0,draftsSize:0,mediaFilesSize:0,remainingSpace:5*1024*1024,percentageUsed:0,isNearLimit:!1}}}getQuizzesFromLocalStorage(){try{const t=localStorage.getItem("quizzard_quizzes");return t?JSON.parse(t):[]}catch{return[]}}getDraftsFromLocalStorage(){try{const t=localStorage.getItem("quizzard_drafts");return t?JSON.parse(t):[]}catch{return[]}}}const H=new es,at=()=>{const{showSnackbar:i}=nt(),[t,r]=p.useState({quizzes:[],drafts:[],isLoading:!1,storageUsage:null,autoSaveStatus:"idle",isInitialized:!1}),s=p.useRef(null),a=p.useRef(null),o=p.useRef(0),l=p.useCallback(async()=>{try{r(y=>({...y,isLoading:!0}));const d=await H.initialize();return r(y=>({...y,isInitialized:d,isLoading:!1})),d?console.log("âœ… IndexedDB initialized successfully"):(console.warn("âš ï¸ Using localStorage fallback"),i("Using local storage - some features may be limited","warning")),d}catch(d){return console.error("Storage initialization failed:",d),r(y=>({...y,isInitialized:!1,isLoading:!1})),i("Storage initialization failed","error"),!1}},[i]),n=p.useCallback(async d=>{try{r(C=>({...C,isLoading:!0}));const y=await H.saveQuiz(d);return y.success?(r(C=>({...C,quizzes:C.quizzes.some(f=>f.id===d.id)?C.quizzes.map(f=>f.id===d.id?d:f):[...C.quizzes,d],isLoading:!1})),i(y.usedFallback?"Quiz saved to local storage":"Quiz saved successfully","success"),await A(),!0):(r(C=>({...C,isLoading:!1})),i(y.error||"Failed to save quiz","error"),!1)}catch(y){return r(C=>({...C,isLoading:!1})),console.error("Error saving quiz:",y),i("Failed to save quiz","error"),!1}},[i]),x=p.useCallback(async()=>{try{r(y=>({...y,isLoading:!0}));const d=await H.loadQuizzes();d.success?(r(y=>({...y,quizzes:d.data||[],isLoading:!1})),d.usedFallback&&console.log("ðŸ“¦ Loaded quizzes from localStorage")):(r(y=>({...y,isLoading:!1})),console.error("Failed to load quizzes:",d.error),i("Failed to load quizzes","error"))}catch(d){r(y=>({...y,isLoading:!1})),console.error("Error loading quizzes:",d),i("Failed to load quizzes","error")}},[i]),w=p.useCallback(async d=>{try{r(C=>({...C,isLoading:!0}));const y=await H.deleteQuiz(d);return y.success?(r(C=>({...C,quizzes:C.quizzes.filter(f=>f.id!==d),isLoading:!1})),i("Quiz deleted successfully","success"),await A(),!0):(r(C=>({...C,isLoading:!1})),i(y.error||"Failed to delete quiz","error"),!1)}catch(y){return r(C=>({...C,isLoading:!1})),console.error("Error deleting quiz:",y),i("Failed to delete quiz","error"),!1}},[i]),c=p.useCallback(async d=>{try{const y=await H.saveDraft(d);return y.success?(r(C=>({...C,drafts:C.drafts.some(f=>f.id===d.id)?C.drafts.map(f=>f.id===d.id?y.data:f):[...C.drafts,y.data]})),!0):(console.error("Failed to save draft:",y.error),!1)}catch(y){return console.error("Error saving draft:",y),!1}},[]),h=p.useCallback(async()=>{try{const d=await H.loadDrafts();d.success?r(y=>({...y,drafts:d.data||[]})):console.error("Failed to load drafts:",d.error)}catch(d){console.error("Error loading drafts:",d)}},[]),u=p.useCallback(async d=>{try{const y=await H.deleteDraft(d);return y.success?(r(C=>({...C,drafts:C.drafts.filter(f=>f.id!==d)})),!0):(console.error("Failed to delete draft:",y.error),!1)}catch(y){return console.error("Error deleting draft:",y),!1}},[]),b=p.useCallback(async()=>{if(a.current)try{if(r(y=>({...y,autoSaveStatus:"saving"})),await c(a.current))r(y=>({...y,autoSaveStatus:"saved"})),o.current=0,setTimeout(()=>{r(y=>({...y,autoSaveStatus:"idle"}))},2e3);else throw new Error("Auto-save failed")}catch(d){console.error("Auto-save error:",d),r(y=>({...y,autoSaveStatus:"error"})),o.current<Ae.MAX_RETRIES?(o.current++,setTimeout(()=>{b()},Ae.RETRY_DELAY)):(i("Auto-save failed. Please save manually.","error"),setTimeout(()=>{r(y=>({...y,autoSaveStatus:"idle"}))},5e3))}},[c,i]),g=p.useCallback(d=>{s.current&&clearTimeout(s.current),a.current=d,s.current=setTimeout(()=>{b()},Ae.DEBOUNCE_DELAY)},[b]),z=p.useCallback(()=>{s.current&&(clearTimeout(s.current),s.current=null),a.current=null,r(d=>({...d,autoSaveStatus:"idle"}))},[]),A=p.useCallback(async()=>{try{const d=await H.getStorageUsage();r(y=>({...y,storageUsage:d})),d.isNearLimit&&i(`Storage is ${d.percentageUsed.toFixed(1)}% full. Consider deleting old quizzes.`,"warning")}catch(d){console.error("Error getting storage usage:",d)}},[i]),T=p.useCallback(async()=>{try{const d=await H.cleanupOldDrafts();return d.success&&d.data>0&&(i(`Cleaned up ${d.data} old drafts`,"info"),await h(),await A()),d.data||0}catch(d){return console.error("Error cleaning up drafts:",d),0}},[h,A,i]);return p.useEffect(()=>{l()},[l]),p.useEffect(()=>{t.isInitialized&&(x(),h(),A())},[t.isInitialized,x,h,A]),p.useEffect(()=>()=>{s.current&&clearTimeout(s.current)},[]),{...t,saveQuiz:n,loadQuizzes:x,deleteQuiz:w,saveDraft:c,loadDrafts:h,deleteDraft:u,enableAutoSave:g,disableAutoSave:z,refreshStorageUsage:A,cleanupOldDrafts:T,initializeStorage:l}},ot={defaultTimeLimit:30},pe={title:"",description:"",category:"general",difficulty:"medium",rounds:[],estimatedDuration:10,settings:ot,status:"draft"},ts=i=>{const{saveDraft:t,loadDrafts:r,deleteDraft:s,autoSaveStatus:a,storageError:o,clearError:l}=at(),[n,x]=p.useState(pe),[w,c]=p.useState(!1),[h,u]=p.useState(null),b=p.useRef(null),g=p.useRef(null);p.useEffect(()=>{w||(async()=>{try{if(i!=null&&i.id){const k={...i,status:"draft",id:i.id};x(k),g.current=k.id}else{const R=(await r()).find(m=>m.title===""||!m.title);if(R)x(R),g.current=R.id;else{const m={...pe,id:`draft_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date};x(m),g.current=m.id}}}catch(k){console.warn("[WizardPersistence] Failed to initialize draft:",k);const R={...pe,id:`draft_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date};x(R),g.current=R.id}finally{c(!0)}})()},[w,i,r]);const z=p.useCallback(()=>{b.current&&clearTimeout(b.current),b.current=setTimeout(async()=>{var j;if(n.id&&(n.title||(j=n.rounds)!=null&&j.length))try{await t(n),u(new Date)}catch(k){console.error("[WizardPersistence] Auto-save failed:",k)}},3e4)},[n,t]),A=p.useCallback(j=>{x(k=>({...k,...j,settings:{...k.settings||ot,...j.settings||{}},rounds:j.rounds!==void 0?j.rounds:k.rounds,updatedAt:new Date})),z()},[z]),T=p.useCallback(async()=>{if(n.id)try{await t(n),u(new Date)}catch(j){throw console.error("[WizardPersistence] Manual save failed:",j),j}},[n,t]),d=p.useCallback(async()=>{if(b.current&&(clearTimeout(b.current),b.current=null),g.current)try{await s(g.current)}catch(j){console.warn("[WizardPersistence] Failed to delete draft:",j)}x(pe),u(null),g.current=null,l()},[s,l]),y=p.useCallback(()=>{const j={...pe,id:`draft_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date};x(j),g.current=j.id,u(null)},[]),C=p.useCallback(j=>{const k={...j,status:"draft",id:`draft_${j.id||Date.now()}_${Date.now()}`,updatedAt:new Date};x(k),g.current=k.id,u(null)},[]),f=p.useCallback(async()=>{try{const k=(await r()).filter(R=>R.status==="draft").sort((R,m)=>new Date(m.updatedAt||0).getTime()-new Date(R.updatedAt||0).getTime())[0];return k?(x(k),g.current=k.id,u(k.updatedAt?new Date(k.updatedAt):null),!0):!1}catch(j){return console.error("[WizardPersistence] Draft recovery failed:",j),!1}},[r]);return p.useEffect(()=>()=>{b.current&&clearTimeout(b.current)},[]),{persistence:{draftQuiz:n,isInitialized:w,autoSaveStatus:a,storageError:o,lastSaved:h},actions:{updateDraft:A,saveDraft:T,clearDraft:d,resetDraft:y,initializeFromQuiz:C,recoverDraft:f}}},ss=i=>{const{persistence:{draftQuiz:t,autoSaveStatus:r,storageError:s,lastSaved:a},actions:o}=ts(i),l=Be({currentStep:0,draftQuiz:t}),{navigation:{currentStep:n,steps:x,canProceed:w},actions:c}=Jt(l.validateStep),h=Be({currentStep:n,draftQuiz:t}),u=Xt({draftQuiz:t,clearDraft:o.clearDraft,resetDraft:o.resetDraft}),b=()=>{c.resetNavigation(),o.clearDraft()};return{currentStep:n,steps:x,canProceed:w,nextStep:c.nextStep,previousStep:c.previousStep,goToStep:c.goToStep,draftQuiz:t,updateDraft:o.updateDraft,saveDraft:o.saveDraft,autoSaveStatus:r,storageError:s,lastSaved:a,validateStep:h.validateStep,completeWizard:u.completeWizard,resetWizard:b,recoverDraft:o.recoverDraft}},rs=p.createContext(null),Le={didCatch:!1,error:null};class is extends p.Component{constructor(t){super(t),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=Le}static getDerivedStateFromError(t){return{didCatch:!0,error:t}}resetErrorBoundary(){const{error:t}=this.state;if(t!==null){for(var r,s,a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];(r=(s=this.props).onReset)===null||r===void 0||r.call(s,{args:o,reason:"imperative-api"}),this.setState(Le)}}componentDidCatch(t,r){var s,a;(s=(a=this.props).onError)===null||s===void 0||s.call(a,t,r)}componentDidUpdate(t,r){const{didCatch:s}=this.state,{resetKeys:a}=this.props;if(s&&r.error!==null&&ns(t.resetKeys,a)){var o,l;(o=(l=this.props).onReset)===null||o===void 0||o.call(l,{next:a,prev:t.resetKeys,reason:"keys"}),this.setState(Le)}}render(){const{children:t,fallbackRender:r,FallbackComponent:s,fallback:a}=this.props,{didCatch:o,error:l}=this.state;let n=t;if(o){const x={error:l,resetErrorBoundary:this.resetErrorBoundary};if(typeof r=="function")n=r(x);else if(s)n=p.createElement(s,x);else if(a!==void 0)n=a;else throw l}return p.createElement(rs.Provider,{value:{didCatch:o,error:l,resetErrorBoundary:this.resetErrorBoundary}},n)}}function ns(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return i.length!==t.length||i.some((r,s)=>!Object.is(r,t[s]))}const Ge={MAX_TITLE_LENGTH:100},se={mixed:{label:"Any Type of Question",description:"Questions of any type",allowedQuestionTypes:["single-answer","multiple-choice","picture","audio","video"],canSelectQuestionType:!0},"single-answer-only":{label:"Question-Answer",description:"Only single answer questions",allowedQuestionTypes:["single-answer"],canSelectQuestionType:!1},"multiple-choice":{label:"Multiple Choice Question",description:"Only multiple choice questions",allowedQuestionTypes:["multiple-choice"],canSelectQuestionType:!1},picture:{label:"Picture Question",description:"Questions with picture uploads",allowedQuestionTypes:["picture"],canSelectQuestionType:!1},audio:{label:"Audio Question",description:"Questions with audio uploads",allowedQuestionTypes:["audio"],canSelectQuestionType:!1},video:{label:"Video Question",description:"Questions with video uploads",allowedQuestionTypes:["video"],canSelectQuestionType:!1},"golden-pyramid":{label:"Golden Pyramid Question",description:"Special 4-question format",allowedQuestionTypes:["multiple-choice"],canSelectQuestionType:!1,specialFormat:!0,prePopulatedQuestions:4}},as=[{value:"general",label:"General Knowledge",description:"Mixed topics and trivia"},{value:"sports",label:"Sports",description:"Sports, teams, and athletics"},{value:"history",label:"History",description:"Historical events and figures"},{value:"science",label:"Science",description:"Science, technology, and nature"},{value:"geography",label:"Geography",description:"Countries, capitals, and locations"},{value:"entertainment",label:"Entertainment",description:"Movies, TV, and celebrities"},{value:"literature",label:"Literature",description:"Books, authors, and poetry"},{value:"art",label:"Art",description:"Visual arts, paintings, and artists"},{value:"music",label:"Music",description:"Songs, artists, and musical theory"},{value:"technology",label:"Technology",description:"Computers, software, and gadgets"},{value:"custom",label:"Custom",description:"Your own custom category"}],os=[{value:"easy",label:"Easy",description:"Simple questions for beginners",color:"success"},{value:"medium",label:"Medium",description:"Moderate difficulty questions",color:"warning"},{value:"hard",label:"Hard",description:"Challenging questions for experts",color:"error"}],ls=({draftQuiz:i,updateDraft:t,validation:r})=>{var a;const s=E.useCallback(o=>r.errors.find(l=>l.toLowerCase().includes(o.toLowerCase())),[r.errors]);return e.jsx(S,{sx:{maxWidth:1e3,mx:"auto"},children:e.jsxs(J,{container:!0,spacing:4,children:[e.jsx(J,{size:{xs:12},children:e.jsx(N,{fullWidth:!0,id:"quiz-title",name:"title",label:"Quiz Title",placeholder:"e.g., General Knowledge Quiz, Science Facts Challenge",value:i.title||"",onChange:o=>t({title:o.target.value}),error:!!s("title"),helperText:s("title")||`${(i.title||"").length}/${Ge.MAX_TITLE_LENGTH} characters`,inputProps:{maxLength:Ge.MAX_TITLE_LENGTH,"aria-label":"Quiz title"},size:"medium",sx:{mb:3}})}),e.jsx(J,{size:{xs:12},children:e.jsx(N,{fullWidth:!0,id:"quiz-description",name:"description",multiline:!0,rows:4,label:"Description (Optional)",placeholder:"Brief description of what this quiz covers...",value:i.description||"",onChange:o=>t({description:o.target.value}),helperText:`${((a=i.description)==null?void 0:a.length)||0}/500 characters`,inputProps:{maxLength:500},size:"medium",sx:{mb:3}})}),e.jsx(J,{size:{xs:12,md:6},children:e.jsxs(_,{fullWidth:!0,error:!!s("category"),size:"medium",children:[e.jsx($,{children:"Quiz Category"}),e.jsx(B,{id:"quiz-category",name:"category",value:i.category||"general",onChange:o=>t({category:o.target.value}),label:"Quiz Category","aria-label":"Quiz category selection",startAdornment:e.jsx(_e,{sx:{mr:1,color:"text.secondary"}}),children:as.map(o=>e.jsx(F,{value:o.value,children:e.jsxs(S,{children:[e.jsx(Q,{variant:"body1",children:o.label}),e.jsx(Q,{variant:"caption",color:"text.secondary",children:o.description})]})},o.value))}),e.jsx(Fe,{children:s("category")||"Choose the main topic of your quiz"})]})}),e.jsx(J,{size:{xs:12,md:6},children:e.jsxs(_,{fullWidth:!0,error:!!s("difficulty"),size:"medium",children:[e.jsx($,{children:"Difficulty Level"}),e.jsx(B,{id:"quiz-difficulty",name:"difficulty",value:i.difficulty||"medium",onChange:o=>t({difficulty:o.target.value}),label:"Difficulty Level","aria-label":"Difficulty level selection",startAdornment:e.jsx(Je,{sx:{mr:1,color:"text.secondary"}}),children:os.map(o=>e.jsx(F,{value:o.value,children:e.jsxs(S,{display:"flex",alignItems:"center",gap:2,width:"100%",children:[e.jsx(Y,{label:o.label,size:"small",color:o.color,variant:"outlined"}),e.jsx(Q,{variant:"body2",color:"text.secondary",children:o.description})]})},o.value))}),e.jsx(Fe,{children:s("difficulty")||"Set the challenge level for your quiz"})]})}),e.jsxs(S,{sx:{mt:3,width:"100%"},children:[e.jsx(Q,{gutterBottom:!0,children:"Default Time Per Question"}),e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%"},children:[e.jsx(zt,{min:10,max:300,step:10,value:i.defaultTimeLimit??60,onChange:(o,l)=>t({defaultTimeLimit:l}),valueLabelDisplay:"auto",valueLabelFormat:o=>`${Math.floor(o/60)} min ${o%60?o%60+" sec":""}`,sx:{flex:1},"aria-label":"Default time per question slider"}),e.jsx(N,{type:"number",size:"small",label:"Seconds",inputProps:{min:10,max:300,step:10},value:i.defaultTimeLimit??60,onChange:o=>{let l=Number(o.target.value);l<10&&(l=10),l>300&&(l=300),t({defaultTimeLimit:l})},InputProps:{endAdornment:e.jsx(Ct,{position:"end",children:"sec"})},sx:{width:120},"aria-label":"Default time per question input"})]}),e.jsx(Fe,{children:"This will be the default time limit for each new question. You can override it per question."})]})]})})};let ue=0,he=0;const Qe=6e4,We=15,Ve=4e3;function cs(){const i=Date.now();if(i-ue>Qe&&(he=0),he>=We){const r=Qe-(i-ue);return{isRateLimited:!0,retryAfter:Math.ceil(r/1e3),message:`Rate limit reached (${We}/minute). Please wait ${Math.ceil(r/1e3)} seconds.`}}const t=i-ue;if(t<Ve&&he>0){const r=Ve-t;return{isRateLimited:!0,retryAfter:Math.ceil(r/1e3),message:`Please wait ${Math.ceil(r/1e3)} seconds between requests to avoid rate limits.`}}return{isRateLimited:!1}}function Ue(i){return new Promise(t=>setTimeout(t,i*1e3))}const lt=async(i={},t)=>{var r;try{const s=cs();if(s.isRateLimited){const h=s.retryAfter||4;t||await Ue(h)}const a="AIzaSyAzhUzT7hqprvBPcz96iN8j0zdAw84pBb4";if(!navigator.onLine)throw new Error("Internet connection required");he++,ue=Date.now();const l={contents:[{parts:[{text:ds(i.difficulty||"medium",i.language||"English",i.category||"random",i.previousQuestions||[])}]}],generationConfig:{temperature:.9,topK:40,topP:.95,maxOutputTokens:1024}},n=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!n.ok){const h=await n.json().catch(()=>({}));if(n.status===429)return await Ue(4),lt(i,t);throw new Error(`Gemini API error: ${n.status} - ${((r=h.error)==null?void 0:r.message)||"Unknown error"}`)}const x=await n.json();if(!x.candidates||x.candidates.length===0)throw new Error("No response generated from Gemini API");const w=x.candidates[0].content.parts[0].text,c=ms(w);return{id:Math.random().toString(36).substring(7),question:c.question,answer:c.answer,category:c.category,difficulty:c.difficulty}}catch(s){throw console.error("Gemini API error:",s),s instanceof Error?s:new Error("Failed to generate question. Please try again.")}};function ds(i,t,r,s){const a=t.toLowerCase()==="bulgarian"?"Generate the question and answer in Bulgarian language.":"Generate the question and answer in English language.",o=r.toLowerCase()==="random"?"Choose a random general knowledge topic.":`Generate a question about the category: ${r}`,l=us(i);let n="";s.length>0&&(n=`

IMPORTANT: Do NOT repeat any of these recently asked questions. Generate something completely different:
${s.slice(-10).map((c,h)=>`${h+1}. ${c.question}`).join(`
`)}`);const x=hs(r);return`You are an expert quiz master with access to accurate, up-to-date information. Generate a single quiz question and its answer.

${a}
${o}
${l}
${x}
${n}

CRITICAL REQUIREMENTS:
- The answer must be 100% factually correct and verifiable
- For geographic questions, double-check all facts (heights, locations, names)
- Avoid controversial or ambiguous topics
- Make the question engaging and educational
- Ensure the question is unique and not repetitive

IMPORTANT: Respond ONLY with a valid JSON object in this exact format:
{
  "question": "Your generated question here",
  "answer": "The correct answer here", 
  "category": "The category of the question",
  "difficulty": "${i}"
}

Do not include any other text, explanations, or formatting outside the JSON object.`}function us(i){switch(i.toLowerCase()){case"easy":return"Make this an EASY question that most people would know. Use basic, well-known facts that are commonly taught in school or widely known in popular culture.";case"hard":return"Make this a HARD question that requires specialized knowledge, advanced education, or deep expertise in a specific field. Use complex concepts, technical details, or obscure historical facts.";case"medium":default:return"Make this a MEDIUM difficulty question that requires some general knowledge and thinking. It should be challenging but not impossible for an educated person to answer."}}function hs(i){const t=i.toLowerCase();return t.includes("geography")||t.includes("ÑÐ¼Ð¾Ð»ÑÐ½")||t.includes("bulgaria")||t.includes("mountain")||t.includes("peak")?`
FACT-CHECKING FOR GEOGRAPHY: 
- For Bulgarian geography: Verify all mountain peaks, heights, and locations
- For Smolyan region: The highest peak near Smolyan is Perelik (2,191m), NOT Snezhanka
- Snezhanka is near Pamporovo but is NOT the highest peak in the Smolyan area
- Always verify geographical facts against reliable sources
- Double-check all numerical data (heights, distances, populations)`:t.includes("history")?`
FACT-CHECKING FOR HISTORY: 
- Verify all dates, names, and historical events
- Ensure chronological accuracy
- Cross-reference multiple historical sources`:t.includes("science")?`
FACT-CHECKING FOR SCIENCE: 
- Verify all scientific facts and figures
- Ensure formulas and laws are correct
- Use current scientific understanding`:`
FACT-CHECKING: 
- Verify all facts before including them
- Use reliable, authoritative sources
- Avoid outdated or disputed information`}function ms(i){try{const r=i.trim().match(/\{[\s\S]*\}/);if(!r)throw new Error("No JSON found in response");const s=JSON.parse(r[0]);if(!s.question||!s.answer)throw new Error("Missing required fields in response");return{question:s.question,answer:s.answer,category:s.category||"General Knowledge",difficulty:s.difficulty||"medium"}}catch{return console.error("Failed to parse Gemini response:",i),{question:"What is the capital of France?",answer:"Paris",category:"Geography",difficulty:"easy"}}}const ct=()=>!!navigator.onLine,fs=()=>{const i=Date.now();i-ue>Qe&&(he=0);const t=Math.max(0,We-he),r=Math.max(0,Qe-(i-ue)),s=t<=3;return{requestsRemaining:t,timeUntilReset:Math.ceil(r/1e3),isNearLimit:s}},ps=async(i={},t)=>{try{if(!ct())return{question:He(),success:!1,error:"AI service is not available. Please check your connection and try again."};const r={difficulty:i.difficulty||"medium",language:i.language||"English",category:i.topicHint||ws(i.category||"general"),previousQuestions:vs(i.previousQuestions||[])},s=await lt(r,t),a=i.questionType||"text-answer";return{question:await gs(s,a,i.optionsCount||4,i.difficulty||"medium"),success:!0}}catch(r){const s=r instanceof Error?r.message:"Failed to generate question";return{question:He(),success:!1,error:s}}};async function gs(i,t,r,s){const a=new Date,o={id:dt(),question:i.question,difficulty:s,points:js(),timeLimit:60,createdAt:a,updatedAt:a};if(t==="text-answer")return{...o,type:"text-answer",options:[],correctAnswer:-1,textAnswer:i.answer,explanation:`The correct answer is: ${i.answer}`};{const l=await xs(i.question,i.answer,r-1,s),n=[i.answer,...l],x=Ss([...n]),w=x.indexOf(i.answer);return{...o,type:"text",options:x,correctAnswer:w,textAnswer:"",explanation:`The correct answer is: ${i.answer}`}}}async function xs(i,t,r,s){var a,o,l,n,x;try{const w=ys(i,t,r,s),c="AIzaSyAzhUzT7hqprvBPcz96iN8j0zdAw84pBb4",h=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${c}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:w}]}],generationConfig:{temperature:.8,topK:40,topP:.9}})});if(!h.ok)return qe(t,r);const b=((x=(n=(l=(o=(a=(await h.json()).candidates)==null?void 0:a[0])==null?void 0:o.content)==null?void 0:l.parts)==null?void 0:n[0])==null?void 0:x.text)||"",g=bs(b,r);if(g.length<r){const z=qe(t,r-g.length);return[...g,...z]}return g.slice(0,r)}catch(w){return console.warn("Failed to generate AI distractors, using fallback:",w),qe(t,r)}}function ys(i,t,r,s){const a={easy:"Make the wrong answers obviously incorrect but still plausible.",medium:"Make the wrong answers plausible but clearly distinguishable from the correct answer.",hard:"Make the wrong answers very plausible and similar to the correct answer."}[s];return`Generate ${r} incorrect but plausible answers for this multiple choice question.

Question: ${i}
Correct Answer: ${t}

Requirements:
- ${a}
- Each wrong answer should be on a separate line
- Make them the same format/length as the correct answer
- Don't number them or add extra text
- Make them factually wrong but believable
- Avoid obviously ridiculous answers

Wrong answers:`}function bs(i,t){return i.split(`
`).map(s=>s.trim()).filter(s=>s.length>0).filter(s=>!s.match(/^[0-9]+\.?\s/)).slice(0,t)}function qe(i,t){const r=[];for(let s=0;s<t;s++)if(i.match(/^\d+$/)){const a=parseInt(i);r.push(String(a+(s+1)*10))}else i.match(/^[A-Z]/)?r.push(`Alternative ${String.fromCharCode(65+s)}`):r.push(`Option ${String.fromCharCode(65+s)}`);return r}function He(){const i=new Date;return{id:dt(),type:"text",question:"",options:["","","",""],correctAnswer:0,difficulty:"medium",points:1,timeLimit:60,createdAt:i,updatedAt:i}}function dt(){return`q_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function ws(i){return{general:"General Knowledge",sports:"Sports",history:"History",science:"Science",geography:"Geography",entertainment:"Entertainment",literature:"Literature",art:"Art",music:"Music",technology:"Technology",custom:"General Knowledge"}[i]||"General Knowledge"}function vs(i){return i.map(t=>({question:t.question,answer:t.options[t.correctAnswer]||""}))}function Ss(i){const t=[...i];for(let r=t.length-1;r>0;r--){const s=Math.floor(Math.random()*(r+1));[t[r],t[s]]=[t[s],t[r]]}return t}function js(i){return 1}const Ye=()=>ct(),zs=()=>fs(),Cs=({rounds:i,currentRoundIdx:t,currentRound:r,onPreviousRound:s,onNextRound:a,onAddRound:o,onEditRound:l,onDeleteRound:n})=>{const x=i.length>0,w=x&&t>0,c=x&&t<i.length-1;return e.jsx(S,{sx:{mb:3},children:e.jsxs(S,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:{xs:.5,sm:1.5},p:{xs:1.5,sm:2},borderRadius:3,bgcolor:"background.paper",border:1,borderColor:"divider",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",transition:"all 0.2s ease-in-out","&:hover":{boxShadow:"0 4px 16px rgba(0,0,0,0.12)"}},children:[e.jsx(xe,{onClick:s,disabled:!w,size:"medium",sx:{width:{xs:36,sm:44},height:{xs:36,sm:44},minWidth:{xs:36,sm:44},bgcolor:w?"primary.main":"grey.200",color:w?"white":"grey.400",boxShadow:w?2:1,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",transform:w?"scale(1)":"scale(0.9)","&:hover":{bgcolor:w?"primary.dark":"grey.200",transform:w?"scale(1.05)":"scale(0.9)",boxShadow:w?3:1},"&:active":{transform:w?"scale(0.95)":"scale(0.9)"},"&:disabled":{bgcolor:"grey.200",color:"grey.400",cursor:"not-allowed"}},"aria-label":"Previous round",children:e.jsx(At,{sx:{fontSize:{xs:"1.1rem",sm:"1.3rem"}}})}),e.jsx(S,{sx:{flex:1}}),x?e.jsx(M,{onClick:l,endIcon:e.jsx(ye,{sx:{fontSize:{xs:"0.9rem",sm:"1rem"}}}),sx:{borderRadius:3,textTransform:"none",fontWeight:600,fontSize:{xs:"0.8rem",sm:"0.9rem"},px:{xs:2,sm:3},py:{xs:1,sm:1.2},background:"linear-gradient(45deg, #1976d2, #42a5f5)",color:"white",boxShadow:"0 2px 8px rgba(25, 118, 210, 0.3)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",minWidth:{xs:90,sm:120},"&:hover":{background:"linear-gradient(45deg, #1565c0, #1976d2)",boxShadow:"0 4px 12px rgba(25, 118, 210, 0.4)",transform:"translateY(-1px)"},"&:active":{transform:"translateY(0px)"}},children:e.jsxs(Q,{variant:"inherit",sx:{fontWeight:600,fontSize:"inherit",whiteSpace:"nowrap"},children:["Round ",t+1,"/",i.length]})}):e.jsx(Q,{variant:"body2",sx:{color:"text.secondary",fontWeight:500,px:{xs:2,sm:3},fontSize:{xs:"0.8rem",sm:"0.9rem"}},children:"No rounds yet"}),e.jsxs(M,{onClick:o,sx:{borderRadius:{xs:"50%",sm:3},textTransform:"none",fontWeight:{xs:600,sm:500},fontSize:{xs:"1.4rem",sm:"0.8rem"},px:{xs:0,sm:3},py:{xs:0,sm:1.2},minWidth:{xs:40,sm:120},minHeight:{xs:40,sm:44},width:{xs:40,sm:120},height:{xs:40,sm:44},ml:{xs:.5,sm:1},background:"linear-gradient(45deg, #4caf50, #66bb6a)",color:"white",boxShadow:"0 2px 8px rgba(76, 175, 80, 0.3)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",display:"flex",alignItems:"center",justifyContent:"center","&:hover":{background:"linear-gradient(45deg, #388e3c, #4caf50)",boxShadow:"0 4px 12px rgba(76, 175, 80, 0.4)",transform:"translateY(-1px)"},"&:active":{transform:"translateY(0px)"}},"aria-label":"Add round",children:[e.jsx(S,{sx:{display:{xs:"flex",sm:"none"},alignItems:"center",justifyContent:"center",width:"100%",height:"100%"},children:e.jsx(ie,{sx:{fontSize:"1.6rem"}})}),e.jsx(Q,{variant:"inherit",sx:{fontWeight:600,fontSize:"inherit",display:{xs:"none",sm:"block"},whiteSpace:"nowrap"},children:"Add Round"})]}),e.jsx(S,{sx:{flex:1}}),e.jsx(xe,{onClick:a,disabled:!c,size:"medium",sx:{width:{xs:36,sm:44},height:{xs:36,sm:44},minWidth:{xs:36,sm:44},bgcolor:c?"primary.main":"grey.200",color:c?"white":"grey.400",boxShadow:c?2:1,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",transform:c?"scale(1)":"scale(0.9)","&:hover":{bgcolor:c?"primary.dark":"grey.200",transform:c?"scale(1.05)":"scale(0.9)",boxShadow:c?3:1},"&:active":{transform:c?"scale(0.95)":"scale(0.9)"},"&:disabled":{bgcolor:"grey.200",color:"grey.400",cursor:"not-allowed"}},"aria-label":"Next round",children:e.jsx(Dt,{sx:{fontSize:{xs:"1.1rem",sm:"1.3rem"}}})})]})})},As=(i,t)=>!i.question||!i.question.trim()?!1:i.type==="single-answer"||["picture","audio","video"].includes(i.type)?!!(i.correctAnswerText&&i.correctAnswerText.trim()):t==="golden-pyramid"?i.possibleAnswers.length>0&&i.possibleAnswers.every(r=>r.trim()):i.possibleAnswers.length>=2&&i.possibleAnswers.every(r=>r.trim())&&i.correctAnswers.length>0,Ds=({currentRound:i,onEditQuestion:t,onDeleteQuestion:r,onAddRound:s,onAddQuestion:a})=>i?e.jsxs(e.Fragment,{children:[e.jsx(S,{sx:{mb:2},children:e.jsxs(Q,{variant:"subtitle1",color:"text.secondary",children:[i.level?`Level: ${i.level}`:""," | Reveal:"," ",i.answerRevealMode," | Default Time:"," ",i.defaultTimePerQuestion,"s"]})}),e.jsx(S,{sx:{display:"flex",flexDirection:"column",gap:2},children:i.questions.length===0?e.jsx(ne,{elevation:0,sx:{textAlign:"center",py:4,border:1,borderStyle:"dashed",borderColor:"divider"},children:e.jsxs(me,{children:[e.jsx(Q,{variant:"body2",color:"text.secondary",paragraph:!0,children:"No questions in this round yet. Add or generate questions to get started."}),a&&e.jsx(M,{variant:"contained",size:"medium",startIcon:e.jsx(ie,{}),onClick:a,sx:{mt:1},children:"Add Question"})]})}):i.questions.map((o,l)=>{const n=As(o,i.type);return e.jsxs(ne,{elevation:0,sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,py:1.5,cursor:"pointer",bgcolor:"background.paper",transition:"box-shadow 0.2s","&:hover":{boxShadow:4}},onClick:()=>t(o),"aria-label":`Edit question ${l+1}`,children:[e.jsx(S,{sx:{mr:1,display:"flex",alignItems:"center"},children:n?e.jsx(tt,{sx:{color:"success.main",fontSize:{xs:16,sm:18}},titleAccess:"Question complete"}):e.jsx(Pe,{sx:{color:"error.main",fontSize:{xs:16,sm:18}},titleAccess:"Question incomplete"})}),e.jsxs(Q,{variant:"subtitle1",sx:{flex:1},children:[l+1,". ",o.question||"Untitled Question"]}),e.jsx(Y,{label:o.difficulty,size:"small",color:o.difficulty==="easy"?"success":o.difficulty==="medium"?"warning":"error",sx:{mr:1}}),e.jsx(te,{size:"small",color:"error",onClick:x=>{x.stopPropagation(),r(o.id)},"aria-label":`Delete question ${l+1}`,children:e.jsx(be,{fontSize:"small"})})]},o.id)})})]}):e.jsx(ne,{elevation:0,sx:{textAlign:"center",py:6,border:2,borderStyle:"dashed",borderColor:"divider",bgcolor:"background.default"},children:e.jsxs(me,{children:[e.jsx(et,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(Q,{variant:"h6",gutterBottom:!0,children:"No Rounds Yet"}),e.jsx(Q,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Add your first round to begin creating your quiz structure."}),s&&e.jsx(M,{variant:"contained",size:"large",startIcon:e.jsx(ie,{}),onClick:s,sx:{mt:2},children:"Add Round"})]})}),Ts=({showActions:i,roundType:t,onOpenAIDialog:r,onOpenManualDialog:s})=>{if(!i||!t||t==="golden-pyramid")return null;const a=["mixed","single-answer-only","multiple-choice"].includes(t);return e.jsxs(S,{sx:{display:"flex",gap:1,mb:3},children:[a&&e.jsx(M,{variant:"outlined",startIcon:e.jsx(st,{}),onClick:r,"aria-label":"Generate question with AI",children:"AI Generate"}),e.jsx(M,{variant:"contained",startIcon:e.jsx(ie,{}),onClick:s,"aria-label":"Add question manually",children:"Add Question"})]})},Qs=({question:i,onUpdate:t,roundType:r="mixed"})=>{const s=se[r],a=async c=>{var C,f,j,k,R;const h=(C=c.target.files)==null?void 0:C[0];if(!h)return;const u={picture:["image/jpeg","image/jpg","image/png","image/webp","image/gif","image/bmp","image/tiff","image/svg+xml"],audio:["audio/mpeg","audio/mp3","audio/wav","audio/wave","audio/x-wav","audio/wma","audio/mp4","audio/m4a"],video:["video/mp4","video/webm","video/mov","video/quicktime","video/x-msvideo","video/avi","video/wmv"]},b=((f=h.name.split(".").pop())==null?void 0:f.toLowerCase())||"",g={picture:["jpg","jpeg","png","webp","gif","bmp","tiff","svg"],audio:["mp3","wav","wma","m4a"],video:["mp4","mov","wmv","avi","webm"]},z=i.type,A=(j=u[z])==null?void 0:j.includes(h.type),T=(k=g[z])==null?void 0:k.includes(b);if(!A&&!T){alert(`Unsupported file format. Supported formats: ${(R=g[z])==null?void 0:R.join(", ")}`);return}const d={picture:10*1024*1024,audio:20*1024*1024,video:100*1024*1024};if(h.size>d[z]){const m=d[z]/1048576;alert(`File too large. Maximum size for ${z} files is ${m}MB`);return}const y=new FileReader;y.onload=m=>{var D;const v={id:`media_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,filename:h.name,type:i.type==="picture"?"image":i.type==="audio"?"audio":"video",size:h.size,data:(D=m.target)==null?void 0:D.result,mimeType:h.type,createdAt:new Date};t({mediaFile:v})},y.readAsDataURL(h)},o=(c,h)=>{const u=[...i.possibleAnswers];u[c]=h,t({possibleAnswers:u})},l=()=>{i.possibleAnswers.length<20&&t({possibleAnswers:[...i.possibleAnswers,""]})},n=c=>{const h=i.type==="multiple-choice"?2:0;if(i.possibleAnswers.length>h){const u=i.possibleAnswers.filter((g,z)=>z!==c),b=i.correctAnswers.filter(g=>g!==c).map(g=>g>c?g-1:g);t({possibleAnswers:u,correctAnswers:b})}},x=c=>{const h=i.correctAnswers||[],u=h.includes(c);let b;u?b=h.filter(g=>g!==c):b=[...h,c].sort(),t({correctAnswers:b})},w=()=>{const c=["picture","audio","video"].includes(i.type),h=["picture","audio","video"].includes(r||"");if(!c&&!h)return null;const u=c?i.type:r;return e.jsxs(S,{sx:{mb:3},children:[e.jsx(Q,{variant:"subtitle2",gutterBottom:!0,children:"Media File"}),e.jsxs(M,{variant:"outlined",component:"label",sx:{mb:2},"aria-label":`Upload ${u} file`,children:["Upload"," ",u&&u.charAt(0).toUpperCase()+u.slice(1),e.jsx("input",{type:"file",accept:u==="picture"?".jpg,.jpeg,.png,.webp,.gif,.bmp,.tiff,.svg":u==="audio"?".mp3,.wav,.wma,.m4a":".mp4,.mov,.wmv,.avi,.webm",hidden:!0,onChange:a})]}),i.mediaFile&&e.jsxs(S,{sx:{mb:2},children:[u==="picture"&&e.jsx(S,{component:"img",src:i.mediaFile.data,alt:"Question media",sx:{maxWidth:"100%",width:"100%",maxHeight:{xs:200,sm:300,md:400},height:"auto",borderRadius:2,objectFit:"contain",border:"1px solid",borderColor:"divider"}}),u==="audio"&&e.jsx(S,{component:"audio",controls:!0,src:i.mediaFile.data,sx:{width:"100%",maxWidth:400,height:40}}),u==="video"&&e.jsx(S,{component:"video",controls:!0,src:i.mediaFile.data,sx:{maxWidth:"100%",width:"100%",maxHeight:{xs:200,sm:300,md:400},height:"auto",borderRadius:2,objectFit:"contain",border:"1px solid",borderColor:"divider"}}),e.jsxs(Q,{variant:"caption",display:"block",sx:{mt:1},children:[i.mediaFile.filename," (",(i.mediaFile.size/1024/1024).toFixed(2)," MB)"]}),e.jsx(M,{size:"small",color:"error",onClick:()=>t({mediaFile:void 0}),sx:{mt:1},children:"Remove File"})]})]})};return e.jsxs(Oe,{spacing:3,sx:{mt:1},children:[(r==="picture"||r==="audio"||r==="video")&&e.jsxs(_,{fullWidth:!0,children:[e.jsx($,{children:"Question Type"}),e.jsxs(B,{value:i.type,label:"Question Type",onChange:c=>{const h=c.target.value,u={type:h};h==="single-answer"?(u.possibleAnswers=[],u.correctAnswers=[],u.correctAnswerText=""):h==="multiple-choice"&&(u.possibleAnswers=["","","",""],u.correctAnswers=[0],u.correctAnswerText=void 0),t(u)},children:[e.jsx(F,{value:"single-answer",children:"Single Answer"}),e.jsx(F,{value:"multiple-choice",children:"Multiple Choice"})]})]}),r==="mixed"&&e.jsxs(_,{fullWidth:!0,children:[e.jsx($,{children:"Question Type"}),e.jsx(B,{value:i.type,label:"Question Type",onChange:c=>{const h=c.target.value,u={type:h};h==="single-answer"?(u.possibleAnswers=[],u.correctAnswers=[],u.correctAnswerText="",u.mediaFile=void 0):h==="multiple-choice"?(u.possibleAnswers=["","","",""],u.correctAnswers=[0],u.correctAnswerText=void 0,u.mediaFile=void 0):(u.possibleAnswers=[],u.correctAnswers=[],u.correctAnswerText=""),t(u)},children:s.allowedQuestionTypes.map(c=>e.jsxs(F,{value:c,children:[c==="single-answer"&&"Single Answer",c==="multiple-choice"&&"Multiple Choice",c==="picture"&&"Picture Question",c==="audio"&&"Audio Question",c==="video"&&"Video Question"]},c))})]}),e.jsx(N,{fullWidth:!0,label:"Question",multiline:!0,minRows:2,maxRows:4,value:i.question,onChange:c=>t({question:c.target.value}),placeholder:"Enter your question here..."}),w(),i.type==="single-answer"||["picture","audio","video"].includes(i.type)&&i.possibleAnswers.length===0?e.jsxs(S,{children:[e.jsxs(S,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(Q,{variant:"subtitle2",children:"Correct Answer"}),["picture","audio","video"].includes(i.type)&&e.jsx(M,{size:"small",variant:"outlined",onClick:()=>{t({possibleAnswers:["","","",""],correctAnswers:[0],correctAnswerText:void 0})},children:"Switch to Multiple Choice"})]}),e.jsx(N,{fullWidth:!0,label:"Type the correct answer",value:i.correctAnswerText||"",onChange:c=>t({correctAnswerText:c.target.value}),placeholder:"e.g., Sofia, Paris, 1969...",helperText:"This is the exact answer participants need to type"})]}):e.jsxs(S,{children:[e.jsxs(S,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(Q,{variant:"subtitle2",children:r==="golden-pyramid"?"Correct Answers":"Answer Options (1-20 options)"}),["picture","audio","video"].includes(i.type)&&r!=="golden-pyramid"&&e.jsx(M,{size:"small",variant:"outlined",onClick:()=>{t({possibleAnswers:[],correctAnswers:[],correctAnswerText:""})},children:"Switch to Single Answer"})]}),e.jsxs(Oe,{spacing:2,children:[i.possibleAnswers.map((c,h)=>e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:1},children:[r!=="golden-pyramid"&&e.jsx(Tt,{control:e.jsx(Qt,{checked:i.correctAnswers.includes(h),onChange:()=>x(h)}),label:""}),e.jsx(N,{fullWidth:!0,value:c,onChange:u=>o(h,u.target.value),placeholder:r==="golden-pyramid"?`Correct Answer (${h+1})`:`Enter option ${h+1}...`}),r!=="golden-pyramid"&&i.possibleAnswers.length>1&&e.jsx(te,{onClick:()=>n(h),color:"error",size:"small",children:e.jsx(be,{})})]},h)),r!=="golden-pyramid"&&i.possibleAnswers.length<20&&e.jsx(M,{startIcon:e.jsx(ie,{}),onClick:l,variant:"outlined",size:"small",children:"Add Option"})]}),r!=="golden-pyramid"&&i.correctAnswers.length===0&&e.jsx(Q,{variant:"caption",color:"error",children:"Please select at least one correct answer"})]}),e.jsxs(S,{sx:{display:"flex",gap:2,width:"100%",flexWrap:"nowrap",alignItems:"flex-start"},children:[e.jsx(N,{fullWidth:!0,type:"number",label:"Points",placeholder:"1",inputProps:{min:.1,step:.1},value:i.points||"",onChange:c=>t({points:Number(c.target.value)||1}),sx:{flex:1,minWidth:0}}),e.jsx(N,{fullWidth:!0,type:"number",label:"Time Limit (min)",placeholder:"1",inputProps:{min:.1,step:.1},value:i.timeLimit||"",onChange:c=>t({timeLimit:Number(c.target.value)||1}),sx:{flex:1,minWidth:0}}),e.jsxs(N,{fullWidth:!0,select:!0,label:"Difficulty",value:i.difficulty,onChange:c=>t({difficulty:c.target.value}),sx:{flex:1,minWidth:0},children:[e.jsx(F,{value:"easy",children:"Easy"}),e.jsx(F,{value:"medium",children:"Medium"}),e.jsx(F,{value:"hard",children:"Hard"})]})]}),e.jsx(N,{fullWidth:!0,label:"Explanation (optional)",multiline:!0,minRows:2,maxRows:3,value:i.explanation||"",onChange:c=>t({explanation:c.target.value}),placeholder:"Optional explanation shown after the question..."})]})},ks=i=>{const[t,r]=p.useState(0),[s,a]=p.useState(!1),[o,l]=p.useState("add"),[n,x]=p.useState(null),[w,c]=p.useState({description:"",type:"mixed",answerRevealMode:"after-all",defaultTimePerQuestion:i.defaultTimeLimit||1,breakingTime:5}),[h,u]=p.useState(!1),[b,g]=p.useState(null),[z,A]=p.useState(null),[T,d]=p.useState(!1),[y,C]=p.useState(!1),[f,j]=p.useState(""),[k,R]=p.useState(""),[m,v]=p.useState(!1),[D,q]=p.useState({questionType:"text-answer",language:"English",topicHint:"",category:"general",difficulty:"medium",optionsCount:4}),[U,K]=p.useState(!1),[we,O]=p.useState(!1),[ae,oe]=p.useState(null),le=i.rounds||[],ke=le[t]||null,Ie=w.type&&w.answerRevealMode&&w.defaultTimePerQuestion>=.1&&w.breakingTime>=.1;p.useEffect(()=>{s&&o==="edit"&&n?c({description:n.description||"",type:n.type,answerRevealMode:n.answerRevealMode,defaultTimePerQuestion:n.defaultTimePerQuestion,breakingTime:n.breakingTime||1}):s&&o==="add"&&c({description:"",type:"mixed",answerRevealMode:"after-all",defaultTimePerQuestion:i.defaultTimeLimit||1,breakingTime:5})},[s,o,n,i]);const Ee={setCurrentRoundIdx:r,goToPrevRound:p.useCallback(()=>{r(W=>Math.max(0,W-1))},[]),goToNextRound:p.useCallback(()=>{r(W=>Math.min(le.length-1,W+1))},[le.length]),openRoundModal:p.useCallback((W,fe)=>{l(W),x(fe||null),a(!0)},[]),closeRoundModal:p.useCallback(()=>{a(!1),x(null)},[]),updateRoundForm:p.useCallback((W,fe)=>{c(Me=>({...Me,[W]:fe}))},[]),openManualDialog:p.useCallback(()=>{u(!0)},[]),closeManualDialog:p.useCallback(()=>{u(!1),g(null)},[]),setManualQuestion:g,setEditingQuestionId:A,openAIDialog:p.useCallback(()=>{d(!0),R(""),v(!1)},[]),closeAIDialog:p.useCallback(()=>{d(!1)},[]),setAiGenerating:C,setAiStatus:j,setAiError:R,setAiErrorDismissed:v,setAiSettings:q,openDeleteRoundConfirm:p.useCallback(()=>{K(!0)},[]),closeDeleteRoundConfirm:p.useCallback(()=>{K(!1)},[]),openDeleteQuestionConfirm:p.useCallback(W=>{oe(W),O(!0)},[]),closeDeleteQuestionConfirm:p.useCallback(()=>{O(!1),oe(null)},[])};return{state:{currentRoundIdx:t,roundModalOpen:s,roundModalMode:o,editingRound:n,roundForm:w,manualDialogOpen:h,manualQuestion:b,editingQuestionId:z,aiDialogOpen:T,aiGenerating:y,aiStatus:f,aiError:k,aiErrorDismissed:m,aiSettings:D,deleteRoundConfirmOpen:U,deleteQuestionConfirmOpen:we,pendingDeleteQuestionId:ae},actions:Ee,derived:{rounds:le,currentRound:ke,isRoundFormValid:Ie}}},Is=({draftQuiz:i,updateDraft:t,showValidation:r})=>{const{state:s,actions:a,derived:o}=ks(i),{rounds:l,currentRound:n,isRoundFormValid:x}=o,w=[{value:"mixed",label:"Mixed Types"},{value:"single-answer-only",label:"Single Answer Only"},{value:"multiple-choice",label:"Multiple Choice"},{value:"picture",label:"Picture Round"},{value:"audio",label:"Audio Round"},{value:"video",label:"Video Round"},{value:"golden-pyramid",label:"Golden Pyramid"}],c=[{value:"after-each",label:"After Each Question"},{value:"after-all",label:"After All Questions"}],h=()=>{var D,q,U;if(!x)return;const m=s.roundModalMode==="add"?l.length:s.currentRoundIdx,v={id:((D=s.editingRound)==null?void 0:D.id)||`round_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:`Round ${m+1}`,description:s.roundForm.description,type:s.roundForm.type,answerRevealMode:s.roundForm.answerRevealMode,defaultTimePerQuestion:Number(s.roundForm.defaultTimePerQuestion),breakingTime:Number(s.roundForm.breakingTime),level:i.difficulty||"medium",questions:((q=s.editingRound)==null?void 0:q.questions)||[],createdAt:((U=s.editingRound)==null?void 0:U.createdAt)||new Date,updatedAt:new Date};if(s.roundForm.type==="golden-pyramid"&&v.questions.length===0){const K=Array.from({length:4},(we,O)=>({id:`question_${Date.now()}_${O}_${Math.random().toString(36).substr(2,9)}`,type:"multiple-choice",question:`Golden Pyramid Question ${O+1}`,possibleAnswers:Array.from({length:O+1},()=>""),correctAnswers:Array.from({length:O+1},(ae,oe)=>oe),correctAnswerText:"",explanation:"",mediaFile:void 0,difficulty:i.difficulty||"medium",points:1,timeLimit:Number(s.roundForm.defaultTimePerQuestion),createdAt:new Date,updatedAt:new Date}));v.questions=K}T(v)},u=E.useCallback(()=>e.jsxs(G,{open:s.aiDialogOpen,onClose:a.closeAIDialog,maxWidth:"sm",fullWidth:!0,children:[e.jsx(X,{children:e.jsxs(S,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(st,{color:"primary"}),"Generate AI Question"]})}),e.jsx(V,{children:e.jsxs(Oe,{spacing:3,sx:{mt:1},children:[(s.aiGenerating||s.aiStatus)&&e.jsx(re,{severity:"info",icon:s.aiGenerating?e.jsx(kt,{size:20}):void 0,children:s.aiStatus||"Generating question..."}),s.aiError&&!s.aiErrorDismissed&&e.jsx(re,{severity:"error",action:e.jsx(te,{size:"small",onClick:()=>a.setAiErrorDismissed(!0),"aria-label":"Dismiss error",children:e.jsx(Te,{fontSize:"small"})}),children:s.aiError}),(n==null?void 0:n.type)==="mixed"&&e.jsxs(_,{fullWidth:!0,children:[e.jsx($,{children:"Question Type"}),e.jsxs(B,{value:s.aiSettings.questionType||"text-answer",onChange:m=>a.setAiSettings({...s.aiSettings,questionType:m.target.value}),label:"Question Type",children:[e.jsx(F,{value:"text-answer",children:e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(It,{fontSize:"small"}),"Single Answer"]})}),e.jsx(F,{value:"text",children:e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Et,{fontSize:"small"}),"Multiple Choice"]})})]})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx($,{children:"Language"}),e.jsxs(B,{value:s.aiSettings.language||"English",onChange:m=>a.setAiSettings({...s.aiSettings,language:m.target.value}),label:"Language",children:[e.jsx(F,{value:"English",children:"English"}),e.jsx(F,{value:"Bulgarian",children:"Bulgarian"})]})]}),e.jsx(N,{fullWidth:!0,label:"Topic (optional)",placeholder:"e.g., Ancient Rome, Quantum Physics, Football...",value:s.aiSettings.topicHint||"",onChange:m=>a.setAiSettings({...s.aiSettings,topicHint:m.target.value}),helperText:"Leave empty for random topic"}),e.jsxs(_,{fullWidth:!0,children:[e.jsx($,{children:"Category"}),e.jsxs(B,{value:s.aiSettings.category||"general",onChange:m=>a.setAiSettings({...s.aiSettings,category:m.target.value}),label:"Category",children:[e.jsx(F,{value:"general",children:"General Knowledge"}),e.jsx(F,{value:"science",children:"Science"}),e.jsx(F,{value:"history",children:"History"}),e.jsx(F,{value:"geography",children:"Geography"}),e.jsx(F,{value:"sports",children:"Sports"}),e.jsx(F,{value:"entertainment",children:"Entertainment"}),e.jsx(F,{value:"literature",children:"Literature"}),e.jsx(F,{value:"art",children:"Art"}),e.jsx(F,{value:"music",children:"Music"}),e.jsx(F,{value:"technology",children:"Technology"})]})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx($,{children:"Difficulty"}),e.jsxs(B,{value:s.aiSettings.difficulty||"medium",onChange:m=>a.setAiSettings({...s.aiSettings,difficulty:m.target.value}),label:"Difficulty",children:[e.jsx(F,{value:"easy",children:"Easy"}),e.jsx(F,{value:"medium",children:"Medium"}),e.jsx(F,{value:"hard",children:"Hard"})]})]}),(s.aiSettings.questionType==="text"||(n==null?void 0:n.type)==="multiple-choice"&&n.type!=="mixed")&&e.jsxs(_,{fullWidth:!0,children:[e.jsx($,{children:"Number of Options"}),e.jsxs(B,{value:s.aiSettings.optionsCount||4,onChange:m=>a.setAiSettings({...s.aiSettings,optionsCount:Number(m.target.value)}),label:"Number of Options",children:[e.jsx(F,{value:2,children:"2 Options"}),e.jsx(F,{value:3,children:"3 Options"}),e.jsx(F,{value:4,children:"4 Options"}),e.jsx(F,{value:5,children:"5 Options"}),e.jsx(F,{value:6,children:"6 Options"})]})]}),Ye()&&e.jsx(S,{sx:{p:2,bgcolor:"background.paper",borderRadius:1},children:e.jsxs(Q,{variant:"body2",color:"text.secondary",children:["AI questions remaining:"," ",zs().requestsRemaining,"/15 per minute"]})})]})}),e.jsxs(ee,{children:[e.jsx(M,{onClick:a.closeAIDialog,children:"Cancel"}),e.jsx(M,{onClick:async()=>{a.setAiGenerating(!0),a.setAiError(null),a.setAiErrorDismissed(!1);try{let m=s.aiSettings.questionType;(n==null?void 0:n.type)==="single-answer-only"?m="text-answer":(n==null?void 0:n.type)==="multiple-choice"&&(m="text");const v=await ps({questionType:m||"text-answer",language:s.aiSettings.language||"English",topicHint:s.aiSettings.topicHint,category:s.aiSettings.category||"general",difficulty:s.aiSettings.difficulty||"medium",optionsCount:s.aiSettings.optionsCount||4});if(v.success&&v.question){const D={...v.question,id:`q_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,difficulty:s.aiSettings.difficulty||"medium",points:1,timeLimit:(n==null?void 0:n.defaultTimePerQuestion)||1,createdAt:new Date,updatedAt:new Date},q={...n,questions:[...(n==null?void 0:n.questions)||[],D],updatedAt:new Date};t({rounds:l.map((U,K)=>K===s.currentRoundIdx?q:U)}),a.setAiStatus("Question generated successfully!"),setTimeout(()=>{a.closeAIDialog(),a.setAiStatus(null)},1500)}else a.setAiError(v.error||"Failed to generate question")}catch(m){a.setAiError(m instanceof Error?m.message:"Unknown error occurred")}finally{a.setAiGenerating(!1)}},variant:"contained",disabled:s.aiGenerating||!Ye(),children:s.aiGenerating?"Generating...":"Generate"})]})]}),[s.aiDialogOpen,s.aiGenerating,s.aiStatus,s.aiError,s.aiErrorDismissed,s.aiSettings,n,l,s.currentRoundIdx,a,t]),b=()=>{if(!n)return;const m=se[n.type];let v;n.type==="picture"?v="picture":n.type==="audio"?v="audio":n.type==="video"?v="video":m.canSelectQuestionType?v="single-answer":v=m.allowedQuestionTypes[0];let D;v==="single-answer"?D={possibleAnswers:[],correctAnswers:[],correctAnswerText:""}:v==="multiple-choice"?D={possibleAnswers:["","","",""],correctAnswers:[0],correctAnswerText:void 0}:["picture","audio","video"].includes(v)?D={possibleAnswers:[],correctAnswers:[],correctAnswerText:""}:D={possibleAnswers:[""],correctAnswers:[0],correctAnswerText:void 0},a.setManualQuestion({id:`q_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:v,question:"",...D,explanation:"",mediaFile:void 0,difficulty:i.difficulty||"medium",points:1,timeLimit:n.defaultTimePerQuestion||1,createdAt:new Date,updatedAt:new Date}),a.openManualDialog()},g=s.manualQuestion&&s.manualQuestion.question.trim()&&(s.manualQuestion.type==="single-answer"||["picture","audio","video"].includes(s.manualQuestion.type)?s.manualQuestion.correctAnswerText&&s.manualQuestion.correctAnswerText.trim():(n==null?void 0:n.type)==="golden-pyramid"?s.manualQuestion.possibleAnswers.length>0&&s.manualQuestion.possibleAnswers.some(m=>m.trim()):s.manualQuestion.possibleAnswers.length>=2&&s.manualQuestion.possibleAnswers.every(m=>m.trim())&&s.manualQuestion.correctAnswers.length>0),z=()=>{a.openRoundModal("add")},A=()=>{a.openRoundModal("edit",n||void 0)},T=m=>{s.roundModalMode==="add"?(t({rounds:[...l,m]}),a.setCurrentRoundIdx(l.length)):s.roundModalMode==="edit"&&n&&t({rounds:l.map((v,D)=>D===s.currentRoundIdx?m:v)}),a.closeRoundModal()},d=()=>{if(s.roundModalMode==="edit"&&s.editingRound){if(s.editingRound.type==="golden-pyramid")return[{value:"golden-pyramid",label:"Golden Pyramid"}];if(s.editingRound.questions.length>0)return[{value:s.editingRound.type,label:se[s.editingRound.type].label},{value:"mixed",label:"Mixed Types"}].filter((m,v,D)=>v===D.findIndex(q=>q.value===m.value))}return w.filter(m=>s.roundModalMode==="add"||m.value!=="golden-pyramid")},y=()=>{a.openDeleteRoundConfirm()},C=()=>{if(!n)return;const m=l.filter((v,D)=>D!==s.currentRoundIdx);t({rounds:m}),a.setCurrentRoundIdx(Math.max(0,s.currentRoundIdx-1)),a.closeDeleteRoundConfirm()},f=()=>a.closeDeleteRoundConfirm(),j=m=>{a.openDeleteQuestionConfirm(m)},k=()=>{var D;if(!n||!s.pendingDeleteQuestionId)return;const m=n.questions.filter(q=>q.id!==s.pendingDeleteQuestionId),v={...n,questions:m,updatedAt:new Date};t({rounds:l.map((q,U)=>U===s.currentRoundIdx?v:q)}),s.editingQuestionId===s.pendingDeleteQuestionId&&a.setEditingQuestionId(null),((D=s.manualQuestion)==null?void 0:D.id)===s.pendingDeleteQuestionId&&a.closeManualDialog(),a.closeDeleteQuestionConfirm()},R=()=>{a.closeDeleteQuestionConfirm()};return e.jsxs(S,{sx:{maxWidth:1e3,mx:"auto"},children:[e.jsx(Cs,{rounds:l,currentRoundIdx:s.currentRoundIdx,currentRound:n,onPreviousRound:a.goToPrevRound,onNextRound:a.goToNextRound,onAddRound:z,onEditRound:A,onDeleteRound:y}),n&&!se[n.type].canSelectQuestionType&&e.jsx(re,{severity:"info",sx:{mb:2},children:e.jsxs(Q,{variant:"body2",children:[e.jsxs("strong",{children:[se[n.type].label,":"]})," ",se[n.type].description,n.type==="golden-pyramid"&&e.jsxs("span",{children:[" ","- This round auto-generates 4 pre-configured questions with 1, 2, 3, and 4 correct answers respectively."]})]})}),e.jsx(Ts,{showActions:!!n,roundType:n==null?void 0:n.type,onOpenAIDialog:a.openAIDialog,onOpenManualDialog:b}),e.jsx(Ds,{currentRound:n,onEditQuestion:m=>{a.setManualQuestion(m),a.openManualDialog()},onDeleteQuestion:j,onAddRound:z,onAddQuestion:b}),u(),e.jsxs(G,{open:s.manualDialogOpen,onClose:a.closeManualDialog,maxWidth:"sm",fullWidth:!0,children:[e.jsx(X,{children:s.manualQuestion&&(n!=null&&n.questions.some(m=>{var v;return m.id===((v=s.manualQuestion)==null?void 0:v.id)}))?`Edit ${n?(()=>{const m=se[n.type].label;return m.includes("Question")?m:`${m} Question`})():"Question"}`:`Add ${n?(()=>{const m=se[n.type].label;return m.includes("Question")?m:`${m} Question`})():"Question"}`}),e.jsx(V,{children:s.manualQuestion&&e.jsx(Qs,{question:s.manualQuestion,roundType:n==null?void 0:n.type,onUpdate:m=>a.setManualQuestion(s.manualQuestion?{...s.manualQuestion,...m,updatedAt:new Date}:null)})}),e.jsxs(ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:3,py:2},children:[s.manualQuestion&&(n==null?void 0:n.questions.some(m=>{var v;return m.id===((v=s.manualQuestion)==null?void 0:v.id)}))&&e.jsx(te,{onClick:()=>{var m;(m=s.manualQuestion)!=null&&m.id&&j(s.manualQuestion.id)},color:"error",sx:{bgcolor:"error.50","&:hover":{bgcolor:"error.100"}},"aria-label":"Delete question",children:e.jsx(be,{})}),!(s.manualQuestion&&(n!=null&&n.questions.some(m=>{var v;return m.id===((v=s.manualQuestion)==null?void 0:v.id)})))&&e.jsx(S,{}),e.jsxs(S,{sx:{display:"flex",gap:1},children:[e.jsx(M,{onClick:a.closeManualDialog,children:"Cancel"}),e.jsx(M,{onClick:()=>{if(s.manualQuestion){if(n!=null&&n.questions.some(m=>{var v;return m.id===((v=s.manualQuestion)==null?void 0:v.id)})){const m=n.questions.map(D=>{var q;return D.id===((q=s.manualQuestion)==null?void 0:q.id)?s.manualQuestion:D}),v={...n,questions:m,updatedAt:new Date};t({rounds:l.map((D,q)=>q===s.currentRoundIdx?v:D)})}else{const m={...n,questions:[...(n==null?void 0:n.questions)||[],s.manualQuestion],updatedAt:new Date};t({rounds:l.map((v,D)=>D===s.currentRoundIdx?m:v)})}a.closeManualDialog()}},variant:"contained",disabled:!g,children:"Save"})]})]})]}),e.jsxs(G,{open:s.roundModalOpen,onClose:a.closeRoundModal,maxWidth:"sm",fullWidth:!0,children:[e.jsx(X,{children:s.roundModalMode==="add"?"Add Round":"Edit Round"}),e.jsx(V,{children:e.jsxs(S,{component:"form",sx:{display:"flex",flexDirection:"column",gap:3,mt:1},children:[e.jsxs(_,{fullWidth:!0,required:!0,children:[e.jsx($,{children:"Round Type"}),e.jsx(B,{value:s.roundForm.type,label:"Round Type",onChange:m=>a.updateRoundForm("type",m.target.value),"aria-label":"Round type",children:d().map(m=>e.jsx(F,{value:m.value,children:m.label},m.value))})]}),e.jsxs(_,{fullWidth:!0,required:!0,children:[e.jsx($,{children:"Answer Reveal Mode"}),e.jsx(B,{value:s.roundForm.answerRevealMode,label:"Answer Reveal Mode",onChange:m=>a.updateRoundForm("answerRevealMode",m.target.value),"aria-label":"Answer reveal mode",children:c.map(m=>e.jsx(F,{value:m.value,children:m.label},m.value))})]}),e.jsxs(S,{children:[e.jsx(Q,{gutterBottom:!0,children:"Default Time Per Question (minutes)"}),e.jsx(N,{type:"number",fullWidth:!0,label:"Minutes",inputProps:{min:.1,max:10,step:.1},value:s.roundForm.defaultTimePerQuestion,onChange:m=>{let v=Number(m.target.value);v<.1&&(v=.1),v>10&&(v=10),a.updateRoundForm("defaultTimePerQuestion",v)},helperText:"Time limit per question (0.5 = 30 seconds, 1 = 60 seconds)","aria-label":"Default time per question in minutes"})]}),e.jsxs(S,{children:[e.jsx(Q,{gutterBottom:!0,children:"Breaking Time (minutes)"}),e.jsx(N,{type:"number",fullWidth:!0,label:"Minutes",placeholder:"5",inputProps:{min:.1,max:10,step:.1},value:s.roundForm.breakingTime||"",onChange:m=>{let v=Number(m.target.value)||5;v<.1&&(v=.1),v>10&&(v=10),a.updateRoundForm("breakingTime",v)},helperText:"Break time between rounds (default 5 minutes)","aria-label":"Breaking time between rounds in minutes"})]}),e.jsx(N,{label:"Round Description (Optional)",value:s.roundForm.description,onChange:m=>a.updateRoundForm("description",m.target.value),fullWidth:!0,multiline:!0,minRows:2,maxRows:4,inputProps:{maxLength:120},"aria-label":"Round description",helperText:"Optional description for this round"})]})}),e.jsxs(ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:3,py:2},children:[s.roundModalMode==="edit"&&l.length>0&&e.jsx(te,{onClick:y,color:"error",sx:{bgcolor:"error.50","&:hover":{bgcolor:"error.100"}},"aria-label":"Delete round",children:e.jsx(be,{})}),s.roundModalMode==="add"&&e.jsx(S,{}),e.jsxs(S,{sx:{display:"flex",gap:1},children:[e.jsx(M,{onClick:a.closeRoundModal,children:"Cancel"}),e.jsx(M,{onClick:h,variant:"contained",disabled:!x,children:"Save"})]})]})]}),r&&l.some(m=>m.questions.length===0)&&e.jsx(re,{severity:"error",sx:{mt:2},children:"Each round must have at least one question to proceed."}),e.jsxs(G,{open:s.deleteRoundConfirmOpen,onClose:f,"aria-labelledby":"delete-round-dialog-title","aria-describedby":"delete-round-dialog-description",children:[e.jsx(X,{id:"delete-round-dialog-title",children:"Confirm Delete Round"}),e.jsx(V,{children:e.jsx(Ne,{id:"delete-round-dialog-description",children:"Are you sure you want to delete this round? All questions in this round will be lost. This action cannot be undone."})}),e.jsxs(ee,{children:[e.jsx(M,{onClick:f,color:"primary",autoFocus:!0,children:"Cancel"}),e.jsx(M,{onClick:C,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsxs(G,{open:s.deleteQuestionConfirmOpen,onClose:R,"aria-labelledby":"delete-question-dialog-title","aria-describedby":"delete-question-dialog-description",children:[e.jsx(X,{id:"delete-question-dialog-title",children:"Confirm Delete Question"}),e.jsx(V,{children:e.jsx(Ne,{id:"delete-question-dialog-description",children:"Are you sure you want to delete this question? This action cannot be undone."})}),e.jsxs(ee,{children:[e.jsx(M,{onClick:R,color:"primary",autoFocus:!0,children:"Cancel"}),e.jsx(M,{onClick:k,color:"error",variant:"contained",children:"Delete"})]})]})]})},Es=({onQuizCreated:i,onCancel:t,editQuiz:r})=>{var k,R,m,v;const{mode:s,handleThemeChange:a}=$t(),[o,l]=p.useState(!0),[n,x]=p.useState(!1),[w,c]=p.useState(!1),{draftQuiz:h,updateDraft:u,resetWizard:b,completeWizard:g}=ss(r),z=((k=h.rounds)==null?void 0:k.flatMap(D=>D.questions).length)||0,A=((R=h.rounds)==null?void 0:R.length)||0,T=!!((m=h.title)!=null&&m.trim()),d=p.useCallback(()=>{h.title||z>0?setTimeout(()=>{t()},100):t()},[h.title,z,t]),y=p.useCallback(()=>{l(!0);const D=document.querySelector('[data-testid="wizard-content"]');D&&D.scrollTo({top:0,behavior:"smooth"})},[]),C=p.useCallback(()=>{T&&x(!0)},[T]),f=p.useCallback(async()=>{c(!0);try{const D=await g();i(D),b(),x(!1),t()}catch(D){console.error("Error saving quiz:",D)}finally{c(!1)}},[g,i,b,t]),j=p.useCallback(()=>{x(!1)},[]);return e.jsx(is,{fallback:e.jsx(G,{open:!0,fullScreen:!0,children:e.jsx(V,{sx:{display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.default"},children:e.jsxs(Q,{variant:"h6",color:"error",textAlign:"center",children:["Something went wrong in the quiz wizard.",e.jsx("br",{}),"Please refresh the page and try again."]})})}),children:e.jsxs(G,{open:!0,onClose:d,fullScreen:!0,PaperProps:{sx:{bgcolor:"background.default",backgroundImage:"none",display:"flex",flexDirection:"column",height:"100vh"}},TransitionComponent:je,transitionDuration:300,children:[e.jsx(S,{sx:{zIndex:1400,position:"relative"},children:e.jsx(Bt,{mode:s,onThemeChange:a})}),e.jsx(V,{"data-testid":"wizard-content",sx:{flex:1,p:0,display:"flex",flexDirection:"column",overflow:"auto"},children:e.jsxs(S,{sx:{maxWidth:1200,mx:"auto",width:"100%",px:{xs:2,sm:3,md:4},py:{xs:2,sm:3}},children:[o&&e.jsxs(S,{sx:{mb:4},children:[e.jsx(Q,{variant:"h4",gutterBottom:!0,fontWeight:600,children:"Quiz Details"}),e.jsx(ls,{draftQuiz:h,updateDraft:u,validation:{isValid:!0,errors:[],warnings:[]}}),e.jsx(S,{sx:{mt:3,textAlign:"center"},children:e.jsx(M,{variant:"contained",onClick:()=>l(!1),disabled:!((v=h.title)!=null&&v.trim()),size:"large",children:"Continue to Questions"})})]}),!o&&e.jsx(S,{children:e.jsx(Is,{draftQuiz:h,updateDraft:u,showValidation:!1})})]})}),!o&&e.jsxs(S,{sx:{position:"fixed",bottom:{xs:16,sm:24},right:{xs:16,sm:24},display:"flex",flexDirection:"row",gap:2,zIndex:1300},children:[e.jsx(S,{sx:{display:{xs:"block",sm:"none"}},children:e.jsx(xe,{color:"secondary",onClick:y,sx:{boxShadow:3,"&:hover":{boxShadow:6}},children:e.jsx(ye,{})})}),e.jsx(S,{sx:{display:{xs:"none",sm:"block"}},children:e.jsx(M,{variant:"contained",color:"secondary",onClick:y,startIcon:e.jsx(ye,{}),sx:{boxShadow:3,"&:hover":{boxShadow:6},minWidth:120,height:56},children:"Edit Quiz"})}),e.jsx(S,{sx:{display:{xs:"block",sm:"none"}},children:e.jsx(xe,{color:"primary",onClick:C,disabled:!T,sx:{boxShadow:3,"&:hover":{boxShadow:6},"&.Mui-disabled":{bgcolor:"action.disabled"}},children:e.jsx(Re,{})})}),e.jsx(S,{sx:{display:{xs:"none",sm:"block"}},children:e.jsx(M,{variant:"contained",color:"primary",onClick:C,disabled:!T,startIcon:e.jsx(Re,{}),sx:{boxShadow:3,"&:hover":{boxShadow:6},"&.Mui-disabled":{bgcolor:"action.disabled"},minWidth:120,height:56},children:"Save Quiz"})})]}),e.jsxs(G,{open:n,onClose:j,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2,boxShadow:24}},children:[e.jsxs(X,{sx:{display:"flex",alignItems:"center",gap:2,pb:2},children:[e.jsx(tt,{color:"success"}),e.jsx(Q,{variant:"h6",fontWeight:600,children:"Save Quiz"})]}),e.jsxs(V,{sx:{pb:2},children:[e.jsx(ne,{variant:"outlined",sx:{mb:3,bgcolor:"background.paper",border:"1px solid",borderColor:"divider"},children:e.jsxs(me,{children:[e.jsx(Q,{variant:"h6",gutterBottom:!0,fontWeight:600,children:h.title}),h.description&&e.jsx(Q,{variant:"body2",color:"text.secondary",paragraph:!0,sx:{mb:2},children:h.description}),e.jsxs(S,{sx:{display:"flex",gap:1,flexWrap:"wrap",mb:2},children:[e.jsx(Y,{icon:e.jsx(_e,{}),label:h.category||"General",size:"small",variant:"outlined"}),e.jsx(Y,{icon:e.jsx(Mt,{}),label:`${A} Round${A!==1?"s":""}`,size:"small",variant:"filled",color:"secondary"}),e.jsx(Y,{icon:e.jsx(et,{}),label:`${z} Question${z!==1?"s":""}`,size:"small",variant:"filled",color:"primary"})]}),e.jsx(rt,{sx:{my:2}}),e.jsxs(Q,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Difficulty:"})," ",h.difficulty||"Not set"]})]})}),e.jsx(Q,{variant:"body2",color:"text.secondary",textAlign:"center",children:"Are you ready to save this quiz? You can always edit it later."})]}),e.jsxs(ee,{sx:{px:3,pb:3,gap:1},children:[e.jsx(M,{onClick:j,variant:"outlined",disabled:w,children:"Cancel"}),e.jsx(M,{onClick:f,variant:"contained",disabled:w,startIcon:w?null:e.jsx(Re,{}),children:w?"Saving...":"Save Quiz"})]})]})]})})},Ms=({selectedQuiz:i,menuAnchorEl:t,editingQuiz:r,isWizardOpen:s,deleteConfirmOpen:a,pendingDeleteQuiz:o,onMenuClose:l,onEditQuiz:n,onExportQuiz:x,onRequestDeleteQuiz:w,onConfirmDeleteQuiz:c,onCancelDeleteQuiz:h,onCreateQuiz:u,onWizardCancel:b,onQuizCreated:g})=>{const z=E.useCallback(()=>{i&&n(i)},[i,n]),A=E.useCallback(()=>{i&&x(i)},[i,x]),T=E.useCallback(()=>{i&&w(i)},[i,w]);return e.jsxs(e.Fragment,{children:[e.jsxs(Ft,{anchorEl:t,open:!!t,onClose:l,transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[e.jsxs(F,{onClick:z,children:[e.jsx(ze,{children:e.jsx(ye,{fontSize:"small"})}),e.jsx(Ce,{children:"Edit Quiz"})]}),e.jsxs(F,{onClick:A,children:[e.jsx(ze,{children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(Ce,{children:"Export to PowerPoint"})]}),e.jsxs(F,{onClick:T,sx:{color:"error.main"},children:[e.jsx(ze,{children:e.jsx(be,{fontSize:"small",color:"error"})}),e.jsx(Ce,{children:"Delete Quiz"})]})]}),e.jsx(xe,{color:"primary","aria-label":"Create new quiz",onClick:u,sx:{position:"fixed",bottom:80,right:24,zIndex:1e3},children:e.jsx(ie,{})}),s&&e.jsx(Es,{onQuizCreated:g,onCancel:b,editQuiz:r||void 0}),e.jsxs(G,{open:a,onClose:h,"aria-labelledby":"delete-quiz-dialog-title","aria-describedby":"delete-quiz-dialog-description",children:[e.jsx(X,{id:"delete-quiz-dialog-title",children:"Confirm Delete"}),e.jsx(V,{children:e.jsx(Ne,{id:"delete-quiz-dialog-description",children:"Are you sure you want to delete this quiz? This action cannot be undone."})}),e.jsxs(ee,{children:[e.jsx(M,{onClick:h,color:"primary",autoFocus:!0,children:"Cancel"}),e.jsx(M,{onClick:c,color:"error",variant:"contained",children:"Delete"})]})]})]})},Fs=({open:i,onClose:t,storageUsage:r,quizzes:s,draftsCount:a,onCleanupStorage:o,onRefreshStorage:l})=>{const n=Rt(),x=Lt(n.breakpoints.down("sm")),[w,c]=p.useState(!1),h=d=>{if(d===0)return"0 B";const y=1024,C=["B","KB","MB","GB"],f=Math.floor(Math.log(d)/Math.log(y));return`${parseFloat((d/Math.pow(y,f)).toFixed(1))} ${C[f]}`},u=p.useMemo(()=>s.map(d=>{var R,m,v;const C=(((R=d.rounds)==null?void 0:R.length)||0)*512,f=(((m=d.title)==null?void 0:m.length)||0)*2,j=(((v=d.description)==null?void 0:v.length)||0)*2,k=1024+C+f+j;return{...d,estimatedSize:k}}),[s]),b=()=>{c(!0)},g=()=>{o(),c(!1),t()},z=()=>{c(!1)},A=(r==null?void 0:r.percentageUsed)||0,T=(r==null?void 0:r.isNearLimit)||!1;return e.jsxs(e.Fragment,{children:[e.jsxs(G,{open:i,onClose:t,maxWidth:"md",fullWidth:!0,fullScreen:x,TransitionComponent:Ze,transitionDuration:300,PaperProps:{sx:{borderRadius:x?0:3,maxHeight:x?"100%":"90vh"}},children:[e.jsxs(X,{sx:{background:`linear-gradient(135deg, ${n.palette.primary.main}, ${n.palette.primary.dark})`,color:"white",textAlign:"center",position:"relative",py:3},children:[e.jsxs(S,{display:"flex",alignItems:"center",justifyContent:"center",gap:2,children:[e.jsx(it,{sx:{fontSize:28}}),e.jsx(Q,{variant:"h5",component:"div",fontWeight:"bold",children:"Storage"})]}),e.jsx(te,{onClick:t,sx:{position:"absolute",right:8,top:8,color:"white",bgcolor:"rgba(255,255,255,0.1)","&:hover":{bgcolor:"rgba(255,255,255,0.2)"}},children:e.jsx(Te,{})})]}),e.jsxs(V,{sx:{p:0},children:[e.jsxs(S,{sx:{p:3,bgcolor:"background.default"},children:[e.jsxs(S,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(qt,{color:"primary"}),e.jsx(Q,{variant:"h6",fontWeight:"600",children:"Current Usage"})]}),r&&e.jsx(je,{in:!0,timeout:500,children:e.jsxs(S,{children:[e.jsxs(S,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[e.jsxs(Q,{variant:"body2",color:"text.secondary",children:[h(r.totalSize)," / 500 MB"]}),e.jsxs(Q,{variant:"body2",fontWeight:"600",color:T?"warning.main":"text.primary",children:[A.toFixed(1),"% used"]})]}),e.jsx(Pt,{variant:"determinate",value:Math.min(A,100),color:T?"warning":"primary",sx:{height:12,borderRadius:6,bgcolor:"rgba(0,0,0,0.1)","& .MuiLinearProgress-bar":{borderRadius:6,background:T?`linear-gradient(90deg, ${n.palette.warning.main}, ${n.palette.warning.dark})`:`linear-gradient(90deg, ${n.palette.primary.main}, ${n.palette.primary.dark})`}}}),T&&e.jsx(re,{severity:"warning",icon:e.jsx(Pe,{}),sx:{mt:2,borderRadius:2},children:"Storage is nearly full. Consider cleaning up old quizzes."})]})})]}),e.jsx(rt,{}),e.jsxs(S,{sx:{p:3},children:[e.jsxs(S,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(De,{color:"primary"}),e.jsx(Q,{variant:"h6",fontWeight:"600",children:"Quiz Storage"}),e.jsx(Y,{label:`${u.length} items`,size:"small",color:"primary",variant:"outlined"})]}),u.length===0?e.jsx(S,{textAlign:"center",py:4,children:e.jsx(Q,{variant:"body2",color:"text.secondary",children:"No quizzes found"})}):e.jsx(Ot,{sx:{maxHeight:300,overflow:"auto"},children:u.map((d,y)=>{var C;return e.jsx(je,{in:!0,timeout:300+y*100,children:e.jsxs(Nt,{sx:{borderRadius:2,mb:1,bgcolor:"background.paper",border:1,borderColor:"divider","&:hover":{bgcolor:"action.hover"}},children:[e.jsx(ze,{children:d.isDraft?e.jsx(ye,{color:"secondary"}):e.jsx(De,{color:"primary"})}),e.jsx(Ce,{primary:e.jsxs(S,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Q,{variant:"body1",noWrap:!0,children:d.title}),d.isDraft&&e.jsx(Y,{label:"Draft",size:"small",color:"secondary",variant:"outlined"})]}),secondary:e.jsxs(Q,{variant:"caption",color:"text.secondary",children:[((C=d.rounds)==null?void 0:C.length)||0," rounds â€¢ Created"," ",new Date(d.createdAt).toLocaleDateString()]})}),e.jsx(Q,{variant:"body2",fontWeight:"600",color:"primary.main",children:h(d.estimatedSize)})]})},d.id)})})]})]}),e.jsxs(ee,{sx:{p:3,bgcolor:"background.default",borderTop:1,borderColor:"divider",gap:2},children:[e.jsx(M,{onClick:b,startIcon:e.jsx(Wt,{}),color:"error",variant:"outlined",disabled:u.length===0,sx:{borderRadius:2,textTransform:"none",fontWeight:600},children:"Clear All Storage"}),e.jsx(S,{sx:{flex:1}}),e.jsx(M,{onClick:t,variant:"contained",sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:4},children:"OK"})]})]}),e.jsxs(G,{open:w,onClose:z,maxWidth:"sm",fullWidth:!0,TransitionComponent:je,children:[e.jsxs(X,{sx:{textAlign:"center",pt:3},children:[e.jsx(Pe,{sx:{fontSize:48,color:"warning.main",mb:2}}),e.jsx(Q,{variant:"h6",fontWeight:"600",children:"Clear All Storage"})]}),e.jsxs(V,{sx:{textAlign:"center",pb:2},children:[e.jsxs(Q,{variant:"body1",color:"text.secondary",children:["Are you sure you want to clear all quiz storage? This will permanently delete ",e.jsx("strong",{children:"ALL quizzes and drafts"})," from your device."]}),e.jsx(Q,{variant:"body2",color:"error.main",sx:{mt:2,fontWeight:600},children:"This action cannot be undone."})]}),e.jsxs(ee,{sx:{p:3,gap:2},children:[e.jsx(M,{onClick:z,variant:"outlined",sx:{borderRadius:2,textTransform:"none",fontWeight:600},autoFocus:!0,children:"Cancel"}),e.jsx(M,{onClick:g,color:"error",variant:"contained",sx:{borderRadius:2,textTransform:"none",fontWeight:600},children:"Clear All Storage"})]})]})]})},Ke={includePresenterNotes:!0,slideTemplate:"standard",questionFontSize:24,optionFontSize:18,includeMetadata:!0,includeAnswerKey:!0,compressImages:!0,imageQuality:85},Rs=()=>{const[i,t]=p.useState(!1),[r,s]=p.useState(null),a=p.useCallback(async(n,x=Ke)=>{t(!0),s(null);try{const w=(await Gt(async()=>{const{default:u}=await import("./pptxgen.es-BuAvOu_s.js");return{default:u}},__vite__mapDeps([0,1,2,3,4]))).default,c=new w;if(c.defineLayout({name:"QUIZZARD",width:10,height:7.5}),c.layout="QUIZZARD",x.includeMetadata){const u=c.addSlide();u.addText(n.title,{x:1,y:2,w:8,h:1.5,fontSize:36,bold:!0,align:"center"}),u.addText([{text:`Category: ${n.category}`,options:{breakLine:!0}},{text:`Difficulty: ${n.difficulty}`,options:{breakLine:!0}},{text:`Questions: ${n.rounds.flatMap(b=>b.questions).length}`,options:{breakLine:!0}}],{x:1,y:4,w:8,h:2,fontSize:18,align:"center"}),x.includePresenterNotes&&u.addNotes(`Quiz: ${n.title}
Total Questions: ${n.rounds.flatMap(b=>b.questions).length}
Estimated Duration: ${n.estimatedDuration} minutes`)}if(n.rounds.flatMap(u=>u.questions).forEach((u,b)=>{const g=c.addSlide(),z=b+1;if(g.addText(`Question ${z}`,{x:.5,y:.5,w:9,h:.8,fontSize:28,bold:!0,color:"1976D2"}),g.addText(u.question,{x:.5,y:1.5,w:9,h:1.5,fontSize:x.questionFontSize,bold:!0}),u.type==="text-answer")g.addText("Type your answer:",{x:1,y:3.5,w:8,h:.7,fontSize:x.optionFontSize,italic:!0,color:"666666"}),x.includePresenterNotes&&u.textAnswer&&g.addNotes(`Question ${z}
Expected Answer: ${u.textAnswer}${u.explanation?`
Explanation: ${u.explanation}`:""}`);else if(u.options.forEach((A,T)=>{const d=String.fromCharCode(65+T),y=T===u.correctAnswer;g.addText(`${d}. ${A}`,{x:1,y:3.5+T*.8,w:8,h:.7,fontSize:x.optionFontSize,bold:y,color:y?"4CAF50":"000000"})}),x.includePresenterNotes){const A=u.options[u.correctAnswer];let T=`Question ${z}
Correct Answer: ${A}`;u.explanation&&(T+=`
Explanation: ${u.explanation}`),u.points&&(T+=`
Points: ${u.points}`),g.addNotes(T)}if(u.mediaFile)try{u.mediaFile.type==="image"&&g.addImage({data:u.mediaFile.data,x:6,y:3,w:3,h:2.5,sizing:{type:"contain",w:3,h:2.5}})}catch(A){console.warn(`Failed to add media for question ${z}:`,A)}}),x.includeAnswerKey){const u=n.rounds.flatMap(b=>b.questions).filter(b=>b.type!=="text-answer");if(u.length>0){const b=c.addSlide();b.addText("Answer Key",{x:1,y:1,w:8,h:1,fontSize:32,bold:!0,align:"center"});const g=u.map((z,A)=>{const T=n.rounds.flatMap(C=>C.questions).indexOf(z)+1,d=z.correctAnswer,y=String.fromCharCode(65+d);return`${T}. ${y}`}).join(`
`);b.addText(g,{x:2,y:2.5,w:6,h:4,fontSize:18})}}const h=`${n.title.replace(/[^a-z0-9]/gi,"_")}_Quiz.pptx`;await c.writeFile({fileName:h})}catch(w){const c=w instanceof Error?w.message:"Failed to export quiz to PowerPoint";throw s(c),new Error(c)}finally{t(!1)}},[]),o=p.useCallback(async n=>{t(!0),s(null);try{const x=JSON.stringify(n,null,2),w=new Blob([x],{type:"application/json"}),c=URL.createObjectURL(w),h=document.createElement("a");h.href=c,h.download=`${n.title.replace(/[^a-z0-9]/gi,"_")}_Quiz.json`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(c)}catch(x){const w=x instanceof Error?x.message:"Failed to export quiz to JSON";throw s(w),new Error(w)}finally{t(!1)}},[]),l=p.useCallback(()=>{s(null)},[]);return{isExporting:i,exportError:r,exportToPowerPoint:a,exportToJSON:o,clearExportError:l,DEFAULT_EXPORT_SETTINGS:Ke}},Ls=()=>{const{quizzes:i,drafts:t,isLoading:r,storageUsage:s,autoSaveStatus:a,isInitialized:o,saveQuiz:l,deleteQuiz:n,enableAutoSave:x,disableAutoSave:w,refreshStorageUsage:c,loadQuizzes:h,loadDrafts:u}=at(),{exportToPowerPoint:b}=Rs(),{showSnackbar:g}=nt(),[z,A]=E.useState(!1),[T,d]=E.useState(!1),[y,C]=E.useState(null),[f,j]=E.useState(null),[k,R]=E.useState(null),[m,v]=E.useState(!1),[D,q]=E.useState(null),[U,K]=E.useState(!1),[we,O]=E.useState(null),ae=we;E.useEffect(()=>{ae&&A(!1)},[ae]),E.useEffect(()=>{s!=null&&s.isNearLimit&&K(!1)},[s==null?void 0:s.isNearLimit]);const oe=E.useCallback(()=>{A(!0),O(null)},[]),le=E.useCallback(()=>{K(!0)},[]),ke=E.useCallback(()=>{C(null),d(!0)},[]),Ie=E.useCallback(L=>{C(L),d(!0),j(null)},[]),Ee=E.useCallback(async L=>{try{const P={...L,status:"completed",updatedAt:new Date};if(await l(P))g(y?"Quiz updated successfully!":"Quiz created successfully!","success"),d(!1),C(null),w(),await c();else throw new Error("Failed to save quiz to storage")}catch(P){const ce=P instanceof Error?P.message:"Failed to save quiz";O(ce),g(ce,"error")}},[y,l,g,w,c]),$e=E.useCallback(()=>{d(!1),C(null),w()},[w]),W=E.useCallback(async L=>{try{await b(L,{includePresenterNotes:!0,slideTemplate:"standard",questionFontSize:20,answerFontSize:16,includeAnswerSlides:!0,includeQuizSummary:!0}),g("PowerPoint exported successfully!","success"),j(null)}catch(P){const ce=P instanceof Error?P.message:"Export failed";O(ce),g(ce,"error")}},[b,g]),fe=E.useCallback((L,P)=>{j(L.currentTarget),R(P)},[]),Me=E.useCallback(()=>{j(null),R(null)},[]),ut=E.useCallback(L=>{q(L),v(!0),j(null)},[]),ht=E.useCallback(async()=>{if(D)try{if(await n(D.id))g("Quiz deleted successfully!","success"),await c(),await h(),await u();else throw new Error("Failed to delete quiz from storage")}catch(L){const P=L instanceof Error?L.message:"Failed to delete quiz";O(P),g(P,"error")}finally{v(!1),q(null)}},[D,n,g,c,h,u]),mt=E.useCallback(()=>{v(!1),q(null)},[]),ft=E.useCallback(async()=>{try{const L=await H.clearAllStorage();if(L.success)g("All storage cleared successfully!","success"),await c(),await h(),await u();else throw new Error(L.error||"Failed to clear storage")}catch(L){const P=L instanceof Error?L.message:"Failed to clear storage";O(P),g(P,"error")}},[g,c,h,u]),pt=E.useCallback(async()=>{try{await c(),g("Storage information refreshed","info")}catch(L){const P=L instanceof Error?L.message:"Failed to refresh storage";O(P),g(P,"error")}},[c,g]);return E.useEffect(()=>{if(T&&y){const L={...y,status:"draft",lastSaved:new Date};x(L)}return()=>{T||w()}},[T,y,x,w]),{quizzes:i,drafts:t,isLoading:r,error:ae,storageUsage:s,isInitialized:o,state:{errorDismissed:z,isWizardOpen:T,editingQuiz:y,menuAnchorEl:f,selectedQuiz:k,deleteConfirmOpen:m,pendingDeleteQuiz:D,autoSaveStatus:a,storageWarningDismissed:U},actions:{dismissError:oe,dismissStorageWarning:le,handleCreateQuiz:ke,handleEditQuiz:Ie,handleQuizCreated:Ee,handleWizardCancel:$e,handleExportQuiz:W,handleMenuOpen:fe,handleMenuClose:Me,handleRequestDeleteQuiz:ut,handleConfirmDeleteQuiz:ht,handleCancelDeleteQuiz:mt,handleCleanupDrafts:ft,handleRefreshStorage:pt}}},_s=({initialQuiz:i})=>{const{quizzes:t,drafts:r,isLoading:s,error:a,state:o,actions:l,storageUsage:n}=Ls(),[x,w]=E.useState(!1),c=E.useMemo(()=>{const u=["general","sports","history","science","geography","entertainment","literature","art","music","technology","custom"],b=f=>typeof f=="string"&&u.includes(f)?f:"general",g=f=>typeof f=="string"&&["easy","medium","hard"].includes(f)?f:"medium",z=f=>{if(typeof f=="number"&&!isNaN(f))return Math.max(1,Math.min(1e3,f));if(f&&typeof f.valueOf=="function"){const j=f.valueOf();if(typeof j=="number"&&!isNaN(j))return Math.max(1,Math.min(1e3,j))}return 10},A=f=>{if(f instanceof Date)return f;if(typeof f=="string"||typeof f=="number"){const j=new Date(f);if(!isNaN(j.getTime()))return j}return new Date},T=f=>{const j={defaultTimeLimit:1,defaultPoints:1,defaultBreakingTime:5};return f&&typeof f=="object"?{defaultTimeLimit:typeof f.defaultTimeLimit=="number"?f.defaultTimeLimit:j.defaultTimeLimit,defaultPoints:typeof f.defaultPoints=="number"?f.defaultPoints:j.defaultPoints,defaultBreakingTime:typeof f.defaultBreakingTime=="number"?f.defaultBreakingTime:j.defaultBreakingTime}:j},d=f=>Array.isArray(f)?f.filter(j=>j&&typeof j=="object"):[],y=f=>Array.isArray(f)?f.filter(j=>typeof j=="string").slice(0,10):[],C=r.filter(f=>f&&f.id&&f.title).map(f=>({...f,id:String(f.id||""),title:String(f.title||"Untitled Draft"),description:String(f.description||"Draft quiz in progress..."),rounds:d(f.rounds),category:b(f.category),difficulty:g(f.difficulty),tags:y(f.tags),status:"draft",createdAt:A(f.createdAt),updatedAt:A(f.updatedAt),isDraft:!0,estimatedDuration:z(f.estimatedDuration),settings:T(f.settings)}));return[...t,...C].map(f=>({...f,id:String(f.id||""),title:String(f.title||"Untitled Quiz"),description:String(f.description||""),rounds:d(f.rounds),estimatedDuration:z(f.estimatedDuration),createdAt:A(f.createdAt),updatedAt:A(f.updatedAt),category:b(f.category),difficulty:g(f.difficulty),tags:y(f.tags),settings:T(f.settings)})).sort((f,j)=>new Date(j.updatedAt).getTime()-new Date(f.updatedAt).getTime())},[t,r]),h=c.length;return e.jsx(Vt,{fallback:e.jsx(re,{severity:"error",children:"Something went wrong in the quiz list. Please refresh the page."}),children:e.jsxs(_t,{maxWidth:"xl",sx:{py:3},children:[e.jsx(S,{mb:4,children:e.jsxs(Q,{variant:"h4",component:"h1",gutterBottom:!0,children:["My Quizzes (",h,")"]})}),a&&!o.errorDismissed&&e.jsx(re,{severity:"error",sx:{mb:3},action:e.jsx(te,{size:"small",onClick:l.dismissError,"aria-label":"Dismiss error",children:e.jsx(Te,{fontSize:"small"})}),children:a}),(n==null?void 0:n.isNearLimit)&&!o.storageWarningDismissed&&e.jsxs(re,{severity:"warning",sx:{mb:3},action:e.jsx(te,{size:"small",onClick:l.dismissStorageWarning,"aria-label":"Dismiss storage warning",children:e.jsx(Te,{fontSize:"small"})}),children:["Storage is nearly full (",(()=>{const u=n==null?void 0:n.usagePercentage;return typeof u=="number"&&!isNaN(u)?Math.round(Math.max(0,Math.min(100,u))):0})(),"% used). Consider cleaning up old drafts or exporting quizzes to free up space."]}),h>0&&e.jsxs(S,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(M,{variant:"contained",startIcon:e.jsx(ie,{}),onClick:l.handleCreateQuiz,sx:{borderRadius:2,textTransform:"none",fontWeight:600},children:[e.jsx(S,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:"Create New Quiz"}),e.jsx(S,{component:"span",sx:{display:{xs:"inline",sm:"none"}},children:"Create"})]}),e.jsx(M,{variant:"outlined",startIcon:e.jsx(it,{}),onClick:()=>w(!0),sx:{borderRadius:2,textTransform:"none",fontWeight:600},children:"Storage"})]}),e.jsx(Zt,{quizzes:c,isLoading:s,onCreateQuiz:l.handleCreateQuiz,onMenuOpen:l.handleMenuOpen,onExport:l.handleExportQuiz}),e.jsx(Ms,{selectedQuiz:o.selectedQuiz,menuAnchorEl:o.menuAnchorEl,editingQuiz:o.editingQuiz,isWizardOpen:o.isWizardOpen,deleteConfirmOpen:o.deleteConfirmOpen,pendingDeleteQuiz:o.pendingDeleteQuiz,onMenuClose:l.handleMenuClose,onEditQuiz:l.handleEditQuiz,onExportQuiz:l.handleExportQuiz,onRequestDeleteQuiz:l.handleRequestDeleteQuiz,onConfirmDeleteQuiz:l.handleConfirmDeleteQuiz,onCancelDeleteQuiz:l.handleCancelDeleteQuiz,onCreateQuiz:l.handleCreateQuiz,onWizardCancel:l.handleWizardCancel,onQuizCreated:l.handleQuizCreated}),e.jsx(Fs,{open:x,onClose:()=>w(!1),storageUsage:n,quizzes:c,draftsCount:r.length,onCleanupStorage:l.handleCleanupDrafts,onRefreshStorage:l.handleRefreshStorage})]})})};export{_s as Quizzes,_s as default};
//# sourceMappingURL=Quizzes-mt4FU8uI.js.map
